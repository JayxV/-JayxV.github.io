<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>2023 CryptoCTF | Van1sh的小屋</title>
  <meta name="keywords" content=" Write Up ">
  <meta name="description" content="2023 CryptoCTF | Van1sh的小屋">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="&amp;emsp;&amp;emsp; Van1sh，也用ID：V、Vanish，主要是有的网站昵称至少两个字符，Vanish也容易被注册&amp;emsp;现就读于杭州电子科技大学。是一只究极大菜鸡加懒狗。自2019.2.14的2019Hctf-Game接触CTF，由于零基础，目前还菜的一批，可能还会继续菜下去。现在还只会做一点Crypto方向的题，其他什么Web，Pwn，Reverse, Misc….俺都不知道。">
<meta property="og:type" content="website">
<meta property="og:title" content="Van1sh的小屋">
<meta property="og:url" content="http://jayxv.github.io/about/index.html">
<meta property="og:site_name" content="Van1sh的小屋">
<meta property="og:description" content="&amp;emsp;&amp;emsp; Van1sh，也用ID：V、Vanish，主要是有的网站昵称至少两个字符，Vanish也容易被注册&amp;emsp;现就读于杭州电子科技大学。是一只究极大菜鸡加懒狗。自2019.2.14的2019Hctf-Game接触CTF，由于零基础，目前还菜的一批，可能还会继续菜下去。现在还只会做一点Crypto方向的题，其他什么Web，Pwn，Reverse, Misc….俺都不知道。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-04-30T11:44:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Van1sh的小屋">
<meta name="twitter:description" content="&amp;emsp;&amp;emsp; Van1sh，也用ID：V、Vanish，主要是有的网站昵称至少两个字符，Vanish也容易被注册&amp;emsp;现就读于杭州电子科技大学。是一只究极大菜鸡加懒狗。自2019.2.14的2019Hctf-Game接触CTF，由于零基础，目前还菜的一批，可能还会继续菜下去。现在还只会做一点Crypto方向的题，其他什么Web，Pwn，Reverse, Misc….俺都不知道。">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/sublime.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1"></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.0.1"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value>
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>Van1sh</span>
</div>

<div class="icon">
    
        
    
        
        <a title="github" href="https://github.com/JayxV" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a title="email" href="mailto:643713081@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=643713081&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(67)</small></div></li>
    
        
            
            <li><div data-rel="比赛小屋">比赛小屋<small>(25)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="工具小屋">工具小屋<small>(5)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="合约小屋"><i class="fold iconfont icon-right"></i>合约小屋<small>(8)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="contract">contract<small>(6)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="区块链靶场">区块链靶场<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
            <li><div data-rel="密码小屋"><i class="fold iconfont icon-right"></i>密码小屋<small>(19)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="ECC">ECC<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Paillier">Paillier<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Lattice">Lattice<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Stream">Stream<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Knapsack">Knapsack<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Block">Block<small>(3)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Rsa">Rsa<small>(3)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="Basic">Basic<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="CTF">CTF<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="RSA">RSA<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="协议小屋">协议小屋<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Web小屋"><i class="fold iconfont icon-right"></i>Web小屋<small>(3)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="Files related">Files related<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="SQL">SQL<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="XSS">XSS<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="逆向小屋"><i class="fold iconfont icon-right"></i>逆向小屋<small>(1)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="patch">patch<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
            <li><div data-rel="论文小屋">论文小屋<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="漏洞小屋">漏洞小屋<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="小书屋">小书屋<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">关于</a><a style="width: 50%"  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="67">
<input type="hidden" id="yelog_site_word_count" value="328.7k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://www.fzwjscj.xyz/">fzwjscj</a></li>
            
            <li><a target="_blank" href="http://dldxz.cn/">DLDXZ</a></li>
            
            <li><a target="_blank" href="http://fanda.cloud/">fanda</a></li>
            
            <li><a target="_blank" href="http://passingfoam.com/">PassingFoam&#39;s blog</a></li>
            
            <li><a target="_blank" href="https://eqqie.cn/">赤道企鹅</a></li>
            
            <li><a target="_blank" href="http://blog.ragdoll.work/">咲夜南梦</a></li>
            
            <li><a target="_blank" href="https://www.zhaoj.in/">glzjin</a></li>
            
            <li><a target="_blank" href="https://coinc1dens.github.io/">Coinc1dens</a></li>
            
            <li><a target="_blank" href="http://blog.soreatu.com/">soreatu</a></li>
            
            <li><a target="_blank" href="http://www.ga1axy.top/">盖乐希</a></li>
            
            <li><a target="_blank" href="https://shawroot.cc/">Root.</a></li>
            
            <li><a target="_blank" href="https://l1near.top/">l1near</a></li>
            
            <li><a target="_blank" href="https://0xdktb.top/">0xDktb</a></li>
            
            <li><a target="_blank" href="https://www.wootec.top/">Reverier</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="以 in: 开头进行全文搜索" />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color4">Write Up</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">docker</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Sage</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">CTF</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">ECC</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Paillier</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">Crypto</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">TLS 1.2</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Web</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Files</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Serialization</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Basic</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">Lattice</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Dsa</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">LCG</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Rc4</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">SM4</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Knapsack</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">DES</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">差分密码分析</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Rsa</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">RE</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">continued_fraction</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">paper</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">small private exponent</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">SQL</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">python</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">操作模式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">number theory</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">Abstract algebra</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">SPN</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">线性密码分析</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">ETH</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">Shadowsocks</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Nmap</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">XSS</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Coppersmith’s Method</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">book</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a id="top" class=""
           href="/2023/08/14/微信公众号/"
           data-tag=""
           data-author="Van1sh" >
            <span class="post-title" title="关于微信公众号">关于微信公众号</span>
            <span class="post-date" title="2023-08-14 00:00:00">2023/08/14</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/08/14/2023 NepCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 NepCTF">2023 NepCTF</span>
            <span class="post-date" title="2023-08-14 12:00:00">2023/08/14</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/08/14/2023 CCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 CryptoCTF">2023 CryptoCTF</span>
            <span class="post-date" title="2023-08-14 00:00:00">2023/08/14</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/08/11/密码学基础之进制与编码/"
           data-tag="Basic"
           data-author="Van1sh" >
            <span class="post-title" title="密码学基础之进制与编码">密码学基础之进制与编码</span>
            <span class="post-date" title="2023-08-11 12:00:00">2023/08/11</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/08/11/2023 熵密杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 熵密杯">2023 熵密杯</span>
            <span class="post-date" title="2023-08-11 12:00:00">2023/08/11</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/08/04/密码学基础之抽象代数基础/"
           data-tag="Basic"
           data-author="Van1sh" >
            <span class="post-title" title="密码学基础之抽象代数基础">密码学基础之抽象代数基础</span>
            <span class="post-date" title="2023-08-04 12:00:00">2023/08/04</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/08/03/2023 ImaginaryCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 ImaginaryCTF">2023 ImaginaryCTF</span>
            <span class="post-date" title="2023-08-03 00:00:00">2023/08/03</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/07/24/2023 巅峰极客/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 巅峰极客-Rosita">2023 巅峰极客-Rosita</span>
            <span class="post-date" title="2023-07-24 01:00:00">2023/07/24</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/07/23/2023 DASCTF-0x401/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 DASCTF-0x401">2023 DASCTF-0x401</span>
            <span class="post-date" title="2023-07-23 00:00:00">2023/07/23</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2023/06/29/（我不懂）密码学系列之异或运算/"
           data-tag="Lattice"
           data-author="Van1sh" >
            <span class="post-title" title="（我不懂）密码学系列之异或运算">（我不懂）密码学系列之异或运算</span>
            <span class="post-date" title="2023-06-29 00:00:00">2023/06/29</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2023/06/15/2023 seectf/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2023 SEECTF">2023 SEECTF</span>
            <span class="post-date" title="2023-06-15 10:55:00">2023/06/15</span>
        </a>
        
        <a  class="漏洞小屋 "
           href="/2023/01/30/Shadowsocks Redirect Attack/"
           data-tag="Shadowsocks"
           data-author="Van1sh" >
            <span class="post-title" title="Shadowsocks Redirect Attack">Shadowsocks Redirect Attack</span>
            <span class="post-date" title="2023-01-30 17:14:00">2023/01/30</span>
        </a>
        
        <a  class="协议小屋 "
           href="/2022/12/15/TLS1.2协议分析（二）/"
           data-tag="TLS 1.2"
           data-author="Van1sh" >
            <span class="post-title" title="TLS 1.2 协议（二）">TLS 1.2 协议（二）</span>
            <span class="post-date" title="2022-12-15 10:24:00">2022/12/15</span>
        </a>
        
        <a  class="协议小屋 "
           href="/2022/12/08/TLS1.2协议分析（一）/"
           data-tag="TLS 1.2"
           data-author="Van1sh" >
            <span class="post-title" title="TLS 1.2 协议（一）">TLS 1.2 协议（一）</span>
            <span class="post-date" title="2022-12-08 21:10:00">2022/12/08</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2022/11/15/密码学学习笔记之连分数/"
           data-tag="continued_fraction"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记之连分数">密码学学习笔记之连分数</span>
            <span class="post-date" title="2022-11-15 17:59:00">2022/11/15</span>
        </a>
        
        <a  class="论文小屋 "
           href="/2022/10/17/Generalization of Some Attacks on RSA with Small Prime Combination and Small Private Exponent/"
           data-tag="paper,small private exponent"
           data-author="Van1sh" >
            <span class="post-title" title="Generalization of Some Attacks on RSA with Small Prime Combination and Small Private Exponent">Generalization of Some Attacks on RSA with Small Prime Combination and Small Private Exponent</span>
            <span class="post-date" title="2022-10-17 15:31:00">2022/10/17</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2022/09/14/2022 cryptoctf/"
           data-tag=""
           data-author="Van1sh" >
            <span class="post-title" title="2022 CryptoCTF">2022 CryptoCTF</span>
            <span class="post-date" title="2022-09-14 17:16:00">2022/09/14</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2022/08/30/2021 cryptoctf/"
           data-tag=""
           data-author="Van1sh" >
            <span class="post-title" title="2021 CryptoCTF">2021 CryptoCTF</span>
            <span class="post-date" title="2022-08-30 13:30:00">2022/08/30</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/06/29/区块链学习笔记之2022ACTF-bet2loss/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之2022ACTF—bet2loss">区块链学习笔记之2022ACTF—bet2loss</span>
            <span class="post-date" title="2022-06-29 15:23:00">2022/06/29</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/04/19/区块链学习笔记之2022starCTF/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之2022starCTF——TreasureHunter">区块链学习笔记之2022starCTF——TreasureHunter</span>
            <span class="post-date" title="2022-04-19 15:23:00">2022/04/19</span>
        </a>
        
        <a  class="合约小屋 区块链靶场 "
           href="/2022/03/08/区块链靶场刷题之cpaturetheether/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="cpature the ether">cpature the ether</span>
            <span class="post-date" title="2022-03-08 11:03:00">2022/03/08</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2022/02/28/2022 SUSCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2022 SUSCTF">2022 SUSCTF</span>
            <span class="post-date" title="2022-02-28 11:18:35">2022/02/28</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2022/02/22/2021TQLCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2022 TQLCTF">2022 TQLCTF</span>
            <span class="post-date" title="2022-02-22 22:22:22">2022/02/22</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/02/18/区块链学习笔记之BalsnCTF 2019 Bank/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之Balsn CTF 2019 - Bank">区块链学习笔记之Balsn CTF 2019 - Bank</span>
            <span class="post-date" title="2022-02-18 14:45:00">2022/02/18</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/02/15/区块链学习笔记之BalsnCTF 2020 IdleGame/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之BalsnCTF 2020 IdleGame">区块链学习笔记之BalsnCTF 2020 IdleGame</span>
            <span class="post-date" title="2022-02-15 15:39:00">2022/02/15</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/02/11/区块链学习笔记之paradigm-CTF babysandbox/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之paradigm-CTF babysandbox">区块链学习笔记之paradigm-CTF babysandbox</span>
            <span class="post-date" title="2022-02-11 16:22:00">2022/02/11</span>
        </a>
        
        <a  class="合约小屋 contract "
           href="/2022/01/23/区块链学习笔记之RealWorld体验赛/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之RealWorld体验赛——TransferFrom">区块链学习笔记之RealWorld体验赛——TransferFrom</span>
            <span class="post-date" title="2022-01-23 00:11:00">2022/01/23</span>
        </a>
        
        <a  class="合约小屋 "
           href="/2021/12/22/区块链学习笔记之初探以太坊/"
           data-tag="ETH"
           data-author="Van1sh" >
            <span class="post-title" title="区块链学习笔记之初探以太坊">区块链学习笔记之初探以太坊</span>
            <span class="post-date" title="2021-12-22 10:16:00">2021/12/22</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2021/08/23/2021 祥云杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2021 祥云杯">2021 祥云杯</span>
            <span class="post-date" title="2021-08-23 14:07:00">2021/08/23</span>
        </a>
        
        <a  class="密码小屋 Block "
           href="/2021/08/06/密码学学习笔记之线性分析入门篇——EzSPN/"
           data-tag="SPN,线性密码分析"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 线性分析入门篇——EzSPN">密码学学习笔记 之 线性分析入门篇——EzSPN</span>
            <span class="post-date" title="2021-08-06 09:24:25">2021/08/06</span>
        </a>
        
        <a  class="密码小屋 Block "
           href="/2021/07/16/密码学学习笔记之差分分析入门篇——四轮DES/"
           data-tag="DES,差分密码分析"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 差分分析入门篇——四轮DES">密码学学习笔记 之 差分分析入门篇——四轮DES</span>
            <span class="post-date" title="2021-07-16 09:24:25">2021/07/16</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2021/04/04/2021HFCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2021 HFCTF">2021 HFCTF</span>
            <span class="post-date" title="2021-04-04 11:02:47">2021/04/04</span>
        </a>
        
        <a  class="逆向小屋 patch "
           href="/2021/03/27/逆向学习笔记之drinkSomeTea/"
           data-tag="RE"
           data-author="Van1sh" >
            <span class="post-title" title="逆向学习笔记 之 drinkSomeTea">逆向学习笔记 之 drinkSomeTea</span>
            <span class="post-date" title="2021-03-27 19:22:00">2021/03/27</span>
        </a>
        
        <a  class="密码小屋 "
           href="/2021/01/01/密码学学习笔记之密码学随笔/"
           data-tag="Crypto"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 密码学随笔">密码学学习笔记 之 密码学随笔</span>
            <span class="post-date" title="2021-01-01 00:00:00">2021/01/01</span>
        </a>
        
        <a  class="密码小屋 RSA "
           href="/2020/12/18/密码学学习笔记之RSA的一些套路/"
           data-tag="Rsa"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 RSA的一些套路">密码学学习笔记 之 RSA的一些套路</span>
            <span class="post-date" title="2020-12-18 14:32:00">2020/12/18</span>
        </a>
        
        <a  class="密码小屋 CTF "
           href="/2020/12/18/密码学学习笔记之CTF/"
           data-tag="CTF"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 CTF">密码学学习笔记 之 CTF</span>
            <span class="post-date" title="2020-12-18 00:00:00">2020/12/18</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/12/10/2020RoarCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 RoarCTF">2020 RoarCTF</span>
            <span class="post-date" title="2020-12-10 10:00:00">2020/12/10</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/11/04/2020ByteCTF&X-NUCA部分密码学题解/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 ByteCTF&amp;X-NUCA">2020 ByteCTF&amp;X-NUCA</span>
            <span class="post-date" title="2020-11-04 10:00:00">2020/11/04</span>
        </a>
        
        <a  class="密码小屋 Rsa "
           href="/2020/08/13/密码学学习笔记之coppersmith/"
           data-tag="Coppersmith’s Method"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 Coppersmith’s Method">密码学学习笔记 之 Coppersmith’s Method</span>
            <span class="post-date" title="2020-08-13 10:00:00">2020/08/13</span>
        </a>
        
        <a  class="Web小屋 Files related "
           href="/2020/08/09/Web学习笔记之文件与序列化/"
           data-tag="Web,Files,Serialization"
           data-author="Van1sh" >
            <span class="post-title" title="Web学习笔记 之 文件与序列化">Web学习笔记 之 文件与序列化</span>
            <span class="post-date" title="2020-08-09 14:16:00">2020/08/09</span>
        </a>
        
        <a  class="Web小屋 SQL "
           href="/2020/08/07/Web学习笔记之SQL注入/"
           data-tag="Web,SQL"
           data-author="Van1sh" >
            <span class="post-title" title="Web学习笔记 之 SQL注入">Web学习笔记 之 SQL注入</span>
            <span class="post-date" title="2020-08-07 13:18:00">2020/08/07</span>
        </a>
        
        <a  class="Web小屋 XSS "
           href="/2020/07/26/Web学习笔记之XSS/"
           data-tag="Web,XSS"
           data-author="Van1sh" >
            <span class="post-title" title="Web学习笔记 之 XSS">Web学习笔记 之 XSS</span>
            <span class="post-date" title="2020-07-26 10:44:00">2020/07/26</span>
        </a>
        
        <a  class="密码小屋 Knapsack "
           href="/2020/06/08/密码学学习笔记之knapsack/"
           data-tag="Knapsack"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 knapsack">密码学学习笔记 之 knapsack</span>
            <span class="post-date" title="2020-06-08 10:30:43">2020/06/08</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/26/2020BJD3rd/"
           data-tag="Write Up"
           data-author="Van1sh &amp; FzWjScJ" >
            <span class="post-title" title="2020 BJD3rd">2020 BJD3rd</span>
            <span class="post-date" title="2020-05-26 16:00:47">2020/05/26</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/24/2020GKCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 GKCTF">2020 GKCTF</span>
            <span class="post-date" title="2020-05-24 17:05:00">2020/05/24</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2020/05/20/sage常用命令/"
           data-tag="Sage"
           data-author="Van1sh" >
            <span class="post-title" title="sage常用命令">sage常用命令</span>
            <span class="post-date" title="2020-05-20 11:22:00">2020/05/20</span>
        </a>
        
        <a  class="密码小屋 Paillier "
           href="/2020/05/14/密码学学习笔记之paillier cryptosystem/"
           data-tag="Paillier"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 paillier cryptosystem">密码学学习笔记 之 paillier cryptosystem</span>
            <span class="post-date" title="2020-05-14 11:00:19">2020/05/14</span>
        </a>
        
        <a  class="密码小屋 Lattice "
           href="/2020/05/12/密码学学习笔记之HNP/"
           data-tag="Lattice,Dsa,LCG"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 HNP">密码学学习笔记 之 HNP</span>
            <span class="post-date" title="2020-05-12 10:00:57">2020/05/12</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/10/2020网鼎杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 网鼎杯">2020 网鼎杯</span>
            <span class="post-date" title="2020-05-10 21:15:00">2020/05/10</span>
        </a>
        
        <a  class="密码小屋 ECC "
           href="/2020/05/07/密码学学习笔记之NCCIP/"
           data-tag="ECC"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 NCCIP">密码学学习笔记 之 NCCIP</span>
            <span class="post-date" title="2020-05-07 10:30:43">2020/05/07</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/05/05/2020De1CTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 De1CTF">2020 De1CTF</span>
            <span class="post-date" title="2020-05-05 15:57:00">2020/05/05</span>
        </a>
        
        <a  class="密码小屋 Block "
           href="/2020/03/03/密码学学习笔记之分组密码操作模式/"
           data-tag="操作模式"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 分组密码操作模式">密码学学习笔记 之 分组密码操作模式</span>
            <span class="post-date" title="2020-03-03 15:15:00">2020/03/03</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2020/02/18/2020hgame_week1/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2020 hgame week1">2020 hgame week1</span>
            <span class="post-date" title="2020-02-18 16:22:35">2020/02/18</span>
        </a>
        
        <a  class="密码小屋 Stream "
           href="/2020/01/30/密码学学习笔记之RC4与SM4/"
           data-tag="Rc4,SM4"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 RC4与SM4">密码学学习笔记 之 RC4与SM4</span>
            <span class="post-date" title="2020-01-30 00:05:00">2020/01/30</span>
        </a>
        
        <a  class="密码小屋 Rsa "
           href="/2019/12/04/密码学学习笔记之浅析On r-th Root Extraction Algorithm in Fq/"
           data-tag="Rsa"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 浅析On r-th Root Extraction Algorithm in Fq">密码学学习笔记 之 浅析On r-th Root Extraction Algorithm in Fq</span>
            <span class="post-date" title="2019-12-04 14:30:46">2019/12/04</span>
        </a>
        
        <a  class="密码小屋 Basic "
           href="/2019/12/03/密码学学习笔记之数论四大定理及应用/"
           data-tag="number theory,Abstract algebra"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 数论四大定理及应用">密码学学习笔记 之 数论四大定理及应用</span>
            <span class="post-date" title="2019-12-03 15:30:25">2019/12/03</span>
        </a>
        
        <a  class="密码小屋 Rsa "
           href="/2019/11/11/密码学学习笔记之浅析Pollard's rho algorithm及其应用/"
           data-tag="Rsa"
           data-author="Van1sh" >
            <span class="post-title" title="密码学学习笔记 之 浅析Pollard&#39;s rho algorithm及其应用">密码学学习笔记 之 浅析Pollard&#39;s rho algorithm及其应用</span>
            <span class="post-date" title="2019-11-11 15:32:00">2019/11/11</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/11/08/2019UNCTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 UNCTF">2019 UNCTF</span>
            <span class="post-date" title="2019-11-08 11:30:30">2019/11/08</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/11/01/docker和docker-compose的安装/"
           data-tag="docker"
           data-author="Van1sh" >
            <span class="post-title" title="安装Docker 和 Docker-Compose以及docker images的制作及上传">安装Docker 和 Docker-Compose以及docker images的制作及上传</span>
            <span class="post-date" title="2019-11-01 21:00:00">2019/11/01</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/09/12/Linux 基础/"
           data-tag="Linux"
           data-author="Vanish" >
            <span class="post-title" title="Linux 基础">Linux 基础</span>
            <span class="post-date" title="2019-09-12 00:17:00">2019/09/12</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/08/29/2019第五空间/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 第五空间">2019 第五空间</span>
            <span class="post-date" title="2019-08-29 12:18:35">2019/08/29</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/08/27/2019OGeek/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 OGeek">2019 OGeek</span>
            <span class="post-date" title="2019-08-27 11:02:35">2019/08/27</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/08/03/2019De1CTF/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 De1CTF">2019 De1CTF</span>
            <span class="post-date" title="2019-08-03 22:14:55">2019/08/03</span>
        </a>
        
        <a  class="小书屋 "
           href="/2019/08/02/三体/"
           data-tag="book"
           data-author="Van1sh" >
            <span class="post-title" title="三体">三体</span>
            <span class="post-date" title="2019-08-02 12:56:00">2019/08/02</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/07/22/nmap/"
           data-tag="Nmap"
           data-author="Van1sh" >
            <span class="post-title" title="初遇Nmap">初遇Nmap</span>
            <span class="post-date" title="2019-07-22 16:07:55">2019/07/22</span>
        </a>
        
        <a  class="工具小屋 "
           href="/2019/07/21/python 正则/"
           data-tag="python"
           data-author="Van1sh" >
            <span class="post-title" title="python 之 正则">python 之 正则</span>
            <span class="post-date" title="2019-07-21 22:30:35">2019/07/21</span>
        </a>
        
        <a  class="比赛小屋 "
           href="/2019/07/15/2019赛博杯/"
           data-tag="Write Up"
           data-author="Van1sh" >
            <span class="post-title" title="2019 赛博杯">2019 赛博杯</span>
            <span class="post-date" title="2019-07-15 16:22:35">2019/07/15</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-2023 CCTF" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">2023 CryptoCTF</h1>
    
    <div class="article-meta">
        
        
        <span class="author"><a>Van1sh</a></span>
        
        
        <span class="book">
            
                <a  data-rel="比赛小屋">比赛小屋</a>
            
        </span>
        
        
        <span class="tag">
            
            <a class="color4">Write Up</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2023-08-14 20:34:35'>2023-08-14 00:00</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:16.5k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Easy"><span class="toc-text">Easy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Did-it"><span class="toc-text">Did it!</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Suction"><span class="toc-text">Suction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Blue-Office"><span class="toc-text">Blue_Office</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Medium"><span class="toc-text">Medium</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Derik"><span class="toc-text">Derik</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#barak"><span class="toc-text">barak</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EllipticCurve-from-cubic-F-P-None-morphism-True"><span class="toc-text">EllipticCurve_from_cubic(F, P=None, morphism=True)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RISK"><span class="toc-text">RISK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Roldy"><span class="toc-text">Roldy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Insights"><span class="toc-text">Insights</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#非预期"><span class="toc-text">非预期</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Resuction"><span class="toc-text">Resuction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Blobfish"><span class="toc-text">Blobfish</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ASIv1"><span class="toc-text">ASIv1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TPSD"><span class="toc-text">TPSD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trex"><span class="toc-text">Trex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Keymote"><span class="toc-text">Keymote</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bertrand"><span class="toc-text">Bertrand</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hard"><span class="toc-text">Hard</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Big"><span class="toc-text">Big</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Byeween"><span class="toc-text">Byeween</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Majan"><span class="toc-text">Majan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vinefruit"><span class="toc-text">Vinefruit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shevid"><span class="toc-text">Shevid</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tough"><span class="toc-text">Tough</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Slowsum"><span class="toc-text">Slowsum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ASIv2"><span class="toc-text">ASIv2</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Easy"><a href="#Easy" class="headerlink" title="Easy"></a>Easy</h2><h3 id="Did-it"><a href="#Did-it" class="headerlink" title="Did it!"></a>Did it!</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">die</span><span class="params">(*args)</span>:</span></span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pr</span><span class="params">(*args)</span>:</span></span><br><span class="line">	s = <span class="string">" "</span>.join(map(str, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">"\n"</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sc</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">did</span><span class="params">(n, l, K, A)</span>:</span></span><br><span class="line">	A, K = set(A), set(K)</span><br><span class="line">	R = [pow(_, <span class="number">2</span>, n) + randint(<span class="number">0</span>, <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> A - K]</span><br><span class="line">	<span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	border = <span class="string">"+"</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">".::   Hi all, she DID it, you should do it too! Are you ready? ::.  "</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	_flag = <span class="literal">False</span></span><br><span class="line">	n, l = <span class="number">127</span>, <span class="number">20</span></span><br><span class="line">	N = set(list(range(<span class="number">0</span>, n)))</span><br><span class="line">	K = [randint(<span class="number">0</span>, n<span class="number">-1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(l)]</span><br><span class="line">	cnt, STEP = <span class="number">0</span>, <span class="number">2</span> * n // l - <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		ans = sc().decode().strip()</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			_A = [int(_) <span class="keyword">for</span> _  <span class="keyword">in</span> ans.split(<span class="string">','</span>)]</span><br><span class="line">			<span class="keyword">if</span> len(_A) &lt;= l <span class="keyword">and</span> set(_A).issubset(N):</span><br><span class="line">				DID = did(n, l, K, _A)</span><br><span class="line">				pr(border, <span class="string">f'DID = <span class="subst">&#123;DID&#125;</span>'</span>)</span><br><span class="line">				<span class="keyword">if</span> set(_A) == set(K):</span><br><span class="line">					_flag = <span class="literal">True</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				die(border, <span class="string">'Exception! Bye!!'</span>)</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			die(border, <span class="string">'Your input is not valid! Bye!!'</span>)</span><br><span class="line">		<span class="keyword">if</span> _flag:</span><br><span class="line">			die(border, <span class="string">f'Congrats! the flag: <span class="subst">&#123;flag&#125;</span>'</span>)</span><br><span class="line">		<span class="keyword">if</span> cnt &gt; STEP:</span><br><span class="line">			die(border, <span class="string">f'Too many tries, bye!'</span>)</span><br><span class="line">		cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>

<p>题目描述起来很简单，即使服务端生成一个有 20 个元素的集合 K，然后你有 11 次机会去猜。你可以输出一个集合 A，服务端会计算集合 $A-K$，并对其中的每一个元素进行计算并返回 ${2^i+j|i\in K-1,j \in (0,1)}$</p>
<p>如果我们有无限次机会，那我们就可以一个一个元素猜，如果返回空集，那么说明我们猜对了。</p>
<p>不过我们只有11次机会，一共有127个元素，因此我们可以一次猜 12 个元素，然后根据返回的集合，我们对这次猜的12个元素，计算 $2^i,2^i+1$，如果它存在于返回的集合中，说明这个元素不在 K 里，舍弃。（不过由于实在模 127 下的计算，不排除有 “误杀” 的情况，因此我们可以一次多输入几个元素，这样能多几次判断。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    sh = remote(<span class="string">"00.cr.yp.toc.tf"</span>,<span class="number">11337</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">"ready?"</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">"+++\n"</span>)</span><br><span class="line">    n=<span class="number">127</span></span><br><span class="line">    A = [] </span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> range(<span class="number">11</span>):</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">1</span>):</span><br><span class="line">            reques = <span class="string">','</span>.join(str( (_ + <span class="number">15</span>*l)%<span class="number">127</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">20</span>))</span><br><span class="line">            sh.sendline(reques)</span><br><span class="line">            sh.recvuntil(<span class="string">"+ DID = "</span>)</span><br><span class="line">            res = sh.recvuntil(<span class="string">"\n"</span>)[:<span class="number">-1</span>]</span><br><span class="line">            res = eval(res)</span><br><span class="line">        <span class="comment">#print(res)</span></span><br><span class="line">            <span class="keyword">for</span> tries <span class="keyword">in</span> [(_ + <span class="number">15</span>*l)%<span class="number">127</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">20</span>)]:</span><br><span class="line">                <span class="keyword">if</span> (pow(tries,<span class="number">2</span>,n) <span class="keyword">not</span> <span class="keyword">in</span> res) <span class="keyword">and</span> (pow(tries,<span class="number">2</span>,n)+<span class="number">1</span> <span class="keyword">not</span> <span class="keyword">in</span> res) <span class="keyword">and</span> tries <span class="keyword">not</span> <span class="keyword">in</span> A:</span><br><span class="line">                    A.append(tries)</span><br><span class="line">        print(len(A),A)</span><br><span class="line">        <span class="keyword">if</span> len(A) == <span class="number">20</span>:</span><br><span class="line">            reques = <span class="string">','</span>.join(str(_) <span class="keyword">for</span> _ <span class="keyword">in</span> A)</span><br><span class="line">            sh.sendline(reques)</span><br><span class="line">            sh.interactive()</span><br><span class="line">    sh.close()</span><br><span class="line">    </span><br><span class="line">+ DID = []</span><br><span class="line">+ Congrats! the flag: CCTF&#123;W4rM_Up_CrYpt0_Ch4Ll3n9e!!&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Suction"><a href="#Suction" class="headerlink" title="Suction"></a>Suction</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span><span class="params">(nbit, r)</span>:</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		p, q = [getPrime(nbit) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">'__'</span>]</span><br><span class="line">		e, n = getPrime(<span class="number">16</span>), p * q</span><br><span class="line">		phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">if</span> GCD(e, phi) == <span class="number">1</span>:</span><br><span class="line">			N = bin(n)[<span class="number">2</span>:-r]</span><br><span class="line">			E = bin(e)[<span class="number">2</span>:-r]</span><br><span class="line">			PKEY = N + E</span><br><span class="line">			pkey = (n, e)</span><br><span class="line">			<span class="keyword">return</span> PKEY, pkey</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(msg, pkey, r)</span>:</span></span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	n, e = pkey</span><br><span class="line">	c = pow(m, e, n)</span><br><span class="line">	C = bin(c)[<span class="number">2</span>:-r]</span><br><span class="line">	<span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line">r, nbit = <span class="number">8</span>, <span class="number">128</span></span><br><span class="line">PKEY, pkey = keygen(nbit, r)</span><br><span class="line">print(<span class="string">f'PKEY = <span class="subst">&#123;int(PKEY, <span class="number">2</span>)&#125;</span>'</span>)</span><br><span class="line">FLAG = flag.lstrip(<span class="string">b'CCTF&#123;'</span>).rstrip(<span class="string">b'&#125;'</span>)</span><br><span class="line">enc = encrypt(FLAG, pkey, r)</span><br><span class="line">print(<span class="string">f'enc = <span class="subst">&#123;int(enc, <span class="number">2</span>)&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>

<p>题目就是一个标准的 RSA，p,q 很短只有 128 bit。不过给出的信息中，密文和公钥对的低 8 bit 都被隐藏了。那就进行一个破的爆， </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">m = (<span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396672</span>&gt;&gt;<span class="number">8</span>)&lt;&lt;<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> sieve_base:</span><br><span class="line">        <span class="keyword">if</span> (m+i)%each == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(m+i)</span><br><span class="line"></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396571</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396573</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396577</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396583</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396589</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396603</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396613</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396633</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396643</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396667</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396723</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396751</span></span><br><span class="line"><span class="number">55208723145458976481271800608918815438075571763947979755496510859604544396783</span></span><br></pre></td></tr></table></figure>

<p>然后去factordb查了一下，发现 <code>55208723145458976481271800608918815438075571763947979755496510859604544396613</code> 的两个因子是一样长的，因此就决定是他了。</p>
<p>然后就是直接爆破 e 和 c 尝试进行解密了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">p=<span class="number">188473222069998143349386719941755726311</span></span><br><span class="line">q=<span class="number">292926085409388790329114797826820624883</span></span><br><span class="line">n=p*q</span><br><span class="line">c=<span class="number">127194641882350916936065994389482700479720132804140137082316257506737630761</span></span><br><span class="line">phi = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        e = (<span class="number">128</span>&lt;&lt;<span class="number">8</span>)+i</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            tmpc = (c&lt;&lt;<span class="number">8</span>)+j</span><br><span class="line">            d = inverse(e,phi)</span><br><span class="line">            m = int(pow(tmpc,d,n))</span><br><span class="line">            <span class="keyword">if</span> m&lt;<span class="number">2</span>^<span class="number">200</span>:</span><br><span class="line">                print(long_to_bytes(m))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="string">b'6oRYGy&amp;Dc$G2ZS'</span></span><br></pre></td></tr></table></figure>

<h3 id="Blue-Office"><a href="#Blue-Office" class="headerlink" title="Blue_Office"></a>Blue_Office</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/enc python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> seed, flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_seed</span><span class="params">(s)</span>:</span></span><br><span class="line">	i, j, k = <span class="number">0</span>, len(s), <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> i &lt; j:</span><br><span class="line">		k = k + ord(s[i])</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> i &lt; j:</span><br><span class="line">		<span class="keyword">if</span> (i % <span class="number">2</span>) != <span class="number">0</span>:</span><br><span class="line">			k = k - (ord(s[i]) * (j - i + <span class="number">1</span>))            </span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			k = k + (ord(s[i]) * (j - i + <span class="number">1</span>))</span><br><span class="line">	</span><br><span class="line">		k = k % <span class="number">2147483647</span></span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">	k = (k * j) % <span class="number">2147483647</span></span><br><span class="line">	<span class="keyword">return</span> k</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reseed</span><span class="params">(s)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> s * <span class="number">214013</span> + <span class="number">2531011</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(s, msg)</span>:</span></span><br><span class="line">	<span class="keyword">assert</span> s &lt;= <span class="number">2</span>**<span class="number">32</span></span><br><span class="line">	c, d = <span class="number">0</span>, s</span><br><span class="line">	enc, l = <span class="string">b''</span>, len(msg)</span><br><span class="line">	<span class="keyword">while</span> c &lt; l:</span><br><span class="line">		d = reseed(d)</span><br><span class="line">		enc += (msg[c] ^ ((d &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>)).to_bytes(<span class="number">1</span>, <span class="string">'big'</span>)</span><br><span class="line">		c += <span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line">enc = encrypt(seed, flag)</span><br><span class="line">print(<span class="string">f'enc = <span class="subst">&#123;binascii.hexlify(enc)&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>

<p>题目内容也是很简单，有点类似于使用流密码对密文进行一个逐字节的加密，不过这里的区别于 LCG 的地方在于这里没有模数，而且加密使用的密钥为 <code>(d &gt;&gt; 16) &amp; 0xff)</code> ，从低往高第 16-24 比特。</p>
<p>那么注意到 <code>(d &gt;&gt; 16) &amp; 0xff)</code> 其实等价于 $(d \mod {2^{24}})//16$，所以整个运算（包括密钥流的生成）都可以看做是再模 $2^{24}$ 下进行的，又因为我们知道 flag 的格式，开头是一个 ‘C’，于是我们先计算出<code>(d &gt;&gt; 16) &amp; 0xff)</code>，然后再爆破一下低 16 位就可以了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reseed</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(s, msg)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">enc =  <span class="string">'b0cb631639f8a5ab20ff7385926383f89a71bbc4ed2d57142e05f39d434fce'</span></span><br><span class="line">enc = bytes.fromhex(enc)</span><br><span class="line">s = ord(<span class="string">'C'</span>)^<span class="number">0xb0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> range(<span class="number">2</span>**<span class="number">16</span>):</span><br><span class="line">	seed = (s&lt;&lt;<span class="number">16</span>)+e</span><br><span class="line">	flag = encrypt(seed,enc[<span class="number">1</span>:])</span><br><span class="line">	<span class="keyword">if</span> <span class="string">b"CTF"</span> <span class="keyword">in</span> flag:</span><br><span class="line">		print(<span class="string">f'enc = C<span class="subst">&#123;flag.decode()&#125;</span>'</span>)</span><br><span class="line">		<span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h2><h3 id="Derik"><a href="#Derik" class="headerlink" title="Derik"></a>Derik</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> C, e, d, p, q, r, flag</span><br><span class="line"></span><br><span class="line">O = [<span class="number">1391526622949983</span>, <span class="number">2848691279889518</span>, <span class="number">89200900157319</span>, <span class="number">31337</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> isPrime(e) <span class="keyword">and</span> isPrime(d) <span class="keyword">and</span> isPrime(p) <span class="keyword">and</span> isPrime(q) <span class="keyword">and</span> isPrime(r)</span><br><span class="line"><span class="keyword">assert</span> C[<span class="number">0</span>] * p - C[<span class="number">1</span>] * q &gt;= <span class="number">0</span></span><br><span class="line"><span class="keyword">assert</span> C[<span class="number">2</span>] * q - C[<span class="number">3</span>] * r &gt;= <span class="number">0</span></span><br><span class="line"><span class="keyword">assert</span> C[<span class="number">4</span>] * r - C[<span class="number">5</span>] * p &gt;= <span class="number">0</span></span><br><span class="line"><span class="keyword">assert</span> (C[<span class="number">0</span>] * p - C[<span class="number">1</span>] * q) ** e + (C[<span class="number">2</span>] * q - C[<span class="number">3</span>] * r) ** e + (C[<span class="number">4</span>] * r - C[<span class="number">5</span>] * p) ** e == d * (C[<span class="number">0</span>] * p - C[<span class="number">1</span>] * q) * (C[<span class="number">2</span>] * q - C[<span class="number">3</span>] * r) * (C[<span class="number">4</span>] * r - C[<span class="number">5</span>] * p)</span><br><span class="line"><span class="keyword">assert</span> C[<span class="number">6</span>] * e - C[<span class="number">7</span>] * d == O[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">n = e * d * p * q * r</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = pow(m, <span class="number">65537</span>, n)</span><br><span class="line">print(<span class="string">f'C = <span class="subst">&#123;C&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'c = <span class="subst">&#123;c&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>

<p>还是基于 RSA，n 的各个因子被疯狂约束</p>
<p>$(c_0 p -c_1q)^e+(c_2 q -c_3r)^e+(c_4 r -c_5p)^e=d(c_0p-c_1q)(c_2 q -c_3r)(c_4 r -c_5p)$</p>
<p>式子两边要齐次，因此这个 $e$ 应该是 $3$，又因为  $c_6e-c_7d=o_3$，所以这个 $d= 73$，确实是个素数。</p>
<p>于是我们得到式子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(c0*p - c1*q)^<span class="number">3</span> + (c2*q - c3*r)^<span class="number">3</span> + (c4*p - c5*r)^<span class="number">3</span>  == <span class="number">73</span>*(c0*p - c1*q)*(c2*q - c3*r)*(c4*p - c5*r)</span><br></pre></td></tr></table></figure>

<p>好像并没有什么头绪，这个时候我们注意到列表 O 里面的数字好像都没有用到，于是尝试一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> O[<span class="number">0</span>]^<span class="number">3</span>+O[<span class="number">1</span>]^<span class="number">3</span>+O[<span class="number">2</span>]^<span class="number">3</span> == <span class="number">73</span> * O[<span class="number">0</span>]* O[<span class="number">1</span>]* O[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<p>（对上出题人脑电波了）发现能通过，于是我们就有新的约束了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from secret import C, e, d, p, q, r, flag</span></span><br><span class="line"></span><br><span class="line">O = [<span class="number">1391526622949983</span>, <span class="number">2848691279889518</span>, <span class="number">89200900157319</span>, <span class="number">31337</span>]</span><br><span class="line">C = [<span class="number">5960650533801939766973431801711817334521794480800845853788489396583576739362531091881299990317357532712965991685855356736023156123272639095501827949743772</span>, <span class="number">6521307334196962312588683933194431457121496634106944587943458360009084052009954473233805656430247044180398241991916007097053259167347016989949709567530079</span>, <span class="number">1974144590530162761749719653512492399674271448426179161347522113979158665904709425021321314572814344781742306475435350045259668002944094011342611452228289</span>, <span class="number">2613994669316609213059728351496129310385706729636898358367479603483933513667486946164472738443484347294444234222189837370548518512002145671578950835894451</span>, <span class="number">8127380985210701021743355783483366664759506587061015828343032669060653534242331741280215982865084745259496501567264419306697788067646135512747952351628613</span>, <span class="number">5610271406291656026350079703507496574797593266125358942992954619413518379131260031910808827754539354830563482514244310277292686031300804846114623378588204</span>, <span class="number">10543</span>, <span class="number">4</span>]</span><br><span class="line">c = <span class="number">80607532565510116966388633842290576008441185412513199071132245517888982730482694498575603226192340250444218146275844981580541820190393565327655055810841864715587561905777565790204415381897361016717820490400344469662479972681922265843907711283466105388820804099348169127917445858990935539611525002789966360469324052731259957798534960845391898385316664884009395500706952606508518095360995300436595374193777531503846662413864377535617876584843281151030183895735511854</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">d = (C[<span class="number">6</span>] * e - O[<span class="number">3</span>]) // C[<span class="number">7</span>]</span><br><span class="line"></span><br><span class="line">var(<span class="string">'p,q,r'</span>)</span><br><span class="line">f1 = C[<span class="number">0</span>] * p - C[<span class="number">1</span>] * q - O[<span class="number">0</span>]</span><br><span class="line">f2 = C[<span class="number">2</span>] * q - C[<span class="number">3</span>] * r - O[<span class="number">1</span>]</span><br><span class="line">f3 = C[<span class="number">4</span>] * r - C[<span class="number">5</span>] * p - O[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">m = solve([f1,f2,f3],p,q,r)</span><br><span class="line">p = m[<span class="number">0</span>][<span class="number">0</span>].rhs()</span><br><span class="line">q = m[<span class="number">0</span>][<span class="number">1</span>].rhs()</span><br><span class="line">r = m[<span class="number">0</span>][<span class="number">2</span>].rhs()</span><br><span class="line"></span><br><span class="line">phi = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)*(r<span class="number">-1</span>)*(e<span class="number">-1</span>)*(d<span class="number">-1</span>)</span><br><span class="line">m = pow(c,inverse(<span class="number">65537</span>,int(phi)),p*q*r*e*d)</span><br><span class="line">print(long_to_bytes(int(m)))</span><br></pre></td></tr></table></figure>

<h3 id="barak"><a href="#barak" class="headerlink" title="barak"></a>barak</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_barak</span><span class="params">(P, E)</span>:</span></span><br><span class="line">	c, d, p = E</span><br><span class="line">	x, y = P</span><br><span class="line">	<span class="keyword">return</span> (x**<span class="number">3</span> + y**<span class="number">3</span> + c - d*x*y) % p == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_barak</span><span class="params">(P, Q, E)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> P == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">		<span class="keyword">return</span> Q</span><br><span class="line">	<span class="keyword">if</span> Q == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">		<span class="keyword">return</span> P</span><br><span class="line">	<span class="keyword">assert</span> on_barak(P, E) <span class="keyword">and</span> on_barak(Q, E)</span><br><span class="line">	x1, y1 = P</span><br><span class="line">	x2, y2 = Q</span><br><span class="line">	<span class="keyword">if</span> P == Q:</span><br><span class="line">		x3 = y1 * (c - x1**<span class="number">3</span>) * inverse(x1**<span class="number">3</span> - y1**<span class="number">3</span>, p) % p</span><br><span class="line">		y3 = x1 * (y1**<span class="number">3</span> - c) * inverse(x1**<span class="number">3</span> - y1**<span class="number">3</span>, p) % p</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">		x3 = (y1**<span class="number">2</span>*x2 - y2**<span class="number">2</span>*x1) * inverse(x2*y2 - x1*y1, p) % p</span><br><span class="line">		y3 = (x1**<span class="number">2</span>*y2 - x2**<span class="number">2</span>*y1) * inverse(x2*y2 - x1*y1, p) % p</span><br><span class="line">	<span class="keyword">return</span> (x3, y3)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul_barak</span><span class="params">(m, P, E)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> P == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">		<span class="keyword">return</span> P</span><br><span class="line">	R = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">while</span> m != <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">if</span> m &amp; <span class="number">1</span>:</span><br><span class="line">			R = add_barak(R, P, E)</span><br><span class="line">		m = m &gt;&gt; <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> m != <span class="number">0</span>:</span><br><span class="line">			P = add_barak(P, P, E)</span><br><span class="line">	<span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rand_barak</span><span class="params">(E)</span>:</span></span><br><span class="line">	c, d, p = E</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		y = randint(<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">		K = Zmod(p)</span><br><span class="line">		P.&lt;x&gt; = PolynomialRing(K) </span><br><span class="line">		f = x**<span class="number">3</span> - d*x*y + c + y^<span class="number">3</span></span><br><span class="line">		R = f.roots()</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			r = R[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">			<span class="keyword">return</span> (r, y)</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">73997272456239171124655017039956026551127725934222347</span></span><br><span class="line">d = <span class="number">68212800478915688445169020404812347140341674954375635</span></span><br><span class="line">c = <span class="number">1</span></span><br><span class="line">E = (c, d, p)</span><br><span class="line"></span><br><span class="line">P = rand_barak(E)</span><br><span class="line"></span><br><span class="line">FLAG = flag.lstrip(<span class="string">b'CCTF&#123;'</span>).rstrip(<span class="string">b'&#125;'</span>)</span><br><span class="line">m = bytes_to_long(FLAG) </span><br><span class="line"><span class="keyword">assert</span> m &lt; p</span><br><span class="line">Q = mul_barak(m, P, E)</span><br><span class="line">print(<span class="string">f'P = <span class="subst">&#123;P&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'Q = <span class="subst">&#123;Q&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>

<p>题目构造的曲线为 $y^3 \equiv -x^3+dxy-c \pmod p$</p>
<p>然后给出曲线参数和曲线上的两个点 $P,Q=mP$，其中 $m$ 为 flag，因此是一个在该曲线上的 DLP。</p>
<p>以往这种题一般是想办法找到同态，但是我脑子不好，遇到这种题一般都想不出来。但是从春哥那学到了一种能调sagemath包的新姿势</p>
<p>首先想办法把式子构造成其次且具有三个变量的三次多项式，于是这里我们增加一个变量 $z$，将式子变为<br>$$<br>y^3 \equiv  -x^3+dxyz-cz^3 \pmod p<br>$$<br>当 $z=1$ 的时候就是我们原来的曲线</p>
<p>然后我们调一手 <code>EllipticCurve_from_cubic</code>，然后就可以调 DLP 了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">73997272456239171124655017039956026551127725934222347</span></span><br><span class="line">d = <span class="number">68212800478915688445169020404812347140341674954375635</span></span><br><span class="line">R.&lt;x,y,z&gt; = Zmod(p)[]</span><br><span class="line">cubic = x^<span class="number">3</span>+y^<span class="number">3</span>-d*x*y*z+z^<span class="number">3</span></span><br><span class="line">P = (<span class="number">71451574057642615329217496196104648829170714086074852</span>, <span class="number">69505051165402823276701818777271117086632959198597714</span>,<span class="number">1</span>)</span><br><span class="line">E = EllipticCurve_from_cubic(cubic, P, morphism=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">P = (<span class="number">71451574057642615329217496196104648829170714086074852</span>, <span class="number">69505051165402823276701818777271117086632959198597714</span>,<span class="number">1</span>)</span><br><span class="line">Q = (<span class="number">40867727924496334272422180051448163594354522440089644</span>, <span class="number">56052452825146620306694006054673427761687498088402245</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">PP = E(P)</span><br><span class="line">QQ = E(Q)</span><br><span class="line"></span><br><span class="line">m = QQ.discrete_log(PP)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1780694557271320552511299360138314441283923223949197</span></span><br></pre></td></tr></table></figure>

<p>但这里还并不是flag，我们得到的应该是 flag % P.order，所以还需要枚举一下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">m = <span class="number">1780694557271320552511299360138314441283923223949197</span></span><br><span class="line">o = int(P.order())</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    m+=o</span><br><span class="line">    <span class="keyword">if</span> all( <span class="number">30</span>&lt;x&lt;<span class="number">125</span> <span class="keyword">for</span> x <span class="keyword">in</span> long_to_bytes(int(m))):</span><br><span class="line">        print(long_to_bytes(int(m)))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># '_hE5S!4n_f0rM_0F_3CC!!</span></span><br></pre></td></tr></table></figure>

<h4 id="EllipticCurve-from-cubic-F-P-None-morphism-True"><a href="#EllipticCurve-from-cubic-F-P-None-morphism-True" class="headerlink" title="EllipticCurve_from_cubic(F, P=None, morphism=True)"></a>EllipticCurve_from_cubic(F, P=None, morphism=True)</h4><p>在标准射影坐标系中，Weierstrass 形式的椭圆曲线方程可以表示为  $Y^2Z=X^3+aXZ^2+Z^3$，注意到这就是一个 cubic，我们使用 EllipticCurve_from_cubic 就是将一个射影坐标系中的一条曲线态射（morphism）到仿射坐标系中的一条曲线。如果设置 morphism=True，则会返回态射函数，如果设置 morphism=False，则仅仅返回曲线，也可以直接使用函数 Jacobian(F) 代替。</p>
<p>在上述例子中，我们的态射 E 为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sage: E</span><br><span class="line">Scheme morphism:</span><br><span class="line">  From: Projective Plane Curve over Ring of integers modulo <span class="number">73997272456239171124655017039956026551127725934222347</span> defined by x^<span class="number">3</span> + y^<span class="number">3</span> + <span class="number">5784471977323482679485996635143679410786050979846712</span>*x*y*z + z^<span class="number">3</span></span><br><span class="line">  To:   Elliptic Curve defined by y^<span class="number">2</span> + <span class="number">41848246294228984089267712788268151466593112763848031</span>*x*y = x^<span class="number">3</span> + <span class="number">8186198475255690096811875068967290988967924587416530</span>*x^<span class="number">2</span> + <span class="number">67041837351181533250843830910913901867849396421579685</span>*x + <span class="number">40673641660869730385035838198800394713965979400200155</span> over Ring of integers modulo <span class="number">73997272456239171124655017039956026551127725934222347</span></span><br><span class="line">  Defn: Defined on coordinates by sending (x : y : z) to</span><br><span class="line">        (<span class="number">9167218108590654299487009181696317855454416112239889</span>*y + <span class="number">3279765642505352830157211697766991850038465138705271</span>*z : <span class="number">5784471977323482679485996635143679410786050979846712</span>*y : <span class="number">64249990329941531194735759683164021211133831031453155</span>*x + <span class="number">22688267644108754864364901498104863155005679028019334</span>*y + <span class="number">42580013058247064141816874924090310799821854717107287</span>*z)</span><br></pre></td></tr></table></figure>

<p>我们可以取 P 的参数进行验证</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 取 P 点 三个坐标 x,y,z</span></span><br><span class="line">sage: x=P[<span class="number">0</span>]</span><br><span class="line">sage: y=P[<span class="number">1</span>]</span><br><span class="line">sage: z=P[<span class="number">2</span>]</span><br><span class="line"><span class="comment"># 根据态射计算值，可以得到射影坐标(X:Y:Z),转化为仿射坐标(X/Z:Y/Z)</span></span><br><span class="line">sage: (<span class="number">9167218108590654299487009181696317855454416112239889</span>*y + <span class="number">3279765642505352</span></span><br><span class="line">....: <span class="number">830157211697766991850038465138705271</span>*z)/(<span class="number">642499903299415311947357596831640</span></span><br><span class="line">....: <span class="number">21211133831031453155</span>*x + <span class="number">2268826764410875486436490149810486315500567902801</span></span><br><span class="line">....: <span class="number">9334</span>*y + <span class="number">42580013058247064141816874924090310799821854717107287</span>*z)%p</span><br><span class="line"><span class="number">67918738637341461863982616331391010431949134469044189</span></span><br><span class="line">sage: E(P)[<span class="number">0</span>]</span><br><span class="line"><span class="number">67918738637341461863982616331391010431949134469044189</span></span><br></pre></td></tr></table></figure>

<p>这一部分难度的题大多都有现成的板子，不过死用板子可不行，还需要有一定的理解，得变着法儿来用板子。</p>
<h3 id="RISK"><a href="#RISK" class="headerlink" title="RISK"></a>RISK</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> m, flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">genPrime</span><span class="params">(m, nbit)</span>:</span></span><br><span class="line">	<span class="keyword">assert</span> m &gt;= <span class="number">2</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		a = getRandomNBitInteger(nbit // m)</span><br><span class="line">		r = getRandomNBitInteger(m ** <span class="number">2</span> - m + <span class="number">2</span>)</span><br><span class="line">		p = a ** m + r</span><br><span class="line">		<span class="keyword">if</span> isPrime(p):</span><br><span class="line">			<span class="keyword">return</span> (p, r)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">genkey</span><span class="params">(m, nbit)</span>:</span></span><br><span class="line">	p, r = genPrime(m, nbit // <span class="number">2</span>)</span><br><span class="line">	q, s = genPrime(m, nbit // <span class="number">2</span>)</span><br><span class="line">	n = p * q</span><br><span class="line">	e = r * s</span><br><span class="line">	<span class="keyword">return</span> (e, n)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(msg, pkey)</span>:</span></span><br><span class="line">	e, n = pkey</span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	c = pow(m, e, n)</span><br><span class="line">	<span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">pkey = genkey(m, <span class="number">2048</span>)</span><br><span class="line">enc = encrypt(flag, pkey)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f'pkey = <span class="subst">&#123;pkey&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'enc = <span class="subst">&#123;enc&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>

<p>仍然是 RSA 公钥密码系统，  $n = (a^4+r)(b^4+s)=(ab)^4+sa^4+rb^4+rs$，其中 $e=rs$ 已知。于是我们可以计算  $\lfloor \sqrt[4]{n}\rfloor=ab$，因此有 $c = n-(ab)^4-rs = sa^4+rb^4$</p>
<p>总共四个未知数，我们已知 $ab,rs$ 和 $c$。理论上是解不出来的，不过由于 $rs$ 并不大，我们可以爆破他的因子来恢复 $r,s$，从而计算得到 $a,b$，同时也能恢复 $p,q$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> isprime</span><br><span class="line">n=<span class="number">373824666550208932851344358703053061405262438259996622188837935528607451817812480600479188884096072016823491996056842120586016323642383543231913508464973502962030059403443181467594283936168384790367731793997013711256520780338341018619858240958105689126133812557401122953030695509876185592917323138313818881164334490044163316692588337720342646339764174333821950301279825316497898035760524780198230860089280791887363472060435443944632303774987556026740232641561706904946900169858650106994947597642013168757868017723456208796677559254390940651802333382820063200360490892131573853635471525711894510477078934343423255983</span></span><br><span class="line"></span><br><span class="line">ab = int(iroot(n,<span class="number">4</span>)[<span class="number">0</span>])</span><br><span class="line">ab4 = ab^<span class="number">4</span></span><br><span class="line"></span><br><span class="line">rs = <span class="number">150953688</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> rs.divisors():</span><br><span class="line">    s = rs//r</span><br><span class="line">    c = n-ab4-rs</span><br><span class="line">    delta = c^<span class="number">2</span><span class="number">-4</span>*rs*ab4</span><br><span class="line">    sdelta = int(iroot(delta,<span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line">    a4 = (c+sdelta)//(<span class="number">2</span>*s)</span><br><span class="line">    <span class="keyword">if</span> iroot(a4,<span class="number">4</span>)[<span class="number">1</span>]:</span><br><span class="line">        a = int(iroot(a4,<span class="number">4</span>)[<span class="number">0</span>])</span><br><span class="line">        b = int(iroot(ab4,<span class="number">4</span>)[<span class="number">0</span>]//a)</span><br><span class="line">        <span class="keyword">if</span> isprime(a^<span class="number">4</span>+r):</span><br><span class="line">            print(<span class="string">"[+] p="</span>,a^<span class="number">4</span>+r)</span><br><span class="line">            print(<span class="string">"[+] q="</span>,n//(a^<span class="number">4</span>+r))</span><br><span class="line">        <span class="keyword">elif</span> isprime(a^<span class="number">4</span>+s):</span><br><span class="line">            print(<span class="string">"[+] p="</span>,a^<span class="number">4</span>+s)</span><br><span class="line">            print(<span class="string">"[+] q="</span>,n//(a^<span class="number">4</span>+s))</span><br><span class="line">            </span><br><span class="line">[+] p= <span class="number">24854995563762799317055160315647073592768859410925406616067526817964296709994775588158311030813096922905657553370793515214591086698010302872311633588541111630338981703494212247996116660819640489213219705595382514374022123356637290058228183400682431815794876393612877273757515867990847040787313812864434536969</span></span><br><span class="line">[+] q= <span class="number">15040222622096320078383580808680733765955114958694997949647342925417877088612792495485641348591026281373930569798925789027166056695954731923306109646611840570310396750856642056018981080439916663195842593441587057719678555907050674529272376248049062724657792390788687452049496308886252188791975094655675938807</span></span><br></pre></td></tr></table></figure>

<p>之后就是解一个 RSA，不过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sage: gcd(rs,p<span class="number">-1</span>)</span><br><span class="line">mpz(<span class="number">10728</span>)</span><br><span class="line">sage: gcd(rs,q<span class="number">-1</span>)</span><br><span class="line">mpz(<span class="number">6</span>)</span><br></pre></td></tr></table></figure>

<p>这就比较麻烦，需要在域下开个根。<strong>掏出 AMM 板子</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># About 3 seconds to run</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AMM</span><span class="params">(o, r, q)</span>:</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    print(<span class="string">'\n----------------------------------------------------------------------------------'</span>)</span><br><span class="line">    print(<span class="string">'Start to run Adleman-Manders-Miller Root Extraction Method'</span>)</span><br><span class="line">    print(<span class="string">'Try to find one &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;'</span>.format(r, o, q))</span><br><span class="line">    g = GF(q)</span><br><span class="line">    o = g(o)</span><br><span class="line">    p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="keyword">while</span> p ^ ((q<span class="number">-1</span>) // r) == <span class="number">1</span>:</span><br><span class="line">        p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    print(<span class="string">'[+] Find p:&#123;&#125;'</span>.format(p))</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s = s // r</span><br><span class="line">    print(<span class="string">'[+] Find s:&#123;&#125;, t:&#123;&#125;'</span>.format(s, t))</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (k * s + <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alp = (k * s + <span class="number">1</span>) // r</span><br><span class="line">    print(<span class="string">'[+] Find alp:&#123;&#125;'</span>.format(alp))</span><br><span class="line">    a = p ^ (r**(t<span class="number">-1</span>) * s)</span><br><span class="line">    b = o ^ (r*alp - <span class="number">1</span>)</span><br><span class="line">    c = p ^ s</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, t):</span><br><span class="line">        d = b ^ (r^(t<span class="number">-1</span>-i))</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'[+] Calculating DLP...'</span>)</span><br><span class="line">            j = - discrete_log(d, a)</span><br><span class="line">            print(<span class="string">'[+] Finish DLP...'</span>)</span><br><span class="line">        b = b * (c^r)^j</span><br><span class="line">        h = h * c^j</span><br><span class="line">        c = c^r</span><br><span class="line">    result = o^alp * h</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">"Finished in &#123;&#125; seconds."</span>.format(end - start))</span><br><span class="line">    print(<span class="string">'Find one solution: &#123;&#125;'</span>.format(result))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">onemod</span><span class="params">(p,r)</span>:</span> </span><br><span class="line">    t=random.randint(<span class="number">2</span>,p)</span><br><span class="line">    <span class="keyword">while</span> pow(t,(p<span class="number">-1</span>)//r,p)==<span class="number">1</span>: </span><br><span class="line">         t=random.randint(<span class="number">2</span>,p)</span><br><span class="line">    <span class="keyword">return</span> pow(t,(p<span class="number">-1</span>)//r,p) </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solution</span><span class="params">(p,root,e)</span>:</span>  </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        g=onemod(p,e) </span><br><span class="line">        may=[] </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(e)): </span><br><span class="line">            may.append(root*pow(g,i,p)%p)</span><br><span class="line">        <span class="keyword">if</span> len(may) == len(set(may)):</span><br><span class="line">            <span class="keyword">return</span> may</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_in_subset</span><span class="params">(ep,p)</span>:</span></span><br><span class="line">    cp = int(pow(c,inverse(int(e//ep),p<span class="number">-1</span>),p))</span><br><span class="line">    com_factors = []</span><br><span class="line">    <span class="keyword">while</span> GCD(ep,p<span class="number">-1</span>) !=<span class="number">1</span>:</span><br><span class="line">        com_factors.append(GCD(ep,p<span class="number">-1</span>))</span><br><span class="line">        ep //= GCD(ep,p<span class="number">-1</span>)</span><br><span class="line">    com_factors.sort()</span><br><span class="line"></span><br><span class="line">    cps = [cp]</span><br><span class="line">    <span class="keyword">for</span> factor <span class="keyword">in</span> com_factors:</span><br><span class="line">        mps = []</span><br><span class="line">        <span class="keyword">for</span> cp <span class="keyword">in</span> cps:</span><br><span class="line">            mp = AMM(cp, factor, p)</span><br><span class="line">            mps += solution(p,mp,factor)</span><br><span class="line">        cps = mps</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> cps:</span><br><span class="line">        <span class="keyword">assert</span> pow(each,e,p)==c%p</span><br><span class="line">    <span class="keyword">return</span> cps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="number">24854995563762799317055160315647073592768859410925406616067526817964296709994775588158311030813096922905657553370793515214591086698010302872311633588541111630338981703494212247996116660819640489213219705595382514374022123356637290058228183400682431815794876393612877273757515867990847040787313812864434536969</span></span><br><span class="line">q = <span class="number">15040222622096320078383580808680733765955114958694997949647342925417877088612792495485641348591026281373930569798925789027166056695954731923306109646611840570310396750856642056018981080439916663195842593441587057719678555907050674529272376248049062724657792390788687452049496308886252188791975094655675938807</span></span><br><span class="line">e = <span class="number">150953688</span></span><br><span class="line">c = <span class="number">275574424285842306309073814038154403551700455145115884031072340378743712325975683329051874910297915882286569143815715537085387363420246497061870251520240399514896001311724695996978111559476733709139080970977190150345474341853495386364275702356438666152069791355990718058189043717952080875207858163490627801836274404446661613239167700736337269924479349700031535265765885064606399858172168036794462235707003475360358004643720927563261787867952228496769300443415094124132722170498229611285689671203272698693505808912907778910378274197503048226322090611405601517624884408718689404556983397217070272851442351897456769883</span></span><br><span class="line"></span><br><span class="line">ep = <span class="number">10728</span></span><br><span class="line">eq = <span class="number">72</span></span><br><span class="line">m_p = solve_in_subset(ep,p)</span><br><span class="line">m_q = solve_in_subset(eq,q)</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">print(<span class="string">'Start CRT...'</span>)</span><br><span class="line"><span class="keyword">for</span> mpp <span class="keyword">in</span> m_p:</span><br><span class="line">    <span class="keyword">for</span> mqq <span class="keyword">in</span> m_q:</span><br><span class="line">        solution = CRT_list([int(mpp), int(mqq)], [p, q])</span><br><span class="line">        <span class="keyword">if</span> solution &lt; <span class="number">2</span>^<span class="number">800</span> :   <span class="comment"># Always the bit_length of flag is less than 800</span></span><br><span class="line">            print(long_to_bytes(solution))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">end = time.time()</span><br><span class="line">print(<span class="string">"Finished in &#123;&#125; seconds."</span>.format(end - start))</span><br><span class="line"></span><br><span class="line"><span class="comment"># CCTF&#123;S!mP1E_A7t4cK_0n_SpEc1aL-5trucTur3D_RSA_pR1me5!&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Roldy"><a href="#Roldy" class="headerlink" title="Roldy"></a>Roldy</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pyope.ope <span class="keyword">import</span> OPE <span class="keyword">as</span> enc</span><br><span class="line"><span class="keyword">from</span> pyope.ope <span class="keyword">import</span> ValueRange</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> key, flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">die</span><span class="params">(*args)</span>:</span></span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pr</span><span class="params">(*args)</span>:</span></span><br><span class="line">	s = <span class="string">" "</span>.join(map(str, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">"\n"</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sc</span><span class="params">()</span>:</span> </span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(msg, key, params)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> len(msg) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">		msg += (<span class="number">16</span> - len(msg) % <span class="number">16</span>) * <span class="string">b'*'</span></span><br><span class="line">	p, k1, k2 = params</span><br><span class="line">	msg = [msg[_*<span class="number">16</span>:_*<span class="number">16</span> + <span class="number">16</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(msg) // <span class="number">16</span>)]</span><br><span class="line">	m = [bytes_to_long(_) <span class="keyword">for</span> _ <span class="keyword">in</span> msg]</span><br><span class="line">	inra = ValueRange(<span class="number">0</span>, <span class="number">2</span>**<span class="number">128</span>)</span><br><span class="line">	oura = ValueRange(k1 + <span class="number">1</span>, k2 * p + <span class="number">1</span>)</span><br><span class="line">	_enc = enc(key, in_range = inra, out_range = oura)</span><br><span class="line">	C = [_enc.encrypt(_) <span class="keyword">for</span> _ <span class="keyword">in</span> m]</span><br><span class="line">	<span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	border = <span class="string">"|"</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">" Welcome to Roldy combat, we implemented an encryption method to    "</span>, border)</span><br><span class="line">	pr(border, <span class="string">" protect our secret. Please note that there is a flaw in our method "</span>, border)</span><br><span class="line">	pr(border, <span class="string">" Can you examine it and get the flag?                               "</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	pr(border, <span class="string">'Generating parameters, please wait...'</span>)</span><br><span class="line">	p, k1, k2 = [getPrime(<span class="number">129</span>)] + [getPrime(<span class="number">64</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">'__'</span>]</span><br><span class="line">	C = encrypt(flag, key, (p, k1, k2))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">			pr(<span class="string">"| Options: \n|\t[E]ncrypted flag! \n|\t[T]ry encryption \n|\t[Q]uit"</span>)</span><br><span class="line">			ans = sc().decode().lower().strip()</span><br><span class="line">			<span class="keyword">if</span> ans == <span class="string">'e'</span>:</span><br><span class="line">				pr(border, <span class="string">f'encrypt(flag, key, params) = <span class="subst">&#123;C&#125;</span>'</span>)</span><br><span class="line">			<span class="keyword">elif</span> ans == <span class="string">'t'</span>:</span><br><span class="line">				pr(border, <span class="string">'Please send your message to encrypt: '</span>)</span><br><span class="line">				msg = sc().rstrip(<span class="string">b'\n'</span>)</span><br><span class="line">				<span class="keyword">if</span> len(msg) &gt; <span class="number">64</span>:</span><br><span class="line">					pr(border, <span class="string">'Your message is too long! Sorry!!'</span>)</span><br><span class="line">				C = encrypt(msg, key, (p, k1, k2))</span><br><span class="line">				pr(border, <span class="string">f'C = <span class="subst">&#123;C&#125;</span>'</span>)</span><br><span class="line">			<span class="keyword">elif</span> ans == <span class="string">'q'</span>:</span><br><span class="line">				die(border, <span class="string">"Quitting ..."</span>)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				die(border, <span class="string">"Bye ..."</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>

<p>交互题，</p>
<p>选项 e 可以提供一个 flag 的密文</p>
<p>选项 t 可以加密用户的输入（短于64字节）并返回密文。</p>
<p>我们看到加密，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(msg, key, params)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> len(msg) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">		msg += (<span class="number">16</span> - len(msg) % <span class="number">16</span>) * <span class="string">b'*'</span></span><br><span class="line">	p, k1, k2 = params</span><br><span class="line">	msg = [msg[_*<span class="number">16</span>:_*<span class="number">16</span> + <span class="number">16</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(msg) // <span class="number">16</span>)]</span><br><span class="line">	m = [bytes_to_long(_) <span class="keyword">for</span> _ <span class="keyword">in</span> msg]</span><br><span class="line">	inra = ValueRange(<span class="number">0</span>, <span class="number">2</span>**<span class="number">128</span>)</span><br><span class="line">	oura = ValueRange(k1 + <span class="number">1</span>, k2 * p + <span class="number">1</span>)</span><br><span class="line">	_enc = enc(key, in_range = inra, out_range = oura)</span><br><span class="line">	C = [_enc.encrypt(_) <span class="keyword">for</span> _ <span class="keyword">in</span> m]</span><br><span class="line">	<span class="keyword">return</span> C</span><br></pre></td></tr></table></figure>

<p>是一个分组加密，将明文以 16 字节进行分组，不足的用 * 补齐，然后调用一种叫做 OPE 的加密算法进行加密，其中 key, k1, k2, p 均未知， k1，k2，p 和 out_range 相关，<code>out_range = (k1 + 1, k2 * p + 1)</code></p>
<p>那么我们来简单看一下这个 OPE，直接去pypi看，其中提到 <code>This is an implementation of Boldyreva symmetric order-preserving encryption scheme (Boldyreva’s paper).</code> 这是一种保序加密的实现，那么何为”保序“呢？下面给出了例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyope.ope <span class="keyword">import</span> OPE</span><br><span class="line">cipher = OPE(<span class="string">b'key goes here'</span>)</span><br><span class="line"><span class="keyword">assert</span> cipher.encrypt(<span class="number">1000</span>) &lt; cipher.encrypt(<span class="number">2000</span>) &lt; cipher.encrypt(<span class="number">3000</span>)</span><br><span class="line"><span class="keyword">assert</span> cipher.decrypt(cipher.encrypt(<span class="number">1337</span>)) == <span class="number">1337</span></span><br></pre></td></tr></table></figure>

<p>那么解题思路就清晰了（甚至没有看具体的加密算法）</p>
<ol>
<li><p>首先获取 flag 的密文 enc(flag)</p>
</li>
<li><p>设置一个下限 floor，设置一个上限 sky，设置一个 mid = (floor+sky)//2</p>
</li>
<li><p>获取 enc(mid)</p>
</li>
<li><p>如果 enc(mid) &gt; enc(flag)，则 sky = mid</p>
</li>
<li><p>如果 enc(mid) &lt; enc(flag)，则 floor = mid</p>
</li>
<li><p>如果 enc(mid) = enc(flag)，则 flag = mid，完成解题；否则重复步骤 3 - 6。</p>
<p>（远程服务好像有问题，虽然是 While True，但是一般6-8次交互后就会强制断掉，好在 flag 是不变的，我们可以重复连接）</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">sh = remote(<span class="string">"06.cr.yp.toc.tf"</span>,<span class="number">31377</span>)</span><br><span class="line">sh.recvuntil(<span class="string">"[Q]uit\n"</span>)</span><br><span class="line">sh.sendline(<span class="string">"E"</span>)</span><br><span class="line">sh.recvuntil(<span class="string">"params) = "</span>)</span><br><span class="line">flag_enc = eval(sh.recvuntil(<span class="string">"]"</span>))</span><br><span class="line"></span><br><span class="line">floor1 = <span class="number">0</span></span><br><span class="line">sky1 = (<span class="number">2</span>**<span class="number">128</span>)<span class="number">-1</span></span><br><span class="line">floor2 = <span class="number">0</span></span><br><span class="line">sky2 = (<span class="number">2</span>**<span class="number">128</span>)<span class="number">-1</span></span><br><span class="line">floor3 = <span class="number">0</span></span><br><span class="line">sky3 = (<span class="number">2</span>**<span class="number">128</span>)<span class="number">-1</span></span><br><span class="line">floor4 = <span class="number">0</span></span><br><span class="line">sky4 = (<span class="number">2</span>**<span class="number">128</span>)<span class="number">-1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">168</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		mid1 = (floor1+sky1)//<span class="number">2</span></span><br><span class="line">		mid2 = (floor2+sky2)//<span class="number">2</span></span><br><span class="line">		mid3 = (floor3+sky3)//<span class="number">2</span></span><br><span class="line">		mid4 = (floor4+sky4)//<span class="number">2</span></span><br><span class="line">		sh.recvuntil(<span class="string">"[Q]uit\n"</span>)</span><br><span class="line">		sh.sendline(<span class="string">"T"</span>)</span><br><span class="line">		data = long_to_bytes(mid1)+long_to_bytes(mid2)+long_to_bytes(mid3)+long_to_bytes(mid4)</span><br><span class="line">		sh.sendline(data)</span><br><span class="line">		sh.recvuntil(<span class="string">"C = "</span>)</span><br><span class="line">		data_enc = eval(sh.recvuntil(<span class="string">"]"</span>))</span><br><span class="line">		<span class="keyword">if</span> data_enc[<span class="number">0</span>] &gt; flag_enc[<span class="number">0</span>]:</span><br><span class="line">			sky1 = mid1</span><br><span class="line">		<span class="keyword">elif</span> data_enc[<span class="number">0</span>] &lt; flag_enc[<span class="number">0</span>]:</span><br><span class="line">			floor1 = mid1</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			print(<span class="string">"[+] "</span>,long_to_bytes(mid1))</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> data_enc[<span class="number">1</span>] &gt; flag_enc[<span class="number">1</span>]:</span><br><span class="line">			sky2 = mid2</span><br><span class="line">		<span class="keyword">elif</span> data_enc[<span class="number">1</span>] &lt; flag_enc[<span class="number">1</span>]:</span><br><span class="line">			floor2 = mid2</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			print(<span class="string">"[+] "</span>,long_to_bytes(mid2))</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> data_enc[<span class="number">2</span>] &gt; flag_enc[<span class="number">2</span>]:</span><br><span class="line">			sky3 = mid3</span><br><span class="line">		<span class="keyword">elif</span> data_enc[<span class="number">2</span>] &lt; flag_enc[<span class="number">2</span>]:</span><br><span class="line">			floor3 = mid3</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			print(<span class="string">"[+] "</span>,long_to_bytes(mid3))</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> data_enc[<span class="number">3</span>] &gt; flag_enc[<span class="number">3</span>]:</span><br><span class="line">			sky4 = mid4</span><br><span class="line">		<span class="keyword">elif</span> data_enc[<span class="number">3</span>] &lt; flag_enc[<span class="number">3</span>]:</span><br><span class="line">			floor4 = mid4</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			print(<span class="string">"[+] "</span>,long_to_bytes(mid4))</span><br><span class="line"></span><br><span class="line">		print(_,mid1,mid2,mid3,mid4)</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		sh.close()</span><br><span class="line">		sh = remote(<span class="string">"06.cr.yp.toc.tf"</span>,<span class="number">31377</span>)</span><br><span class="line">		sh.recvuntil(<span class="string">"[Q]uit\n"</span>)</span><br><span class="line">		sh.sendline(<span class="string">"E"</span>)</span><br><span class="line">		sh.recvuntil(<span class="string">"params) = "</span>)</span><br><span class="line">		flag_enc = eval(sh.recvuntil(<span class="string">"]"</span>))</span><br><span class="line"></span><br><span class="line">[DEBUG] Sent <span class="number">0x2</span> bytes:</span><br><span class="line">    <span class="string">b'T\n'</span></span><br><span class="line">[DEBUG] Sent <span class="number">0x41</span> bytes:</span><br><span class="line">    <span class="string">b'CCTF&#123;Boldyreva_5ymMe7rIC_0rD3r_pRe5Erv!n9_3nCryp7i0n!_LStfig9TM&#125;\n'</span></span><br><span class="line">[DEBUG] Received <span class="number">0x28</span> bytes:</span><br><span class="line">    <span class="string">b'| Please send your message to encrypt: \n'</span></span><br><span class="line">[DEBUG] Received <span class="number">0x135</span> bytes:</span><br><span class="line">    <span class="string">b'| C = [2599038725030407463903804797382365452856395373775921222259, 4691931002839804444939519387512017276102085486050513350917, 3183751470526374746059757707916120807018893056051312221576, 2141073881141548858839412849804595194017377913807338508876]\n'</span></span><br><span class="line">    <span class="string">b'| Options: \n'</span></span><br><span class="line">    <span class="string">b'|\t[E]ncrypted flag! \n'</span></span><br><span class="line">    <span class="string">b'|\t[T]ry encryption \n'</span></span><br><span class="line">    <span class="string">b'|\t[Q]uit\n'</span></span><br><span class="line">[+]  <span class="string">b'CCTF&#123;Boldyreva_5'</span></span><br><span class="line">[+]  <span class="string">b'ymMe7rIC_0rD3r_p'</span></span><br><span class="line">[+]  <span class="string">b'Re5Erv!n9_3nCryp'</span></span><br><span class="line">[+]  <span class="string">b'7i0n!_LStfig9TM&#125;'</span></span><br></pre></td></tr></table></figure>

<h3 id="Insights"><a href="#Insights" class="headerlink" title="Insights"></a>Insights</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getRandomNBits</span><span class="params">(n)</span>:</span></span><br><span class="line">	nb = <span class="string">'1'</span> + <span class="string">''</span>.join([str(randint(<span class="number">0</span>, <span class="number">1</span>)) <span class="keyword">for</span> _ <span class="keyword">in</span> range(n - <span class="number">1</span>)])</span><br><span class="line">	<span class="keyword">return</span> nb</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getLeader</span><span class="params">(L, n)</span>:</span></span><br><span class="line">	nb = L + getRandomNBits(n)</span><br><span class="line">	<span class="keyword">return</span> int(nb, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">genPrime</span><span class="params">(L, nbit)</span>:</span></span><br><span class="line">	l = len(L)</span><br><span class="line">	<span class="keyword">assert</span> nbit &gt;= l</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		p = getLeader(L, nbit - l)</span><br><span class="line">		<span class="keyword">if</span> is_prime(p):</span><br><span class="line">			<span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">genKey</span><span class="params">(L, nbit)</span>:</span></span><br><span class="line">	p, q = [genPrime(L, nbit) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">'__'</span>]</span><br><span class="line">	n = p * q</span><br><span class="line">	d = next_prime(pow(n, <span class="number">0.2919</span>))</span><br><span class="line">	phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">	e = inverse(d, phi)</span><br><span class="line">	pubkey, privkey = (n, e), (p, q)</span><br><span class="line">	<span class="keyword">return</span> pubkey, privkey</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(msg, pubkey)</span>:</span></span><br><span class="line">	n, e = pubkey</span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	c = pow(m, e, n)</span><br><span class="line">	<span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">nbit = <span class="number">1024</span></span><br><span class="line">L = bin(bytes_to_long(<span class="string">b'Practical'</span>))[<span class="number">2</span>:]</span><br><span class="line">pubkey, privkey = genKey(L, nbit)</span><br><span class="line">p, q = privkey</span><br><span class="line">c = encrypt(flag, pubkey)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Information:'</span>)</span><br><span class="line">print(<span class="string">'-'</span> * <span class="number">85</span>)</span><br><span class="line">print(<span class="string">f'n = <span class="subst">&#123;p * q&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'e = <span class="subst">&#123;pubkey[<span class="number">1</span>]&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'c = <span class="subst">&#123;c&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'p = <span class="subst">&#123;bin(p)[<span class="number">2</span>:len(L)]&#125;</span>...[REDACTED]'</span>)</span><br><span class="line">print(<span class="string">f'q = <span class="subst">&#123;bin(q)[<span class="number">2</span>:len(L)]&#125;</span>...[REDACTED]'</span>)</span><br><span class="line">print(<span class="string">'-'</span> * <span class="number">85</span>)</span><br></pre></td></tr></table></figure>

<p>虽然代码很长，但总结下来，就是一个基础的 RSA 加密体制，但是 $d \lt n^{0.291}$，另外给出了 71 比特的 p,q 高位，并且这部分比特是相等的。</p>
<p>熟悉 RSA 低私钥攻击的读者肯定知道 Boneh-Durfee 攻击，而其理论界是 0.292。虽然这里的界似乎确实是小于 0.292，但正如题目中所指出的 <code>Practical</code>，想要达到这个理论界几乎是不可能的。于是我们需要从额外给出 p,q 高 72 比特入手。</p>
<p>回顾一下 Boneh-Durfee 攻击，我们设 $d = n^{i},e=n^{\alpha}$</p>
<p>根据公钥和私钥的关系，我们有</p>
<p> $ed = 1+\frac{k\varphi(n)}{2} $，</p>
<p>其中 $\varphi(n)=(p-1)(q-1)=n-p-q+1$，</p>
<p>因此可以写为 $ed = 1+k(\frac{n+1}{2}-\frac{p+q}{2})$，</p>
<p>记 $x = \frac{n+1}{2},y=-\frac{p+q}{2}$，</p>
<p>于是式子简化为 $1=ed+k(x+y)$ </p>
<p>我们将式子放在模 $e$ 的剩余系下，得到同余式<br>$$<br>k(x+y)\equiv 1 \pmod e<br>$$<br>由于 $y = O(\sqrt N),k \lt \frac{2ed}{\varphi(n)}\le\frac{3ed}{n}\lt3n^{\alpha+i-1}$，</p>
<p>因此我们使用 coppersmith 对二元同余式 $f(x,y)\equiv k(x+y) \equiv 1 \pmod e$ 求小根能够得到 $k,y$，从而分解 $n$。</p>
<p>那么对于本题，我们应该利用额外的信息来减小需要求的 $k,y$</p>
<p>我们设 $p = \bar p+p’,q = \bar q + q$，于是<br>$$<br>x+y=\frac{n+1}{2}-\frac{p+q}{2}=\frac{n+1}{2}-\frac{\bar p + p’+\bar q+q’}{2}=\frac{n+1-\bar p - \bar q}{2}-\frac{p’+q’}{2}<br>$$<br>这样我们需要的 $y=\frac{p’+q’}{2}$ 就要小很多了。</p>
<p>然后我们掏出 <strong>Boneh-Durfee 板子</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string"># https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">example</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">############################################</span></span><br><span class="line">    <span class="comment"># How To Use This Script</span></span><br><span class="line">    <span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># The problem to solve (edit the following values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the modulus</span></span><br><span class="line">    N = <span class="number">12765231982257032754070342601068819788671760506321816381988340379929052646067454855779362773785313297204165444163623633335057895252608396010414744222572161530653104640020689896882490979790275711854268113058363186249545193245142912930804650114934761299016468156185416083682476142929968501395899099376750415294540156026131156551291971922076435528869024742993840057342092865203064721826362149723366381892539617642364692012936270150691803063945919154346756726869466855557344213050973081755499746750276623648407677639812809665472258655462846021403503851719008687214848550916999977775070011121527941755954255781343103086789</span></span><br><span class="line">    <span class="comment"># the public exponent</span></span><br><span class="line">    e = <span class="number">459650454686946706615371845737527916539205656667844780634386049268800615782964920944229084502752167395446158290854047696006034750210758341744841762479191173017773034647739346927390580848998121830029134542880713409306092967282675122699586503684943407535067216738556403169403622104762516293879994387324370835718056251706150557820106296417750402984941838652433642298378976899556042987560946508887315484380807248331504458640857234708123277403252632993828101306072382329879857946191508782246793011691530554606521701055094223574951862129713872918021549814674387049788995785872980320871421550616327471735316980754238323013</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the hypothesis on the private exponent (the theoretical maximum is 0.292)</span></span><br><span class="line">    delta = <span class="number">.291</span> <span class="comment"># this means that d &lt; N^delta</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Lattice (tweak those values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you should tweak this (after a first run), (e.g. increment it until a solution is found)</span></span><br><span class="line">    m = <span class="number">6</span> <span class="comment"># size of the lattice (bigger the better/slower)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you need to be a lattice master to tweak these</span></span><br><span class="line">    t = int((<span class="number">1</span><span class="number">-2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">    X = <span class="number">2</span>*floor(N^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">    Y = floor(N^(<span class="number">953</span>/<span class="number">2048</span>))    <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Don't touch anything below</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Problem put in equation</span></span><br><span class="line">    P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    pbar = int(<span class="string">'10100000111001001100001011000110111010001101001011000110110000101101100'</span>,<span class="number">2</span>)&lt;&lt;(<span class="number">1024</span><span class="number">-71</span>)</span><br><span class="line">    A = int((N+<span class="number">1</span><span class="number">-2</span>*pbar)/<span class="number">2</span>)</span><br><span class="line">    pol = <span class="number">1</span> + x * (A + y)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Find the solutions!</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Checking bounds</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        print(<span class="string">"=== checking values ==="</span>)</span><br><span class="line">        print(<span class="string">"* delta:"</span>, delta)</span><br><span class="line">        print(<span class="string">"* delta &lt; 0.292"</span>, delta &lt; <span class="number">0.292</span>)</span><br><span class="line">        print(<span class="string">"* size of e:"</span>, int(log(e)/log(<span class="number">2</span>)))</span><br><span class="line">        print(<span class="string">"* size of N:"</span>, int(log(N)/log(<span class="number">2</span>)))</span><br><span class="line">        print(<span class="string">"* m:"</span>, m, <span class="string">", t:"</span>, t)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># boneh_durfee</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        print(<span class="string">"=== running algorithm ==="</span>)</span><br><span class="line">        start_time = time.time()</span><br><span class="line"></span><br><span class="line">    solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># found a solution?</span></span><br><span class="line">    <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"=== solution found ==="</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">            print(<span class="string">"x:"</span>, solx)</span><br><span class="line">            print(<span class="string">"y:"</span>, soly)</span><br><span class="line"></span><br><span class="line">        d = int(pol(solx, soly) / e)</span><br><span class="line">        print(<span class="string">"private key found:"</span>, d)</span><br><span class="line">        c = <span class="number">10992248752412909788626396175372747713079469256270100576886987393986576680666320383209810005318254336440105142571546847427454822405793626080251363454531982746373841267986148332456716023293306870382809568309620264499225135226626560298741596462262513921032733814032790312163314776421380481083058518893602887082464123177575742160690315666730642727773288362853901330620841098230284739614618790097180848133698381487679399364400048499041582830157094876815030301231505774900176910650887780842536610942820066913075027528705150102760422836458745949063992228680293226303245265232017738712226154128654682937687199768621565945171</span></span><br><span class="line">        m = pow(c,d,N)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"message found:"</span>, long_to_bytes(int(m)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"=== no solution was found ==="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        print(<span class="string">"=== %s seconds ==="</span> % (time.time() - start_time))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    example()</span><br><span class="line">    </span><br><span class="line">=== solution found ===</span><br><span class="line">private key found: <span class="number">693984516363754919249700902493753051718166208912377865278483876234349619419200560616162942304659132290614866566556420934365717915837808485622613368180482591406570741380374249603517</span></span><br><span class="line">message found: <span class="string">b'CCTF&#123;RSA_N3w_rEc0rd5_4Nd_nEw_!nSi9h75!&#125;'</span></span><br><span class="line">=== <span class="number">11.820068597793579</span> seconds ===</span><br></pre></td></tr></table></figure>

<h4 id="非预期"><a href="#非预期" class="headerlink" title="非预期"></a>非预期</h4><p>令人意想不到的出题失误，注意到 $d$ 的生成方式 <code>d = next_prime(pow(n, 0.2919))</code>，使用的函数是 next_prime，因此这个私钥我们可以直接计算出来。（emmm，难崩）</p>
<h3 id="Resuction"><a href="#Resuction" class="headerlink" title="Resuction"></a>Resuction</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span><span class="params">(nbit, r)</span>:</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		p, q = [getPrime(nbit) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">'__'</span>]</span><br><span class="line">		d, n = getPrime(<span class="number">64</span>), p * q</span><br><span class="line">		phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">if</span> GCD(d, phi) == <span class="number">1</span>:</span><br><span class="line">			e = inverse(d, phi)</span><br><span class="line">			N = bin(n)[<span class="number">2</span>:-r]</span><br><span class="line">			E = bin(e)[<span class="number">2</span>:-r]</span><br><span class="line">			PKEY = N + E</span><br><span class="line">			pkey = (n, e)</span><br><span class="line">			<span class="keyword">return</span> PKEY, pkey</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(msg, pkey, r)</span>:</span></span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	n, e = pkey</span><br><span class="line">	c = pow(m, e, n)</span><br><span class="line">	C = bin(c)[<span class="number">2</span>:-r]</span><br><span class="line">	<span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line">r, nbit = <span class="number">8</span>, <span class="number">1024</span></span><br><span class="line">PKEY, pkey = keygen(nbit, r)</span><br><span class="line">print(<span class="string">f'PKEY = <span class="subst">&#123;int(PKEY, <span class="number">2</span>)&#125;</span>'</span>)</span><br><span class="line">FLAG = flag.lstrip(<span class="string">b'CCTF&#123;'</span>).rstrip(<span class="string">b'&#125;'</span>)</span><br><span class="line">enc = encrypt(FLAG, pkey, r)</span><br><span class="line">print(<span class="string">f'enc = <span class="subst">&#123;int(enc, <span class="number">2</span>)&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>

<p>如题，是 Suction 一题的升级版，同样的将 $n,e,c$ 的第 8 比特给抛掉了，但这一次的模数比较长，切入点在于私钥 <code>d=getPrime(64)</code> 比较短。使用维纳攻击就可以恢复。于是同 suction一样，我们先排除一些 $n$：爆破 $n$，然后将有小因子的 $n$ 剔除。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n = (<span class="number">112427415074496733728692221822236708267020071361134595480944452567332776053338591808303191116824668207575885357243149596990683319683952721613109860104563666843168030575222891621946617002107610348479917006441273131192536638336531098426557725336808479141871883466571954197021295145182566118601456967383373633195241318527152234920928439522439998675385534769566753824107447367198956368408576813105163823071250689597585130857134935943413570763481702219998410358821249192007224259883929235667449109565875403158782316445806131091179344390038436184567391800053904246077478412520806972604858022406108303505402566299783227719</span>)&lt;&lt;<span class="number">8</span></span><br><span class="line"></span><br><span class="line">candidate_n=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> sieve_base:</span><br><span class="line">        <span class="keyword">if</span> (n+i)%each == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        candidate_n.append(n+i)</span><br><span class="line">        </span><br><span class="line">print(len(candidate_n))	<span class="comment">#18</span></span><br></pre></td></tr></table></figure>

<p>我们得到 18 个候选 $n$，然后爆破 $e$，<strong>掏出维纳攻击板子</strong>恢复 $d$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://cryptohack.gitbook.io/cryptobook/untitled/low-private-component-attacks/wieners-attack</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wiener</span><span class="params">(e, n)</span>:</span></span><br><span class="line">    <span class="comment"># Convert e/n into a continued fraction</span></span><br><span class="line">    cf = continued_fraction(e/n)</span><br><span class="line">    convergents = cf.convergents()</span><br><span class="line">    <span class="keyword">for</span> kd <span class="keyword">in</span> convergents:</span><br><span class="line">        k = kd.numerator()</span><br><span class="line">        d = kd.denominator()</span><br><span class="line">        <span class="comment"># Check if k and d meet the requirements</span></span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span> <span class="keyword">or</span> d%<span class="number">2</span> == <span class="number">0</span> <span class="keyword">or</span> e*d % k != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        phi = (e*d - <span class="number">1</span>)/k</span><br><span class="line">        <span class="comment"># Create the polynomial</span></span><br><span class="line">        x = PolynomialRing(RationalField(), <span class="string">'x'</span>).gen()</span><br><span class="line">        f = x^<span class="number">2</span> - (n-phi+<span class="number">1</span>)*x + n</span><br><span class="line">        roots = f.roots()</span><br><span class="line">        <span class="comment"># Check if polynomial as two roots</span></span><br><span class="line">        <span class="keyword">if</span> len(roots) != <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># Check if roots of the polynomial are p and q</span></span><br><span class="line">        p,q = int(roots[<span class="number">0</span>][<span class="number">0</span>]), int(roots[<span class="number">1</span>][<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> p*q == n:</span><br><span class="line">            <span class="keyword">return</span> d</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="comment"># Test to see if our attack works</span></span><br><span class="line"></span><br><span class="line">cbar = <span class="number">93313196155732054514477836642637636744872135106456047659057794344503071105783322399713135615723000054324693644981340568454628360027598469597864407205974007198804288563284521413279406211756674451582156555173212403946908121125010635246043311803494356106191509999360722019559999844621905376368824621365540442906142224342650371557766313381899279520110833822291649001754956653102495882094754863493058001964760438040783400782352466943990226083197340594364084294954324101604417550048379969516185353765224920719355485680872367930581872987972421836853197205534334204586713387469939986387582911728909524428102693874671302382</span></span><br><span class="line"></span><br><span class="line">ebar = <span class="number">74815283003042416338002870607297643274871034448602599708384141071471917607169366460779106981614337875374527128073342874020038409390009797167164979588156632069225354809941878042041409035570766771978869694205473027422664974736500767764276542632434961655827607595857636591200768423760020441355451161200288584365600631284260544071893780843946670256375597950133179820952349509047750482890979996176201687343781812761180017866837666545025976113041894068276225989698747704895120678129952143858563031610250246566072046781376525603542675861354076677536820335237963848876218689030737874987393642014514707143849847745550092834</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> candidate_n:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>,<span class="number">2</span>):</span><br><span class="line">        e = (ebar &lt;&lt; <span class="number">8</span>) + i</span><br><span class="line">        d = wiener(e,n)</span><br><span class="line">        <span class="keyword">if</span> d:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">                c = (cbar&lt;&lt;<span class="number">8</span>)+j</span><br><span class="line">                m = int(pow(c,d,n))</span><br><span class="line">                <span class="keyword">if</span> m.bit_length()&lt;<span class="number">800</span>:</span><br><span class="line">                    print(long_to_bytes(int(pow(c,d,n))).decode())</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># aIr_pr3s5urE_d!Ff3rEn7i4L_8eTw3eN_ArEa5!</span></span><br></pre></td></tr></table></figure>

<h3 id="Blobfish"><a href="#Blobfish" class="headerlink" title="Blobfish"></a>Blobfish</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageDraw</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">key = get_random_bytes(<span class="number">8</span>) * <span class="number">2</span></span><br><span class="line">iv = md5(key).digest()</span><br><span class="line"></span><br><span class="line">cipher = AES.new(key, AES.MODE_CFB, iv=iv)</span><br><span class="line">enc = cipher.encrypt(flag)</span><br><span class="line"></span><br><span class="line">img = Image.new(<span class="string">'RGB'</span>, (<span class="number">800</span>, <span class="number">50</span>))</span><br><span class="line">drw = ImageDraw.Draw(img)</span><br><span class="line">drw.text((<span class="number">20</span>, <span class="number">20</span>), enc.hex(), fill=(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">img.save(<span class="string">"flag.png"</span>)</span><br><span class="line"></span><br><span class="line">hkey = <span class="string">''</span>.join(<span class="string">'\\x&#123;:02x&#125;'</span>.format(x) <span class="keyword">for</span> x <span class="keyword">in</span> key[:<span class="number">10</span>])</span><br><span class="line"></span><br><span class="line">os.system(<span class="string">f'/bin/zip -0 flag.zip flag.png -e -P \"$(/bin/echo -en \"<span class="subst">&#123;hkey&#125;</span>\")\"'</span>)</span><br></pre></td></tr></table></figure>

<p>分析一下代码，题目使用 8个随机字节 * 2  作为 AES-CFB 的加密密钥加密的 flag，随后将密文作图，并加密打包，压缩包的密码是 AES 密钥的前十个字节。不过看一下 zip 命令，会发现 -0 参数是仅储存。而里面的密文作为图片文件，我们是知道其文件头的，于是我们可以对其实施明文攻击，恢复密钥，获得密文，进而解密密文获得 flag。<strong>使用的工具是 github 开源的 <a href="https://github.com/kimci86/bkcrack/tree/0a6817021af573e075cd0774383b596d8877ed23" target="_blank" rel="noopener">bkcrack</a> （何尝不是一个板子）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/bkcrack-master/<span class="keyword">install</span>]</span><br><span class="line">└─$ ./bkcrack -C flag.zip -c flag.png -p plain.png</span><br><span class="line">bkcrack <span class="number">1.5</span><span class="number">.0</span> - <span class="number">2023</span><span class="number">-07</span><span class="number">-12</span></span><br><span class="line">[<span class="number">03</span>:<span class="number">35</span>:<span class="number">31</span>] Z reduction <span class="keyword">using</span> <span class="number">9</span> <span class="keyword">bytes</span> <span class="keyword">of</span> known plaintext</span><br><span class="line"><span class="number">100.0</span> % (<span class="number">9</span> / <span class="number">9</span>)</span><br><span class="line">[<span class="number">03</span>:<span class="number">35</span>:<span class="number">31</span>] Attack <span class="keyword">on</span> <span class="number">697990</span> Z <span class="keyword">values</span> <span class="keyword">at</span> <span class="keyword">index</span> <span class="number">6</span></span><br><span class="line"><span class="keyword">Keys</span>: <span class="number">03492</span>be6 b81a5123 <span class="number">24</span>d7b146</span><br><span class="line"><span class="number">13.0</span> % (<span class="number">90955</span> / <span class="number">697990</span>)</span><br><span class="line">[<span class="number">03</span>:<span class="number">39</span>:<span class="number">01</span>] <span class="keyword">Keys</span></span><br><span class="line"><span class="number">03492</span>be6 b81a5123 <span class="number">24</span>d7b146</span><br><span class="line">                                                                                                                                                            </span><br><span class="line">┌──(kali㉿kali)-[~/Desktop/bkcrack-<span class="keyword">master</span>/<span class="keyword">install</span>]</span><br><span class="line">└─$ ./bkcrack -C flag.zip -c flag.png -k <span class="number">03492</span>be6 b81a5123 <span class="number">24</span>d7b146 -d flag.png</span><br><span class="line">bkcrack <span class="number">1.5</span><span class="number">.0</span> - <span class="number">2023</span><span class="number">-07</span><span class="number">-12</span></span><br><span class="line">[<span class="number">04</span>:<span class="number">03</span>:<span class="number">00</span>] Writing deciphered <span class="keyword">data</span> flag.png (maybe compressed)</span><br><span class="line">Wrote deciphered data.</span><br><span class="line">                                                                                                                                                            </span><br><span class="line">┌──(kali㉿kali)-[~/Desktop/bkcrack-<span class="keyword">master</span>/<span class="keyword">install</span>]</span><br><span class="line">└─$ ./bkcrack -k <span class="number">03492</span>be6 b81a5123 <span class="number">24</span>d7b146 <span class="comment">--bruteforce ?b --length 10</span></span><br><span class="line"></span><br><span class="line">bkcrack <span class="number">1.5</span><span class="number">.0</span> - <span class="number">2023</span><span class="number">-07</span><span class="number">-12</span></span><br><span class="line">[<span class="number">04</span>:<span class="number">03</span>:<span class="number">32</span>] Recovering <span class="keyword">password</span></span><br><span class="line"><span class="keyword">length</span> <span class="number">10.</span>..</span><br><span class="line"><span class="keyword">Password</span>: �n�y*�Z��n (<span class="keyword">as</span> <span class="keyword">bytes</span>: ad <span class="number">6</span>e fb <span class="number">79</span> <span class="number">2</span>a ea <span class="number">5</span>a aa ad <span class="number">6</span>e)</span><br><span class="line"><span class="keyword">Some</span> <span class="keyword">characters</span> <span class="keyword">are</span> <span class="keyword">not</span> <span class="keyword">in</span> the expected charset. Continuing.</span><br><span class="line"><span class="number">100.0</span> % (<span class="number">65536</span> / <span class="number">65536</span>)</span><br><span class="line">[<span class="number">04</span>:<span class="number">03</span>:<span class="number">35</span>] Could <span class="keyword">not</span> <span class="keyword">recover</span> <span class="keyword">password</span></span><br></pre></td></tr></table></figure>

<p>解密压缩包得到图片</p>
<p><img src="https://s2.loli.net/2023/08/14/Cs2hDYdpPab5VSB.png" alt="flag.png"></p>
<p>编写解密代码解密密文获得 flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">key = <span class="string">b"\xad\x6e\xfb\x79\x2a\xea\x5a\xaa"</span> * <span class="number">2</span></span><br><span class="line">iv = md5(key).digest()</span><br><span class="line"></span><br><span class="line">enc = bytes.fromhex(<span class="string">"69f421d9e241933cbc62a9ffe937779c864ffa193de014aeb57046b16c40c7353910c61a2676f14f4c7737f038a6db53262c50"</span>)</span><br><span class="line">cipher = AES.new(key, AES.MODE_CFB, iv=iv)</span><br><span class="line">flag = cipher.decrypt(enc)</span><br><span class="line"></span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment"># b'CCTF&#123;d3ep-Zip_fi5h_0f_tH3_knOwN_pL4!n_7exT_ATtAcK!&#125;'</span></span><br></pre></td></tr></table></figure>

<h3 id="ASIv1"><a href="#ASIv1" class="headerlink" title="ASIv1"></a>ASIv1</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base</span><span class="params">(n, l)</span>:</span></span><br><span class="line">    D = []</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        n, r = divmod(n, l)</span><br><span class="line">        D.append(r)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(str(d) <span class="keyword">for</span> d <span class="keyword">in</span> reversed(D)) <span class="keyword">or</span> <span class="string">'0'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">asiv_prng</span><span class="params">(seed)</span>:</span></span><br><span class="line">	l = len(seed)</span><br><span class="line">	_seed = base(bytes_to_long(seed), <span class="number">3</span>)</span><br><span class="line">	_seed = [int(_) <span class="keyword">for</span> _ <span class="keyword">in</span> _seed]</span><br><span class="line">	_l = len(_seed)</span><br><span class="line">	R = [[getRandomRange(<span class="number">0</span>, <span class="number">3</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(_l)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(_l**<span class="number">2</span>)]</span><br><span class="line">	S = []</span><br><span class="line">	<span class="keyword">for</span> r <span class="keyword">in</span> R:</span><br><span class="line">		s = <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> _ <span class="keyword">in</span> range(_l):</span><br><span class="line">			s += (r[_] * _seed[_]) % <span class="number">3</span></span><br><span class="line">		<span class="comment"># s += getRandomRange(0, 3)</span></span><br><span class="line">		s %= <span class="number">3</span></span><br><span class="line">		S.append(s)</span><br><span class="line">	<span class="keyword">return</span> R, S</span><br><span class="line"></span><br><span class="line">seed = flag.lstrip(<span class="string">b'CCTF&#123;'</span>).rstrip(<span class="string">b'&#125;'</span>)</span><br><span class="line">R, S = asiv_prng(seed)</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'output.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">f.write(<span class="string">f'R = <span class="subst">&#123;R&#125;</span>\nS = <span class="subst">&#123;S&#125;</span>'</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<p>题目首先将 flag 转为三进制，随后作为 <em>seed 数组，然后根据 _seed 数组的长度随机生成了一系列随机数组 R，然后对每一个 R 数组做运算<br>$$<br>s \equiv \sum</em>{i=0}^{n}r_i \cdot seed_i \pmod 3<br>$$<br>题目给出了 R 数组和由 s 组成的 S 数组，所以其实就是在模 3 下解一个线性同余方程组。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"output.txt "</span>) <span class="keyword">as</span> f:</span><br><span class="line">	data = f.read().split(<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line">R = eval(data[<span class="number">0</span>][<span class="number">4</span>:])</span><br><span class="line">S = eval(data[<span class="number">1</span>][<span class="number">4</span>:])</span><br><span class="line">RR = matrix(Zmod(<span class="number">3</span>),R[:<span class="number">200</span>])</span><br><span class="line">SS = vector(Zmod(<span class="number">3</span>),S[:<span class="number">200</span>])</span><br><span class="line">mm = RR.solve_right(SS)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span>.join(str(i) <span class="keyword">for</span> i <span class="keyword">in</span> mm)</span><br><span class="line">flag = int(flag,<span class="number">3</span>)</span><br><span class="line">print(long_to_bytes(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b'3Xpl0i7eD_bY_AtT4ck3r!'</span></span><br></pre></td></tr></table></figure>

<h3 id="TPSD"><a href="#TPSD" class="headerlink" title="TPSD"></a>TPSD</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">+ Welcome, esteemed cryptographers <span class="keyword">with</span> expertise <span class="keyword">in</span> <span class="built_in">number</span> theory!    +</span><br><span class="line">+ It's a pleasure <span class="keyword">to</span> have you here. Whether you're a seasoned veteran  +</span><br><span class="line">+ <span class="keyword">or</span> a budding enthusiast, let's dive <span class="keyword">in</span> <span class="keyword">and</span> explore <span class="keyword">the</span> fascinating   +</span><br><span class="line">+ world <span class="keyword">of</span> cryptography <span class="keyword">and</span> <span class="built_in">number</span> theory together!                    +</span><br><span class="line">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">+ We are looking <span class="keyword">for</span> <span class="keyword">the</span> <span class="built_in">integer</span> solution <span class="keyword">of</span> p^<span class="number">3</span> + q^<span class="number">3</span> + r^<span class="number">3</span> = <span class="number">1</span>, such +</span><br><span class="line">+ <span class="keyword">that</span> <span class="keyword">at</span> least one <span class="keyword">of</span> p, q, <span class="keyword">or</span> r <span class="keyword">is</span> prime. Submit each such triple    +</span><br><span class="line">+ <span class="keyword">at</span> <span class="keyword">every</span> step <span class="keyword">with</span> mentioned properties.                             +</span><br><span class="line">+ Send a triple array <span class="keyword">of</span> integers <span class="keyword">whose</span> absolute minimum value has     +</span><br><span class="line">+ almost (<span class="number">6</span>, <span class="number">26</span>)-bits. You are <span class="keyword">at</span> level <span class="number">1</span>:</span><br></pre></td></tr></table></figure>

<p>丢番图方程，需要给出值 $p,q,r$ 满足 $p^3 + q^3 + r^3 =1$，其中满足 $min(|p|,|q|,|e|)\in [2^l,2^h ]$。是一道数学题，也有现成结论，见《On the Diophantine Equation x3+y3+z3= 1》</p>
<p><img src="https://s2.loli.net/2023/08/14/Vr5RIUG7T6YyDpH.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random </span><br><span class="line"></span><br><span class="line">t = random.randint(<span class="number">2</span>**<span class="number">6</span>,<span class="number">2</span>**<span class="number">26</span>)</span><br><span class="line">p = <span class="number">9</span>*t**<span class="number">4</span></span><br><span class="line">q = <span class="number">-9</span>*t**<span class="number">4</span>+<span class="number">3</span>*t</span><br><span class="line">r = <span class="number">-9</span>*t**<span class="number">3</span>+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> p**<span class="number">3</span>+q**<span class="number">3</span>+r**<span class="number">3</span>==<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>显然三个参数里面 $r$ 应该是最小的，所以它的满足 $r \in [2^l,2^h]$，其次也只有 $r$ 有可能是一个素数，于是我们在区间内找到一个素数 $r$ 就能通过关卡了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">"05.cr.yp.toc.tf"</span>,<span class="string">"11137"</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	sh.recvuntil(<span class="string">"+ almost ("</span>)</span><br><span class="line">	l = int(sh.recvuntil(<span class="string">", "</span>)[:<span class="number">-2</span>])</span><br><span class="line">	h = int(sh.recvuntil(<span class="string">")"</span>)[:<span class="number">-1</span>])</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		t = random.randint(<span class="number">2</span>**(l//<span class="number">3</span>),<span class="number">2</span>**(h//<span class="number">3</span>))</span><br><span class="line">		r = <span class="number">-9</span>*t**<span class="number">3</span>+<span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> isprime(abs(r)) <span class="keyword">and</span> (<span class="number">2</span>**l)&lt;abs(r)&lt;(<span class="number">2</span>**h):</span><br><span class="line"></span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	p = <span class="number">9</span>*t**<span class="number">4</span></span><br><span class="line">	q = <span class="number">-9</span>*t**<span class="number">4</span>+<span class="number">3</span>*t</span><br><span class="line">	sh.recvuntil(<span class="string">"level"</span>)</span><br><span class="line">	sh.recvuntil(<span class="string">": \n"</span>)</span><br><span class="line">	sh.sendline(<span class="string">','</span>.join(str(i) <span class="keyword">for</span> i <span class="keyword">in</span> [p,q,r]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">b'+ gj, try the next level :)\n'</span></span><br><span class="line">    <span class="string">b'+ Send a triple array of integers whose absolute minimum value has     +\n'</span></span><br><span class="line">    <span class="string">b'+ almost (186, 206)-bits. You are at level 19: \n'</span></span><br><span class="line">[DEBUG] Sent <span class="number">0xe7</span> bytes:</span><br><span class="line">    <span class="string">b'2610575330510601411661135837391203680216386303602680076369749905572234291076173824,-2610575330510601411661135837391203680216386303602680076369749514060588681431841560,-20003813626888652657280145082395768211458812516684950505205247\n'</span></span><br><span class="line">[DEBUG] Received <span class="number">0x3f</span> bytes:</span><br><span class="line">    <span class="string">b'+ Congrats! the flag: CCTF&#123;pr1m3S_in_7ErnArY_Cu8!c_3qu4tI0nS!&#125;\n'</span></span><br></pre></td></tr></table></figure>

<h3 id="Trex"><a href="#Trex" class="headerlink" title="Trex"></a>Trex</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">die</span><span class="params">(*args)</span>:</span></span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pr</span><span class="params">(*args)</span>:</span></span><br><span class="line">	s = <span class="string">" "</span>.join(map(str, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">"\n"</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sc</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_inputs</span><span class="params">(a, b, c)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> all(isinstance(x, int) <span class="keyword">for</span> x <span class="keyword">in</span> [a, b, c]):</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">if</span> a == <span class="number">0</span> <span class="keyword">or</span> b == <span class="number">0</span> <span class="keyword">or</span> c == <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">if</span> a == b <span class="keyword">or</span> b == c <span class="keyword">or</span> a == c:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_solution</span><span class="params">(a, x, y, z)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> (x*x + y*y - x*y - a*(z**<span class="number">3</span>)) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	border = <span class="string">"|"</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">".::   Hi all, she DID it, you should do it too! Are you ready? ::.  "</span>, border)</span><br><span class="line">	pr(border, <span class="string">"Welcome to the Ternary World! You need to pass each level until 20  "</span>, border)</span><br><span class="line">	pr(border, <span class="string">"to get the flag. Pay attention that your solutions should be nonzero"</span>, border)</span><br><span class="line">	pr(border, <span class="string">"distinct integers. Let's start!                                     "</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	level, step = <span class="number">0</span>, <span class="number">19</span></span><br><span class="line">	<span class="keyword">while</span> level &lt;= step:</span><br><span class="line">		a = random.randint(<span class="number">2</span>**(level * <span class="number">12</span>), <span class="number">2</span>**(level*<span class="number">12</span> + <span class="number">12</span>))</span><br><span class="line">		equation = <span class="string">f'x^2 + y^2 - xy = <span class="subst">&#123;a&#125;</span>*z^3'</span></span><br><span class="line">		pr(<span class="string">f"Level <span class="subst">&#123;level + <span class="number">1</span>&#125;</span>: <span class="subst">&#123;equation&#125;</span>"</span>)</span><br><span class="line">		inputs = input().strip().split(<span class="string">","</span>)</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			x, y, z = map(int, inputs)</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			die(border, <span class="string">"Invalid input, Bye!!"</span>)</span><br><span class="line">		<span class="keyword">if</span> check_inputs(x, y, z):</span><br><span class="line">			<span class="keyword">if</span> check_solution(a, x, y, z):</span><br><span class="line">				pr(border, <span class="string">"Correct! Try the next level :)"</span>)</span><br><span class="line">				level += <span class="number">1</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				pr(border, <span class="string">"You didn't provide the correct solution."</span>)</span><br><span class="line">				die(border, <span class="string">"Better luck next time!"</span>)			</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			pr(border, <span class="string">"Your solutions should be non-zero distinct integers"</span>)</span><br><span class="line">			die(border, <span class="string">"Quiting..."</span>)</span><br><span class="line">		<span class="keyword">if</span> level == step:</span><br><span class="line">			pr(border, <span class="string">"Congratulations! You've successfully solved all the equations!"</span>)</span><br><span class="line">			die(border, <span class="string">f"flag: <span class="subst">&#123;flag&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>

<p>是一道数学题，要求对不同尺寸的 20 个 $a$，找到满足式子的  $x^2+y^2-xy = az^3$ 三个变量 $x,y,z$ 其中要求这三个变量均不为0，且两两不相等。</p>
<p>一个很自然的想法，右边是 3 次，是一个奇数次，那么我们设 $z=a$，这样右边就是 $a^4$，要好看些。题目要求 $x,y$ 不能相等，但并没要求它们不能相反，所以令  $x=-y$，这样左边就是 $3y^2$，有一个系数，配合的还不是很好。</p>
<p>调整一下，我们设 $z=3a$，这样右边就是 $27a^4$，于是有 $3y^2=27a^4$ ，我们令 $y = 3a^2$ 就可以满足等式的要求了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve</span><span class="params">(a)</span>:</span></span><br><span class="line">	z = <span class="number">3</span>*a</span><br><span class="line">	y = <span class="number">3</span>*a**<span class="number">2</span></span><br><span class="line">	x = -y</span><br><span class="line">	<span class="keyword">return</span> x,y,z</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">"03.cr.yp.toc.tf"</span>,<span class="string">"31317"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">19</span>):</span><br><span class="line">	sh.recvuntil(<span class="string">"x^2 + y^2 - xy = "</span>)</span><br><span class="line">	a = int(sh.recvuntil(<span class="string">"*"</span>)[:<span class="number">-1</span>])</span><br><span class="line">	x,y,z = solve(a)</span><br><span class="line">	sh.sendline(<span class="string">','</span>.join(str(i) <span class="keyword">for</span> i <span class="keyword">in</span> [x,y,z]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># | Correct! Try the next level :)</span></span><br><span class="line"><span class="comment"># | Congratulations! You've successfully solved all the equations!</span></span><br><span class="line"><span class="comment"># | flag: CCTF&#123;T3rn3ry_Tr3x_3Qu4t!0n&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Keymote"><a href="#Keymote" class="headerlink" title="Keymote"></a>Keymote</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_koymoted</span><span class="params">(nbit)</span>:</span></span><br><span class="line">	p = getPrime(nbit)</span><br><span class="line">	a, b = [randint(<span class="number">1</span>, p - <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">'__'</span>]</span><br><span class="line">	Ep = EllipticCurve(GF(p), [a, b])</span><br><span class="line">	tp = p + <span class="number">1</span> - Ep.order()</span><br><span class="line">	_s = p ^^ ((<span class="number">2</span> ** (nbit - <span class="number">1</span>)) + <span class="number">2</span> ** (nbit // <span class="number">2</span>))</span><br><span class="line">	q = next_prime(<span class="number">2</span> * _s + <span class="number">1</span>)</span><br><span class="line">	Eq = EllipticCurve(GF(q), [a, b])</span><br><span class="line">	n = p * q</span><br><span class="line">	tq = q + <span class="number">1</span> - Eq.order()</span><br><span class="line">	e = <span class="number">65537</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		<span class="keyword">if</span> gcd(e, (p**<span class="number">2</span> - tp**<span class="number">2</span>) * (q**<span class="number">2</span> - tq**<span class="number">2</span>)) == <span class="number">1</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			e = next_prime(e)</span><br><span class="line">	pkey, skey = (n, e, a, b), (p, q)</span><br><span class="line">	<span class="keyword">return</span> pkey, skey</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(msg, pkey, skey)</span>:</span></span><br><span class="line">	n, e, a, b = pkey</span><br><span class="line">	p, q = skey</span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	<span class="keyword">assert</span> m &lt; n</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		xp = (m**<span class="number">3</span> + a*m + b) % p</span><br><span class="line">		xq = (m**<span class="number">3</span> + a*m + b) % q</span><br><span class="line">		<span class="keyword">if</span> pow(xp, (p<span class="number">-1</span>)//<span class="number">2</span>, p) == pow(xq, (q<span class="number">-1</span>)//<span class="number">2</span>, q) == <span class="number">1</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			m += <span class="number">1</span></span><br><span class="line">	eq1, eq2 = Mod(xp, p), Mod(xq, q)</span><br><span class="line">	rp, rq = sqrt(eq1), sqrt(eq2)</span><br><span class="line">	_, x, y = xgcd(p, q)</span><br><span class="line">	Z = Zmod(n)</span><br><span class="line">	x = (Z(rp) * Z(q) * Z(y) + Z(rq) * Z(p) * Z(x)) % n</span><br><span class="line">	E = EllipticCurve(Z, [a, b])</span><br><span class="line">	P = E(m, x)</span><br><span class="line">	enc = e * P</span><br><span class="line">	<span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line">nbit = <span class="number">256</span></span><br><span class="line">pkey, skey = gen_koymoted(nbit)</span><br><span class="line">enc = encrypt(flag, pkey, skey)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f'pkey = <span class="subst">&#123;pkey&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'enc = <span class="subst">&#123;enc&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>

<p>我们从加密 <code>encrypt</code> 函数开始看，</p>
<p><code>xp = (m**3 + a*m + b) % p</code> 这里首先将 flag 放在了一条椭圆曲线上，作为 x 轴坐标 ，并且分别是在子群 p,q 下进行计算的。所以在后面使用了中国剩余定理来计算模 n 下曲线的 y 点，<code>x = (Z(rp) * Z(q) * Z(y) + Z(rq) * Z(p) * Z(x)) % n</code> </p>
<p>因此这一大部分的内容只是将 flag 放在一条模 $n$ 的椭圆曲线 $E$ 上作为 $P$ 点，随后加密计算得到 $enc = eP$。如果我们能够知道 $P$ 点的阶，我们直接对 $e$ 在该阶下求乘法逆元即可。但由于是模 $n$，这里我们没法计算。我们也需要先在子群 $p,q$ 下求出 $P$ 点的 $x$ 轴坐标，然后再用中国剩余定理进行组合。</p>
<p>那么我们就需要先分解 $n$，我们看到 <code>gen_koymoted</code> 函数。$n=p\cdot q$，其中 $p$ 是一个随机的素数，但注意到 $q = 2 \cdot _s + a$，而 <code>_s = p ^^ ((2 ** (nbit - 1)) + 2 ** (nbit // 2))</code>，是将 $p$ 的第一个比特和中间一个比特进行了翻转。可以表示为 $s=p-A$，于是有 $n=p\cdot q = p\cdot (2p-2A+a)=2p^2-p(2A-a)$，其中 $A$ 已知，$a$ 是一个较小的值（不超过10000），于是我们可以爆破 $a$ 然后解丢番图方程，从而求出 $p$。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">nbit = <span class="number">256</span></span><br><span class="line">p = getPrime(nbit)</span><br><span class="line">_s = p ^ ((<span class="number">2</span> ** (nbit - <span class="number">1</span>)) + <span class="number">2</span> ** (nbit // <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">A = p-_s</span><br><span class="line">n=<span class="number">6660938713055850877314255610895820875305739186102790477966786501810416821294442374977193379731704125177528590285016474818841859956990486067573436301232301</span></span><br><span class="line"><span class="comment"># f = 2p^2-p(2A-a)-n</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> range(<span class="number">99999</span>):</span><br><span class="line">	delta = (<span class="number">2</span>*A-a)**<span class="number">2</span>+<span class="number">4</span>*<span class="number">2</span>*n</span><br><span class="line">	<span class="keyword">if</span> iroot(delta,<span class="number">2</span>)[<span class="number">1</span>]:</span><br><span class="line">		delta = iroot(delta,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">		p = ((<span class="number">2</span>*A-a)+delta)//<span class="number">4</span></span><br><span class="line">		<span class="keyword">assert</span> n%p==<span class="number">0</span></span><br><span class="line">		print(p)</span><br><span class="line">		print(n//p)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 93511613846272978051774379195449772332692693333173612296021789501865098047641</span></span><br><span class="line">		<span class="comment"># 71231138455229760679977773382211636812795966734548537479512744210680602878261</span></span><br></pre></td></tr></table></figure>

<p>然后我们分别在子群 $p,q$ 下计算 $P$ 点，然后取其 $x$ 轴坐标，使用 CRT 获取 flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">93511613846272978051774379195449772332692693333173612296021789501865098047641</span></span><br><span class="line">q = <span class="number">71231138455229760679977773382211636812795966734548537479512744210680602878261</span></span><br><span class="line">a = <span class="number">5539256645640498184116966196249666621079506508209770360679460869295427007578</span></span><br><span class="line">b = <span class="number">20151017657582479433586370393795140515103572865771721775868586710594524816458</span></span><br><span class="line">Q = (<span class="number">6641320679869421443758875467781930795132746694454926965779628505713445486895274490835545942727970688359873955019634877304270220728625521646208912044469433</span>,<span class="number">2856872654927815636828860866843721158889474116106462420201092148493803550131351543372740950198853438539317164093538508795630146854596724019329887894933972</span>)</span><br><span class="line"></span><br><span class="line">Ep = EllipticCurve(GF(p),[a,b])</span><br><span class="line"></span><br><span class="line">Qp = Ep(Q)</span><br><span class="line">Epo = Qp.order()</span><br><span class="line">Pp = Qp * inverse(<span class="number">65537</span>,Epo)</span><br><span class="line">mp = int(Pp.xy()[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Eq = EllipticCurve(GF(q),[a,b])</span><br><span class="line">Qq = Eq(Q)</span><br><span class="line">Eqo = Qq.order()</span><br><span class="line">Pq = Qq * inverse(<span class="number">65537</span>,Eqo)</span><br><span class="line">mq = int(Pq.xy()[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">m = crt([mp,mq],[p,q])</span><br><span class="line">print(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b'CCTF&#123;a_n3W_4t7aCk_0n_RSA_a9ain!?\x82'</span></span><br></pre></td></tr></table></figure>

<h3 id="Bertrand"><a href="#Bertrand" class="headerlink" title="Bertrand"></a>Bertrand</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, key, n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span><span class="params">(s, l)</span>:</span></span><br><span class="line">	<span class="keyword">while</span> len(s) &lt; l:</span><br><span class="line">		s += string.printable[randint(<span class="number">0</span>, <span class="number">61</span>)]</span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sox</span><span class="params">(n, d)</span>:</span></span><br><span class="line">	x, y, t = <span class="number">0</span>, <span class="number">0</span>, d</span><br><span class="line">	<span class="keyword">for</span> s <span class="keyword">in</span> range(n - <span class="number">1</span>):</span><br><span class="line">		u = <span class="number">1</span> &amp; t // <span class="number">2</span></span><br><span class="line">		v = <span class="number">1</span> &amp; t ^ u</span><br><span class="line">		x, y = spin(<span class="number">2</span>**s, x, y, u, v)</span><br><span class="line">		x += <span class="number">2</span>**s * u</span><br><span class="line">		y += <span class="number">2</span>**s * v</span><br><span class="line">		t = t // <span class="number">4</span></span><br><span class="line">	<span class="keyword">return</span> x, y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spin</span><span class="params">(n, x, y, u, v)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> v == <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">if</span> u == <span class="number">1</span>:</span><br><span class="line">			x = n - <span class="number">1</span> - x</span><br><span class="line">			y = n - <span class="number">1</span> - y</span><br><span class="line">		x, y = y, x</span><br><span class="line">	<span class="keyword">return</span> x, y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(msg, key, n)</span>:</span></span><br><span class="line">	_msg = pad(msg, n ** <span class="number">2</span>)</span><br><span class="line">	_msg, _key = [ord(_) <span class="keyword">for</span> _ <span class="keyword">in</span> _msg], [ord(_) <span class="keyword">for</span> _ <span class="keyword">in</span> key]</span><br><span class="line">	img = Image.new(<span class="string">'RGBA'</span>, (n, n), <span class="string">'darkblue'</span>)</span><br><span class="line">	pix = img.load()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> range(len(key)):</span><br><span class="line">		w = len(_key)</span><br><span class="line">		h = n**<span class="number">2</span> // w + <span class="number">1</span></span><br><span class="line">		arr = [[_msg[w*x + y] <span class="keyword">if</span> w*x + y &lt; n**<span class="number">2</span> <span class="keyword">else</span> <span class="literal">None</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(h)] <span class="keyword">for</span> y <span class="keyword">in</span> range(w)]</span><br><span class="line">		_conf = sorted([(_key[i], i) <span class="keyword">for</span> i <span class="keyword">in</span> range(w)])</span><br><span class="line">		_marshal = [arr[_conf[i][<span class="number">1</span>]] <span class="keyword">for</span> i <span class="keyword">in</span> range(w)]</span><br><span class="line">		_msg = functools.reduce(<span class="keyword">lambda</span> a, r: a + _marshal[r], range(w), [])</span><br><span class="line">		_msg = list(filter(<span class="keyword">lambda</span> x: x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, _msg))</span><br><span class="line">		_msg = [(_msg[_] + _key[_ % w]) % <span class="number">256</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(n**<span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> d <span class="keyword">in</span> range(n**<span class="number">2</span>):</span><br><span class="line">		x, y = sox(n, d)</span><br><span class="line">		pix[x,y] = (_msg[d], _msg[d], _msg[d])</span><br><span class="line">	keysum = sum(_key) <span class="keyword">if</span> w &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">	orient = keysum % <span class="number">4</span></span><br><span class="line">	img = img.rotate(<span class="number">90</span>*orient)</span><br><span class="line">	<span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> len(key) == <span class="number">3</span></span><br><span class="line">img = encrypt(flag, key, n)</span><br><span class="line">img.save(<span class="string">'enc.png'</span>)</span><br></pre></td></tr></table></figure>

<p>这道题目将 flag 的信息储存在了图片中，出题人对 python 语言的娴熟操作也令整个代码读起来会略微有点吃力，需要静下心来慢慢分析。我们先看到 <code>encrypt</code> 这个函数，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_msg = pad(msg, n ** <span class="number">2</span>)</span><br><span class="line">_msg, _key = [ord(_) <span class="keyword">for</span> _ <span class="keyword">in</span> _msg], [ord(_) <span class="keyword">for</span> _ <span class="keyword">in</span> key]</span><br><span class="line">img = Image.new(<span class="string">'RGBA'</span>, (n, n), <span class="string">'darkblue'</span>)</span><br><span class="line">pix = img.load()</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(len(key)):</span><br></pre></td></tr></table></figure>

<p>首先创建了一个 $n\times n$ 的图片，然后将 flag 填充至 $n\times n$ 的长度，随后分别用每个密钥进行处理，密钥未知，但是密钥的长度为3，并且使用了 ord 函数，说明每个密钥的值得范围是 $0-255$。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">w = len(_key)</span><br><span class="line">h = n**<span class="number">2</span> // w + <span class="number">1</span></span><br><span class="line">arr = [[_msg[w*x + y] <span class="keyword">if</span> w*x + y &lt; n**<span class="number">2</span> <span class="keyword">else</span> <span class="literal">None</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(h)] <span class="keyword">for</span> y <span class="keyword">in</span> range(w)]</span><br></pre></td></tr></table></figure>

<p>将 msg 分为三块 arr，但是分块类似于栅栏加密，第一块为第 [0,3,6….] 个字节，第二块为第 [1,4,7….] 个字节 ，第二块为第 [2,5,8….] 个字节。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_conf = sorted([(_key[i], i) <span class="keyword">for</span> i <span class="keyword">in</span> range(w)])</span><br><span class="line">_marshal = [arr[_conf[i][<span class="number">1</span>]] <span class="keyword">for</span> i <span class="keyword">in</span> range(w)]</span><br></pre></td></tr></table></figure>

<p>对密钥的大小进行排序，并记录原来的位置，例如原来有 <code>key = [123,251,34]</code>，排序后为 <code>conf = [(34, 2), (123, 0), (251, 1)]</code></p>
<p>随后置换消息块 arr 进行置换，规则按照 key 来，按照上面的例子，那么置换后的消息块为 arr[2],arr[0],arr[1]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_msg = functools.reduce(<span class="keyword">lambda</span> a, r: a + _marshal[r], range(w), [])</span><br><span class="line">_msg = list(filter(<span class="keyword">lambda</span> x: x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, _msg))</span><br><span class="line">_msg = [(_msg[_] + _key[_ % w]) % <span class="number">256</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(n**<span class="number">2</span>)]</span><br></pre></td></tr></table></figure>

<p>最后将三个数组拼接，并清除块中的 None 项，然后循环使用密钥逐元素进行模 256 加。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> range(n**<span class="number">2</span>):</span><br><span class="line">    x, y = sox(n, d)</span><br><span class="line">    pix[x,y] = (_msg[d], _msg[d], _msg[d])</span><br><span class="line">keysum = sum(_key) <span class="keyword">if</span> w &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">orient = keysum % <span class="number">4</span></span><br><span class="line">img = img.rotate(<span class="number">90</span>*orient)</span><br><span class="line"><span class="keyword">return</span> img</span><br></pre></td></tr></table></figure>

<p>如此操作三回后，将数组中的元素按一定规则放入图片中，最后根据三个密钥值的和来旋转图片。</p>
<p>这个 sox 规则可以本地用较小的数字测一下，发现就是希尔伯特曲线（但这并不是重点，我们也不需要逆，解密的时候再重新按照这个规则取点就好了）</p>
<p>那么想要恢复原来的图片的话，很直观的想法是爆破key，然后逆向解密：</p>
<ol>
<li>首先猜一个旋转角度，然后爆破key，求和后不符合我们设定的旋转角度的直接跳过（之所以先确定角度是因为按照希尔伯特曲线取点的操作很耗时，不能每次都取）</li>
<li>调用 sox 函数从图片取得信息，随后循环执行步骤 3-5三次：</li>
<li>循环使用密钥在模 256 下减</li>
<li>根据 “key 的大小关系” 反向置换</li>
<li>根据 “栅栏分块” 反向置换</li>
<li>取消息开头判断是不是 “CCTF”</li>
<li>无解的话换一个旋转角度，重新回到步骤 2</li>
</ol>
<p>理论可行，但是实践起来，发现运行起来非常耗时，一个角度都需要爆破十几个小时（用python的话）。<a href="https://zhuanlan.zhihu.com/p/643051459" target="_blank" rel="noopener">春哥</a>的解决方案是 C++，沛公选择了部分数据，看了下 <a href="https://blog.maple3142.net/2023/07/09/cryptoctf-2023-writeups/#bertrand" target="_blank" rel="noopener">maple</a> 的解决方案，是 z3 ！！！这种办法要简单很多了。因为所有的操作都是线性的，用 z3 去约束确实是可行的。</p>
<p>我们只需要爆破角度（一共四种），然后遍历 key 元素之间的大小关系（一共六种），然后按照加密规则进行操作，最后添加约束（用我们已知的 flag 头 ”CCTF{“ )即可。优雅，太优雅了！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://blog.maple3142.net/2023/07/09/cryptoctf-2023-writeups/#bertrand</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> z3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span><span class="params">(s, l)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> len(s) &lt; l:</span><br><span class="line">        s += string.printable[randint(<span class="number">0</span>, <span class="number">61</span>)]</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sox</span><span class="params">(n, d)</span>:</span></span><br><span class="line">    x, y, t = <span class="number">0</span>, <span class="number">0</span>, d</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> range(n - <span class="number">1</span>):</span><br><span class="line">        u = <span class="number">1</span> &amp; t // <span class="number">2</span></span><br><span class="line">        v = <span class="number">1</span> &amp; t ^ u</span><br><span class="line">        x, y = spin(<span class="number">2</span>**s, x, y, u, v)</span><br><span class="line">        x += <span class="number">2</span>**s * u</span><br><span class="line">        y += <span class="number">2</span>**s * v</span><br><span class="line">        t = t // <span class="number">4</span></span><br><span class="line">    <span class="keyword">return</span> x, y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spin</span><span class="params">(n, x, y, u, v)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> v == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> u == <span class="number">1</span>:</span><br><span class="line">            x = n - <span class="number">1</span> - x</span><br><span class="line">            y = n - <span class="number">1</span> - y</span><br><span class="line">        x, y = y, x</span><br><span class="line">    <span class="keyword">return</span> x, y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">256</span></span><br><span class="line">img = Image.open(<span class="string">"enc.png"</span>)</span><br><span class="line">img = img.rotate(<span class="number">90</span> * <span class="number">1</span>)  <span class="comment"># guess</span></span><br><span class="line">pix = img.load()</span><br><span class="line">msg = []</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> range(n**<span class="number">2</span>):</span><br><span class="line">    x, y = sox(n, d)</span><br><span class="line">    msg.append(pix[x, y][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">try_conf</span><span class="params">(conf)</span>:</span></span><br><span class="line">    key_sym = [z3.BitVec(<span class="string">"key_%d"</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>)]</span><br><span class="line">    msg_sym = [z3.BitVec(<span class="string">"msg_%d"</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n**<span class="number">2</span>)]</span><br><span class="line">    msg_arr = msg_sym[:]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(key_sym)):</span><br><span class="line">        w = len(key_sym)</span><br><span class="line">        h = n**<span class="number">2</span> // w + <span class="number">1</span></span><br><span class="line">        arr = [[msg_arr[w * x + y] <span class="keyword">if</span> w * x + y &lt; n**<span class="number">2</span> <span class="keyword">else</span> <span class="literal">None</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(h)] <span class="keyword">for</span> y <span class="keyword">in</span> range(w)]</span><br><span class="line">        _marshal = [arr[conf[i]] <span class="keyword">for</span> i <span class="keyword">in</span> range(w)]</span><br><span class="line">        msg_arr = functools.reduce(<span class="keyword">lambda</span> a, r: a + _marshal[r], range(w), [])</span><br><span class="line">        msg_arr = list(filter(<span class="keyword">lambda</span> x: x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, msg_arr))</span><br><span class="line">        msg_arr = [(msg_arr[_] + key_sym[_ % w]) % <span class="number">256</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(n**<span class="number">2</span>)]</span><br><span class="line">    sol = z3.Solver()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n**<span class="number">2</span>):</span><br><span class="line">        sol.add(msg_arr[i] == msg[i])</span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(msg_sym, <span class="string">b"CCTF&#123;"</span>):</span><br><span class="line">        sol.add(x == y)</span><br><span class="line">    <span class="keyword">if</span> sol.check() == z3.sat:</span><br><span class="line">        m = sol.model()</span><br><span class="line">        print([m.eval(x) <span class="keyword">for</span> x <span class="keyword">in</span> key_sym])</span><br><span class="line">        print(bytes([m.eval(x).as_long() <span class="keyword">for</span> x <span class="keyword">in</span> msg_sym])[:<span class="number">100</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> conf <span class="keyword">in</span> itertools.permutations(range(<span class="number">3</span>)):</span><br><span class="line">    <span class="comment"># correct conf = (1, 2, 0)</span></span><br><span class="line">    print(conf)</span><br><span class="line">    try_conf(conf)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">[<span class="number">107</span>, <span class="number">51</span>, <span class="number">89</span>]</span><br><span class="line"><span class="string">b'CCTF&#123;3nCrypTioN_8Y_c0lUmn4R_7rAnSp05it!On!&#125;9BB5bgJN8YNH2kRMynPqDmygUHsNCOoYAfn865iLVDKUBQhNuVfnQK65p'</span></span><br><span class="line">(<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Hard"><a href="#Hard" class="headerlink" title="Hard"></a>Hard</h2><h3 id="Big"><a href="#Big" class="headerlink" title="Big"></a>Big</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha512</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">genkey</span><span class="params">(nbit)</span>:</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		p = getPrime(nbit)</span><br><span class="line">		<span class="keyword">if</span> p % <span class="number">4</span> == <span class="number">3</span>:</span><br><span class="line">			q = int(str(p)[::<span class="number">-1</span>])</span><br><span class="line">			<span class="keyword">if</span> isPrime(q):</span><br><span class="line">				<span class="keyword">return</span> p * q, (p, q)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">(msg, pkey)</span>:</span></span><br><span class="line">	hid = sha512(msg).digest()</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		a = bytes_to_long(hid)</span><br><span class="line">		<span class="keyword">if</span> kronecker(a, pkey) == <span class="number">1</span>:</span><br><span class="line">			<span class="keyword">return</span> a</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			hid = sha512(hid).digest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(msg, pkey)</span>:</span></span><br><span class="line">	a, m = setup(msg, pkey), bytes_to_long(msg)</span><br><span class="line">	B, C = bin(m)[<span class="number">2</span>:], []</span><br><span class="line">	<span class="keyword">for</span> b <span class="keyword">in</span> B:</span><br><span class="line">		<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">			t = randint(<span class="number">1</span>, pkey)</span><br><span class="line">			<span class="keyword">if</span> kronecker(t, pkey) == <span class="number">2</span> * int(b) - <span class="number">1</span>:</span><br><span class="line">				C.append((t - a * inverse(t, pkey)) % pkey)</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">return</span> (a, C)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pkey, privkey = genkey(<span class="number">512</span>)</span><br><span class="line">E = encrypt(flag, pkey)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f'pkey = <span class="subst">&#123;pkey&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'E = <span class="subst">&#123;E&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>

<p>题目给出了一个 $n=p \cdot q$，其中满足 $p \equiv 3 \pmod 4$，并且 $p,q$ 的十进制数是前后相反的。那么首先我们就需要根据这个特性去将 $p,q$ 给恢复出来。掏出板子（其实就是加了约束的爆破）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># https://kt.gy/blog/2015/10/asis-2015-finals-rsasr/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">t</span><span class="params">(a, b, k)</span>:</span></span><br><span class="line">	<span class="comment"># sqrt(n) has 154 digits, so we need to figure out 77 digits on each side</span></span><br><span class="line">    <span class="keyword">if</span> k == (ndigs+<span class="number">1</span>)//<span class="number">2</span>:</span><br><span class="line">        <span class="keyword">if</span> a*b == n:</span><br><span class="line">          print(<span class="string">'p = %d'</span> % a)</span><br><span class="line">          print(<span class="string">'q = %d'</span> % b)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">			<span class="comment"># we try to guess the last not-already-guessed digits of both primes</span></span><br><span class="line">            a1 = a + i*(<span class="number">10</span>**k) + j*(<span class="number">10</span>**(ndigs-k))</span><br><span class="line">            b1 = b + j*(<span class="number">10</span>**k) + i*(<span class="number">10</span>**(ndigs-k))</span><br><span class="line">            <span class="keyword">if</span> a1*b1 &gt; n:</span><br><span class="line">				<span class="comment"># a1 and b1 are too large</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> (a1+(<span class="number">10</span>**(ndigs-k)))*(b1+(<span class="number">10</span>**(ndigs-k))) &lt; n:</span><br><span class="line">				<span class="comment"># a1 and b1 are too small</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> ((a1*b1)%(<span class="number">10</span>**(k+<span class="number">1</span>))) != (n%(<span class="number">10</span>**(k+<span class="number">1</span>))):</span><br><span class="line">				<span class="comment"># The last digits of a1*b1 (which won't change later) doesn't match n</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">			<span class="comment"># this a1 and b1 seem to be a possible match, try to guess remaining digits</span></span><br><span class="line">            t(a1, b1, k+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">n = <span class="number">72271787633166084700895603235291055045699965307538401174867474485084272711938364003794151073975875159886045553516299177522950407802715116792937858353646755246888532333536918663888208381012106370000886903776721867958523682675624556576505534100750339626081218194389244007622749982917071344697799413034317147013</span></span><br><span class="line">ndigs = len(str(isqrt(n)))<span class="number">-1</span></span><br><span class="line">t(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p = <span class="number">7690745050590286968025665448815927548186441771518218204702842288098845344789340509868897149374937793107491606741591691437711395848517107039674900831427939</span></span><br><span class="line">q = <span class="number">9397241380094769307017158485931177341961951476061947013977394739417988689050439874435488908822482074028128151771446818457295188445665208696820950505470967</span></span><br></pre></td></tr></table></figure>

<p>随后的加密是逐比特的，使用了 kronecker symbol：是勒让德符号以及雅可比符号的推广，将底数由正奇数推广至一切整数。因此就是数的二次剩余性质。密文 $c_i \equiv  t_i-\frac{a}{t_i}$ 组成，其中，如果$m_i = 0$， 则 $t_i$ 在模 $n$ 下是二次非剩余，如果$m_i = 1$， 则 $t_i$ 在模 $n$ 下是二次剩余。由于 $a$ 已知，所以我们有一个关于 $t_i$ 的一元二次同余式：$t_i^2 -c_it_i+a \equiv 0 \pmod n$，但理论上 $t_i$ 会有四个解，这四个 $t_i$ 的二次剩余性质是否一致呢？测一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	p = getPrime(<span class="number">128</span>)</span><br><span class="line">	q = getPrime(<span class="number">128</span>)</span><br><span class="line">	pkey = p*q</span><br><span class="line">	<span class="keyword">if</span> p%<span class="number">4</span>==<span class="number">3</span> <span class="keyword">and</span> q%<span class="number">4</span>==<span class="number">3</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">qsqrt</span><span class="params">(s,p)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> pow(s,(p+<span class="number">1</span>)//<span class="number">4</span>,p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	a = randint(<span class="number">1</span>, pkey)</span><br><span class="line">	<span class="keyword">if</span> kronecker(a, pkey) == <span class="number">1</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">	t = randint(<span class="number">1</span>, pkey)</span><br><span class="line">	<span class="keyword">if</span> kronecker(t, pkey) == <span class="number">1</span>:</span><br><span class="line">		c =(t - a * inverse(t, pkey)) % pkey</span><br><span class="line">		tp = (qsqrt(c^<span class="number">2</span>+<span class="number">4</span>*a,p)+c)/<span class="number">2</span></span><br><span class="line">		tq = (qsqrt(c^<span class="number">2</span>+<span class="number">4</span>*a,q)+c)/<span class="number">2</span></span><br><span class="line">		ti = crt([int(tp),int(tq)],[p,q])</span><br><span class="line">		print(kronecker(ti, pkey))</span><br></pre></td></tr></table></figure>

<p>代码中我只计算了四个解中的一个，但是所有的返回结果均显示  <code>kronecker(ti, pkey)=1</code>，也就是说，四个解均为二次剩余。因此我们只需要使用所有的 $c_i$，分别解出 $t_i$ ，判断其是否为二次剩余即可得到 flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">9397241380094769307017158485931177341961951476061947013977394739417988689050439874435488908822482074028128151771446818457295188445665208696820950505470967</span></span><br><span class="line">q = <span class="number">7690745050590286968025665448815927548186441771518218204702842288098845344789340509868897149374937793107491606741591691437711395848517107039674900831427939</span></span><br><span class="line">a = <span class="number">8288287062919561222859437914506472745100526530793196302687340335555115611914901909767968051705772262896385459058120439118678774481183385263128414336707441</span></span><br><span class="line">C = [...]</span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> C:</span><br><span class="line">	tp = (qsqrt(c^<span class="number">2</span>+<span class="number">4</span>*a,p)+c)/<span class="number">2</span></span><br><span class="line">	tq = (qsqrt(c^<span class="number">2</span>+<span class="number">4</span>*a,q)+c)/<span class="number">2</span></span><br><span class="line">	ti = crt([int(tp),int(tq)],[p,q])</span><br><span class="line">	flag += <span class="string">"1"</span> <span class="keyword">if</span> kronecker(ti, p*q)==<span class="number">1</span> <span class="keyword">else</span> <span class="string">"0"</span></span><br><span class="line">print(long_to_bytes(int(flag,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># b'CCTF&#123;_Cocks_18e_5chEm3&#125;'</span></span><br></pre></td></tr></table></figure>

<h3 id="Byeween"><a href="#Byeween" class="headerlink" title="Byeween"></a>Byeween</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@VM<span class="number">-0</span><span class="number">-7</span>-centos <span class="number">2023</span>CCTF]<span class="comment"># nc 03.cr.yp.toc.tf 33137</span></span><br><span class="line">||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><br><span class="line">|  Hi all, I have created a basic <span class="keyword">and</span> simple cryptography task about   |</span><br><span class="line">|  elliptic curve over rational field. Your mission <span class="keyword">is</span> to find all     |</span><br><span class="line">|  points Q over E such that <span class="number">2</span> * Q = P, such that P <span class="keyword">is</span> given.          |</span><br><span class="line">||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><br><span class="line">| Generating parameters, please wait...</span><br><span class="line">| Options: </span><br><span class="line">|	[I]informations </span><br><span class="line">|	[S]ubmit points </span><br><span class="line">|	[Q]uit</span><br><span class="line">I</span><br><span class="line">| E = Elliptic Curve defined by y^<span class="number">2</span> = x^<span class="number">3</span> - <span class="number">342446165721</span>*x over Rational Field</span><br><span class="line">| Q = (<span class="number">11312349909982661811485861119060804225</span>/<span class="number">19331014841872758669209197674496</span> : <span class="number">116099721688697073463805997395884506343692166552542145</span>/<span class="number">84992769577026199814140167579218475635959660544</span> : <span class="number">1</span>)</span><br><span class="line">| Options: </span><br><span class="line">|	[I]informations </span><br><span class="line">|	[S]ubmit points </span><br><span class="line">|	[Q]uit</span><br></pre></td></tr></table></figure>

<p>题目给定一条实数域下的曲线，然后需要我们给出点 $Q$ 满足 $2Q=P$ ，理论上来说在有理数域上这条曲线上应该是有无穷多点的，因此我们也不能求 $2$ 在曲线阶下的逆来解题。不过sagemath有一个现成的函数，我们在 SEECTF里面的 Isogeny Maze 一题也是遇到过的，就是 <code>division_points</code></p>
<p>于是</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">E = EllipticCurve(QQ,[<span class="number">-305870939136</span>,<span class="number">0</span>])</span><br><span class="line">Q = E(<span class="number">221303102265244533371483402644506621479115743892744422261154252676217167681</span>/<span class="number">213693626187627681294262261815109614857458011180352878308546312436900</span>,<span class="number">2783390608443160879347865193209570334025777278259973486688917132185180217527312885060303635922214606854675997921</span>/<span class="number">3123829724421951797186354163467857827737536183310312285378057065885446059832209901960648225147252153000</span>)</span><br><span class="line">Q.division_points(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">[(<span class="number">-581886118964997</span>/<span class="number">2395417249</span> : <span class="number">-30763025733327911831808</span>/<span class="number">117238906417807</span> : <span class="number">1</span>),</span><br><span class="line"> (<span class="number">-45549205864448</span>/<span class="number">188320729</span> : <span class="number">677260204084819298944</span>/<span class="number">2584325364067</span> : <span class="number">1</span>),</span><br><span class="line"> (<span class="number">5454365075973</span>/<span class="number">3869089</span> : <span class="number">-11589081804276058368</span>/<span class="number">7610498063</span> : <span class="number">1</span>),</span><br><span class="line"> (<span class="number">3920272615593</span>/<span class="number">2768896</span> : <span class="number">7067979399917751147</span>/<span class="number">4607442944</span> : <span class="number">1</span>)]</span><br></pre></td></tr></table></figure>

<p>交互</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">s</span><br><span class="line">| Please send the points on elliptic curve one by one: </span><br><span class="line"><span class="number">-581886118964997</span>/<span class="number">2395417249</span>,<span class="number">-30763025733327911831808</span>/<span class="number">117238906417807</span></span><br><span class="line">| You have sent <span class="number">1</span> correct points already!</span><br><span class="line">| Options: </span><br><span class="line">|	[I]informations </span><br><span class="line">|	[S]ubmit points </span><br><span class="line">|	[Q]uit</span><br><span class="line">s</span><br><span class="line">| Please send the points on elliptic curve one by one: </span><br><span class="line"><span class="number">-45549205864448</span>/<span class="number">188320729</span>,<span class="number">677260204084819298944</span>/<span class="number">2584325364067</span></span><br><span class="line">| You have sent <span class="number">2</span> correct points already!</span><br><span class="line">| Options: </span><br><span class="line">|	[I]informations </span><br><span class="line">|	[S]ubmit points </span><br><span class="line">|	[Q]uit</span><br><span class="line">s</span><br><span class="line">| Please send the points on elliptic curve one by one: </span><br><span class="line"><span class="number">5454365075973</span>/<span class="number">3869089</span>,<span class="number">-11589081804276058368</span>/<span class="number">7610498063</span></span><br><span class="line">| You have sent <span class="number">3</span> correct points already!</span><br><span class="line">| Options: </span><br><span class="line">|	[I]informations </span><br><span class="line">|	[S]ubmit points </span><br><span class="line">|	[Q]uit</span><br><span class="line">s</span><br><span class="line">| Please send the points on elliptic curve one by one: </span><br><span class="line"><span class="number">3920272615593</span>/<span class="number">2768896</span>,<span class="number">7067979399917751147</span>/<span class="number">4607442944</span></span><br><span class="line">| Congrats, you got the flag: <span class="string">b'CCTF&#123;H4lVin9_pO!ntS_0n_3lLipT1C_cuRve5!&#125;'</span></span><br></pre></td></tr></table></figure>

<p>也许出题人本意是让我们自己实现叭，故放在了 hard 难度，没想到 sagemath 就有现成的实现。</p>
<h3 id="Majan"><a href="#Majan" class="headerlink" title="Majan"></a>Majan</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="number">114863632180633827211184132915225798242263961691870412740605315763112513729991</span></span><br><span class="line">A = <span class="number">-3</span></span><br><span class="line">B = <span class="number">105675527217961035404524512435875047840495516468907806313576241823653895562912</span></span><br><span class="line">E = EllipticCurve(GF(p), [A, B])</span><br><span class="line">G = E.random_point()</span><br><span class="line">_o = E.order()</span><br><span class="line">original_msg = <span class="string">'I love all cryptographers!!!'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">die</span><span class="params">(*args)</span>:</span></span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pr</span><span class="params">(*args)</span>:</span></span><br><span class="line">	s = <span class="string">" "</span>.join(map(str, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">"\n"</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sc</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span><span class="params">(E)</span>:</span></span><br><span class="line">	skey = randint(<span class="number">1</span>, _o)</span><br><span class="line">	pkey = skey * G</span><br><span class="line">	<span class="keyword">return</span> pkey, skey</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(msg, pkey)</span>:</span></span><br><span class="line">	e, l = randint(<span class="number">1</span>, _o), len(msg)</span><br><span class="line">	m1, m2 = bytes_to_long(msg[:l // <span class="number">2</span>]), bytes_to_long(msg[l // <span class="number">2</span>:])</span><br><span class="line">	<span class="keyword">assert</span> m1 &lt; p <span class="keyword">and</span> m2 &lt; p</span><br><span class="line">	e1, e2 = (e * pkey).xy()</span><br><span class="line">	c1, c2 = m1 * e1 % p, m2 * e2 % p</span><br><span class="line">	<span class="keyword">return</span> (c1, c2, e * G)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign</span><span class="params">(msg, skey)</span>:</span></span><br><span class="line">	_tail = bytes_to_long(sha256(str(skey).encode(<span class="string">'utf-8'</span>)).digest()) % (<span class="number">1</span> &lt;&lt; <span class="number">24</span>)</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		K = [randint(<span class="number">1</span>, <span class="number">2</span>**<span class="number">255</span>) // (<span class="number">1</span> &lt;&lt; <span class="number">24</span>) + _tail <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">'__'</span>]</span><br><span class="line">		r, s = int((K[<span class="number">0</span>] * G).xy()[<span class="number">0</span>]), int((K[<span class="number">1</span>] * G).xy()[<span class="number">1</span>])</span><br><span class="line">		<span class="keyword">if</span> r * s != <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	h = bytes_to_long(sha256(msg).digest())</span><br><span class="line">	t = inverse(K[<span class="number">0</span>], _o) * (h * r - s * skey) % _o</span><br><span class="line">	<span class="keyword">return</span> (r, s, t)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify</span><span class="params">(msg, pkey, _sign)</span>:</span></span><br><span class="line">	r, s, t = [int(_) % _o <span class="keyword">for</span> _ <span class="keyword">in</span> _sign]</span><br><span class="line">	h = bytes_to_long(sha256(msg.encode(<span class="string">'utf-8'</span>)).digest())</span><br><span class="line">	u = int(h * r * inverse(t, _o) % _o)</span><br><span class="line">	v = int(s * inverse(t, _o) % _o)</span><br><span class="line">	<span class="comment"># u = h * r * inverse(t, _o) % _o</span></span><br><span class="line">	<span class="comment"># v = s * inverse(t, _o) % _o</span></span><br><span class="line">	_R = (u * G - v * pkey).xy()[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">return</span> _R == r</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	border = <span class="string">"|"</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">"Hi all, now it's time to solve a probably simple ECC challenge about"</span>, border)</span><br><span class="line">	pr(border, <span class="string">"encryption and signing in elliptic curves! Follow the questions and "</span>, border)</span><br><span class="line">	pr(border, <span class="string">"find the secret flag, are you ready!?                               "</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	pkey, skey = keygen(E)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		pr(<span class="string">"| Options: \n|\t[E]ncrypt a message! \n|\t[G]et the flag \n|\t[P]ublic Key \n|\t[S]ign a message \n|\t[V]erify signature \n|\t[Q]uit"</span>)</span><br><span class="line">		ans = sc().decode().lower().strip()</span><br><span class="line">		<span class="keyword">if</span> ans == <span class="string">'e'</span>:</span><br><span class="line">			pr(border, <span class="string">'Send your message here: '</span>)</span><br><span class="line">			_msg = sc()</span><br><span class="line">			_enc = encrypt(_msg, pkey)</span><br><span class="line">			pr(border, <span class="string">f'enc = <span class="subst">&#123;_enc&#125;</span>'</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">'g'</span>:</span><br><span class="line">			pr(border, <span class="string">'You should send the valid signature for my given message!'</span>)</span><br><span class="line">			pr(border, <span class="string">'Send the signature of original message here: '</span>)</span><br><span class="line">			_sgn = sc().split(<span class="string">b','</span>)</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				_sgn = [int(_) <span class="keyword">for</span> _ <span class="keyword">in</span> _sgn]</span><br><span class="line">				<span class="keyword">if</span> verify(original_msg, pkey, _sgn):</span><br><span class="line">					die(border, <span class="string">f'Congratz! You got the flag: <span class="subst">&#123;flag&#125;</span>'</span>)</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					pr(border, <span class="string">'Your signature is not correct!'</span>)</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				<span class="keyword">import</span> traceback; traceback.print_exc()</span><br><span class="line">				pr(border, <span class="string">'Try to send valid signature!'</span>)</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">'s'</span>:</span><br><span class="line">			pr(border, <span class="string">'Send your message to sign: '</span>)</span><br><span class="line">			_msg = sc()</span><br><span class="line">			<span class="keyword">if</span> len(_msg) &gt;= <span class="number">10</span>:</span><br><span class="line">				die(border, <span class="string">'Sorry, I sign only short messages! :/'</span>)</span><br><span class="line">			_sgn = sign(_msg, skey)</span><br><span class="line">			pr(border, <span class="string">f'sgn = <span class="subst">&#123;_sgn&#125;</span>'</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">'v'</span>:</span><br><span class="line">			pr(border, <span class="string">'Send your signature to verify: '</span>)</span><br><span class="line">			_sgn = sc().split(<span class="string">b','</span>)</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				_sgn = [int(_) <span class="keyword">for</span> _ <span class="keyword">in</span> _sgn]</span><br><span class="line">				pr(border, <span class="string">'Send your message: '</span>)</span><br><span class="line">				_msg = sc()</span><br><span class="line">				<span class="keyword">if</span> verify(_msg, pkey, _sgn):</span><br><span class="line">					pr(border, <span class="string">'Your message successfully verified :)'</span>)</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					pr(border, <span class="string">'Verification failed :('</span>)</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				pr(border, <span class="string">'Try to send valid signature!'</span>)</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">'p'</span>:</span><br><span class="line">			pr(border, <span class="string">f'pkey = <span class="subst">&#123;pkey&#125;</span>'</span>)</span><br><span class="line">			pr(border, <span class="string">f'G = <span class="subst">&#123;G&#125;</span>'</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">'q'</span>:</span><br><span class="line">			die(border, <span class="string">'Quitting...'</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">'You should select valid choice!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>

<p>题目是基于 ECC 的加密、签名系统，提供四个服务</p>
<ol>
<li>提供加密服务</li>
<li>提供签名服务，但是签名的数据长度不能超过 10 </li>
<li>提供验签服务</li>
<li>如果提供的签名是消息 <code>I love all cryptographers!!!</code> 的签名，则给出 flag。</li>
</ol>
<p>注意到由于签名服务限制了消息长度，我们无法直接让服务端给我们计算 <code>I love all cryptographers!!!</code> 的签名，那么应该是利用其他服务来获取服务端的私钥，然后自己计算签名。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(msg, pkey)</span>:</span></span><br><span class="line">	e, l = randint(<span class="number">1</span>, _o), len(msg)</span><br><span class="line">	m1, m2 = bytes_to_long(msg[:l // <span class="number">2</span>]), bytes_to_long(msg[l // <span class="number">2</span>:])</span><br><span class="line">	<span class="keyword">assert</span> m1 &lt; p <span class="keyword">and</span> m2 &lt; p</span><br><span class="line">	e1, e2 = (e * pkey).xy()</span><br><span class="line">	c1, c2 = m1 * e1 % p, m2 * e2 % p</span><br><span class="line">	<span class="keyword">return</span> (c1, c2, e * G)</span><br></pre></td></tr></table></figure>

<p>加密算法 encrypt：</p>
<p>输入： $m,pubkey$</p>
<p>$e \in (1,_o)$</p>
<p>$(e_1,e_2) = e\cdot pkey = e \cdot sk \cdot G$</p>
<p>$c_1 \equiv m_1\cdot e_1 \pmod p,c_2 \equiv m_2\cdot e_2 \pmod p$</p>
<p>输出 $c_1,c_2,e\cdot G$</p>
<p>根据加密逻辑，我们可以利用加密服务，比如传一个 <code>&#39;\x01\x01&#39;</code>，就能获得 $e_1,e_2$，于是我们就能获得 $(e_1,e_2)=e\cdot sk\cdot G$，我们还知道 $e\cdot G$，如果能解 <strong>ECDLP</strong>，就能够计算 $sk = log_{eG}(e\cdot sk\cdot G)$ ，从而获取私钥了，不过显然难度为 hard 题，不会提供一个能直接解 <strong>ECDLP</strong> 的题，我们看看别处。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign</span><span class="params">(msg, skey)</span>:</span></span><br><span class="line">	_tail = bytes_to_long(sha256(str(skey).encode(<span class="string">'utf-8'</span>)).digest()) % (<span class="number">1</span> &lt;&lt; <span class="number">24</span>)</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		K = [randint(<span class="number">1</span>, <span class="number">2</span>**<span class="number">255</span>) // (<span class="number">1</span> &lt;&lt; <span class="number">24</span>) + _tail <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">'__'</span>]</span><br><span class="line">		r, s = int((K[<span class="number">0</span>] * G).xy()[<span class="number">0</span>]), int((K[<span class="number">1</span>] * G).xy()[<span class="number">1</span>])</span><br><span class="line">		<span class="keyword">if</span> r * s != <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	h = bytes_to_long(sha256(msg).digest())</span><br><span class="line">	t = inverse(K[<span class="number">0</span>], _o) * (h * r - s * skey) % _o</span><br><span class="line">	<span class="keyword">return</span> (r, s, t)</span><br></pre></td></tr></table></figure>

<p>签名算法 sign</p>
<p>输入：$m$</p>
<p>$K =[k_0+tail,k_1+tail] $</p>
<p>$r = K_0  G.x$</p>
<p>$s=K_1G.x$</p>
<p>$h = sha256(msg)$</p>
<p>$t \equiv \frac{h\cdot r-s\cdot skey}{K_0} \pmod {_o}$</p>
<p>输出：$(r,s,t)$</p>
<p>那么这里很显然有一个出题人故意设置的点，就是 $K_0,K_1$ 的长度是比较短的，（因为 $K$ 整除了 <code>1&lt;&lt;24</code> ），我们还能不断的调用签名函数，这就不由让人想到 HNP 了。然后想，如果我们能够解决 HNP，那么我们就能恢复 $K_0$，然后就能利用 $t,h,r,s$ 恢复私钥 $skey$ 了，那就结束了！</p>
<p>那么想一下如果构造来解这样一个 HNP，根据 $t$ 的生成公式，</p>
<p>我们有 $K_0 \equiv  t^{-1}\cdot h\cdot r-t^{-1} \cdot s\cdot skey \pmod o$，</p>
<p>其中 $r,s,t$ 已知，</p>
<p>我们设 $A = -t^{-1}\cdot s，B = t^{-1}\cdot h\cdot r,$，</p>
<p>于是有 $K_0 = A\cdot skey+B + kp$</p>
<p>很像最开始接触 HNP 遇到的祥哥（Soreat_u）出的一道题 <a href="https://blog.soreatu.com/posts/intended-solution-to-nhp-in-gxzyctf-2020/#summary" target="_blank" rel="noopener">XCTF2020-高校战役-NHP</a>)，那个题也是不断交互，需要拿到临时密钥比较短的签名。</p>
<p>这里我们构造经典的 HNP 格子，其中 $K = 2^{231}$</p>
<p>$M =<br>\begin{bmatrix}<br>o  &amp;   &amp;      &amp;    &amp;   &amp;   &amp; \newline<br>&amp; o &amp;      &amp;    &amp;   &amp;   &amp; \newline<br>&amp;   &amp;\ddots&amp;    &amp;   &amp;   &amp; \newline<br>&amp;   &amp;      &amp; o  &amp;   &amp;   &amp; \newline<br>A_0&amp;A_1&amp;\dots &amp; A_t&amp;K/o&amp;   &amp; \newline<br>B_0&amp;B_1&amp;\dots &amp; B_t&amp;   &amp; K &amp; \newline<br>\end{bmatrix}$</p>
<p>然后这里就会存在一个向量 $v = \begin{bmatrix} k_0 &amp; k_1 &amp; \cdots &amp; k_t &amp; skey &amp; 1 \end{bmatrix}$</p>
<p>使得 $vM = \begin{bmatrix} K_0 &amp; K_1 &amp; \cdots &amp; K_t &amp; skey\cdot K/o &amp; K \end{bmatrix}$</p>
<p>再消去 $K/o$ ，我们就能直接获取到 $skey$ 了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">p = <span class="number">114863632180633827211184132915225798242263961691870412740605315763112513729991</span></span><br><span class="line">A = <span class="number">-3</span></span><br><span class="line">B = <span class="number">105675527217961035404524512435875047840495516468907806313576241823653895562912</span></span><br><span class="line">E = EllipticCurve(GF(p), [A, B])</span><br><span class="line">G = E.random_point()</span><br><span class="line">o = _o = E.order()</span><br><span class="line">original_msg = <span class="string">b'I love all cryptographers!!!'</span></span><br><span class="line"></span><br><span class="line">local = <span class="literal">False</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> local:</span><br><span class="line">    <span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">    sh = remote(<span class="string">'06.cr.yp.toc.tf'</span>,<span class="string">'13337'</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">"[Q]uit\n"</span>)</span><br><span class="line">    sh.sendline(<span class="string">"P"</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">"| pkey = ("</span>)</span><br><span class="line">    x = int(sh.recvuntil(<span class="string">" : "</span>)[:<span class="number">-3</span>])</span><br><span class="line">    y = int(sh.recvuntil(<span class="string">" : "</span>)[:<span class="number">-3</span>])</span><br><span class="line">    pubkey = E(x,y)</span><br><span class="line"></span><br><span class="line">    sh.recvuntil(<span class="string">"G = ("</span>)</span><br><span class="line">    x = int(sh.recvuntil(<span class="string">" : "</span>)[:<span class="number">-3</span>])</span><br><span class="line">    y = int(sh.recvuntil(<span class="string">" : "</span>)[:<span class="number">-3</span>])</span><br><span class="line">    G = E(x,y)</span><br><span class="line">    print(pubkey,G)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_sign</span><span class="params">(msg)</span>:</span></span><br><span class="line">    sh.recvuntil(<span class="string">"[Q]uit\n"</span>)</span><br><span class="line">    sh.sendline(<span class="string">"S"</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">"sign: "</span>)</span><br><span class="line">    sh.sendline(msg)</span><br><span class="line">    sh.recvuntil(<span class="string">'sgn = '</span>)</span><br><span class="line">    sig = eval(sh.recvuntil(<span class="string">")"</span>))</span><br><span class="line">    <span class="keyword">return</span> sig</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign</span><span class="params">(msg, skey)</span>:</span></span><br><span class="line">    _tail = bytes_to_long(sha256(str(skey).encode(<span class="string">'utf-8'</span>)).digest()) % (<span class="number">1</span> &lt;&lt; <span class="number">24</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        K = [randint(<span class="number">1</span>, <span class="number">2</span>**<span class="number">255</span>) // (<span class="number">1</span> &lt;&lt; <span class="number">24</span>) + _tail <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">'__'</span>]</span><br><span class="line">        r, s = int((K[<span class="number">0</span>] * G).xy()[<span class="number">0</span>]), int((K[<span class="number">1</span>] * G).xy()[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> r * s != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    h = bytes_to_long(sha256(msg).digest())</span><br><span class="line">    t = inverse(K[<span class="number">0</span>], _o) * (h * r - s * skey) % _o</span><br><span class="line">    <span class="keyword">return</span> (r, s, t)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span><span class="params">(E)</span>:</span></span><br><span class="line">    skey = randint(<span class="number">1</span>, _o)</span><br><span class="line">    pkey = skey * G</span><br><span class="line">    <span class="keyword">return</span> pkey, skey</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    pubkey, skey = keygen(E)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A = []</span><br><span class="line">B = []</span><br><span class="line">times = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> len(A)&lt;<span class="number">40</span>:</span><br><span class="line">    print(len(A))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        times+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> local:</span><br><span class="line">            r,s,t = get_sign(str(times).encode())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r,s,t = sign(str(times).encode(),skey)</span><br><span class="line">        h = bytes_to_long(sha256((str(times)+<span class="string">"\n"</span>).encode(<span class="string">'utf-8'</span>)).digest())	<span class="comment"># 这里好坑，我卡了好久，本地都能成功，远程就是失败，一直找不到原因，最后才意识到可能是 hash 算错了。</span></span><br><span class="line">        A.append(int((-inverse(t,o)*s)%o))</span><br><span class="line">        B.append(int(inverse(t,o)*h*r%o))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(str(e))</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">"construct hnp lattice..."</span>)</span><br><span class="line">CC = matrix(QQ,[A,B])</span><br><span class="line">K = <span class="number">2</span>^<span class="number">232</span></span><br><span class="line">DD = matrix(QQ,[[K/o,<span class="number">0</span>],[<span class="number">0</span>,K]])</span><br><span class="line">MM = block_matrix(QQ,[[o,<span class="number">0</span>],[CC,DD]])</span><br><span class="line">L = MM.LLL()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> L:</span><br><span class="line">    <span class="keyword">if</span> abs(each[<span class="number">-1</span>]) == K:</span><br><span class="line">        <span class="keyword">if</span> each[<span class="number">-2</span>] * o % K == <span class="number">0</span>:</span><br><span class="line">            print(each)</span><br><span class="line">            ss = (each[<span class="number">-2</span>] * o // K)%o</span><br><span class="line">            <span class="comment"># skey = abs(skey)</span></span><br><span class="line">            print(pubkey == ss*G)</span><br><span class="line">            signatrue = sign(original_msg, ss)</span><br><span class="line">            sh.recvuntil(<span class="string">"[Q]uit\n"</span>)</span><br><span class="line">            sh.sendline(<span class="string">"G"</span>)</span><br><span class="line">            sh.recvuntil(<span class="string">"message here: "</span>)</span><br><span class="line">            sh.sendline(<span class="string">','</span>.join(str(i)<span class="keyword">for</span> i <span class="keyword">in</span> signatrue))</span><br><span class="line">            sh.interactive()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># print(int(each[0]).bit_length(),skey)</span></span><br><span class="line">        </span><br><span class="line">[DEBUG] Received <span class="number">0x46</span> bytes:</span><br><span class="line">    <span class="string">b"| Congratz! You got the flag: b'CCTF&#123;L4T71c3_atTAck5_a9A!nS7_ECDSA!&#125;'\n"</span></span><br><span class="line">| Congratz! You got the flag: <span class="string">b'CCTF&#123;L4T71c3_atTAck5_a9A!nS7_ECDSA!&#125;'</span></span><br></pre></td></tr></table></figure>

<p>比较坑的一个点是，服务端在接受用户的输入的时候，把回车符号也算进去了，所以本地在计算 $h$ 的时候需要注意。</p>
<h3 id="Vinefruit"><a href="#Vinefruit" class="headerlink" title="Vinefruit"></a>Vinefruit</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">die</span><span class="params">(*args)</span>:</span></span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pr</span><span class="params">(*args)</span>:</span></span><br><span class="line">	s = <span class="string">" "</span>.join(map(str, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">"\n"</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sc</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vinefruit</span><span class="params">(msg, mod, flag = <span class="number">0</span>)</span>:</span></span><br><span class="line">	P = [<span class="number">16777619</span>, <span class="number">1099511628211</span>, <span class="number">309485009821345068724781371</span>]</span><br><span class="line">	O = [<span class="number">2166136261</span>, <span class="number">14695981039346656037</span>, <span class="number">144066263297769815596495629667062367629</span>]</span><br><span class="line">	<span class="keyword">assert</span> mod <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">	p, o, m = P[mod], O[mod], <span class="number">2</span> ** (<span class="number">2</span> &lt;&lt; (<span class="number">4</span> + mod))</span><br><span class="line">	vine = o</span><br><span class="line">	<span class="keyword">for</span> b <span class="keyword">in</span> msg:</span><br><span class="line">		<span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">			vine = (vine + b) % (<span class="number">2</span> ** <span class="number">128</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			vine = vine ^ b</span><br><span class="line">		vine = (vine * p) % m</span><br><span class="line">	<span class="keyword">return</span> vine</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	border = <span class="string">"|"</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">" Hi all, I have designed a gorgeous cryptography hash function in   "</span>, border)</span><br><span class="line">	pr(border, <span class="string">" order to secure the world! Your mission is to find collision for   "</span>, border)</span><br><span class="line">	pr(border, <span class="string">" this function with specific conditions.                            "</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	</span><br><span class="line">	step = <span class="number">19</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		pr(<span class="string">"| Options: \n|\t[S]ubmit collision \n|\t[Q]uit"</span>)</span><br><span class="line">		ans = sc().decode().lower().strip()</span><br><span class="line">		<span class="keyword">if</span> ans == <span class="string">'s'</span>:</span><br><span class="line">			S = []</span><br><span class="line">			<span class="keyword">for</span> level <span class="keyword">in</span> range(step):</span><br><span class="line">				mod = random.randint(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">				pr(border, <span class="string">f'Submit two different string such that vinefruit(m1, <span class="subst">&#123;mod&#125;</span>, 1) = vinefruit(m2, <span class="subst">&#123;mod&#125;</span>, 1)'</span>)</span><br><span class="line">				pr(border, <span class="string">f'You are at level: <span class="subst">&#123;level + <span class="number">1</span>&#125;</span>'</span>)</span><br><span class="line">				<span class="keyword">if</span> level == step - <span class="number">1</span> <span class="keyword">and</span> len(S) == step - <span class="number">1</span>:</span><br><span class="line">					die(border, <span class="string">f'Congrats, you got the flag: <span class="subst">&#123;flag&#125;</span>'</span>)</span><br><span class="line">				<span class="keyword">try</span>:</span><br><span class="line">					pr(border, <span class="string">f'Please send first byte string: '</span>)</span><br><span class="line">					s1 = sc()[:<span class="number">-1</span>]</span><br><span class="line">					pr(border, <span class="string">f'Please send second byte string: '</span>)</span><br><span class="line">					s2 = sc()[:<span class="number">-1</span>]</span><br><span class="line">					s1, s2 = binascii.unhexlify(s1), binascii.unhexlify(s2)</span><br><span class="line">				<span class="keyword">except</span>:</span><br><span class="line">					pr(border, <span class="string">'You should send valid hex strings.'</span>)</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">				<span class="keyword">if</span> len(s1) == len(s2) == <span class="number">35</span> - level <span class="keyword">and</span> s1 != s2:</span><br><span class="line">					<span class="keyword">if</span> vinefruit(s1, mod, <span class="number">1</span>) == vinefruit(s2, mod, <span class="number">1</span>):</span><br><span class="line">						<span class="keyword">if</span> vinefruit(s1, mod, <span class="number">1</span>) <span class="keyword">not</span> <span class="keyword">in</span> S:</span><br><span class="line">							S.append(vinefruit(s1, mod, <span class="number">1</span>))</span><br><span class="line">							pr(border, <span class="string">'gj, try the next level :)'</span>)</span><br><span class="line">						<span class="keyword">else</span>:</span><br><span class="line">							<span class="keyword">break</span></span><br><span class="line">					<span class="keyword">else</span>:</span><br><span class="line">						<span class="keyword">break</span></span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					die(border, <span class="string">'Kidding me?! Try again and be smart!! Bye!!!'</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">'q'</span>:</span><br><span class="line">			die(border, <span class="string">'Quitting...'</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">'You should select valid choice!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>

<p>简而言之，服务端每次指定一个 <code>mod</code>，<code>mod</code> 会确定 <code>o,p,m</code>，我们需要找到两个指定长度的不同消息 $S_1,S_2$，满足 $f(S_1) \equiv  f(S_2) \pmod m$，设 $S=m_l||m_{l-1}||\cdots||m_1$ ，那么有 $f(S)\equiv \sum_{i=1}^n m_i \cdot p^i \pmod m$</p>
<p>其实这和我们在 <strong><a href="https://mp.weixin.qq.com/s?__biz=Mzg5OTkxMzM3NA==&mid=2247483790&idx=1&sn=85841fd6a6443fd5a0cec417f0359811&chksm=c04d427ff73acb694569a661b332f31b1249e92538e3e7bae195117244855be293dedc69c18c&token=1723194808&lang=zh_CN#rd" target="_blank" rel="noopener">SEECTF</a></strong> 遇到的 <strong>onelinecrypto</strong> 差不多，那一题是要求 $f(S) \equiv 0 \pmod {13^{37}}$，并且还要求 $S$ 都是可见字符，而这一题约束就要松的多了，因此这里也不需要用到枚举，我也是照搬脚本，只是稍微改了改交互。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">avg = <span class="number">127</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span><span class="params">(mod,level)</span>:</span></span><br><span class="line"></span><br><span class="line">    P = [<span class="number">16777619</span>, <span class="number">1099511628211</span>, <span class="number">309485009821345068724781371</span>]</span><br><span class="line">    O = [<span class="number">2166136261</span>, <span class="number">14695981039346656037</span>, <span class="number">144066263297769815596495629667062367629</span>]</span><br><span class="line">    p, o, m = P[mod], O[mod], <span class="number">2</span> ** (<span class="number">2</span> &lt;&lt; (<span class="number">4</span> + mod))</span><br><span class="line">    M = m</span><br><span class="line"></span><br><span class="line">    length = <span class="number">35</span> - level</span><br><span class="line">    P = PolynomialRing(ZZ, <span class="string">"ap"</span>, length)</span><br><span class="line">    aps = P.gens()</span><br><span class="line">    aa = [ap + avg <span class="keyword">for</span> ap <span class="keyword">in</span> aps]</span><br><span class="line">    f = sum([a * p**(i+<span class="number">1</span>) <span class="keyword">for</span> i, a <span class="keyword">in</span> enumerate(aa)]) + o - length</span><br><span class="line"></span><br><span class="line">    L = matrix(f.coefficients()).T</span><br><span class="line">    L = block_matrix([[<span class="number">1</span>,L],[<span class="number">0</span>,M]])</span><br><span class="line">    scale = [<span class="number">1</span>]*(length+<span class="number">1</span>) + [<span class="number">2</span>**<span class="number">20</span>]</span><br><span class="line">    Q = diagonal_matrix(scale)</span><br><span class="line">    L *= Q</span><br><span class="line">    L = L.BKZ(block_size=<span class="number">25</span>)</span><br><span class="line">    L /= Q</span><br><span class="line"></span><br><span class="line">    answer = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> L:</span><br><span class="line">        <span class="keyword">if</span> row[<span class="number">-2</span>] &lt; <span class="number">0</span>:</span><br><span class="line">            row = -row</span><br><span class="line">        <span class="keyword">if</span> row[<span class="number">-1</span>] == <span class="number">0</span> <span class="keyword">and</span> row[<span class="number">-2</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="comment">#print(row)</span></span><br><span class="line">            <span class="keyword">assert</span> f(*row[:<span class="number">-2</span>]) % M == <span class="number">0</span></span><br><span class="line">            aa = [x + avg <span class="keyword">for</span> x <span class="keyword">in</span> row[:<span class="number">-2</span>]][::<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> bytes(aa).hex() <span class="keyword">not</span> <span class="keyword">in</span> answer:</span><br><span class="line">                answer.append(bytes(aa).hex())</span><br><span class="line">                <span class="keyword">if</span> len(answer) == <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">return</span> answer</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">"04.cr.yp.toc.tf"</span>,<span class="string">"31777"</span>)</span><br><span class="line">sh.recvuntil(<span class="string">"[Q]uit"</span>)</span><br><span class="line">sh.sendline(<span class="string">"S"</span>)</span><br><span class="line"><span class="keyword">for</span> level <span class="keyword">in</span> range(<span class="number">19</span>):</span><br><span class="line">    sh.recvuntil(<span class="string">"vinefruit(m1, "</span>)</span><br><span class="line">    mod = int(sh.recvuntil(<span class="string">","</span>)[:<span class="number">-1</span>])</span><br><span class="line">    answer = attack(mod,level)</span><br><span class="line">    sh.recvuntil(<span class="string">"string: "</span>)</span><br><span class="line">    sh.sendline(answer[<span class="number">0</span>])</span><br><span class="line">    sh.recvuntil(<span class="string">"string: "</span>)</span><br><span class="line">    sh.sendline(answer[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># [DEBUG] Received 0xcd bytes:</span></span><br><span class="line"><span class="comment">#     b'| gj, try the next level :)\n'</span></span><br><span class="line"><span class="comment">#     b'| Submit two different string such that vinefruit(m1, 0, 1) = vinefruit(m2, 0, 1)\n'</span></span><br><span class="line"><span class="comment">#     b'| You are at level: 19\n'</span></span><br><span class="line"><span class="comment">#     b"| Congrats, you got the flag: b'CCTF&#123;fINd1n9_cOlL!s10n_f0r___FNV2___!&#125;'\n"</span></span><br></pre></td></tr></table></figure>

<h3 id="Shevid"><a href="#Shevid" class="headerlink" title="Shevid"></a>Shevid</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_param</span><span class="params">(B)</span>:</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		a = randint(B &gt;&gt; <span class="number">1</span>, B)</span><br><span class="line">		b = randint(B &gt;&gt; <span class="number">2</span>, B &gt;&gt; <span class="number">1</span>)</span><br><span class="line">		p = <span class="number">2</span>**a * <span class="number">3</span>**b - <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> is_prime(p):</span><br><span class="line">			<span class="keyword">return</span> a, b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_dmap</span><span class="params">(E)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> E.isogeny(E.lift_x(ZZ(<span class="number">1</span>)), codomain = E)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_tpt</span><span class="params">(E, a, b)</span>:</span></span><br><span class="line">	P, Q = [((p + <span class="number">1</span>) // <span class="number">2</span>**a) * _ <span class="keyword">for</span> _ <span class="keyword">in</span> E.gens()]</span><br><span class="line">	R, S = [((p + <span class="number">1</span>) // <span class="number">3</span>**b) * _ <span class="keyword">for</span> _ <span class="keyword">in</span> E.gens()]</span><br><span class="line">	<span class="keyword">return</span> P, Q, R, S</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span><span class="params">(EC, b, P, Q, R, S)</span>:</span></span><br><span class="line">	skey = randint(<span class="number">1</span>, <span class="number">3</span>**b)</span><br><span class="line">	T = R + skey * S</span><br><span class="line">	phi = EC.isogeny(T, algorithm = <span class="string">"factored"</span>)</span><br><span class="line">	_phi_dom, _phi_P, _phi_Q = phi.codomain(), phi(P), phi(Q)</span><br><span class="line">	<span class="keyword">return</span> skey, _phi_dom, _phi_P, _phi_Q</span><br><span class="line"></span><br><span class="line">a, b = gen_param(<span class="number">190</span>)</span><br><span class="line">p = <span class="number">2</span>**a * <span class="number">3</span>**b - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">F.&lt;x&gt; = GF(p^<span class="number">2</span>, modulus = x**<span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line">EC = EllipticCurve(F, [<span class="number">0</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line">P, Q, R, S = gen_tpt(EC, a, b)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f'P = <span class="subst">&#123;P.xy()&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'Q = <span class="subst">&#123;Q.xy()&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'R = <span class="subst">&#123;R.xy()&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'S = <span class="subst">&#123;S.xy()&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">skey, _phi_dom, _phi_P, _phi_Q = keygen(EC, b, P, Q, R, S)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f'_phi_dom = <span class="subst">&#123;_phi_dom&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'_phi_P   = <span class="subst">&#123;_phi_P.xy()&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'_phi_Q   = <span class="subst">&#123;_phi_Q.xy()&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">key = md5(long_to_bytes(skey)).digest()</span><br><span class="line">iv = md5(str(skey).encode()).digest()</span><br><span class="line"></span><br><span class="line">cipher = AES.new(key, AES.MODE_CFB, iv=iv)</span><br><span class="line">enc = cipher.encrypt(flag)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f'enc = <span class="subst">&#123;enc.hex()&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>

<p>题目又是基于超椭（超奇异椭圆曲线），参数这边，$p=2^a3^b-1$，根据曲线 phi 给出的 $p$ ，我们能够得到 $a=142,b=69$。然后还给出了 四个点 $P,Q,R,S$ ，其中 $P,Q$ 的阶是 $2^a$，$R,S$ 的阶是 $3^b$</p>
<p>然后随机生成私钥 $skey \in (0,3^b) $，计算 $T = R+skey\times S$ ，并以 T 为核对曲线 $E$ 进行同源映射到曲线 $phi$，随后给出曲线 $phi$，以及给出 $P,Q$ 在曲线 $phi$ 上的象: $phi(P),phi(Q)$</p>
<p>我们需要根据这些信息来恢复 $skey$。</p>
<p>我对超椭同源这块还很陌生，一个初步的想法应该是根据 $phi$ 和 $E$ 能够恢复出核 $T$，然后减去 $R$，求个 $ECDLP$ 得到 $skey$ 。（当然这只是个小白的痴心妄想）</p>
<p>实在不会做，只能踩在巨人的肩膀上了，github上有相关攻击的<a href="https://github.com/GiacomoPope/Castryck-Decru-SageMath.git" target="_blank" rel="noopener">开源代码</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Local imports</span></span><br><span class="line"><span class="keyword">import</span> public_values_aux</span><br><span class="line"><span class="keyword">from</span> public_values_aux <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load Sage files</span></span><br><span class="line">load(<span class="string">'castryck_decru_shortcut.sage'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Baby SIKEp64 parameters</span></span><br><span class="line">a = <span class="number">142</span></span><br><span class="line">b = <span class="number">69</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the prime, finite fields and starting curve</span></span><br><span class="line"><span class="comment"># with known endomorphism</span></span><br><span class="line">p = <span class="number">2</span>^a*<span class="number">3</span>^b - <span class="number">1</span></span><br><span class="line">public_values_aux.p = p</span><br><span class="line"></span><br><span class="line">Fp2.&lt;i&gt; = GF(p^<span class="number">2</span>, modulus=x^<span class="number">2</span>+<span class="number">1</span>)</span><br><span class="line">R.&lt;x&gt; = PolynomialRing(Fp2)</span><br><span class="line"></span><br><span class="line">E_start = EllipticCurve(Fp2, [<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>])</span><br><span class="line">E_start.set_order((p+<span class="number">1</span>)^<span class="number">2</span>) <span class="comment"># Speeds things up in Sage</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generation of the endomorphism 2i</span></span><br><span class="line">two_i = generate_distortion_map(E_start)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate public torsion points, for SIKE implementations</span></span><br><span class="line"><span class="comment"># these are fixed but to save loading in constants we can</span></span><br><span class="line"><span class="comment"># just generate them on the fly</span></span><br><span class="line"><span class="comment"># P2, Q2, P3, Q3 = generate_torsion_points(E_start, a, b)</span></span><br><span class="line">P = (<span class="number">3799366067639160994711391413511701264777392349807255916259320256251336249666</span>*i + <span class="number">633884628131689177031068067897867565283026098415356709331881575255526844055</span>, <span class="number">3967348484864888240941807454988077684669074109524399477973520952727771366997</span>*i + <span class="number">2712354532382043232096058211997452093712477916671679907467703464009558475387</span>)</span><br><span class="line">Q = (<span class="number">560486392227142181240528415381730657098132581407794833013161975335122628946</span>*i + <span class="number">3215971074127995409351672272900519761566156375365764079386358523254177565572</span>, <span class="number">2231746347912007096335360835242707156884468521076802738444724241125548841199</span>*i + <span class="number">1147378568798166954853288670809304301194478550602719730593160186622788033023</span>)</span><br><span class="line">R = (<span class="number">2656280316115888204975052029900945854050191685154131031859911335618240136443</span>*i + <span class="number">1127449111197960889758916770042950976852995868310602942974825430779982061546</span>, <span class="number">3477289737920472771668877366806058236254602770820629911886593813749930497839</span>*i + <span class="number">4646016633241840360901490323351236375375727836768954121794139000985805816564</span>)</span><br><span class="line">S = (<span class="number">2403139149412141532587482679318245468078604585804423116505024414375742701912</span>*i + <span class="number">2772488504607240668919423445309052101443116827322741849326656561794480962717</span>, <span class="number">3356599382898540527962106232860239304405841217130774924490318752448476310798</span>*i + <span class="number">2818004736373436361527915593539097434287090434842750370886675729711731978922</span>)</span><br><span class="line">P2, Q2, P3, Q3 = E_start(P), E_start(Q), E_start(R), E_start(S)</span><br><span class="line"></span><br><span class="line">check_torsion_points(E_start, a, b, P2, Q2, P3, Q3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate Bob's key pair</span></span><br><span class="line"><span class="comment"># bob_private_key, EB, PB, QB = gen_bob_keypair(E_start, b, P2, Q2, P3, Q3)</span></span><br><span class="line">EB = EllipticCurve(Fp2, [<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,(<span class="number">2070374075904221348548347954672740119972290047985052548426161483408084160515</span>*i+<span class="number">896749506444795652787374405713981306103783874504413776724865996633074195878</span>),(<span class="number">2497300913991521538985990865799426081199023429830552981773916386651958830387</span>*i+<span class="number">4243320791854592301388975795466391442631117041175807728844738724691845270777</span>)])</span><br><span class="line">EB.set_order((p+<span class="number">1</span>)**<span class="number">2</span>, num_checks=<span class="number">0</span>)</span><br><span class="line">PB   = EB(<span class="number">76437828586489590038329193939006186966443918785230388533883401536928551274</span>*i + <span class="number">1854701339851606878866613257086348330205980107370562791121360193846610915298</span>, <span class="number">3614996124089236146025194675467338095830005859290616536023140003816221458491</span>*i + <span class="number">1308394538776387115295908857102539180825411698539070801598965381200026966383</span>)</span><br><span class="line">QB   = EB(<span class="number">2350346337927935568113772636838467488287314266120334638991371449749383548230</span>*i + <span class="number">3389994457403704259291228848441313337916860864318549296438418403582347527289</span>, <span class="number">3514523396038039657181009561828298688334341559779027220238590888980836781356</span>*i + <span class="number">1132784636339236588815425424619354807485262558088269015122405460656452137103</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#solution = Integer(bob_private_key).digits(base=3)</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f"Running the attack against Baby SIDHp64 parameters, which has a prime: 2^<span class="subst">&#123;a&#125;</span>*3^<span class="subst">&#123;b&#125;</span> - 1"</span>)</span><br><span class="line"><span class="comment">#print(f"If all goes well then the following digits should be found: &#123;solution&#125;")</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===================================</span></span><br><span class="line"><span class="comment"># =====  ATTACK  ====================</span></span><br><span class="line"><span class="comment"># ===================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RunAttack</span><span class="params">(num_cores)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> CastryckDecruAttack(E_start, P2, Q2, EB, PB, QB, two_i, num_cores=num_cores)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">recovered_key = RunAttack(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Running the attack against Baby SIDHp64 parameters, which has a prime: 2^142*3^69 - 1</span></span><br><span class="line"><span class="comment"># Determination of first 2 ternary digits. We are working with 2^114-torsion.</span></span><br><span class="line"><span class="comment"># Testing digits: [2, 0]</span></span><br><span class="line"><span class="comment"># Testing digits: [1, 0]</span></span><br><span class="line"><span class="comment"># Testing digits: [0, 1]</span></span><br><span class="line"><span class="comment"># Testing digits: [0, 0]</span></span><br><span class="line"><span class="comment"># Testing digits: [0, 2]</span></span><br><span class="line"><span class="comment"># Testing digits: [1, 2]</span></span><br><span class="line"><span class="comment"># Testing digits: [2, 1]</span></span><br><span class="line"><span class="comment"># Testing digits: [1, 1]</span></span><br><span class="line"><span class="comment"># Testing digits: [2, 2]</span></span><br><span class="line"><span class="comment"># Computing image of 3-adic torsion in split factor CB</span></span><br><span class="line"><span class="comment"># Glue-and-split! These are most likely the secret digits.</span></span><br><span class="line"><span class="comment"># Bob's secret key revealed as: 35588822058809282635150734794357</span></span><br><span class="line"><span class="comment"># In ternary, this is: [2, 2, 2, 1, 2, 2, 2, 1, 1, 0, 0, 0, 2, 2, 1, 0, 2, 1, 0, 0, 1, 2, 2, 0, 0, 2, 0, 0, 1, 0, 0, 0, 1, 1, 2, 2, 0, 1, 0, 1, 0, 0, 1, 2, 2, 1, 2, 2, 1, 2, 0, 0, 0, 1, 2, 0, 1, 2, 1, 1, 2, 0, 0, 1, 1, 0, 1]</span></span><br><span class="line"><span class="comment"># Altogether this took 8.304964780807495 seconds.</span></span><br></pre></td></tr></table></figure>

<p>直接获得私钥，然后 AES 解密一下即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">skey = <span class="number">35588822058809282635150734794357</span></span><br><span class="line"></span><br><span class="line">enc = <span class="string">'50d8ed352ccf3ce6d64b25e50ed67b832dcbcd94dcb7dc8293e813e0c83ace541abb61618d5f971ff5d24fab8a2e'</span></span><br><span class="line">enc = bytes.fromhex(enc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = md5(long_to_bytes(skey)).digest()</span><br><span class="line">iv = md5(str(skey).encode()).digest()</span><br><span class="line"></span><br><span class="line">cipher = AES.new(key, AES.MODE_CFB, iv=iv)</span><br><span class="line">flag = cipher.decrypt(enc)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f'flag = <span class="subst">&#123;flag&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag = b'CCTF&#123;3FfiC!En7_k3Y_R3c0vErY_4tTacK_ON_SIDH!!!&#125;'</span></span><br></pre></td></tr></table></figure>

<h2 id="Tough"><a href="#Tough" class="headerlink" title="Tough"></a>Tough</h2><h3 id="Slowsum"><a href="#Slowsum" class="headerlink" title="Slowsum"></a>Slowsum</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">die</span><span class="params">(*args)</span>:</span></span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pr</span><span class="params">(*args)</span>:</span></span><br><span class="line">	s = <span class="string">" "</span>.join(map(str, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">"\n"</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sc</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">slowsum</span><span class="params">(p, n)</span>:</span></span><br><span class="line">	g = <span class="number">0</span></span><br><span class="line">	perms = list(product([<span class="number">0</span>, <span class="number">1</span>], repeat = n))</span><br><span class="line">	<span class="keyword">for</span> _prm <span class="keyword">in</span> perms:</span><br><span class="line">		g += p(_prm)</span><br><span class="line">	<span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">h4sh</span><span class="params">(p, q)</span>:</span></span><br><span class="line">	coeffs = p.coefficients()</span><br><span class="line">	<span class="keyword">return</span> pow(sum(coeffs), (q - <span class="number">1</span>) // <span class="number">2</span> - sum(coeffs), q) </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	border = <span class="string">"|"</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">"Hi all, I have created a basic and rudimentary version of a sumcheck"</span>, border)</span><br><span class="line">	pr(border, <span class="string">"protocol. Your task is to generate a false statement and persuade   "</span>, border)</span><br><span class="line">	pr(border, <span class="string">"verifier of its validity.                                           "</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	</span><br><span class="line">	q = <span class="number">2</span>**<span class="number">61</span> - <span class="number">1</span>  <span class="comment"># Mersenne prime</span></span><br><span class="line">	F = GF(q)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		pr(<span class="string">"| Options: \n|\t[C]laim the statement \n|\t[D]etermine parameters and polynomial \n|\t[Q]uit"</span>)</span><br><span class="line">		ans = sc().decode().lower().strip()</span><br><span class="line">		<span class="keyword">if</span> ans == <span class="string">'d'</span>:</span><br><span class="line">			pr(border, <span class="string">f'Please first send the number of variable and the degree of your desired polynomial:'</span>)</span><br><span class="line">			_ans = sc()</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				_n, _d = [int(_) <span class="keyword">for</span> _ <span class="keyword">in</span> _ans.split(<span class="string">b','</span>)]</span><br><span class="line">				<span class="keyword">if</span> (_n * _d) // q &lt; <span class="number">5e-17</span> <span class="keyword">and</span> _n &gt;= <span class="number">5</span> <span class="keyword">and</span> _d &gt;= <span class="number">3</span>:</span><br><span class="line">					R = PolynomialRing(F, _n, <span class="string">'x'</span>)</span><br><span class="line">					x = R.gens()</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					<span class="keyword">raise</span> Exception()</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				die(border, <span class="string">'The parameters are not consistent! Try again!!'</span>)</span><br><span class="line">			pr(border, <span class="string">f'Now, please send the <span class="subst">&#123;_n&#125;</span>-variable polynomial as p: '</span>)</span><br><span class="line">			_p = sc().strip().decode()</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				_p = R(_p)</span><br><span class="line">				p = _p</span><br><span class="line">				_deg = _p.degree(std_grading=<span class="literal">True</span>)</span><br><span class="line">				<span class="keyword">if</span> _deg != _d:</span><br><span class="line">					<span class="keyword">raise</span> Exception()</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				die(border, <span class="string">'The polynomial is not valid or does not hold true in the given situations!'</span>)</span><br><span class="line">			g = slowsum(_p, _n)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">'c'</span>:</span><br><span class="line">			pr(border, <span class="string">'Please send the g: '</span>)</span><br><span class="line">			_g = sc()</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				_g = int(_g)</span><br><span class="line">				<span class="keyword">if</span> _g == g:</span><br><span class="line">					die(border, <span class="string">'Kidding me?! Bye :P'</span>)</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				die(border, <span class="string">'Some exception occurred! Bye!!'</span>)</span><br><span class="line">			_P, _H = [], []</span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> range(_n):</span><br><span class="line">				pr(border, <span class="string">f'Please send the (p_<span class="subst">&#123;i&#125;</span>, h4sh(p_<span class="subst">&#123;i&#125;</span>, q)): '</span>)</span><br><span class="line">				pr(border, <span class="string">f'Note that the variable of p_<span class="subst">&#123;i&#125;</span> should be x. '</span>)</span><br><span class="line">				_ph = sc().strip()</span><br><span class="line">				<span class="keyword">try</span>:</span><br><span class="line">					_p, _h = [_.decode() <span class="keyword">for</span> _  <span class="keyword">in</span> _ph.split(<span class="string">b','</span>)]</span><br><span class="line">					_R = PolynomialRing(F, <span class="string">'x'</span>)</span><br><span class="line">					_p, _h = _R(_p), F(_h)</span><br><span class="line">					<span class="keyword">if</span> _p.degree() &gt; _d:</span><br><span class="line">						<span class="keyword">raise</span> Exception()</span><br><span class="line">					_P.append(_p)</span><br><span class="line">					_H.append(_h)</span><br><span class="line">				<span class="keyword">except</span>:</span><br><span class="line">					die(border, <span class="string">'Some exception occurred! Bye!!'</span>)</span><br><span class="line">			j = <span class="number">0</span></span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> range(_n):</span><br><span class="line">				<span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">					<span class="keyword">if</span> _P[i](<span class="number">0</span>) + _P[i](<span class="number">1</span>) != _g <span class="keyword">or</span> h4sh(_P[i], q) != _H[i]:</span><br><span class="line">						<span class="keyword">break</span></span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					<span class="keyword">if</span> _P[i](<span class="number">0</span>) + _P[i](<span class="number">1</span>) != _P[i<span class="number">-1</span>](_H[i<span class="number">-1</span>]) <span class="keyword">or</span> h4sh(_P[i], q) != _H[i]:</span><br><span class="line">						<span class="keyword">break</span></span><br><span class="line">				j += <span class="number">1</span></span><br><span class="line">			<span class="keyword">if</span> j &lt; _n <span class="keyword">or</span> p(_H) != _P[_n<span class="number">-1</span>](_H[_n<span class="number">-1</span>]):</span><br><span class="line">				die(border, <span class="string">'Oops, verifier believes that the polynomial is not valid! Bye!!'</span>)</span><br><span class="line">			die(border, <span class="string">f'Congrats, here the flag: <span class="subst">&#123;flag&#125;</span>'</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">'q'</span>:</span><br><span class="line">			die(border, <span class="string">'Quitting...'</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">'You should select valid choice!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>

<p>这道题的流程看起来比较复杂冗长，我们一点点走下来。</p>
<p>首先看到 <code>[D]etermine parameters and polynomial</code>：我们需要给服务提供一个多项式，不过在此之前，我们要先如果这个多项式的变量数量和度（degree)，其中，需要满足 <code>if (_n * _d) // q &lt; 5e-17 and _n &gt;= 5 and _d &gt;= 3:</code>，那么我们这里就先设定 $n=5,d=3$ ，然后我们给出的多项式为 <code>x0^3</code> (他好像只判断了最高次，并没有判断变量数量，所以方便起见，我们先给一项，往后看看先)，然后执行 <code>g = slowsum(_p, _n)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">slowsum</span><span class="params">(p, n)</span>:</span></span><br><span class="line">	g = <span class="number">0</span></span><br><span class="line">	perms = list(product([<span class="number">0</span>, <span class="number">1</span>], repeat = n))</span><br><span class="line">	<span class="keyword">for</span> _prm <span class="keyword">in</span> perms:</span><br><span class="line">		g += p(_prm)</span><br><span class="line">	<span class="keyword">return</span> g</span><br></pre></td></tr></table></figure>

<p>slowsum 会让每个变量都遍历一遍 0，1 然后相加。由于这里我们的多项式只有一个变量，因此求和结果应该是 $g=2^4 = 16$</p>
<p>然后我们看到 <code>[C]laim the statement</code>：我们先给一个不等于前面 $g$ 的值 $_g$ （我们可以给个 <code>0</code> 先），</p>
<p>然后要给 $n=5$ 对单项式和值 <code>p_{i}, h4sh(p_{i}, q)</code>，（我们可以给5个 <code>x^3,1</code> 先）</p>
<p>接下来要过几个判断：</p>
<p>当 $i=0$ , 对于每个单项式 $p(x)$，都要有 $p_0(0)+p_0(1)=_g$ 以及 <code>h4sh(_P[i], q) = _H[i]</code> ，后面这部分我们只要按照它的要求生成 即可，前面这部分，我们把前面的设成 $_g=1$ 好了。</p>
<p>当 $i\gt0$，对于每个单项式 $p(x)$，都要有 $p_i(0)+p_i(1)=p_{i-1}(H_{i-1})$ 以及 <code>h4sh(_P[i], q) = _H[i]</code> ，好像这个我们能过，因为 $H_{i-1}$ 一直是 1，$p_i(0)=0$，</p>
<p>最后，要求 <code>p(_H) == _P[_n-1](_H[_n-1])</code>，对于我们这就是 $1^3=p_4(1)=1$，好像也能过。验证一下，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><br><span class="line">| Hi all, I have created a basic <span class="keyword">and</span> rudimentary version of a sumcheck |</span><br><span class="line">| protocol. Your task <span class="keyword">is</span> to generate a false statement <span class="keyword">and</span> persuade    |</span><br><span class="line">| verifier of its validity.                                            |</span><br><span class="line">||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><br><span class="line">| Options: </span><br><span class="line">|       [C]laim the statement </span><br><span class="line">|       [D]etermine parameters <span class="keyword">and</span> polynomial </span><br><span class="line">|       [Q]uit</span><br><span class="line">d</span><br><span class="line">| Please first send the number of variable <span class="keyword">and</span> the degree of your desired polynomial:</span><br><span class="line"><span class="number">5</span>,<span class="number">3</span></span><br><span class="line">| Now, please send the <span class="number">5</span>-variable polynomial <span class="keyword">as</span> p: </span><br><span class="line">x0^<span class="number">3</span></span><br><span class="line">| Options: </span><br><span class="line">|       [C]laim the statement </span><br><span class="line">|       [D]etermine parameters <span class="keyword">and</span> polynomial </span><br><span class="line">|       [Q]uit</span><br><span class="line">c</span><br><span class="line">| Please send the g: </span><br><span class="line"><span class="number">1</span></span><br><span class="line">| Please send the (p_0, h4sh(p_0, q)): </span><br><span class="line">| Note that the variable of p_0 should be x. </span><br><span class="line">x^<span class="number">3</span>,<span class="number">1</span></span><br><span class="line">| Please send the (p_1, h4sh(p_1, q)): </span><br><span class="line">| Note that the variable of p_1 should be x. </span><br><span class="line">x^<span class="number">3</span>,<span class="number">1</span></span><br><span class="line">| Please send the (p_2, h4sh(p_2, q)): </span><br><span class="line">| Note that the variable of p_2 should be x. </span><br><span class="line">x^<span class="number">3</span>,<span class="number">1</span></span><br><span class="line">| Please send the (p_3, h4sh(p_3, q)): </span><br><span class="line">| Note that the variable of p_3 should be x. </span><br><span class="line">x^<span class="number">3</span>,<span class="number">1</span></span><br><span class="line">| Please send the (p_4, h4sh(p_4, q)): </span><br><span class="line">| Note that the variable of p_4 should be x. </span><br><span class="line">x^<span class="number">3</span>,<span class="number">1</span></span><br><span class="line">| Congrats, here the flag: <span class="string">b'CCTF&#123;Rem3Mb3er_tH4t_F14t_5h4m1r_tR4nsf0rm4tiOn_n33Ds_A_g00D_r4Nd0m_Or4cLe!&#125;'</span></span><br></pre></td></tr></table></figure>

<p>唔？这是 Tough？非预期啦？还是 Tough 在题目有点绕？</p>
<h3 id="ASIv2"><a href="#ASIv2" class="headerlink" title="ASIv2"></a>ASIv2</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base</span><span class="params">(n, l)</span>:</span></span><br><span class="line">    D = []</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        n, r = divmod(n, l)</span><br><span class="line">        D.append(r)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(str(d) <span class="keyword">for</span> d <span class="keyword">in</span> reversed(D)) <span class="keyword">or</span> <span class="string">'0'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">asiv_prng</span><span class="params">(seed)</span>:</span></span><br><span class="line">	l = len(seed)</span><br><span class="line">	_seed = base(bytes_to_long(seed), <span class="number">3</span>)</span><br><span class="line">	_l = len(_seed)</span><br><span class="line">	R = [[getRandomRange(<span class="number">0</span>, <span class="number">3</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(_l)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(_l**<span class="number">2</span>)]</span><br><span class="line">	S = []</span><br><span class="line">	<span class="keyword">for</span> r <span class="keyword">in</span> R:</span><br><span class="line">		s = <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> _ <span class="keyword">in</span> range(_l):</span><br><span class="line">			b = ((int(r[_]) + int(_seed[_])) % <span class="number">3</span>) % <span class="number">2</span></span><br><span class="line">			s = s ^ b</span><br><span class="line">		S.append(s)</span><br><span class="line">	print(len(S))</span><br><span class="line">	<span class="keyword">return</span> R, S</span><br><span class="line"></span><br><span class="line">seed = flag.lstrip(<span class="string">b'CCTF&#123;'</span>).rstrip(<span class="string">b'&#125;'</span>)</span><br><span class="line">R, S = asiv_prng(seed)</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'output.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">f.write(<span class="string">f'R = <span class="subst">&#123;R&#125;</span>\nS = <span class="subst">&#123;S&#125;</span>'</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<p>ASIv1 的升级版，区别在于，</p>
<p>前者是 $S_1 \equiv \sum_{i=0}^n r_i \cdot s_i \pmod 3$，</p>
<p>现在是 $S_2\equiv \oplus _{i=0}^{n}(((r_i+s_i) \mod 3) \mod 2)$</p>
<p>我们知道，在$\mod 2$ 下，异或和相加是一样的，所以 $S_2$ 可以改为 $S_2\equiv \sum _{i=0}^{n}((r_i+s_i) \mod 3) \mod 2$，但这两次模该怎么处理呢？</p>
<p>我们列一个真值表</p>
<table>
<thead>
<tr>
<th align="center">r</th>
<th align="center">s</th>
<th align="center">r+s</th>
<th align="center">mod 3</th>
<th align="center">mod 2</th>
<th align="center">(mod 3)  mod 2</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
</tbody></table>
<p>因此如果 $r_i+s_i$ 的分布相对均匀的话，那么 $b$ 为 $1$ 的概率应该是 $1/3$，$b$ 为 $0$ 的概率应该是 $2/3$。（然并卵）我们需要的是找到一个线性表达式来表示 $seed,R,S$，即我们需要找到一个线性映射，满足</p>
<table>
<thead>
<tr>
<th align="center">r</th>
<th align="center">s</th>
<th align="center">o</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
</tbody></table>
<p>我们考虑用向量来表示 $r,s$，例如，$f_r(0) \to (1,0,0)$，$f_s(0) \to (1,0,0)$，这样 $f_r(0) \cdot f_s(0) = 1$，不行不行，调整一下，$f_s(0)=(0,1,0)$，这样就能有 $f_r(0)\cdot f_s(0)=1$。以此类推，我们有<br>$$<br>f_r(0) \to (1,0,0),f_r(1) \to (0,1,0),f_r(2) \to (0,0,1)<br>$$</p>
<p>$$<br>f_s(0) \to (0,1,0),f_s(1) \to (1,0,0),f_s(2) \to (0,0,1)<br>$$</p>
<p>这样我们就有 $((r_i+s_i) \mod 3) \mod 2 \equiv  f_r(r) \cdot f_s(s) \pmod 2$，就是线性的了！</p>
<p>于是我们有 $S_2 \equiv \sum_{i=0}^n f_r(r)\cdot f_s(s) \pmod 2$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f_r</span><span class="params">(r)</span>:</span></span><br><span class="line">	fr = []</span><br><span class="line">	mapping_r = &#123;<span class="number">0</span>:[<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],<span class="number">1</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>],<span class="number">2</span>:[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>]&#125;</span><br><span class="line">	<span class="keyword">for</span> each <span class="keyword">in</span> r:</span><br><span class="line">		t = []</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> each:</span><br><span class="line">			t+=mapping_r[i]</span><br><span class="line">		fr.append(t)</span><br><span class="line">	<span class="keyword">return</span> fr</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"output.txt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">	data = f.read().split(<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line">R = eval(data[<span class="number">0</span>][<span class="number">4</span>:])</span><br><span class="line">S = eval(data[<span class="number">1</span>][<span class="number">4</span>:])</span><br><span class="line">FR = f_r(R)</span><br><span class="line">RR = matrix(Zmod(<span class="number">2</span>),FR[:<span class="number">375</span>])</span><br><span class="line">SS = vector(Zmod(<span class="number">2</span>),S[:<span class="number">375</span>])</span><br><span class="line">mm = RR.solve_right(SS)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(mm),<span class="number">3</span>):</span><br><span class="line">    print(mm[i:i+<span class="number">3</span>])</span><br><span class="line">	print(mapping_s_inv[tuple(mm[i:i+<span class="number">3</span>])])</span><br><span class="line"></span><br><span class="line">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>在我们解密后打算将明文向量逆映射回去，此时发现会有向量 $(1,1,0)$ 出现，这在我们的映射关系中是非法的（找不到原象），但是对于向量内积来说是合理的。因此我们需要额外考虑一下这个向量还可以由哪个值映射过来。这里暴力一点就是直接莽，en试，于是</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mapping_s_inv = &#123;(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>):<span class="string">"1"</span>,(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>):<span class="string">"0"</span>,(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>):<span class="string">"2"</span>,(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>):<span class="string">"2"</span>&#125;</span><br><span class="line"></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(mm),<span class="number">3</span>):</span><br><span class="line">	flag += (mapping_s_inv[tuple(mm[i:i+<span class="number">3</span>])])</span><br><span class="line"></span><br><span class="line">flag = int(flag,<span class="number">3</span>)</span><br><span class="line">print(long_to_bytes(flag))</span><br><span class="line"></span><br><span class="line"><span class="string">b'4n0Th3R_47tACkER_!n_Vi5A!'</span></span><br></pre></td></tr></table></figure>

<p>（PS：测完发现，$(1,1,0)$ 和 $(0,0,1)$ 是各位取反，因此可以大胆猜测一下，$(0,0,1) \to 1,(1,1,0) \to 0$）</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可联系QQ 643713081，也可以邮件至 643713081@qq.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>2023 CryptoCTF</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">16.5k</span></p>
    <p><span class="copy-title">本文作者:</span><a  title="Van1sh">Van1sh</a></p>
    <p><span class="copy-title">发布时间:</span>2023-08-14, 00:00:00</p>
    <p><span class="copy-title">最后更新:</span>2023-08-14, 20:34:35</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2023/08/14/2023 CCTF/" title="2023 CryptoCTF">http://jayxv.github.io/2023/08/14/2023 CCTF/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>





    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<input type="hidden" id="MathJax-js"
        value="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</input>
    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2020 Van1sh</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['@Van1sh','@FzWjScJ','#Write Up','#docker','#Sage','#CTF','#ECC','#Paillier','#Crypto','#TLS 1.2','#Web','#Files','#Serialization','#Basic','#Lattice','#Dsa','#LCG','#Rc4','#SM4','#Knapsack','#DES','#差分密码分析','#Rsa','#RE','#continued_fraction','#paper','#small private exponent','#SQL','#python','#操作模式','#number theory','#Abstract algebra','#SPN','#线性密码分析','#ETH','#Shadowsocks','#Nmap','#XSS','#Coppersmith’s Method','#Linux','#book',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
